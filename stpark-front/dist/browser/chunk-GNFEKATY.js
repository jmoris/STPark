import{a as Z}from"./chunk-6AGRNQTD.js";import{a as st}from"./chunk-J2G3Y6LG.js";import{a as Q,c as Y}from"./chunk-ICPS6N2F.js";import{a as tt,b as it,c as nt,d as G,e as rt,f as at,g as ot}from"./chunk-TU7IT4N6.js";import{a as He,b as qe,c as We,d as Ge,e as Qe,f as Ye,g as Je,h as Ke,i as Xe,j as Ze,k as et}from"./chunk-Y6UNS2UZ.js";import{a as J,c as K,f as X}from"./chunk-N7KP3IEB.js";import"./chunk-KEI4KRBM.js";import{a as q,b as Le}from"./chunk-FSRW5HPF.js";import{a as ge,b as he,c as xe,e as Ce,f as be,g as Ee,h as k}from"./chunk-65NYBKEE.js";import{a as we,b as Fe,c as ke,d as De}from"./chunk-IDWAZBHT.js";import{a as ye,b as Ie}from"./chunk-FSA3IEFI.js";import{b as W}from"./chunk-POSCZER2.js";import"./chunk-ECYJLMJT.js";import{a as Te}from"./chunk-VKB6BRO6.js";import{a as Oe,b as ze}from"./chunk-RDXEG6SZ.js";import{b as N,c as j}from"./chunk-IMRKXFOQ.js";import{d as L,e as O}from"./chunk-5Q7CCL6V.js";import{a as z,b as H}from"./chunk-CWSZZ2DY.js";import{b as D,c as Se,d as ve,e as Me,j as A,k as B}from"./chunk-K3BNOLHS.js";import{A as $e,b as P,d as v,f as $,g as Ae,j as Be,k as Ve,n as Re,q as Ne,x as je,z as Pe}from"./chunk-ZTFUS4RN.js";import{la as V,na as Ue,oa as R}from"./chunk-QQQ5XT6I.js";import"./chunk-YXFY4UXK.js";import{d as _e}from"./chunk-EARUC3FY.js";import{l as fe,m as w,s as F}from"./chunk-BAM5RHC5.js";import{$b as f,Eb as m,Gb as le,Pb as r,Qb as i,Rb as h,Sb as b,Tb as E,U as M,Vb as U,_ as oe,bb as s,bc as u,cb as g,da as se,f as y,fc as me,gc as de,hc as ce,lc as pe,mc as o,nc as _,oa as x,oc as S,pa as C,pb as I,rc as ie,sc as ne,tc as re,uc as ue,wb as c}from"./chunk-MLNNMN4J.js";import{a as ae}from"./chunk-TSRGIXR5.js";var ee=(()=>{class t{constructor(e){this.http=e,this.baseUrl=`${Te.authApiUrl}/api/central-admin/users`}getUsers(e={}){return this.http.get(this.baseUrl,{params:e})}getUser(e){return this.http.get(`${this.baseUrl}/${e}`)}createUser(e){return this.http.post(this.baseUrl,e)}updateUser(e,n){return this.http.put(`${this.baseUrl}/${e}`,n)}deleteUser(e){return this.http.delete(`${this.baseUrl}/${e}`)}assignToTenants(e,n){return this.http.post(`${this.baseUrl}/${e}/assign-tenants`,{tenant_ids:n})}removeFromTenants(e,n){return this.http.post(`${this.baseUrl}/${e}/remove-tenants`,{tenant_ids:n})}static{this.\u0275fac=function(n){return new(n||t)(se(_e))}}static{this.\u0275prov=oe({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function St(t,l){t&1&&(r(0,"span"),o(1,"Asignar Usuario a Estacionamientos"),i())}function vt(t,l){if(t&1&&(r(0,"span"),o(1),i()),t&2){let e=u();s(),_(e.data.isEdit?"Editar Usuario":"Nuevo Usuario")}}function Mt(t,l){t&1&&(r(0,"mat-error"),o(1," El nombre es requerido "),i())}function Ut(t,l){t&1&&(r(0,"mat-error"),o(1," Debe tener al menos 2 caracteres "),i())}function Tt(t,l){t&1&&(r(0,"mat-error"),o(1," El email es requerido "),i())}function yt(t,l){t&1&&(r(0,"mat-error"),o(1," Formato de email inv\xE1lido "),i())}function It(t,l){t&1&&(r(0,"mat-error"),o(1," La contrase\xF1a es requerida "),i())}function wt(t,l){t&1&&(r(0,"mat-error"),o(1," La contrase\xF1a debe tener al menos 6 caracteres "),i())}function Ft(t,l){if(t&1&&(r(0,"mat-form-field",13)(1,"mat-label"),o(2,"Contrase\xF1a"),i(),h(3,"input",22),r(4,"mat-icon",15),o(5,"lock"),i(),c(6,It,2,0,"mat-error",2)(7,wt,2,0,"mat-error",2),i()),t&2){let e,n,a=u(2);s(6),m("ngIf",(e=a.userForm.get("password"))==null?null:e.hasError("required")),s(),m("ngIf",(n=a.userForm.get("password"))==null?null:n.hasError("minlength"))}}function kt(t,l){t&1&&(r(0,"mat-error"),o(1," La contrase\xF1a debe tener al menos 6 caracteres "),i())}function Dt(t,l){if(t&1&&(r(0,"mat-form-field",13)(1,"mat-label"),o(2,"Nueva Contrase\xF1a (opcional)"),i(),h(3,"input",23),r(4,"mat-icon",15),o(5,"lock"),i(),r(6,"mat-hint"),o(7,"Deje vac\xEDo si no desea cambiar la contrase\xF1a"),i(),c(8,kt,2,0,"mat-error",2),i()),t&2){let e,n=u(2);s(8),m("ngIf",(e=n.userForm.get("password"))==null?null:e.hasError("minlength"))}}function At(t,l){if(t&1&&(r(0,"form",9)(1,"div",10)(2,"h3",11),o(3,"Informaci\xF3n del Usuario"),i(),r(4,"div",12)(5,"mat-form-field",13)(6,"mat-label"),o(7,"Nombre"),i(),h(8,"input",14),r(9,"mat-icon",15),o(10,"person"),i(),c(11,Mt,2,0,"mat-error",2)(12,Ut,2,0,"mat-error",2),i(),r(13,"mat-form-field",13)(14,"mat-label"),o(15,"Email"),i(),h(16,"input",16),r(17,"mat-icon",15),o(18,"email"),i(),c(19,Tt,2,0,"mat-error",2)(20,yt,2,0,"mat-error",2),i()(),c(21,Ft,8,2,"mat-form-field",17)(22,Dt,9,1,"mat-form-field",17),r(23,"div",18)(24,"mat-checkbox",19)(25,"span",20),o(26,"Administrador Central"),i()(),r(27,"mat-icon",21),o(28,"info"),i()()()()),t&2){let e,n,a,d,p=u();m("formGroup",p.userForm),s(11),m("ngIf",(e=p.userForm.get("name"))==null?null:e.hasError("required")),s(),m("ngIf",(n=p.userForm.get("name"))==null?null:n.hasError("minlength")),s(7),m("ngIf",(a=p.userForm.get("email"))==null?null:a.hasError("required")),s(),m("ngIf",(d=p.userForm.get("email"))==null?null:d.hasError("email")),s(),m("ngIf",!p.data.isEdit),s(),m("ngIf",p.data.isEdit),s(5),m("matTooltip","Concede permisos de administraci\xF3n central al usuario")}}function Bt(t,l){t&1&&(r(0,"mat-icon",35),o(1,"check_circle"),i())}function Vt(t,l){t&1&&(r(0,"mat-icon",36),o(1,"radio_button_unchecked"),i())}function Rt(t,l){if(t&1){let e=U();r(0,"mat-card",28),f("click",function(){let a=x(e).$implicit,d=u(2);return C(d.toggleTenant(a))}),r(1,"mat-card-content",29)(2,"div",30)(3,"div")(4,"h4",31),o(5),i(),r(6,"p",32),o(7),i()(),c(8,Bt,2,0,"mat-icon",33)(9,Vt,2,0,"mat-icon",34),i()()()}if(t&2){let e=l.$implicit,n=u(2);le("bg-blue-50",n.isTenantSelected(e))("border-blue-500",n.isTenantSelected(e)),s(5),_(e.name||e.id),s(2),S("ID: ",e.id,""),s(),m("ngIf",n.isTenantSelected(e)),s(),m("ngIf",!n.isTenantSelected(e))}}function Nt(t,l){if(t&1&&(r(0,"mat-chip",41),o(1),i()),t&2){let e=l.$implicit;s(),S(" ",e.name||e.id," ")}}function jt(t,l){if(t&1&&(r(0,"div",37)(1,"h4",38),o(2),i(),r(3,"div",39),c(4,Nt,2,1,"mat-chip",40),i()()),t&2){let e=u(2);s(2),S("Estacionamientos seleccionados (",e.selectedTenants.length,"):"),s(2),m("ngForOf",e.selectedTenants)}}function Pt(t,l){if(t&1&&(r(0,"div",10)(1,"h3",11),o(2,"Seleccionar Estacionamientos"),i(),r(3,"p",24),o(4,"Seleccione los estacionamientos a los que desea asignar al usuario "),r(5,"strong"),o(6),i()(),r(7,"div",25),c(8,Rt,10,8,"mat-card",26),i(),c(9,jt,5,2,"div",27),i()),t&2){let e=u();s(6),_(e.data.user==null?null:e.data.user.name),s(2),m("ngForOf",e.tenants),s(),m("ngIf",e.selectedTenants.length>0)}}function $t(t,l){t&1&&h(0,"mat-spinner",42)}function Lt(t,l){t&1&&(r(0,"span"),o(1,"Asignar"),i())}function Ot(t,l){if(t&1&&(r(0,"span"),o(1),i()),t&2){let e=u(2);s(),_(e.data.isEdit?"Actualizar":"Crear")}}function zt(t,l){if(t&1&&(r(0,"span"),c(1,Lt,2,0,"span",2)(2,Ot,2,1,"span",2),i()),t&2){let e=u();s(),m("ngIf",e.data.showTenantAssignment),s(),m("ngIf",!e.data.showTenantAssignment)}}function Ht(t,l){t&1&&(r(0,"span"),o(1,"Procesando..."),i())}var te=(()=>{class t{constructor(e,n,a,d,p,T){this.fb=e,this.dialogRef=n,this.data=a,this.userService=d,this.tenantService=p,this.snackBar=T,this.loading=!1,this.tenants=[],this.selectedTenants=[],this._unsubscribeAll=new y}ngOnInit(){this.userForm=this.createForm(),this.data.isEdit&&this.data.user&&setTimeout(()=>{this.loadUserData()},50),this.data.showTenantAssignment&&this.data.user?(this.loadTenants(),this.loadUserTenants()):this.data.showTenantAssignment||this.loadTenants()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}createForm(){let e=this.data.isEdit,n={name:["",[v.required,v.minLength(2)]],email:["",[v.required,v.email]],password:["",e?[]:[v.required,v.minLength(6)]],is_central_admin:[!1]};return this.fb.group(n)}loadUserData(){if(this.data.user){let e={name:this.data.user.name||"",email:this.data.user.email||"",is_central_admin:this.data.user.is_central_admin||!1};this.userForm.patchValue(e,{emitEvent:!1})}}loadTenants(){this.tenantService.getTenants({per_page:100}).pipe(M(this._unsubscribeAll)).subscribe({next:e=>{this.tenants=e.data?.data||[]},error:e=>{console.error("Error loading tenants:",e)}})}loadUserTenants(){this.data.user&&this.data.user.id&&this.userService.getUser(this.data.user.id).pipe(M(this._unsubscribeAll)).subscribe({next:e=>{let n=e.data;n.tenants&&(this.selectedTenants=n.tenants.map(a=>({id:a.id,name:a.name})))},error:e=>{console.error("Error loading user tenants:",e)}})}getErrorMessage(e){let n=this.userForm.get(e);return n?.hasError("required")?"Este campo es requerido":n?.hasError("minlength")?e==="password"?"La contrase\xF1a debe tener al menos 6 caracteres":"Debe tener al menos 2 caracteres":n?.hasError("email")?"Formato de email inv\xE1lido":"Campo inv\xE1lido"}toggleTenant(e){let n=this.selectedTenants.findIndex(a=>a.id===e.id);n>=0?this.selectedTenants.splice(n,1):this.selectedTenants.push(e)}isTenantSelected(e){return this.selectedTenants.some(n=>n.id===e.id)}onSubmit(){if(this.data.showTenantAssignment&&this.data.user){if(this.selectedTenants.length===0){this.snackBar.open("Debe seleccionar al menos un estacionamiento","Cerrar",{duration:3e3});return}this.loading=!0;let e=this.selectedTenants.map(n=>n.id);this.userService.assignToTenants(this.data.user.id,e).subscribe({next:n=>{this.loading=!1,this.snackBar.open("Usuario asignado a estacionamiento(s) exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:n=>{this.loading=!1,console.error("Error assigning user to tenants:",n);let a=n.error?.message||"Error al asignar usuario a estacionamiento(s)";this.snackBar.open(a,"Cerrar",{duration:5e3})}})}else if(this.userForm.valid){this.loading=!0;let e=this.userForm.value;if(this.data.isEdit&&this.data.user){let n={name:e.name.trim(),email:e.email.trim().toLowerCase(),is_central_admin:e.is_central_admin||!1};e.password&&e.password.trim()&&(n.password=e.password),this.userService.updateUser(this.data.user.id,n).subscribe({next:a=>{this.loading=!1,this.snackBar.open("Usuario actualizado exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:a=>{this.loading=!1,console.error("Error updating user:",a);let d=a.error?.message||"Error al actualizar usuario";this.snackBar.open(d,"Cerrar",{duration:5e3})}})}else{let n={name:e.name.trim(),email:e.email.trim().toLowerCase(),password:e.password,is_central_admin:e.is_central_admin||!1};this.userService.createUser(n).subscribe({next:a=>{this.loading=!1,this.snackBar.open("Usuario creado exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:a=>{this.loading=!1,console.error("Error creating user:",a);let d=a.error?.message||"Error al crear usuario";this.snackBar.open(d,"Cerrar",{duration:5e3})}})}}else this.userForm.markAllAsTouched()}onCancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(n){return new(n||t)(g(je),g(ge),g(he),g(ee),g(Z),g(q))}}static{this.\u0275cmp=I({type:t,selectors:[["app-user-form"]],decls:15,vars:10,consts:[["mat-dialog-title",""],[1,"mr-2"],[4,"ngIf"],["class","space-y-4",3,"formGroup",4,"ngIf"],["class","mb-6",4,"ngIf"],["align","end",1,"p-4"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20","class","inline-block mr-2",4,"ngIf"],[1,"space-y-4",3,"formGroup"],[1,"mb-6"],[1,"text-lg","font-semibold","mb-4","text-gray-700"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Nombre completo"],["matPrefix",""],["matInput","","type","email","formControlName","email","placeholder","usuario@ejemplo.com"],["appearance","outline","class","w-full",4,"ngIf"],[1,"flex","items-center","mt-4"],["formControlName","is_central_admin"],[1,"ml-2"],[1,"ml-2","text-gray-500",3,"matTooltip"],["matInput","","type","password","formControlName","password","placeholder","M\xEDnimo 6 caracteres"],["matInput","","type","password","formControlName","password","placeholder","Dejar vac\xEDo para mantener la actual"],[1,"text-gray-600","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","max-h-96","overflow-y-auto"],["class","cursor-pointer border-2 transition-colors",3,"bg-blue-50","border-blue-500","click",4,"ngFor","ngForOf"],["class","mt-4",4,"ngIf"],[1,"cursor-pointer","border-2","transition-colors",3,"click"],[1,"p-4"],[1,"flex","items-center","justify-between"],[1,"font-semibold"],[1,"text-sm","text-gray-600"],["class","text-blue-600",4,"ngIf"],["class","text-gray-400",4,"ngIf"],[1,"text-blue-600"],[1,"text-gray-400"],[1,"mt-4"],[1,"text-sm","font-semibold","mb-2"],[1,"flex","flex-wrap","gap-2"],["class","bg-blue-100 text-blue-800",4,"ngFor","ngForOf"],[1,"bg-blue-100","text-blue-800"],["diameter","20",1,"inline-block","mr-2"]],template:function(n,a){n&1&&(r(0,"h2",0)(1,"mat-icon",1),o(2),i(),c(3,St,2,0,"span",2)(4,vt,2,1,"span",2),i(),r(5,"mat-dialog-content"),c(6,At,29,8,"form",3)(7,Pt,10,3,"div",4),i(),r(8,"mat-dialog-actions",5)(9,"button",6),f("click",function(){return a.onCancel()}),o(10," Cancelar "),i(),r(11,"button",7),f("click",function(){return a.onSubmit()}),c(12,$t,1,0,"mat-spinner",8)(13,zt,3,2,"span",2)(14,Ht,2,0,"span",2),i()()),n&2&&(s(2),_(a.data.showTenantAssignment?"local_parking":"person"),s(),m("ngIf",a.data.showTenantAssignment),s(),m("ngIf",!a.data.showTenantAssignment),s(2),m("ngIf",!a.data.showTenantAssignment),s(),m("ngIf",a.data.showTenantAssignment),s(2),m("disabled",a.loading),s(2),m("disabled",a.loading||!a.data.showTenantAssignment&&a.userForm.invalid),s(),m("ngIf",a.loading),s(),m("ngIf",!a.loading),s(),m("ngIf",a.loading))},dependencies:[F,fe,w,$e,Ve,P,$,Ae,Re,Ne,k,Ce,Ee,be,B,A,D,ve,Se,Me,O,L,R,V,j,N,W,H,z,ze,Oe,Y,Q,Ie,ye,X,J,K],encapsulation:2})}}return t})();function qt(t,l){t&1&&(r(0,"th",48),o(1,"ID"),i())}function Wt(t,l){if(t&1&&(r(0,"td",49)(1,"div",50)(2,"mat-icon",51),o(3,"tag"),i(),r(4,"span",52),o(5),i()()()),t&2){let e=l.$implicit;s(5),_(e.id)}}function Gt(t,l){t&1&&(r(0,"th",53),o(1,"Nombre"),i())}function Qt(t,l){if(t&1&&(r(0,"td",49)(1,"span",54),o(2),i()()),t&2){let e=l.$implicit;s(2),_(e.name)}}function Yt(t,l){t&1&&(r(0,"th",55),o(1,"Email"),i())}function Jt(t,l){if(t&1&&(r(0,"td",49)(1,"span",4),o(2),i()()),t&2){let e=l.$implicit;s(2),_(e.email)}}function Kt(t,l){t&1&&(r(0,"th",56),o(1,"Administrador Central"),i())}function Xt(t,l){t&1&&(r(0,"mat-chip",59)(1,"mat-icon",60),o(2,"admin_panel_settings"),i(),o(3," S\xED "),i())}function Zt(t,l){t&1&&(r(0,"span",61),o(1,"No"),i())}function ei(t,l){if(t&1&&(r(0,"td",49),c(1,Xt,4,0,"mat-chip",57)(2,Zt,2,0,"span",58),i()),t&2){let e=l.$implicit;s(),m("ngIf",e.is_central_admin),s(),m("ngIf",!e.is_central_admin)}}function ti(t,l){t&1&&(r(0,"th",62),o(1,"Estacionamientos"),i())}function ii(t,l){if(t&1&&(r(0,"td",49)(1,"div",50)(2,"mat-icon",63),o(3,"local_parking"),i(),r(4,"span",64),o(5),i()()()),t&2){let e=l.$implicit;s(5),_(e.tenants_count||0)}}function ni(t,l){t&1&&(r(0,"th",65),o(1,"Fecha de Registro"),i())}function ri(t,l){if(t&1&&(r(0,"td",49)(1,"span",4),o(2),i()()),t&2){let e=l.$implicit,n=u();s(2),_(n.formatDate(e.created_at))}}function ai(t,l){t&1&&(r(0,"th",56),o(1,"Acciones"),i())}function oi(t,l){if(t&1){let e=U();r(0,"td",49)(1,"button",66)(2,"mat-icon"),o(3,"more_vert"),i()(),r(4,"mat-menu",null,0)(6,"button",67),f("click",function(){let a=x(e).$implicit,d=u();return C(d.viewUser(a))}),r(7,"mat-icon"),o(8,"visibility"),i(),o(9," Ver detalles "),i(),r(10,"button",67),f("click",function(){let a=x(e).$implicit,d=u();return C(d.editUser(a))}),r(11,"mat-icon"),o(12,"edit"),i(),o(13," Editar "),i(),r(14,"button",67),f("click",function(){let a=x(e).$implicit,d=u();return C(d.assignToTenants(a))}),r(15,"mat-icon"),o(16,"local_parking"),i(),o(17," Asignar a estacionamiento "),i(),r(18,"button",68),f("click",function(){let a=x(e).$implicit,d=u();return C(d.deleteUser(a))}),r(19,"mat-icon"),o(20,"delete"),i(),o(21," Eliminar "),i()()()}if(t&2){let e=pe(5);s(),m("matMenuTriggerFor",e)}}function si(t,l){t&1&&h(0,"tr",69)}function li(t,l){t&1&&h(0,"tr",70)}function mi(t,l){t&1&&(r(0,"div",71),h(1,"mat-spinner",72),i())}function di(t,l){t&1&&(r(0,"div",73)(1,"mat-icon",74),o(2,"people"),i(),r(3,"h3",75),o(4,"No hay usuarios registrados"),i(),r(5,"p",51),o(6,"Los usuarios aparecer\xE1n aqu\xED cuando se registren."),i()())}function ci(t,l){if(t&1){let e=U();r(0,"mat-paginator",76),f("page",function(a){x(e);let d=u();return C(d.onPageChange(a))}),i()}if(t&2){let e=u();m("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}var tn=(()=>{class t{constructor(e,n,a,d){this.userService=e,this.tenantService=n,this.dialog=a,this.snackBar=d,this._unsubscribeAll=new y,this.users=[],this.loading=!1,this.displayedColumns=["id","name","email","is_central_admin","tenants_count","created_at","actions"],this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.sortBy="created_at",this.sortOrder="desc",this.filters={name:"",email:""}}ngOnInit(){this.loadUsers()}ngAfterViewInit(){this.sort&&this.sort.sortChange.pipe(M(this._unsubscribeAll)).subscribe(e=>{this.sortBy=e.active,this.sortOrder=e.direction==="asc"?"asc":"desc",this.currentPage=0,this.loadUsers()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadUsers(){this.loading=!0;let e=ae({page:this.currentPage+1,per_page:this.pageSize,sort_by:this.sortBy,sort_order:this.sortOrder},this.filters);this.userService.getUsers(e).pipe(M(this._unsubscribeAll)).subscribe({next:n=>{this.users=n.data?.data||[],this.totalItems=n.data?.total||0,this.loading=!1},error:n=>{console.error("Error loading users:",n),this.loading=!1,n.status===403?this.snackBar.open("No tiene permisos para acceder a esta funcionalidad","Cerrar",{duration:5e3}):this.snackBar.open("Error al cargar usuarios","Cerrar",{duration:3e3})}})}formatDate(e){if(!e)return"-";let n=new Date(e);return new Intl.DateTimeFormat("es-CL",{year:"numeric",month:"2-digit",day:"2-digit"}).format(n)}get totalUsers(){return this.users.length}get centralAdmins(){return this.users.filter(e=>e.is_central_admin).length}get usersThisMonth(){let e=new Date;return this.users.filter(n=>{if(!n.created_at)return!1;let a=new Date(n.created_at);return a.getMonth()===e.getMonth()&&a.getFullYear()===e.getFullYear()}).length}createUser(){this.dialog.open(te,{width:"800px",maxWidth:"90vw",data:{isEdit:!1}}).afterClosed().subscribe(n=>{n&&this.loadUsers()})}viewUser(e){this.userService.getUser(e.id).subscribe({next:n=>{let a=n.data,d=[{label:"ID",key:"id",icon:"tag",type:"text"},{label:"Nombre",key:"name",icon:"person",type:"text"},{label:"Email",key:"email",icon:"email",type:"text"},{label:"Administrador Central",key:"is_central_admin",icon:"admin_panel_settings",type:"boolean"},{label:"Cantidad de Estacionamientos",key:"tenants_count",icon:"local_parking",type:"text",format:T=>T?`${T} estacionamiento(s)`:"0 estacionamientos"},{label:"Fecha de Registro",key:"created_at",icon:"calendar_today",type:"date"},{label:"\xDAltima Actualizaci\xF3n",key:"updated_at",icon:"update",type:"date"}],p=this.dialog.open(st,{width:"700px",data:{title:"Detalles del Usuario",data:a,fields:d,actions:[{label:"Editar",icon:"edit",color:"primary",action:()=>{p.close(),this.editUser(e)}}]}})},error:n=>{console.error("Error loading user:",n),this.snackBar.open("Error al cargar los datos del usuario","Cerrar",{duration:3e3})}})}editUser(e){this.userService.getUser(e.id).subscribe({next:n=>{let a=n.data;this.dialog.open(te,{width:"800px",maxWidth:"90vw",data:{isEdit:!0,user:a}}).afterClosed().subscribe(p=>{p&&this.loadUsers()})},error:n=>{console.error("Error loading user:",n),this.snackBar.open("Error al cargar los datos del usuario","Cerrar",{duration:3e3})}})}deleteUser(e){confirm(`\xBFEst\xE1 seguro de eliminar el usuario ${e.name||e.email}? Esta acci\xF3n no se puede deshacer.`)&&this.userService.deleteUser(e.id).subscribe({next:()=>{this.snackBar.open("Usuario eliminado correctamente","Cerrar",{duration:3e3}),this.loadUsers()},error:n=>{console.error("Error deleting user:",n);let a=n.error?.message||"Error al eliminar usuario";this.snackBar.open(a,"Cerrar",{duration:5e3})}})}assignToTenants(e){this.userService.getUser(e.id).subscribe({next:n=>{let a=n.data;this.dialog.open(te,{width:"800px",maxWidth:"90vw",data:{isEdit:!1,user:a,showTenantAssignment:!0}}).afterClosed().subscribe(p=>{p&&this.loadUsers()})},error:n=>{console.error("Error loading user:",n),this.snackBar.open("Error al cargar los datos del usuario","Cerrar",{duration:3e3})}})}applyFilters(){this.currentPage=0,this.loadUsers()}clearFilters(){this.filters={name:"",email:""},this.currentPage=0,this.loadUsers()}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadUsers()}static{this.\u0275fac=function(n){return new(n||t)(g(ee),g(Z),g(xe),g(q))}}static{this.\u0275cmp=I({type:t,selectors:[["app-users"]],viewQuery:function(n,a){if(n&1&&me(G,5),n&2){let d;de(d=ce())&&(a.sort=d.first)}},features:[ue([{provide:tt,useValue:ot()}])],decls:95,vars:13,consts:[["userMenu","matMenu"],[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-blue-600"],[1,"p-3","bg-purple-100","rounded-full"],[1,"text-purple-600"],[1,"text-2xl","font-bold","text-purple-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"mb-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline"],["matInput","","placeholder","Nombre del usuario",3,"ngModelChange","ngModel"],["matInput","","placeholder","Email del usuario",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],[1,"overflow-x-auto"],["mat-table","","matSort","",1,"w-full",3,"dataSource","matSortActive","matSortDirection"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","id",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","name",4,"matHeaderCellDef"],["matColumnDef","email"],["mat-header-cell","","mat-sort-header","email",4,"matHeaderCellDef"],["matColumnDef","is_central_admin"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","tenants_count"],["mat-header-cell","","mat-sort-header","tenants_count",4,"matHeaderCellDef"],["matColumnDef","created_at"],["mat-header-cell","","mat-sort-header","created_at",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],["mat-header-cell","","mat-sort-header","id"],["mat-cell",""],[1,"flex","items-center","gap-2"],[1,"text-gray-500"],[1,"font-mono","text-sm"],["mat-header-cell","","mat-sort-header","name"],[1,"font-semibold"],["mat-header-cell","","mat-sort-header","email"],["mat-header-cell",""],["class","bg-purple-100 text-purple-800",4,"ngIf"],["class","text-gray-400",4,"ngIf"],[1,"bg-purple-100","text-purple-800"],[1,"text-sm","mr-1"],[1,"text-gray-400"],["mat-header-cell","","mat-sort-header","tenants_count"],[1,"text-gray-500","text-sm"],[1,"font-medium"],["mat-header-cell","","mat-sort-header","created_at"],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"text-red-600",3,"click"],["mat-header-row",""],["mat-row",""],[1,"flex","justify-center","items-center","py-8"],["diameter","40"],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"]],template:function(n,a){n&1&&(r(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),o(4,"Usuarios"),i(),r(5,"p",4),o(6,"Gestiona los usuarios del sistema"),i()(),r(7,"button",5),f("click",function(){return a.createUser()}),r(8,"mat-icon"),o(9,"add"),i(),o(10," Nuevo Usuario "),i()(),r(11,"div",6)(12,"mat-card")(13,"mat-card-content",7)(14,"div",8)(15,"div",9)(16,"mat-icon",10),o(17,"people"),i()(),r(18,"div",11)(19,"p",12),o(20,"Total Usuarios"),i(),r(21,"p",13),o(22),i()()()()(),r(23,"mat-card")(24,"mat-card-content",7)(25,"div",8)(26,"div",14)(27,"mat-icon",15),o(28,"admin_panel_settings"),i()(),r(29,"div",11)(30,"p",12),o(31,"Administradores Centrales"),i(),r(32,"p",16),o(33),i()()()()(),r(34,"mat-card")(35,"mat-card-content",7)(36,"div",8)(37,"div",17)(38,"mat-icon",18),o(39,"calendar_today"),i()(),r(40,"div",11)(41,"p",12),o(42,"Este Mes"),i(),r(43,"p",19),o(44),i()()()()()(),r(45,"mat-card",20)(46,"mat-card-content",7)(47,"div",21)(48,"mat-form-field",22)(49,"mat-label"),o(50,"Buscar por nombre"),i(),r(51,"input",23),re("ngModelChange",function(p){return ne(a.filters.name,p)||(a.filters.name=p),p}),i()(),r(52,"mat-form-field",22)(53,"mat-label"),o(54,"Buscar por email"),i(),r(55,"input",24),re("ngModelChange",function(p){return ne(a.filters.email,p)||(a.filters.email=p),p}),i()()(),r(56,"div",25)(57,"button",26),f("click",function(){return a.clearFilters()}),r(58,"mat-icon"),o(59,"clear"),i(),o(60," Limpiar "),i(),r(61,"button",5),f("click",function(){return a.applyFilters()}),r(62,"mat-icon"),o(63,"search"),i(),o(64," Filtrar "),i()()()(),r(65,"mat-card")(66,"mat-card-content",7)(67,"div",27)(68,"table",28),b(69,29),c(70,qt,2,0,"th",30)(71,Wt,6,1,"td",31),E(),b(72,32),c(73,Gt,2,0,"th",33)(74,Qt,3,1,"td",31),E(),b(75,34),c(76,Yt,2,0,"th",35)(77,Jt,3,1,"td",31),E(),b(78,36),c(79,Kt,2,0,"th",37)(80,ei,3,2,"td",31),E(),b(81,38),c(82,ti,2,0,"th",39)(83,ii,6,1,"td",31),E(),b(84,40),c(85,ni,2,0,"th",41)(86,ri,3,1,"td",31),E(),b(87,42),c(88,ai,2,0,"th",37)(89,oi,22,1,"td",31),E(),c(90,si,1,0,"tr",43)(91,li,1,0,"tr",44),i(),c(92,mi,2,0,"div",45)(93,di,7,0,"div",46),i(),c(94,ci,1,5,"mat-paginator",47),i()()()),n&2&&(s(22),_(a.totalUsers),s(11),S(" ",a.centralAdmins," "),s(11),S(" ",a.usersThisMonth," "),s(7),ie("ngModel",a.filters.name),s(4),ie("ngModel",a.filters.email),s(13),m("dataSource",a.users)("matSortActive",a.sortBy)("matSortDirection",a.sortOrder),s(22),m("matHeaderRowDef",a.displayedColumns),s(),m("matRowDefColumns",a.displayedColumns),s(),m("ngIf",a.loading),s(),m("ngIf",!a.loading&&a.users.length===0),s(),m("ngIf",a.totalItems>0))},dependencies:[F,w,Pe,P,$,Be,et,He,We,Je,Ge,qe,Ke,Qe,Ye,Xe,Ze,X,J,K,R,V,Ue,j,N,H,z,B,A,D,O,L,De,Fe,we,ke,Y,Q,W,nt,it,at,G,rt,k,Le],encapsulation:2})}}return t})();export{tn as UsersComponent};
