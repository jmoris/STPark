import{a as et}from"./chunk-2J2JMEHU.js";import{c as G}from"./chunk-5BS7ZJIQ.js";import{a as H,b as F,c as B,d as V,e as $,f as W,g as Y,h as J,i as U,j as q,k as z}from"./chunk-HXJZOTA2.js";import{a as K,b as Q,c as X,e as Z,f as tt}from"./chunk-NB6DWIHZ.js";import"./chunk-QT3W5JSU.js";import"./chunk-VKB6BRO6.js";import{b as k,c as N}from"./chunk-7EGXZGVT.js";import{a as j,b as L}from"./chunk-7AXTM6W3.js";import"./chunk-DO3SX6N4.js";import"./chunk-EGGCURRC.js";import{la as R,na as P,oa as O}from"./chunk-AHUY5V3P.js";import"./chunk-CQGOYTFO.js";import{b as T,d as A}from"./chunk-DOMNBE5L.js";import"./chunk-7OGW3PNS.js";import{m as w,s as M}from"./chunk-TQARHOKX.js";import{$b as g,Eb as d,Gb as _,Pb as n,Qb as e,Rb as u,Sb as x,Tb as v,U as b,Vb as E,bb as o,bc as s,cb as h,f as D,mc as a,nc as c,oa as S,oc as p,pa as C,pb as I,wb as f}from"./chunk-BSJZAB7M.js";import"./chunk-TSRGIXR5.js";function it(i,r){if(i&1){let t=E();n(0,"button",9),g("click",function(){S(t);let m=s();return C(m.downloadReport("pdf"))}),n(1,"mat-icon"),a(2,"picture_as_pdf"),e(),a(3," Descargar PDF "),e()}}function nt(i,r){if(i&1){let t=E();n(0,"button",10),g("click",function(){S(t);let m=s();return C(m.downloadReport("json"))}),n(1,"mat-icon"),a(2,"description"),e(),a(3," JSON "),e()}}function at(i,r){i&1&&(n(0,"div",11),u(1,"mat-spinner",12),e())}function ot(i,r){if(i&1&&(n(0,"mat-card",15)(1,"mat-card-content",16)(2,"div",17)(3,"div",33)(4,"mat-icon",34),a(5,"account_balance_wallet"),e()(),n(6,"div",19)(7,"p",20),a(8,"Efectivo Esperado"),e(),n(9,"p",35),a(10),e()()()()()),i&2){let t=s(2);o(10),c(t.formatAmount(t.totals.cash_expected))}}function rt(i,r){if(i&1&&(n(0,"mat-card",15)(1,"mat-card-content",16)(2,"div",17)(3,"div",36)(4,"mat-icon",37),a(5,"payments"),e()(),n(6,"div",19)(7,"p",20),a(8,"Efectivo Cobrado"),e(),n(9,"p",38),a(10),e()()()()()),i&2){let t=s(2);o(10),c(t.formatAmount(t.totals.cash_collected))}}function lt(i,r){if(i&1&&(n(0,"mat-card",15)(1,"mat-card-content",16)(2,"div",17)(3,"div",18)(4,"mat-icon"),a(5),e()(),n(6,"div",19)(7,"p",20),a(8,"Diferencia"),e(),n(9,"p",39),a(10),e()()()()()),i&2){let t=s(2);o(3),_("bg-red-100",t.shift.cash_over_short<0)("bg-green-100",t.shift.cash_over_short>0),o(),_("text-red-600",t.shift.cash_over_short<0)("text-green-600",t.shift.cash_over_short>0),o(),p(" ",t.shift.cash_over_short<0?"trending_down":"trending_up"," "),o(4),_("text-red-600",t.shift.cash_over_short<0)("text-green-600",t.shift.cash_over_short>0),o(),p(" ",t.formatAmount(t.shift.cash_over_short)," ")}}function dt(i,r){if(i&1&&(n(0,"div",40)(1,"span",28),a(2,"Cierre"),e(),n(3,"span",31),a(4),e()()),i&2){let t=s(2);o(4),c(t.formatDate(t.shift.closed_at))}}function mt(i,r){if(i&1&&(n(0,"div",27)(1,"span",28),a(2,"Retiros"),e(),n(3,"span",45),a(4),e()()),i&2){let t=s(3);o(4),p("-",t.formatAmount(t.totals.cash_withdrawals),"")}}function st(i,r){if(i&1&&(n(0,"div",27)(1,"span",28),a(2,"Dep\xF3sitos"),e(),n(3,"span",41),a(4),e()()),i&2){let t=s(3);o(4),p("+",t.formatAmount(t.totals.cash_deposits),"")}}function ct(i,r){if(i&1&&(n(0,"div",40)(1,"span",28),a(2,"Efectivo Declarado"),e(),n(3,"span",30),a(4),e()()),i&2){let t=s(3);o(4),c(t.formatAmount(t.totals.cash_declared))}}function ft(i,r){if(i&1&&(n(0,"mat-card",15)(1,"mat-card-header",24)(2,"mat-card-title",25)(3,"mat-icon"),a(4,"account_balance"),e(),a(5," Flujo de Efectivo "),e()(),n(6,"mat-card-content")(7,"div",26)(8,"div",27)(9,"span",28),a(10,"Fondo Inicial"),e(),n(11,"span",30),a(12),e()(),n(13,"div",27)(14,"span",28),a(15,"Efectivo Cobrado"),e(),n(16,"span",41),a(17),e()(),f(18,mt,5,1,"div",42)(19,st,5,1,"div",42),n(20,"div",43)(21,"span",44),a(22,"Efectivo Esperado"),e(),n(23,"span",35),a(24),e()(),f(25,ct,5,1,"div",32),e()()()),i&2){let t=s(2);o(12),c(t.formatAmount(t.totals.opening_float)),o(5),p("+",t.formatAmount(t.totals.cash_collected),""),o(),d("ngIf",t.totals.cash_withdrawals>0),o(),d("ngIf",t.totals.cash_deposits>0),o(5),c(t.formatAmount(t.totals.cash_expected)),o(),d("ngIf",t.totals.cash_declared!==null&&t.totals.cash_declared!==void 0)}}function pt(i,r){i&1&&(n(0,"th",57),a(1,"M\xE9todo de Pago"),e())}function _t(i,r){if(i&1&&(n(0,"td",58)(1,"div",25)(2,"mat-icon",59),a(3),e(),n(4,"span",60),a(5),e()()()),i&2){let t=r.$implicit,l=s(3);o(3),c(l.getMethodIcon(t.method)),o(2),c(l.getMethodText(t.method))}}function ut(i,r){i&1&&(n(0,"th",61),a(1,"Transacciones"),e())}function ht(i,r){if(i&1&&(n(0,"td",62)(1,"span",63),a(2),e()()),i&2){let t=r.$implicit;o(2),c(t.count)}}function xt(i,r){i&1&&(n(0,"th",61),a(1,"Monto Total"),e())}function vt(i,r){if(i&1&&(n(0,"td",62)(1,"span",64),a(2),e()()),i&2){let t=r.$implicit,l=s(3);o(2),c(l.formatAmount(t.collected))}}function gt(i,r){i&1&&u(0,"tr",65)}function bt(i,r){i&1&&u(0,"tr",66)}function St(i,r){if(i&1&&(n(0,"mat-card",15)(1,"mat-card-header",24)(2,"mat-card-title",25)(3,"mat-icon"),a(4,"receipt_long"),e(),a(5," Pagos por M\xE9todo "),e()(),n(6,"mat-card-content")(7,"div",46)(8,"table",47),x(9,48),f(10,pt,2,0,"th",49)(11,_t,6,2,"td",50),v(),x(12,51),f(13,ut,2,0,"th",52)(14,ht,3,1,"td",53),v(),x(15,54),f(16,xt,2,0,"th",52)(17,vt,3,1,"td",53),v(),f(18,gt,1,0,"tr",55)(19,bt,1,0,"tr",56),e()()()()),i&2){let t=s(2);o(8),d("dataSource",t.totals.payments_by_method),o(10),d("matHeaderRowDef",t.displayedColumns),o(),d("matRowDefColumns",t.displayedColumns)}}function Ct(i,r){if(i&1&&(n(0,"div",13)(1,"div",14)(2,"mat-card",15)(3,"mat-card-content",16)(4,"div",17)(5,"div",18)(6,"mat-icon"),a(7),e()(),n(8,"div",19)(9,"p",20),a(10,"Estado"),e(),n(11,"p",21),a(12),e()()()()(),f(13,ot,11,1,"mat-card",22)(14,rt,11,1,"mat-card",22)(15,lt,11,14,"mat-card",22),e(),n(16,"div",23)(17,"mat-card",15)(18,"mat-card-header",24)(19,"mat-card-title",25)(20,"mat-icon"),a(21,"info"),e(),a(22," Informaci\xF3n del Turno "),e()(),n(23,"mat-card-content")(24,"div",26)(25,"div",27)(26,"span",28),a(27,"Turno ID"),e(),n(28,"span",29),a(29),e()(),n(30,"div",27)(31,"span",28),a(32,"Operador"),e(),n(33,"span",30),a(34),e()(),n(35,"div",27)(36,"span",28),a(37,"Sector"),e(),n(38,"span",30),a(39),e()(),n(40,"div",27)(41,"span",28),a(42,"Apertura"),e(),n(43,"span",31),a(44),e()(),f(45,dt,5,1,"div",32),e()()(),f(46,ft,26,6,"mat-card",22),e(),f(47,St,20,3,"mat-card",22),e()),i&2){let t=s();o(5),_("bg-green-100",t.shift.status==="OPEN")("bg-blue-100",t.shift.status==="CLOSED")("bg-red-100",t.shift.status==="CANCELED"),o(),_("text-green-600",t.shift.status==="OPEN")("text-blue-600",t.shift.status==="CLOSED")("text-red-600",t.shift.status==="CANCELED"),o(),p(" ",t.shift.status==="OPEN"?"stopwatch":t.shift.status==="CLOSED"?"check_circle":"cancel"," "),o(4),_("text-green-600",t.shift.status==="OPEN")("text-blue-600",t.shift.status==="CLOSED")("text-red-600",t.shift.status==="CANCELED"),o(),p(" ",t.shift.status==="OPEN"?"Abierto":t.shift.status==="CLOSED"?"Cerrado":"Cancelado"," "),o(),d("ngIf",t.totals),o(),d("ngIf",t.totals),o(),d("ngIf",t.shift.cash_over_short!==null&&t.shift.cash_over_short!==void 0),o(14),p("#",t.shift.id.substring(0,8),""),o(5),c((t.shift.operator==null?null:t.shift.operator.name)||"N/A"),o(5),c((t.shift.sector==null?null:t.shift.sector.name)||"N/A"),o(5),c(t.formatDate(t.shift.opened_at)),o(),d("ngIf",t.shift.closed_at),o(),d("ngIf",t.totals),o(),d("ngIf",t.totals&&t.totals.payments_by_method&&t.totals.payments_by_method.length>0)}}var Bt=(()=>{class i{constructor(t,l,m){this.route=t,this.router=l,this.shiftService=m,this._unsubscribeAll=new D,this.shift=null,this.totals=null,this.report=null,this.loading=!1,this.shiftId="",this.displayedColumns=["method","collected","count"]}ngOnInit(){this.shiftId=this.route.snapshot.paramMap.get("id")||"",this.shiftId&&this.loadShift()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadShift(){this.loading=!0,this.shiftService.getShift(this.shiftId).pipe(b(this._unsubscribeAll)).subscribe({next:t=>{t.success&&t.data&&(this.shift=t.data.shift,this.totals=t.data.totals,this.loadReport()),this.loading=!1},error:t=>{console.error("Error loading shift:",t),this.loading=!1}})}loadReport(){this.shiftService.getShiftReport(this.shiftId).pipe(b(this._unsubscribeAll)).subscribe({next:t=>{t.success&&t.data&&(this.report=t.data)},error:t=>console.error("Error loading report:",t)})}formatAmount(t){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP"}).format(t)}formatDate(t){if(!t)return"-";let l=new Date(t);if(isNaN(l.getTime()))return"-";let m=l.toLocaleDateString("es-CL",{day:"2-digit",month:"2-digit",year:"numeric"}),y=l.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${m} ${y}`}getMethodIcon(t){switch(t){case"CASH":return"payments";case"CARD":return"credit_card";case"WEBPAY":return"account_balance";case"TRANSFER":return"account_balance_wallet";default:return"payment"}}getMethodText(t){switch(t){case"CASH":return"Efectivo";case"CARD":return"Tarjeta";case"WEBPAY":return"Webpay";case"TRANSFER":return"Transferencia";default:return t}}goBack(){this.router.navigate(["/parking/shifts"])}downloadReport(t="json"){this.shiftService.getShiftReport(this.shiftId,t).subscribe({next:l=>{l.success&&console.log("Report:",l.data)},error:l=>console.error("Error downloading report:",l)})}static{this.\u0275fac=function(l){return new(l||i)(h(T),h(A),h(et))}}static{this.\u0275cmp=I({type:i,selectors:[["app-shift-detail"]],decls:12,vars:4,consts:[[1,"p-6","w-full"],[1,"flex","items-center","gap-4","mb-6"],["mat-icon-button","",1,"rounded-sm",3,"click"],[1,"text-2xl","font-bold","text-gray-900"],[1,"flex-1"],["mat-raised-button","","color","primary","class","rounded-sm",3,"click",4,"ngIf"],["mat-stroked-button","","class","rounded-sm",3,"click",4,"ngIf"],["class","flex justify-center items-center h-64",4,"ngIf"],["class","space-y-6",4,"ngIf"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],["mat-stroked-button","",1,"rounded-sm",3,"click"],[1,"flex","justify-center","items-center","h-64"],["diameter","50"],[1,"space-y-6"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6"],[1,"rounded-lg"],[1,"p-6"],[1,"flex","items-center","mb-2"],[1,"p-3","rounded-full"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-lg","font-bold"],["class","rounded-lg",4,"ngIf"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"pb-4"],[1,"flex","items-center","gap-2"],[1,"space-y-4"],[1,"flex","items-center","justify-between","py-2","border-b","border-gray-100"],[1,"text-gray-600","font-medium"],[1,"font-mono","text-sm","font-semibold"],[1,"font-semibold","text-gray-900"],[1,"text-sm"],["class","flex items-center justify-between py-2",4,"ngIf"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"text-xl","font-bold","text-blue-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-xl","font-bold","text-green-600"],[1,"text-xl","font-bold"],[1,"flex","items-center","justify-between","py-2"],[1,"font-semibold","text-green-600"],["class","flex items-center justify-between py-2 border-b border-gray-100",4,"ngIf"],[1,"flex","items-center","justify-between","py-3","border-t-2","border-blue-200","bg-blue-50","px-2","-mx-2","rounded"],[1,"font-semibold","text-blue-900"],[1,"font-semibold","text-red-600"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","method"],["mat-header-cell","","class","font-semibold",4,"matHeaderCellDef"],["mat-cell","","class","py-4",4,"matCellDef"],["matColumnDef","count"],["mat-header-cell","","class","font-semibold text-right",4,"matHeaderCellDef"],["mat-cell","","class","text-right",4,"matCellDef"],["matColumnDef","collected"],["mat-header-row","","class","border-b-2 border-gray-200",4,"matHeaderRowDef"],["mat-row","","class","border-b border-gray-100",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"font-semibold"],["mat-cell","",1,"py-4"],[1,"text-gray-400","text-sm"],[1,"font-medium"],["mat-header-cell","",1,"font-semibold","text-right"],["mat-cell","",1,"text-right"],[1,"font-semibold"],[1,"font-bold","text-gray-900"],["mat-header-row","",1,"border-b-2","border-gray-200"],["mat-row","",1,"border-b","border-gray-100"]],template:function(l,m){l&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return m.goBack()}),n(3,"mat-icon"),a(4,"arrow_back"),e()(),n(5,"h1",3),a(6,"Detalle de Turno"),e(),u(7,"span",4),f(8,it,4,0,"button",5)(9,nt,4,0,"button",6),e(),f(10,at,2,0,"div",7)(11,Ct,48,30,"div",8),e()),l&2&&(o(8),d("ngIf",(m.shift==null?null:m.shift.status)==="CLOSED"),o(),d("ngIf",(m.shift==null?null:m.shift.status)==="CLOSED"),o(),d("ngIf",m.loading),o(),d("ngIf",!m.loading&&m.shift))},dependencies:[M,w,tt,K,X,Z,Q,O,R,P,N,k,L,j,G,z,H,B,Y,V,F,J,$,W,U,q],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f;border-radius:8px}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151}.mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}@media (max-width: 768px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}"]})}}return i})();export{Bt as ShiftDetailComponent};
