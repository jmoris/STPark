import{a as vt}from"./chunk-CHR54TP5.js";import{a as xt}from"./chunk-T4SBZZYB.js";import{a as Ct}from"./chunk-EW2BJTQW.js";import{a as ct}from"./chunk-Y33ASIMI.js";import{c as gt}from"./chunk-ZMAIZYCZ.js";import{a as ue,b as pe,c as _e,d as fe}from"./chunk-ECV7I2AV.js";import{a as ut,b as pt,c as _t,d as we,e as ft,f as ht,g as St}from"./chunk-JDQ2XOLK.js";import{a as he,b as ge,c as Se,d as Ce,e as xe,f as ve,g as Me,h as be,i as Ee,j as ye,k as De}from"./chunk-A3W56N53.js";import{a as lt,c as mt,f as dt}from"./chunk-CFZHHQ3I.js";import"./chunk-2LVKS4R7.js";import{a as le,b as rt}from"./chunk-FGUURFJS.js";import{a as Ge,b as Ue,c as qe,d as Ye}from"./chunk-UQSNXR2K.js";import{a as ze,b as We}from"./chunk-3FSFXLFF.js";import{a as me,b as de}from"./chunk-3FSLCT73.js";import{g as te}from"./chunk-4Y4LGJ4R.js";import{a as Le,c as Re,h as G}from"./chunk-ZMKJJYLL.js";import"./chunk-EOYQYJ3N.js";import"./chunk-VKB6BRO6.js";import{a as st,b as ce}from"./chunk-C6O7BKF5.js";import{b as Z,c as ee}from"./chunk-72F6PA3H.js";import{d as oe,e as ae}from"./chunk-F2IYN6IZ.js";import{b as U,c as je,d as $e,e as He,f as q,j as Y,k as Q}from"./chunk-EO526QJS.js";import{a as re,b as se}from"./chunk-6JXRNXI3.js";import{A as ot,B as at,b as ie,d as y,f as ne,g as Qe,j as Je,k as Ke,l as Xe,n as Ze,q as et,u as tt,v as it,y as nt}from"./chunk-XMMUWBM2.js";import{W as z,fa as W,la as J,na as K,oa as X,u as Ne,v as Be}from"./chunk-56JILNRZ.js";import"./chunk-TTG7A5I5.js";import{d as Ae}from"./chunk-P2DCSIJY.js";import"./chunk-FDUGCV2L.js";import{l as j,m as $,t as H}from"./chunk-IZAOXH6X.js";import{$b as g,Eb as d,Fb as w,Gb as O,Ib as R,Pb as n,Qb as i,Rb as S,Sb as C,Tb as x,U as b,Vb as E,bb as l,bc as p,cb as M,f as B,fc as Ve,gc as Pe,hc as Fe,lc as T,mc as a,nc as D,oa as f,oc as v,pa as h,pb as L,rc as I,sc as k,tc as V,uc as Oe,v as ke,wb as _}from"./chunk-QDWFRTQW.js";import{a as P,b as F}from"./chunk-TSRGIXR5.js";function Lt(t,m){t&1&&(n(0,"mat-error"),a(1,"Nombre es obligatorio"),i())}function Rt(t,m){if(t&1&&(n(0,"mat-option",34),a(1),i()),t&2){let e=m.$implicit;d("value",e.value),l(),v(" ",e.label," ")}}function jt(t,m){t&1&&(n(0,"mat-error"),a(1,"Tipo es obligatorio"),i())}function $t(t,m){t&1&&(n(0,"mat-error"),a(1,"Monto es obligatorio"),i())}function Ht(t,m){t&1&&(n(0,"mat-error"),a(1,"El monto debe ser mayor o igual a 0"),i())}function zt(t,m){if(t&1&&(n(0,"div",35)(1,"mat-form-field",13)(2,"mat-label"),a(3,"Monto del descuento (CLP)"),i(),S(4,"input",36),_(5,$t,2,0,"mat-error",15)(6,Ht,2,0,"mat-error",15),i()()),t&2){let e,r,o=p();l(5),d("ngIf",(e=o.discountForm.get("value"))==null?null:e.hasError("required")),l(),d("ngIf",(r=o.discountForm.get("value"))==null?null:r.hasError("min"))}}function Wt(t,m){t&1&&(n(0,"mat-error"),a(1,"Porcentaje es obligatorio"),i())}function Gt(t,m){t&1&&(n(0,"mat-error"),a(1," El porcentaje debe estar entre 0 y 100 "),i())}function Ut(t,m){t&1&&(n(0,"mat-error"),a(1," El monto m\xE1ximo debe ser mayor o igual a 0 "),i())}function qt(t,m){if(t&1&&(n(0,"div",35)(1,"mat-form-field",13)(2,"mat-label"),a(3,"Porcentaje de descuento"),i(),S(4,"input",37),n(5,"mat-hint"),a(6,"Porcentaje del 0 al 100"),i(),_(7,Wt,2,0,"mat-error",15)(8,Gt,2,0,"mat-error",15),i(),n(9,"mat-form-field",13)(10,"mat-label"),a(11,"Monto m\xE1ximo de descuento (CLP)"),i(),S(12,"input",38),n(13,"mat-hint"),a(14,"L\xEDmite m\xE1ximo del descuento en pesos"),i(),_(15,Ut,2,0,"mat-error",15),i()()),t&2){let e,r,o,s=p();l(7),d("ngIf",(e=s.discountForm.get("value"))==null?null:e.hasError("required")),l(),d("ngIf",((r=s.discountForm.get("value"))==null?null:r.hasError("min"))||((r=s.discountForm.get("value"))==null?null:r.hasError("max"))),l(7),d("ngIf",(o=s.discountForm.get("max_amount"))==null?null:o.hasError("min"))}}function Yt(t,m){t&1&&(n(0,"mat-error"),a(1,"Valor del minuto es obligatorio"),i())}function Qt(t,m){t&1&&(n(0,"mat-error"),a(1," El valor del minuto debe ser mayor o igual a 0 "),i())}function Jt(t,m){t&1&&(n(0,"mat-error"),a(1," El valor m\xEDnimo debe ser mayor o igual a 0 "),i())}function Kt(t,m){if(t&1&&(n(0,"div",35)(1,"mat-form-field",13)(2,"mat-label"),a(3,"Valor del minuto (CLP)"),i(),S(4,"input",39),_(5,Yt,2,0,"mat-error",15)(6,Qt,2,0,"mat-error",15),i(),n(7,"mat-form-field",13)(8,"mat-label"),a(9,"Valor m\xEDnimo (CLP)"),i(),S(10,"input",40),n(11,"mat-hint"),a(12,"Tarifa m\xEDnima a cobrar"),i(),_(13,Jt,2,0,"mat-error",15),i()()),t&2){let e,r,o,s=p();l(5),d("ngIf",(e=s.discountForm.get("minute_value"))==null?null:e.hasError("required")),l(),d("ngIf",(r=s.discountForm.get("minute_value"))==null?null:r.hasError("min")),l(7),d("ngIf",(o=s.discountForm.get("min_amount"))==null?null:o.hasError("min"))}}function Xt(t,m){t&1&&(n(0,"mat-icon"),a(1,"save"),i())}function Zt(t,m){t&1&&S(0,"mat-spinner",41)}function ei(t,m){t&1&&(n(0,"div",42),S(1,"mat-spinner",43),n(2,"p",44),a(3,"Cargando descuentos..."),i()())}function ti(t,m){t&1&&(n(0,"th",60),a(1,"Nombre"),i())}function ii(t,m){if(t&1&&(n(0,"td",61),a(1),i()),t&2){let e=m.$implicit;l(),D(e.name)}}function ni(t,m){t&1&&(n(0,"th",60),a(1,"Tipo"),i())}function oi(t,m){if(t&1&&(n(0,"td",62),a(1),i()),t&2){let e=m.$implicit,r=p(2);l(),D(r.getDiscountTypeLabel(e.discount_type))}}function ai(t,m){t&1&&(n(0,"th",60),a(1,"Valor"),i())}function ri(t,m){if(t&1&&(n(0,"td",62),a(1),i()),t&2){let e=m.$implicit,r=p(2);l(),D(r.getDiscountDisplayValue(e))}}function si(t,m){t&1&&(n(0,"th",60),a(1,"Estado"),i())}function li(t,m){if(t&1&&(n(0,"td",62)(1,"span"),a(2),i()()),t&2){let e=m.$implicit;l(),R(e.is_active?"text-green-600":"text-gray-400"),l(),v(" ",e.is_active?"Activo":"Inactivo"," ")}}function mi(t,m){t&1&&(n(0,"th",63),a(1,"Acciones"),i())}function di(t,m){if(t&1){let e=E();n(0,"td",64)(1,"button",65),g("click",function(){let o=f(e).$implicit,s=p(2);return h(s.startEdit(o))}),n(2,"mat-icon"),a(3,"edit"),i()(),n(4,"button",66),g("click",function(){let o=f(e).$implicit,s=p(2);return h(s.delete(o))}),n(5,"mat-icon"),a(6,"delete"),i()()()}}function ci(t,m){t&1&&S(0,"tr",67)}function ui(t,m){t&1&&S(0,"tr",68)}function pi(t,m){t&1&&(n(0,"div",69),a(1," No hay descuentos creados todav\xEDa. "),i())}function _i(t,m){if(t&1&&(n(0,"div",45)(1,"table",46),C(2,47),_(3,ti,2,0,"th",48)(4,ii,2,1,"td",49),x(),C(5,50),_(6,ni,2,0,"th",48)(7,oi,2,1,"td",51),x(),C(8,52),_(9,ai,2,0,"th",48)(10,ri,2,1,"td",51),x(),C(11,53),_(12,si,2,0,"th",48)(13,li,3,3,"td",51),x(),C(14,54),_(15,mi,2,0,"th",55)(16,di,7,0,"td",56),x(),_(17,ci,1,0,"tr",57)(18,ui,1,0,"tr",58),i(),_(19,pi,2,0,"div",59),i()),t&2){let e=p();l(),d("dataSource",e.discounts),l(16),d("matHeaderRowDef",e.displayedColumns),l(),d("matRowDefColumns",e.displayedColumns),l(),d("ngIf",e.discounts.length===0)}}var Mt=(()=>{class t{constructor(e,r,o,s,c){this.dialogRef=e,this.fb=r,this.discountService=o,this.snackBar=s,this.confirmationService=c,this._unsubscribeAll=new B,this.loading=!1,this.saving=!1,this.discounts=[],this.displayedColumns=["name","type","value","status","actions"],this.editingDiscount=null,this.discountTypes=[{value:"AMOUNT",label:"Por Monto"},{value:"PERCENTAGE",label:"Por Porcentaje"},{value:"PRICING_PROFILE",label:"Perfil de Precio"}],this.discountForm=this.fb.group({name:["",[y.required,y.minLength(2)]],description:[""],discount_type:["AMOUNT",[y.required]],value:[null],max_amount:[null],minute_value:[null],min_amount:[null],is_active:[!0],priority:[0],valid_from:[null],valid_until:[null]}),this.discountForm.get("discount_type")?.valueChanges.pipe(b(this._unsubscribeAll)).subscribe(u=>{this.updateFormValidations(u)})}ngOnInit(){this.loadDiscounts()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}updateFormValidations(e){let r=this.discountForm.get("value"),o=this.discountForm.get("max_amount"),s=this.discountForm.get("minute_value"),c=this.discountForm.get("min_amount");r?.clearValidators(),o?.clearValidators(),s?.clearValidators(),c?.clearValidators(),e==="AMOUNT"?(r?.setValidators([y.required,y.min(0)]),o?.clearValidators(),s?.clearValidators(),c?.clearValidators()):e==="PERCENTAGE"?(r?.setValidators([y.required,y.min(0),y.max(100)]),o?.setValidators([y.min(0)]),s?.clearValidators(),c?.clearValidators()):e==="PRICING_PROFILE"&&(s?.setValidators([y.required,y.min(0)]),c?.setValidators([y.min(0)]),r?.clearValidators(),o?.clearValidators()),r?.updateValueAndValidity(),o?.updateValueAndValidity(),s?.updateValueAndValidity(),c?.updateValueAndValidity()}loadDiscounts(){this.loading=!0,this.discountService.getSessionDiscounts().pipe(b(this._unsubscribeAll)).subscribe({next:e=>{this.discounts=e.data||[],this.loading=!1},error:e=>{console.error("Error loading discounts:",e),this.snackBar.open("Error al cargar descuentos","Cerrar",{duration:3e3}),this.loading=!1}})}startCreate(){this.editingDiscount=null,this.discountForm.reset({name:"",description:"",discount_type:"AMOUNT",value:null,max_amount:null,minute_value:null,min_amount:null,is_active:!0,priority:0,valid_from:null,valid_until:null}),this.updateFormValidations("AMOUNT")}startEdit(e){this.editingDiscount=e;let r={name:e.name,description:e.description||"",discount_type:e.discount_type,is_active:e.is_active,priority:e.priority||0};e.discount_type==="AMOUNT"||e.discount_type==="PERCENTAGE"?(r.value=e.value||null,r.max_amount=e.max_amount||null):e.discount_type==="PRICING_PROFILE"&&(r.minute_value=e.minute_value||null,r.min_amount=e.min_amount||null),e.valid_from&&(r.valid_from=new Date(e.valid_from)),e.valid_until&&(r.valid_until=new Date(e.valid_until)),this.discountForm.reset(r),this.updateFormValidations(e.discount_type)}save(){if(this.discountForm.invalid){this.discountForm.markAllAsTouched();return}let e=this.discountForm.value,r={name:String(e.name).trim(),description:e.description?String(e.description).trim():void 0,discount_type:e.discount_type,is_active:e.is_active!==!1,priority:Number(e.priority)||0};e.discount_type==="AMOUNT"||e.discount_type==="PERCENTAGE"?(r.value=e.value?Number(e.value):void 0,r.max_amount=e.max_amount?Number(e.max_amount):void 0):e.discount_type==="PRICING_PROFILE"&&(r.minute_value=e.minute_value?Number(e.minute_value):void 0,r.min_amount=e.min_amount?Number(e.min_amount):void 0),e.valid_from&&(r.valid_from=new Date(e.valid_from).toISOString().split("T")[0]),e.valid_until&&(r.valid_until=new Date(e.valid_until).toISOString().split("T")[0]),this.saving=!0,(this.editingDiscount?.id?this.discountService.updateSessionDiscount(this.editingDiscount.id,r):this.discountService.createSessionDiscount(r)).pipe(b(this._unsubscribeAll)).subscribe({next:s=>{s.success?(this.snackBar.open(this.editingDiscount?"Descuento actualizado":"Descuento creado","Cerrar",{duration:2500}),this.editingDiscount=null,this.startCreate(),this.loadDiscounts()):this.snackBar.open(s.message||"Error al guardar descuento","Cerrar",{duration:3e3}),this.saving=!1},error:s=>{console.error("Error saving discount:",s);let c=s?.error?.message||"Error al guardar descuento";this.snackBar.open(c,"Cerrar",{duration:4e3}),this.saving=!1}})}delete(e){if(!e.id)return;this.confirmationService.open({title:"Eliminar Descuento",message:`\xBFEst\xE1 seguro de eliminar el descuento "${e.name}"?`,icon:{show:!0,name:"heroicons_outline:exclamation-triangle",color:"warn"},actions:{confirm:{show:!0,label:"Eliminar",color:"warn"},cancel:{show:!0,label:"Cancelar"}}}).afterClosed().subscribe(o=>{o==="confirmed"&&this.discountService.deleteSessionDiscount(e.id).pipe(b(this._unsubscribeAll)).subscribe({next:s=>{s.success?(this.snackBar.open("Descuento eliminado","Cerrar",{duration:2500}),this.loadDiscounts()):this.snackBar.open(s.message||"Error al eliminar descuento","Cerrar",{duration:3e3})},error:s=>{console.error("Error deleting discount:",s);let c=s?.error?.message||"Error al eliminar descuento";this.snackBar.open(c,"Cerrar",{duration:4e3})}})})}close(){this.dialogRef.close(!0)}formatAmount(e){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0)}getDiscountTypeLabel(e){return this.discountTypes.find(o=>o.value===e)?.label||e}getDiscountDisplayValue(e){if(e.discount_type==="AMOUNT")return this.formatAmount(e.value||0);if(e.discount_type==="PERCENTAGE")return`${e.value||0}%`;if(e.discount_type==="PRICING_PROFILE"){let r=[];return e.minute_value&&r.push(`Min: ${this.formatAmount(e.minute_value)}`),e.min_amount&&r.push(`M\xEDn: ${this.formatAmount(e.min_amount)}`),r.length>0?r.join(", "):"Perfil personalizado"}return"-"}static{this.\u0275fac=function(r){return new(r||t)(M(Le),M(nt),M(Ct),M(le),M(te))}}static{this.\u0275cmp=L({type:t,selectors:[["app-session-discounts-modal"]],decls:76,vars:17,consts:[["pickerFrom",""],["pickerUntil",""],[1,"p-6"],[1,"flex","items-start","justify-between","mb-4"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-gray-600"],["mat-icon-button","","aria-label","Cerrar",3,"click"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"bg-white","rounded","border","border-gray-200","p-4"],[1,"flex","items-center","justify-between","mb-3"],[1,"font-semibold","text-gray-900"],["mat-stroked-button","",1,"rounded-sm",3,"click"],[1,"grid","grid-cols-1","gap-4",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Ej: Descuento por monto fijo"],[4,"ngIf"],["matInput","","formControlName","description","rows","2","placeholder","Descripci\xF3n opcional"],["formControlName","discount_type"],[3,"value",4,"ngFor","ngForOf"],["class","grid grid-cols-1 gap-4",4,"ngIf"],["matInput","","type","number","formControlName","priority","placeholder","0"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["matInput","","formControlName","valid_from",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","valid_until",3,"matDatepicker"],["formControlName","is_active"],[1,"flex","gap-2","justify-end"],["mat-stroked-button","","type","button",1,"rounded-sm",3,"click"],["mat-raised-button","","color","primary","type","button",1,"rounded-sm",3,"click","disabled"],["diameter","18",4,"ngIf"],[1,"font-semibold","text-gray-900","mb-3"],["class","text-center py-8",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],[1,"flex","justify-end","mt-6"],[3,"value"],[1,"grid","grid-cols-1","gap-4"],["matInput","","type","number","formControlName","value","placeholder","Ej: 1000"],["matInput","","type","number","formControlName","value","placeholder","Ej: 10","min","0","max","100"],["matInput","","type","number","formControlName","max_amount","placeholder","Opcional"],["matInput","","type","number","formControlName","minute_value","placeholder","Ej: 50"],["matInput","","type","number","formControlName","min_amount","placeholder","Opcional"],["diameter","18"],[1,"text-center","py-8"],["diameter","40",1,"mx-auto"],[1,"mt-3","text-gray-600"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","font-medium",4,"matCellDef"],["matColumnDef","type"],["mat-cell","",4,"matCellDef"],["matColumnDef","value"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-cell","","class","text-right",4,"matHeaderCellDef"],["mat-cell","","class","text-right",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","py-6 text-center text-gray-600",4,"ngIf"],["mat-header-cell",""],["mat-cell","",1,"font-medium"],["mat-cell",""],["mat-header-cell","",1,"text-right"],["mat-cell","",1,"text-right"],["mat-icon-button","","aria-label","Editar",3,"click"],["mat-icon-button","","color","warn","aria-label","Eliminar",3,"click"],["mat-header-row",""],["mat-row",""],[1,"py-6","text-center","text-gray-600"]],template:function(r,o){if(r&1){let s=E();n(0,"div",2)(1,"div",3)(2,"div")(3,"h2",4),a(4,"Descuentos de Sesiones"),i(),n(5,"p",5),a(6,"Administra descuentos aplicables a las sesiones de estacionamiento"),i()(),n(7,"button",6),g("click",function(){return f(s),h(o.close())}),n(8,"mat-icon"),a(9,"close"),i()()(),n(10,"div",7)(11,"div",8)(12,"div",9)(13,"h3",10),a(14),i(),n(15,"button",11),g("click",function(){return f(s),h(o.startCreate())}),n(16,"mat-icon"),a(17,"add"),i(),a(18," Nuevo "),i()(),n(19,"form",12)(20,"mat-form-field",13)(21,"mat-label"),a(22,"Nombre del descuento"),i(),S(23,"input",14),_(24,Lt,2,0,"mat-error",15),i(),n(25,"mat-form-field",13)(26,"mat-label"),a(27,"Descripci\xF3n"),i(),S(28,"textarea",16),i(),n(29,"mat-form-field",13)(30,"mat-label"),a(31,"Tipo de descuento"),i(),n(32,"mat-select",17),_(33,Rt,2,2,"mat-option",18),i(),_(34,jt,2,0,"mat-error",15),i(),_(35,zt,7,2,"div",19)(36,qt,16,3,"div",19)(37,Kt,14,3,"div",19),n(38,"mat-form-field",13)(39,"mat-label"),a(40,"Prioridad"),i(),S(41,"input",20),n(42,"mat-hint"),a(43,"Prioridad de aplicaci\xF3n (mayor n\xFAmero = mayor prioridad)"),i()(),n(44,"div",21)(45,"mat-form-field",13)(46,"mat-label"),a(47,"V\xE1lido desde"),i(),S(48,"input",22)(49,"mat-datepicker-toggle",23)(50,"mat-datepicker",null,0),i(),n(52,"mat-form-field",13)(53,"mat-label"),a(54,"V\xE1lido hasta"),i(),S(55,"input",24)(56,"mat-datepicker-toggle",23)(57,"mat-datepicker",null,1),i()(),n(59,"mat-checkbox",25),a(60,"Activo"),i(),n(61,"div",26)(62,"button",27),g("click",function(){return f(s),h(o.startCreate())}),a(63," Cancelar "),i(),n(64,"button",28),g("click",function(){return f(s),h(o.save())}),_(65,Xt,2,0,"mat-icon",15)(66,Zt,1,0,"mat-spinner",29),a(67," Guardar "),i()()()(),n(68,"div",8)(69,"h3",30),a(70,"Listado"),i(),_(71,ei,4,0,"div",31)(72,_i,20,4,"div",32),i()(),n(73,"div",33)(74,"button",11),g("click",function(){return f(s),h(o.close())}),a(75,"Cerrar"),i()()()}if(r&2){let s,c,u,A,N,Te=T(51),Ie=T(58);l(14),D(o.editingDiscount?"Editar descuento":"Nuevo descuento"),l(5),d("formGroup",o.discountForm),l(5),d("ngIf",(s=o.discountForm.get("name"))==null?null:s.hasError("required")),l(9),d("ngForOf",o.discountTypes),l(),d("ngIf",(c=o.discountForm.get("discount_type"))==null?null:c.hasError("required")),l(),d("ngIf",((u=o.discountForm.get("discount_type"))==null?null:u.value)==="AMOUNT"),l(),d("ngIf",((A=o.discountForm.get("discount_type"))==null?null:A.value)==="PERCENTAGE"),l(),d("ngIf",((N=o.discountForm.get("discount_type"))==null?null:N.value)==="PRICING_PROFILE"),l(11),d("matDatepicker",Te),l(),d("for",Te),l(6),d("matDatepicker",Ie),l(),d("for",Ie),l(8),d("disabled",o.saving||o.discountForm.invalid),l(),d("ngIf",!o.saving),l(),d("ngIf",o.saving),l(5),d("ngIf",o.loading),l(),d("ngIf",!o.loading)}},dependencies:[H,j,$,at,Ke,ie,Xe,ne,Qe,it,tt,Ze,et,G,Q,Y,U,$e,je,q,ae,oe,X,J,K,ee,Z,De,he,Se,Me,Ce,ge,be,xe,ve,Ee,ye,se,re,de,me,W,ce,st,fe,ue,pe,_e,z],encapsulation:2})}}return t})();function fi(t,m){if(t&1&&(n(0,"mat-option",41),a(1),i()),t&2){let e=m.$implicit;d("value",e.id),l(),v(" ",e.name," ")}}function hi(t,m){if(t&1&&(n(0,"mat-option",41),a(1),i()),t&2){let e=m.$implicit;d("value",e.id),l(),v(" ",e.name," ")}}function gi(t,m){if(t&1&&(n(0,"mat-option",41),a(1),i()),t&2){let e=m.$implicit;d("value",e.value),l(),v(" ",e.label," ")}}function Si(t,m){t&1&&(n(0,"div",42),S(1,"mat-spinner",43),i())}function Ci(t,m){if(t&1&&(n(0,"div",24)(1,"fuse-alert",44),a(2),i()()),t&2){let e=p();l(),d("dismissible",!0),l(),v(" ",e.error," ")}}function xi(t,m){if(t&1&&(n(0,"th",72),a(1,"Placa"),i()),t&2){let e=p(2);w("width",e.isMobile?23:12,"%")}}function vi(t,m){if(t&1&&S(0,"div",77),t&2){let e=p().$implicit,r=p(2);w("background-color",r.getStatusCircleColor(e.status)),d("matTooltip",r.getStatusLabel(e.status))}}function Mi(t,m){if(t&1&&(n(0,"td",73)(1,"div",74),_(2,vi,1,3,"div",75),n(3,"div",76),a(4),i()()()),t&2){let e=m.$implicit,r=p(2);l(2),d("ngIf",r.isMobile),l(2),D(e.plate)}}function bi(t,m){t&1&&(n(0,"th",78),a(1,"Sector"),i())}function Ei(t,m){if(t&1&&(n(0,"td",73)(1,"div",79),a(2),i()()),t&2){let e=m.$implicit;l(2),D((e.sector==null?null:e.sector.name)||"N/A")}}function yi(t,m){t&1&&(n(0,"th",80),a(1,"Calle"),i())}function Di(t,m){if(t&1&&(n(0,"td",73)(1,"div",79),a(2),i()()),t&2){let e=m.$implicit;l(2),D((e.street==null?null:e.street.name)||"N/A")}}function wi(t,m){t&1&&(n(0,"th",81),a(1,"Operador"),i())}function Ti(t,m){if(t&1&&(n(0,"td",73)(1,"div",79),a(2),i()()),t&2){let e=m.$implicit;l(2),D((e.operator==null?null:e.operator.name)||"N/A")}}function Ii(t,m){if(t&1&&(n(0,"th",82),a(1,"Inicio"),i()),t&2){let e=p(2);w("width",e.isMobile?18:15,"%")}}function ki(t,m){if(t&1&&(n(0,"td",73)(1,"div",79),a(2),i()()),t&2){let e=m.$implicit,r=p(2);l(),O("text-xs",r.isMobile),l(),v(" ",r.isMobile?r.formatDateTimeMobile(e.started_at):r.formatDateTime(e.started_at)," ")}}function Vi(t,m){if(t&1&&(n(0,"th",83),a(1,"Fin"),i()),t&2){let e=p(2);w("width",e.isMobile?18:15,"%")}}function Pi(t,m){if(t&1&&(n(0,"td",73)(1,"div",79),a(2),i()()),t&2){let e=m.$implicit,r=p(2);l(),O("text-xs",r.isMobile),l(),v(" ",e.ended_at?r.isMobile?r.formatDateTimeMobile(e.ended_at):r.formatDateTime(e.ended_at):"-"," ")}}function Fi(t,m){if(t&1&&(n(0,"th",84),a(1,"Duraci\xF3n"),i()),t&2){let e=p(2);w("width",e.isMobile?12:10,"%")}}function Oi(t,m){if(t&1&&(n(0,"td",73)(1,"div",79),a(2),i()()),t&2){let e=m.$implicit,r=p(2);l(),O("text-xs",r.isMobile),l(),v(" ",e.duration_formatted||"-"," ")}}function Ai(t,m){t&1&&(n(0,"span"),a(1,"$"),i())}function Ni(t,m){t&1&&(n(0,"span"),a(1,"Monto"),i())}function Bi(t,m){if(t&1&&(n(0,"th",85),_(1,Ai,2,0,"span",38)(2,Ni,2,0,"span",38),i()),t&2){let e=p(2);w("width",e.isMobile?12:10,"%"),l(),d("ngIf",e.isMobile),l(),d("ngIf",!e.isMobile)}}function Li(t,m){if(t&1&&(n(0,"td",73)(1,"div",86),a(2),i()()),t&2){let e=m.$implicit,r=p(2);l(),O("text-xs",r.isMobile),l(),v(" ",e.total_paid_formatted||"-"," ")}}function Ri(t,m){t&1&&(n(0,"th",87),a(1,"Estado"),i())}function ji(t,m){if(t&1&&(n(0,"td",73)(1,"span",88),a(2),i()()),t&2){let e=m.$implicit,r=p(2);l(),R("bg-"+r.getStatusColor(e.status)+"-100 text-"+r.getStatusColor(e.status)+"-800"),l(),v(" ",r.getStatusLabel(e.status)," ")}}function $i(t,m){t&1&&(n(0,"span"),a(1,"Acciones"),i())}function Hi(t,m){if(t&1&&(n(0,"th",89),_(1,$i,2,0,"span",38),i()),t&2){let e=p(2);w("width",(e.isMobile,10),"%"),l(),d("ngIf",!e.isMobile)}}function zi(t,m){if(t&1){let e=E();n(0,"button",92),g("click",function(){f(e);let o=p().$implicit,s=p(2);return h(s.editSession(o))}),n(1,"mat-icon"),a(2,"edit"),i(),a(3," Editar "),i()}}function Wi(t,m){if(t&1){let e=E();n(0,"button",92),g("click",function(){f(e);let o=p().$implicit,s=p(2);return h(s.checkoutSession(o))}),n(1,"mat-icon"),a(2,"exit_to_app"),i(),a(3," Checkout "),i()}}function Gi(t,m){if(t&1){let e=E();n(0,"button",92),g("click",function(){f(e);let o=p().$implicit,s=p(2);return h(s.paySession(o))}),n(1,"mat-icon"),a(2,"payment"),i(),a(3," Pagar "),i()}}function Ui(t,m){if(t&1){let e=E();n(0,"button",95),g("click",function(){f(e);let o=p().$implicit,s=p(2);return h(s.cancelSession(o))}),n(1,"mat-icon"),a(2,"cancel"),i(),a(3," Cancelar "),i()}}function qi(t,m){if(t&1){let e=E();n(0,"td",90)(1,"button",91)(2,"mat-icon"),a(3,"more_vert"),i()(),n(4,"mat-menu",null,2)(6,"button",92),g("click",function(){let o=f(e).$implicit,s=p(2);return h(s.viewSession(o))}),n(7,"mat-icon"),a(8,"visibility"),i(),a(9," Ver Detalles "),i(),_(10,zi,4,0,"button",93)(11,Wi,4,0,"button",93)(12,Gi,4,0,"button",93)(13,Ui,4,0,"button",94),i()()}if(t&2){let e=m.$implicit,r=T(5),o=p(2);l(),d("matMenuTriggerFor",r),l(9),d("ngIf",o.canEdit(e)),l(),d("ngIf",o.canCheckout(e)),l(),d("ngIf",o.canPay(e)),l(),d("ngIf",o.canCancel(e))}}function Yi(t,m){t&1&&S(0,"tr",96)}function Qi(t,m){t&1&&S(0,"tr",97)}function Ji(t,m){if(t&1){let e=E();n(0,"mat-card")(1,"mat-card-content",45)(2,"div",46)(3,"table",47),g("matSortChange",function(o){f(e);let s=p();return h(s.onSortChange(o))}),C(4,48),_(5,xi,2,2,"th",49)(6,Mi,5,2,"td",50),x(),C(7,51),_(8,bi,2,0,"th",52)(9,Ei,3,1,"td",50),x(),C(10,53),_(11,yi,2,0,"th",54)(12,Di,3,1,"td",50),x(),C(13,55),_(14,wi,2,0,"th",56)(15,Ti,3,1,"td",50),x(),C(16,57),_(17,Ii,2,2,"th",58)(18,ki,3,3,"td",50),x(),C(19,59),_(20,Vi,2,2,"th",60)(21,Pi,3,3,"td",50),x(),C(22,61),_(23,Fi,2,2,"th",62)(24,Oi,3,3,"td",50),x(),C(25,63),_(26,Bi,3,4,"th",64)(27,Li,3,3,"td",50),x(),C(28,65),_(29,Ri,2,0,"th",66)(30,ji,3,3,"td",50),x(),C(31,67),_(32,Hi,2,3,"th",68)(33,qi,14,5,"td",69),x(),_(34,Yi,1,0,"tr",70)(35,Qi,1,0,"tr",71),i()()()()}if(t&2){let e=p();l(3),d("dataSource",e.sessions)("matSortActive",e.sortBy)("matSortDirection",e.sortOrder)("matSortDisableClear",!0),l(31),d("matHeaderRowDef",e.isMobile?e.displayedColumnsMobile:e.displayedColumns),l(),d("matRowDefColumns",e.isMobile?e.displayedColumnsMobile:e.displayedColumns)}}function Ki(t,m){if(t&1){let e=E();n(0,"mat-paginator",98),g("page",function(o){f(e);let s=p();return h(s.onPageChange(o))}),i()}if(t&2){let e=p();d("length",e.totalItems)("pageSize",e.pageSize)("pageSizeOptions",e.pageSizeOptions)("pageIndex",e.currentPage)}}function Xi(t,m){if(t&1){let e=E();n(0,"div",99)(1,"mat-icon",100),a(2,"directions_car"),i(),n(3,"h3",101),a(4,"No hay sesiones"),i(),n(5,"p",102),a(6,"No se encontraron sesiones con los filtros aplicados."),i(),n(7,"button",9),g("click",function(){f(e);let o=p();return h(o.createNewSession())}),n(8,"mat-icon"),a(9,"add"),i(),a(10," Crear Nueva Sesi\xF3n "),i()()}}var Kn=(()=>{class t{constructor(e,r,o,s,c,u,A,N){this.sessionService=e,this.sectorService=r,this.operatorService=o,this.router=s,this.snackBar=c,this.confirmationService=u,this.breakpointObserver=A,this.dialog=N,this._unsubscribeAll=new B,this.sessions=[],this.loading=!1,this.error=null,this.totalSessions=0,this.activeSessionsCount=0,this.completedSessionsCount=0,this.loadingMetrics=!1,this.totalItems=0,this.pageSize=15,this.currentPage=0,this.pageSizeOptions=[5,10,15,25,50],this.sortBy="started_at",this.sortOrder="desc",this.filters={plate:"",sector_id:void 0,operator_id:void 0,status:"",date_from:"",date_to:""},this.dateFromModel=null,this.dateToModel=null,this.sectors=[],this.operators=[],this.statusOptions=[{value:"",label:"Todos"},{value:"CREATED",label:"Creada"},{value:"ACTIVE",label:"Activa"},{value:"TO_PAY",label:"Por Pagar"},{value:"PAID",label:"Pagada"},{value:"CLOSED",label:"Cerrada"},{value:"CANCELED",label:"Cancelada"}],this.displayedColumns=["plate","sector","street","operator","started_at","ended_at","duration","amount","status","actions"],this.displayedColumnsMobile=["plate","started_at","ended_at","duration","amount","actions"],this.isMobile=!1}ngOnInit(){this.loadSectors(),this.loadOperators(),this.loadSessions(),this.loadMetrics(),this.breakpointObserver.observe([Be.Handset]).pipe(b(this._unsubscribeAll)).subscribe(e=>{this.isMobile=e.matches})}ngAfterViewInit(){this.sort&&setTimeout(()=>{this.sort.active=this.sortBy,this.sort.direction=this.sortOrder},0)}onSortChange(e){console.log("Sort change event:",e),e.active===this.sortBy?this.sortOrder==="desc"?this.sortOrder="asc":this.sortOrder="desc":(this.sortBy=e.active,this.sortOrder=e.direction==="asc"?"asc":"desc"),console.log("Updated sortBy:",this.sortBy,"sortOrder:",this.sortOrder),this.currentPage=0,this.loadSessions()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadSessions(){this.loading=!0,this.error=null;let e={page:this.currentPage+1,per_page:this.pageSize,sort_by:this.sortBy,sort_order:this.sortOrder};this.filters.plate&&this.filters.plate.trim()!==""&&(e.plate=this.filters.plate.trim()),this.filters.sector_id!==void 0&&this.filters.sector_id!==null&&(e.sector_id=this.filters.sector_id),this.filters.operator_id!==void 0&&this.filters.operator_id!==null&&(e.operator_id=this.filters.operator_id),this.filters.status&&this.filters.status.trim()!==""&&(e.status=this.filters.status),this.filters.date_from&&this.filters.date_from.trim()!==""&&(e.date_from=this.filters.date_from),this.filters.date_to&&this.filters.date_to.trim()!==""&&(e.date_to=this.filters.date_to),this.sessionService.getSessions(e).pipe(b(this._unsubscribeAll)).subscribe({next:r=>{this.sessions=r.data||[],this.totalItems=r.pagination?.total||0,this.loading=!1},error:r=>{this.error="Error al cargar sesiones",this.loading=!1,console.error("Error loading sessions:",r),this.snackBar.open("Error al cargar sesiones","Cerrar",{duration:3e3})}})}loadMetrics(){this.loadingMetrics=!0;let e={};this.filters.plate&&this.filters.plate.trim()!==""&&(e.plate=this.filters.plate.trim()),this.filters.sector_id!==void 0&&this.filters.sector_id!==null&&(e.sector_id=this.filters.sector_id),this.filters.operator_id!==void 0&&this.filters.operator_id!==null&&(e.operator_id=this.filters.operator_id),this.filters.date_from&&this.filters.date_from.trim()!==""&&(e.date_from=this.filters.date_from),this.filters.date_to&&this.filters.date_to.trim()!==""&&(e.date_to=this.filters.date_to);let r=F(P({},e),{page:1,per_page:1}),o=F(P({},e),{status:"ACTIVE",page:1,per_page:1}),s=F(P({},e),{status:"COMPLETED",page:1,per_page:1});if(this.filters.status&&this.filters.status.trim()!==""){let c=F(P({},e),{status:this.filters.status,page:1,per_page:1});this.sessionService.getSessions(c).pipe(b(this._unsubscribeAll)).subscribe({next:u=>{this.totalSessions=u.pagination?.total||0,this.filters.status==="ACTIVE"?(this.activeSessionsCount=u.pagination?.total||0,this.completedSessionsCount=0):this.filters.status==="COMPLETED"?(this.activeSessionsCount=0,this.completedSessionsCount=u.pagination?.total||0):(this.activeSessionsCount=0,this.completedSessionsCount=0),this.loadingMetrics=!1},error:u=>{console.error("Error loading metrics:",u),this.loadingMetrics=!1}})}else ke({total:this.sessionService.getSessions(r),active:this.sessionService.getSessions(o),completed:this.sessionService.getSessions(s)}).pipe(b(this._unsubscribeAll)).subscribe({next:c=>{this.totalSessions=c.total?.pagination?.total||0,this.activeSessionsCount=c.active?.pagination?.total||0,this.completedSessionsCount=c.completed?.pagination?.total||0,this.loadingMetrics=!1},error:c=>{console.error("Error loading metrics:",c),this.loadingMetrics=!1}})}loadSectors(){this.sectorService.getSectors().pipe(b(this._unsubscribeAll)).subscribe({next:e=>{this.sectors=e.data?.data||[]},error:e=>{console.error("Error loading sectors:",e)}})}loadOperators(){this.operatorService.getOperators().pipe(b(this._unsubscribeAll)).subscribe({next:e=>{this.operators=e.data?.data||[]},error:e=>{console.error("Error loading operators:",e)}})}viewSession(e){this.router.navigate(["/parking/sessions",e.id])}editSession(e){e.status==="ACTIVE"?this.router.navigate(["/parking/sessions",e.id,"edit"]):this.snackBar.open("Solo se pueden editar sesiones activas","Cerrar",{duration:3e3})}cancelSession(e){if(e.status!=="ACTIVE"){this.snackBar.open("Solo se pueden cancelar sesiones activas","Cerrar",{duration:3e3});return}this.confirmationService.open({title:"Cancelar Sesi\xF3n",message:`\xBFEst\xE1 seguro de cancelar la sesi\xF3n de la placa ${e.plate}?`,icon:{show:!0,name:"heroicons_outline:exclamation-triangle",color:"warn"},actions:{confirm:{show:!0,label:"Cancelar Sesi\xF3n",color:"warn"},cancel:{show:!0,label:"No"}}}).afterClosed().subscribe(o=>{o==="confirmed"&&this.sessionService.cancelSession(e.id).pipe(b(this._unsubscribeAll)).subscribe({next:s=>{this.snackBar.open("Sesi\xF3n cancelada exitosamente","Cerrar",{duration:3e3}),this.loadSessions()},error:s=>{this.snackBar.open("Error al cancelar sesi\xF3n","Cerrar",{duration:3e3}),console.error("Error canceling session:",s)}})})}checkoutSession(e){if(e.status!=="ACTIVE"){this.snackBar.open("Solo se puede hacer checkout de sesiones activas","Cerrar",{duration:3e3});return}this.router.navigate(["/parking/sessions",e.id,"checkout"])}paySession(e){if(e.status!=="TO_PAY"){this.snackBar.open("Solo se pueden pagar sesiones pendientes de pago","Cerrar",{duration:3e3});return}this.router.navigate(["/parking/sessions",e.id,"payment"])}formatAmount(e){return this.sessionService.formatAmount(e)}formatDate(e){return new Date(e).toLocaleString("es-CL")}formatDateTime(e){if(!e)return"N/A";let r=new Date(e);if(isNaN(r.getTime()))return"N/A";let o=r.toLocaleDateString("es-CL",{day:"2-digit",month:"2-digit",year:"2-digit"}),s=r.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${o} ${s}`}formatDateTimeMobile(e){if(!e)return"-";let r=new Date(e);if(isNaN(r.getTime()))return"-";let o=String(r.getDate()).padStart(2,"0"),s=String(r.getMonth()+1).padStart(2,"0"),c=String(r.getHours()).padStart(2,"0"),u=String(r.getMinutes()).padStart(2,"0");return`${o}/${s} ${c}:${u}`}formatDuration(e){return this.sessionService.formatDuration(e)}getStatusLabel(e){return this.sessionService.getStatusLabel(e)}getStatusColor(e){return this.sessionService.getStatusColor(e)}getStatusCircleColor(e){return{CREATED:"#6B7280",ACTIVE:"#3B82F6",TO_PAY:"#F59E0B",PAID:"#10B981",CLOSED:"#10B981",CANCELED:"#EF4444"}[e]||"#6B7280"}getTotalSessionsCount(){return this.loadingMetrics?0:this.totalSessions}getActiveSessionsCount(){return this.loadingMetrics?0:this.activeSessionsCount}getCompletedSessionsCount(){return this.loadingMetrics?0:this.completedSessionsCount}canEdit(e){return e.status==="ACTIVE"}canCancel(e){return e.status==="ACTIVE"}canCheckout(e){return e.status==="ACTIVE"}canPay(e){return e.status==="TO_PAY"}createNewSession(){this.router.navigate(["/parking/sessions/new"])}openDiscountsModal(){this.dialog.open(Mt,{width:"900px",maxWidth:"95vw",maxHeight:"90vh"}).afterClosed().subscribe(r=>{})}exportSessions(){this.snackBar.open("Funcionalidad de exportaci\xF3n en desarrollo","Cerrar",{duration:3e3})}refreshSessions(){this.loadSessions(),this.loadMetrics()}onSearchChange(e){this.filters.plate=e||""}onSectorChange(e){e===""||e===null?this.filters.sector_id=void 0:this.filters.sector_id=typeof e=="number"?e:parseInt(e,10),this.applyFilters()}onOperatorChange(e){e===""||e===null?this.filters.operator_id=void 0:this.filters.operator_id=typeof e=="number"?e:parseInt(e,10),this.applyFilters()}onStatusChange(e){this.filters.status=e||"",this.applyFilters()}formatDateLocal(e){let r=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${r}-${o}-${s}`}onDateFromChange(e){e?this.filters.date_from=this.formatDateLocal(e):this.filters.date_from="",this.applyFilters()}onDateToChange(e){e?this.filters.date_to=this.formatDateLocal(e):this.filters.date_to="",this.applyFilters()}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadSessions()}applyFilters(){this.currentPage=0,this.loadSessions(),this.loadMetrics()}clearFilters(){this.filters={plate:"",sector_id:void 0,operator_id:void 0,status:"",date_from:"",date_to:""},this.dateFromModel=null,this.dateToModel=null,this.currentPage=0,this.loadSessions(),this.loadMetrics()}static{this.\u0275fac=function(r){return new(r||t)(M(ct),M(xt),M(vt),M(Ae),M(le),M(te),M(Ne),M(Re))}}static{this.\u0275cmp=L({type:t,selectors:[["app-sessions"]],viewQuery:function(r,o){if(r&1&&Ve(we,5),r&2){let s;Pe(s=Fe())&&(o.sort=s.first)}},features:[Oe([{provide:ut,useValue:St()}])],decls:106,vars:21,consts:[["pickerFrom",""],["pickerTo",""],["actionMenu","matMenu"],[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"flex","gap-2"],["mat-raised-button","","color","accent",1,"rounded-sm",3,"click"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-blue-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"p-3","bg-purple-100","rounded-full"],[1,"text-purple-600"],[1,"text-2xl","font-bold","text-purple-600"],[1,"mb-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["appearance","outline"],["matInput","","placeholder","ABC123",3,"ngModelChange","ngModel"],["matPrefix",""],[3,"ngModelChange","selectionChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","placeholder","DD/MM/YYYY",3,"ngModelChange","dateChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],["class","flex justify-center items-center h-64",4,"ngIf"],["class","mb-6",4,"ngIf"],[4,"ngIf"],["showFirstLastButtons","","class","mt-4",3,"length","pageSize","pageSizeOptions","pageIndex","page",4,"ngIf"],["class","text-center py-12",4,"ngIf"],[3,"value"],[1,"flex","justify-center","items-center","h-64"],["diameter","50"],["type","error",3,"dismissible"],[1,"p-0"],[1,"overflow-x-auto"],["mat-table","","matSort","",1,"w-full","mat-elevation-z2",2,"width","100%","table-layout","fixed",3,"matSortChange","dataSource","matSortActive","matSortDirection","matSortDisableClear"],["matColumnDef","plate"],["mat-header-cell","","mat-sort-header","plate",3,"width",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","sector"],["mat-header-cell","","mat-sort-header","sector_id","style","width: 12%;",4,"matHeaderCellDef"],["matColumnDef","street"],["mat-header-cell","","mat-sort-header","street_id","style","width: 12%;",4,"matHeaderCellDef"],["matColumnDef","operator"],["mat-header-cell","","mat-sort-header","operator_in_id","style","width: 15%;",4,"matHeaderCellDef"],["matColumnDef","started_at"],["mat-header-cell","","mat-sort-header","started_at",3,"width",4,"matHeaderCellDef"],["matColumnDef","ended_at"],["mat-header-cell","","mat-sort-header","ended_at",3,"width",4,"matHeaderCellDef"],["matColumnDef","duration"],["mat-header-cell","","mat-sort-header","seconds_total",3,"width",4,"matHeaderCellDef"],["matColumnDef","amount"],["mat-header-cell","","mat-sort-header","net_amount",3,"width",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","status","style","width: 10%;",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","text-right",3,"width",4,"matHeaderCellDef"],["mat-cell","","class","text-right",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","mat-sort-header","plate"],["mat-cell",""],[1,"flex","items-center","gap-2"],["class","status-circle flex-shrink-0",3,"background-color","matTooltip",4,"ngIf"],[1,"font-medium","text-gray-900"],[1,"status-circle","flex-shrink-0",3,"matTooltip"],["mat-header-cell","","mat-sort-header","sector_id",2,"width","12%"],[1,"text-sm","text-gray-600"],["mat-header-cell","","mat-sort-header","street_id",2,"width","12%"],["mat-header-cell","","mat-sort-header","operator_in_id",2,"width","15%"],["mat-header-cell","","mat-sort-header","started_at"],["mat-header-cell","","mat-sort-header","ended_at"],["mat-header-cell","","mat-sort-header","seconds_total"],["mat-header-cell","","mat-sort-header","net_amount"],[1,"text-sm","font-medium","text-gray-900"],["mat-header-cell","","mat-sort-header","status",2,"width","10%"],[1,"px-2","py-1","rounded","text-xs","font-medium"],["mat-header-cell","",1,"text-right"],["mat-cell","",1,"text-right"],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","","class","text-red-600",3,"click",4,"ngIf"],["mat-menu-item","",1,"text-red-600",3,"click"],["mat-header-row",""],["mat-row",""],["showFirstLastButtons","",1,"mt-4",3,"page","length","pageSize","pageSizeOptions","pageIndex"],[1,"text-center","py-12"],[1,"text-6xl","text-gray-400","mb-4"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-600","mb-4"]],template:function(r,o){if(r&1){let s=E();n(0,"div",3)(1,"div",4)(2,"div")(3,"h1",5),a(4,"Sesiones"),i(),n(5,"p",6),a(6,"Gestiona las sesiones de estacionamiento del sistema"),i()(),n(7,"div",7)(8,"button",8),g("click",function(){return f(s),h(o.openDiscountsModal())}),n(9,"mat-icon"),a(10,"local_offer"),i(),a(11," Descuentos "),i(),n(12,"button",9),g("click",function(){return f(s),h(o.createNewSession())}),n(13,"mat-icon"),a(14,"add"),i(),a(15," Nueva Sesi\xF3n "),i()()(),n(16,"div",10)(17,"mat-card")(18,"mat-card-content",11)(19,"div",12)(20,"div",13)(21,"mat-icon",14),a(22,"directions_car"),i()(),n(23,"div",15)(24,"p",16),a(25,"Total de Sesiones"),i(),n(26,"p",17),a(27),i()()()()(),n(28,"mat-card")(29,"mat-card-content",11)(30,"div",12)(31,"div",18)(32,"mat-icon",19),a(33,"play_circle"),i()(),n(34,"div",15)(35,"p",16),a(36,"Sesiones Activas"),i(),n(37,"p",20),a(38),i()()()()(),n(39,"mat-card")(40,"mat-card-content",11)(41,"div",12)(42,"div",21)(43,"mat-icon",22),a(44,"check_circle"),i()(),n(45,"div",15)(46,"p",16),a(47,"Sesiones Completadas"),i(),n(48,"p",23),a(49),i()()()()()(),n(50,"mat-card",24)(51,"mat-card-content",11)(52,"div",25)(53,"mat-form-field",26)(54,"mat-label"),a(55,"Buscar por Placa"),i(),n(56,"input",27),V("ngModelChange",function(u){return f(s),k(o.filters.plate,u)||(o.filters.plate=u),h(u)}),i(),n(57,"mat-icon",28),a(58,"search"),i()(),n(59,"mat-form-field",26)(60,"mat-label"),a(61,"Sector"),i(),n(62,"mat-select",29),V("ngModelChange",function(u){return f(s),k(o.filters.sector_id,u)||(o.filters.sector_id=u),h(u)}),g("selectionChange",function(u){return f(s),h(o.onSectorChange(u.value))}),n(63,"mat-option",30),a(64,"Todos los sectores"),i(),_(65,fi,2,2,"mat-option",31),i()(),n(66,"mat-form-field",26)(67,"mat-label"),a(68,"Operador"),i(),n(69,"mat-select",29),V("ngModelChange",function(u){return f(s),k(o.filters.operator_id,u)||(o.filters.operator_id=u),h(u)}),g("selectionChange",function(u){return f(s),h(o.onOperatorChange(u.value))}),n(70,"mat-option",30),a(71,"Todos los operadores"),i(),_(72,hi,2,2,"mat-option",31),i()(),n(73,"mat-form-field",26)(74,"mat-label"),a(75,"Estado"),i(),n(76,"mat-select",29),V("ngModelChange",function(u){return f(s),k(o.filters.status,u)||(o.filters.status=u),h(u)}),g("selectionChange",function(u){return f(s),h(o.onStatusChange(u.value))}),_(77,gi,2,2,"mat-option",31),i()(),n(78,"mat-form-field",26)(79,"mat-label"),a(80,"Fecha Desde"),i(),n(81,"input",32),V("ngModelChange",function(u){return f(s),k(o.dateFromModel,u)||(o.dateFromModel=u),h(u)}),g("dateChange",function(u){return f(s),h(o.onDateFromChange(u.value))}),i(),S(82,"mat-datepicker-toggle",33)(83,"mat-datepicker",null,0),i(),n(85,"mat-form-field",26)(86,"mat-label"),a(87,"Fecha Hasta"),i(),n(88,"input",32),V("ngModelChange",function(u){return f(s),k(o.dateToModel,u)||(o.dateToModel=u),h(u)}),g("dateChange",function(u){return f(s),h(o.onDateToChange(u.value))}),i(),S(89,"mat-datepicker-toggle",33)(90,"mat-datepicker",null,1),i()(),n(92,"div",34)(93,"button",35),g("click",function(){return f(s),h(o.clearFilters())}),n(94,"mat-icon"),a(95,"clear"),i(),a(96," Limpiar "),i(),n(97,"button",9),g("click",function(){return f(s),h(o.applyFilters())}),n(98,"mat-icon"),a(99,"search"),i(),a(100," Filtrar "),i()()()(),_(101,Si,2,0,"div",36)(102,Ci,3,2,"div",37)(103,Ji,36,6,"mat-card",38)(104,Ki,1,4,"mat-paginator",39)(105,Xi,11,0,"div",40),i()}if(r&2){let s=T(84),c=T(91);l(27),v(" ",o.loadingMetrics?"...":o.getTotalSessionsCount()," "),l(11),v(" ",o.loadingMetrics?"...":o.getActiveSessionsCount()," "),l(11),v(" ",o.loadingMetrics?"...":o.getCompletedSessionsCount()," "),l(7),I("ngModel",o.filters.plate),l(6),I("ngModel",o.filters.sector_id),l(3),d("ngForOf",o.sectors),l(4),I("ngModel",o.filters.operator_id),l(3),d("ngForOf",o.operators),l(4),I("ngModel",o.filters.status),l(),d("ngForOf",o.statusOptions),l(4),d("matDatepicker",s),I("ngModel",o.dateFromModel),l(),d("for",s),l(6),d("matDatepicker",c),I("ngModel",o.dateToModel),l(),d("for",c),l(12),d("ngIf",o.loading),l(),d("ngIf",o.error),l(),d("ngIf",!o.loading),l(),d("ngIf",!o.loading&&o.sessions.length>0),l(),d("ngIf",!o.loading&&o.sessions.length===0)}},dependencies:[H,j,$,ot,ie,ne,Je,De,he,Se,Me,Ce,ge,be,xe,ve,Ee,ye,_t,pt,ht,we,ft,X,J,K,ee,Z,Q,Y,U,He,q,ae,oe,de,me,W,fe,ue,pe,_e,z,gt,We,ze,Ye,Ue,Ge,qe,rt,se,re,ce,dt,lt,mt,G],styles:[".mat-chip[_ngcontent-%COMP%]{font-size:12px;font-weight:500}.mat-chip.mat-chip-green[_ngcontent-%COMP%]{background-color:#10b981;color:#fff}.mat-chip.mat-chip-blue[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.mat-chip.mat-chip-orange[_ngcontent-%COMP%]{background-color:#f59e0b;color:#fff}.mat-chip.mat-chip-red[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff}.mat-chip.mat-chip-gray[_ngcontent-%COMP%]{background-color:#6b7280;color:#fff}.table-container[_ngcontent-%COMP%]{overflow-x:auto}@media (max-width: 768px){.mat-table[_ngcontent-%COMP%]{font-size:14px}.mat-header-cell[_ngcontent-%COMP%]{font-size:11px!important;font-weight:500}.mat-column-actions[_ngcontent-%COMP%]{width:60px}.mat-column-street[_ngcontent-%COMP%], .mat-column-operator[_ngcontent-%COMP%], .mat-column-sector[_ngcontent-%COMP%]{display:none}.status-circle[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:2px;display:inline-block;cursor:pointer;transition:transform .2s}.status-circle[_ngcontent-%COMP%]:hover{transform:scale(1.2)}}.filters-section[_ngcontent-%COMP%]{background:#f8fafc;border-radius:8px;padding:1.5rem;margin-bottom:1.5rem}.action-button[_ngcontent-%COMP%]{margin-right:8px}.action-button[_ngcontent-%COMP%]:last-child{margin-right:0}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem 1rem}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:4rem;height:4rem;width:4rem;color:#9ca3af;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#111827;font-size:1.125rem;font-weight:500;margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6b7280;margin-bottom:1rem}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:16rem}.error-container[_ngcontent-%COMP%]{margin-bottom:1.5rem}"]})}}return t})();export{Kn as SessionsComponent};
