import{a as ot}from"./chunk-4HRC5WJT.js";import{a as nt}from"./chunk-H4P7QJPG.js";import{a as H}from"./chunk-QU4WFXUG.js";import{a as pe}from"./chunk-ZMZZWBL4.js";import{c as et}from"./chunk-A34BBAVQ.js";import{a as Ye,b as Ze}from"./chunk-3OPQLQ7Z.js";import{a as qe,b as Le,c as $e,d as Ge,e as We,f as Ue,g as He,h as Ke,i as Je,j as Qe,k as Xe}from"./chunk-EYHG6JIJ.js";import{a as tt,c as it,f as rt}from"./chunk-O24YRI2L.js";import{a as Ne,b as Re,c as je,d as ze}from"./chunk-PFLL6SKJ.js";import{a as W,b as U}from"./chunk-7XMR7DBQ.js";import"./chunk-R6PAK4TL.js";import{a as G}from"./chunk-EQ3II6XW.js";import{a as ee,b as te,c as Me,e as Oe,f as Ie,g as ye,h as ie}from"./chunk-UG2EBNTC.js";import{a as ke,b as Fe,c as Te,d as Ae}from"./chunk-E7BFUDNM.js";import"./chunk-G7M3T37K.js";import"./chunk-UF23LYQO.js";import"./chunk-VKB6BRO6.js";import{b as Be}from"./chunk-MP4NGWWR.js";import{b as B,c as N}from"./chunk-U3LSFXAC.js";import{d as z,e as q}from"./chunk-PKSNJV5O.js";import{a as L,b as $}from"./chunk-VKOFSPQJ.js";import{b as T,c as re,f as we,j as A,k as D}from"./chunk-L3L2HYJX.js";import{b as R,d as b,f as j,g as oe,j as De,k as ae,n as le,o as me,u as Pe,v as se,x as Ve,y as de}from"./chunk-EGGCURRC.js";import{W as Ee,fa as F,la as P,na as ne,oa as V}from"./chunk-JXZZYULX.js";import"./chunk-CQGOYTFO.js";import"./chunk-7OGW3PNS.js";import{l as be,m as w,s as k}from"./chunk-TQARHOKX.js";import{$b as _,Eb as d,Jb as Se,Pb as n,Qb as t,Rb as h,Sb as E,Tb as M,U as O,Vb as y,bb as l,bc as c,cb as f,f as Q,lc as J,mc as o,nc as x,oa as S,oc as g,pa as v,pb as I,pc as ve,rc as X,sc as Y,tc as Z,wb as u}from"./chunk-BSJZAB7M.js";import{a as Ce}from"./chunk-TSRGIXR5.js";function St(i,s){if(i&1&&(n(0,"mat-error"),o(1),t()),i&2){let e=c();l(),g(" ",e.getErrorMessage("name")," ")}}function vt(i,s){if(i&1&&(n(0,"mat-error"),o(1),t()),i&2){let e=c();l(),g(" ",e.getErrorMessage("name")," ")}}function bt(i,s){if(i&1&&(n(0,"mat-error"),o(1),t()),i&2){let e=c();l(),g(" ",e.getErrorMessage("rut")," ")}}function Et(i,s){if(i&1&&(n(0,"mat-error"),o(1),t()),i&2){let e=c();l(),g(" ",e.getErrorMessage("rut")," ")}}function Mt(i,s){if(i&1&&(n(0,"mat-error"),o(1),t()),i&2){let e=c();l(),g(" ",e.getErrorMessage("email")," ")}}function Ot(i,s){if(i&1&&(n(0,"mat-error"),o(1),t()),i&2){let e=c();l(),g(" ",e.getErrorMessage("email")," ")}}function It(i,s){if(i&1&&(n(0,"mat-error"),o(1),t()),i&2){let e=c();l(),g(" ",e.getErrorMessage("phone")," ")}}function yt(i,s){if(i&1&&(n(0,"mat-error"),o(1),t()),i&2){let e=c();l(),g(" ",e.getErrorMessage("phone")," ")}}function wt(i,s){if(i&1&&(n(0,"mat-error"),o(1),t()),i&2){let e=c();l(),g(" ",e.getErrorMessage("pin")," ")}}function kt(i,s){i&1&&h(0,"mat-spinner",21)}function Ft(i,s){if(i&1&&(n(0,"mat-icon"),o(1),t()),i&2){let e=c();l(),x(e.data.isEdit?"save":"add")}}var ce=(()=>{class i{constructor(e,a,r,m,p,C){this.fb=e,this.dialogRef=a,this.data=r,this.operatorService=m,this.sectorService=p,this.snackBar=C,this.loading=!1,this.sectors=[],this.operatorForm=this.createForm()}ngOnInit(){this.loadSectors(),this.data.isEdit&&this.data.operator&&this.loadOperatorData()}createForm(){return this.fb.group({name:["",[b.required,b.minLength(2)]],rut:["",[b.required,b.pattern(/^[0-9]+-[0-9kK]{1}$/)]],email:["",[b.email]],phone:["",[b.pattern(/^[+]?[\d\s-()]+$/)]],pin:["",[b.pattern(/^[0-9]{6}$/)]],status:["ACTIVE"]})}loadSectors(){this.sectorService.getSectors().subscribe({next:e=>{this.sectors=e.data?.data||[]},error:e=>{console.error("Error loading sectors:",e),this.snackBar.open("Error al cargar sectores","Cerrar",{duration:3e3})}})}loadOperatorData(){this.data.operator&&this.operatorForm.patchValue({name:this.data.operator.name,rut:this.data.operator.rut,email:this.data.operator.email||"",phone:this.data.operator.phone||"",pin:this.data.operator.pin||"",status:this.data.operator.status||"ACTIVE"})}onSubmit(){if(this.operatorForm.valid){this.loading=!0;let e=this.operatorForm.value;if(this.data.isEdit&&this.data.operator){let a=Number(this.data.operator.id);this.operatorService.updateOperator(a,e).subscribe({next:r=>{this.loading=!1,this.snackBar.open("Operador actualizado correctamente","Cerrar",{duration:3e3}),this.dialogRef.close(r.data)},error:r=>{this.loading=!1,console.error("Error updating operator:",r),this.snackBar.open("Error al actualizar operador","Cerrar",{duration:3e3})}})}else this.operatorService.createOperator(e).subscribe({next:a=>{this.loading=!1,this.snackBar.open("Operador creado correctamente","Cerrar",{duration:3e3}),this.dialogRef.close(a.data)},error:a=>{this.loading=!1,this.snackBar.open("Error al crear operador","Cerrar",{duration:3e3})}})}else this.snackBar.open("Por favor, complete todos los campos requeridos","Cerrar",{duration:3e3})}onCancel(){this.dialogRef.close()}getErrorMessage(e){let a=this.operatorForm.get(e);return a?.hasError("required")?"Este campo es requerido":a?.hasError("email")?"Ingrese un email v\xE1lido":a?.hasError("minlength")?"M\xEDnimo 2 caracteres":a?.hasError("pattern")?e==="rut"?"Formato de RUT inv\xE1lido (ej: 12.345.678-9)":e==="pin"?"El PIN debe tener exactamente 6 d\xEDgitos":"Formato de tel\xE9fono inv\xE1lido":""}static{this.\u0275fac=function(a){return new(a||i)(f(se),f(ee),f(te),f(H),f(pe),f(G))}}static{this.\u0275cmp=I({type:i,selectors:[["app-operator-form"]],decls:56,vars:16,consts:[[1,"operator-form-dialog"],[1,"dialog-header"],[1,"dialog-title"],["mat-icon-button","",1,"close-button",3,"click"],[1,"dialog-content"],[1,"operator-form",3,"formGroup"],[1,"form-row"],["appearance","outline",1,"half-width"],["matInput","","formControlName","name","placeholder","Ingrese el nombre completo"],[4,"ngIf"],["matInput","","formControlName","rut","placeholder","12.345.678-9"],["matInput","","formControlName","email","type","email","placeholder","operador@ejemplo.com"],["matInput","","formControlName","phone","placeholder","+56 9 1234 5678"],["matInput","","formControlName","pin","placeholder","123456","maxlength","6"],["formControlName","status"],["value","ACTIVE"],["value","INACTIVE"],[1,"dialog-actions"],["mat-button","",1,"rounded-sm",3,"click","disabled"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click","disabled"],["diameter","20","class","inline-spinner",4,"ngIf"],["diameter","20",1,"inline-spinner"]],template:function(a,r){if(a&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),o(3),t(),n(4,"button",3),_("click",function(){return r.onCancel()}),n(5,"mat-icon"),o(6,"close"),t()()(),n(7,"div",4)(8,"form",5)(9,"div",6)(10,"mat-form-field",7)(11,"mat-label"),o(12,"Nombre completo"),t(),h(13,"input",8),u(14,St,2,1,"mat-error",9)(15,vt,2,1,"mat-error",9),t(),n(16,"mat-form-field",7)(17,"mat-label"),o(18,"RUT"),t(),h(19,"input",10),u(20,bt,2,1,"mat-error",9)(21,Et,2,1,"mat-error",9),t()(),n(22,"div",6)(23,"mat-form-field",7)(24,"mat-label"),o(25,"Email"),t(),h(26,"input",11),u(27,Mt,2,1,"mat-error",9)(28,Ot,2,1,"mat-error",9),t(),n(29,"mat-form-field",7)(30,"mat-label"),o(31,"Tel\xE9fono"),t(),h(32,"input",12),u(33,It,2,1,"mat-error",9)(34,yt,2,1,"mat-error",9),t()(),n(35,"div",6)(36,"mat-form-field",7)(37,"mat-label"),o(38,"PIN (6 d\xEDgitos)"),t(),h(39,"input",13),u(40,wt,2,1,"mat-error",9),t(),n(41,"mat-form-field",7)(42,"mat-label"),o(43,"Estado"),t(),n(44,"mat-select",14)(45,"mat-option",15),o(46,"Activo"),t(),n(47,"mat-option",16),o(48,"Inactivo"),t()()()()()(),n(49,"div",17)(50,"button",18),_("click",function(){return r.onCancel()}),o(51," Cancelar "),t(),n(52,"button",19),_("click",function(){return r.onSubmit()}),u(53,kt,1,0,"mat-spinner",20)(54,Ft,2,1,"mat-icon",9),o(55),t()()()),a&2){let m,p,C,K,ge,fe,_e,he,xe;l(3),g(" ",r.data.isEdit?"Editar Operador":"Nuevo Operador"," "),l(5),d("formGroup",r.operatorForm),l(6),d("ngIf",(m=r.operatorForm.get("name"))==null?null:m.hasError("required")),l(),d("ngIf",(p=r.operatorForm.get("name"))==null?null:p.hasError("minlength")),l(5),d("ngIf",(C=r.operatorForm.get("rut"))==null?null:C.hasError("required")),l(),d("ngIf",(K=r.operatorForm.get("rut"))==null?null:K.hasError("pattern")),l(6),d("ngIf",(ge=r.operatorForm.get("email"))==null?null:ge.hasError("required")),l(),d("ngIf",(fe=r.operatorForm.get("email"))==null?null:fe.hasError("email")),l(5),d("ngIf",(_e=r.operatorForm.get("phone"))==null?null:_e.hasError("required")),l(),d("ngIf",(he=r.operatorForm.get("phone"))==null?null:he.hasError("pattern")),l(6),d("ngIf",(xe=r.operatorForm.get("pin"))==null?null:xe.hasError("pattern")),l(10),d("disabled",r.loading),l(2),d("disabled",r.loading||r.operatorForm.invalid),l(),d("ngIf",r.loading),l(),d("ngIf",!r.loading),l(),g(" ",r.data.isEdit?"Actualizar":"Crear"," ")}},dependencies:[k,w,de,ae,R,j,oe,Pe,le,me,ie,D,A,T,re,q,z,V,P,ne,N,B,U,W,F,Be,$,L],styles:[".operator-form-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:90vh;width:100%}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem 1.5rem 0;border-bottom:1px solid #e5e7eb;margin-bottom:1rem}.dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:#111827}.close-button[_ngcontent-%COMP%]{margin-left:auto}.dialog-content[_ngcontent-%COMP%]{flex:1;padding:0 1.5rem;overflow-y:auto}.dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1rem 1.5rem 1.5rem;border-top:1px solid #e5e7eb;margin-top:1rem}.operator-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-start}.full-width[_ngcontent-%COMP%]{width:100%}.half-width[_ngcontent-%COMP%]{flex:1}.inline-spinner[_ngcontent-%COMP%]{margin-right:8px}@media (max-width: 600px){.operator-form-dialog[_ngcontent-%COMP%]{max-height:95vh}.form-row[_ngcontent-%COMP%]{flex-direction:column}.half-width[_ngcontent-%COMP%]{width:100%}.dialog-header[_ngcontent-%COMP%]{padding:1rem 1rem 0}.dialog-content[_ngcontent-%COMP%]{padding:0 1rem}.dialog-actions[_ngcontent-%COMP%]{padding:1rem}}"]})}}return i})();function Tt(i,s){if(i&1&&(n(0,"mat-option",30),o(1),t()),i&2){let e=s.$implicit;d("value",e.id),l(),ve(" ",e.name," (",e.is_private?"Privado":"P\xFAblico",") ")}}function At(i,s){if(i&1&&(n(0,"mat-error"),o(1),t()),i&2){let e=c();l(),g(" ",e.getErrorMessage("sector_id")," ")}}function Dt(i,s){if(i&1&&(n(0,"mat-option",30),o(1),t()),i&2){let e=s.$implicit;d("value",e.id),l(),g(" ",e.name," ")}}function Pt(i,s){i&1&&h(0,"mat-spinner",31)}function Vt(i,s){if(i&1&&(n(0,"mat-error"),o(1),t()),i&2){let e=c();l(),g(" ",e.getErrorMessage("valid_from")," ")}}function Bt(i,s){i&1&&h(0,"mat-spinner",31)}function Nt(i,s){if(i&1&&(n(0,"mat-icon"),o(1),t()),i&2){let e=c();l(),x(e.data.isEdit?"save":"add")}}var ue=(()=>{class i{constructor(e,a,r,m,p,C){this.fb=e,this.dialogRef=a,this.data=r,this.operatorService=m,this.sectorService=p,this.snackBar=C,this._unsubscribeAll=new Q,this.loading=!1,this.sectors=[],this.streets=[],this.loadingStreets=!1,this.assignmentForm=this.createForm()}ngOnInit(){this.loadSectors(),this.data.isEdit&&this.data.assignment&&this.loadAssignmentData()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}createForm(){return this.fb.group({sector_id:["",[b.required]],street_id:[""],valid_from:["",[b.required]],valid_to:[""]})}loadSectors(){this.sectorService.getSectors().pipe(O(this._unsubscribeAll)).subscribe({next:e=>{this.sectors=e.data?.data||[]},error:e=>{console.error("Error loading sectors:",e),this.snackBar.open("Error al cargar sectores","Cerrar",{duration:3e3})}})}onSectorChange(e){this.streets=[],this.assignmentForm.patchValue({street_id:""}),e&&this.loadStreetsBySector(e)}loadStreetsBySector(e){this.loadingStreets=!0,this.sectorService.getSectorStreets(e).pipe(O(this._unsubscribeAll)).subscribe({next:a=>{this.streets=a.data||[],this.loadingStreets=!1},error:a=>{console.error("Error loading streets:",a),this.snackBar.open("Error al cargar calles","Cerrar",{duration:3e3}),this.loadingStreets=!1}})}loadAssignmentData(){this.data.assignment&&(this.assignmentForm.patchValue({sector_id:this.data.assignment.sector_id,street_id:this.data.assignment.street_id,valid_from:this.data.assignment.valid_from,valid_to:this.data.assignment.valid_to}),this.data.assignment.sector_id&&this.loadStreetsBySector(this.data.assignment.sector_id))}onSubmit(){if(this.assignmentForm.valid){this.loading=!0;let e=this.assignmentForm.value;e.valid_from&&(e.valid_from=new Date(e.valid_from).toISOString().split("T")[0]),e.valid_to&&(e.valid_to=new Date(e.valid_to).toISOString().split("T")[0]),this.operatorService.assignOperator(this.data.operator.id,e).pipe(O(this._unsubscribeAll)).subscribe({next:a=>{let r=a.message||"Asignaci\xF3n realizada exitosamente";this.snackBar.open(r,"Cerrar",{duration:4e3}),this.dialogRef.close(!0)},error:a=>{console.error("Error assigning operator:",a),this.snackBar.open("Error al asignar operador","Cerrar",{duration:3e3}),this.loading=!1}})}else this.snackBar.open("Por favor, complete todos los campos requeridos","Cerrar",{duration:3e3})}onCancel(){this.dialogRef.close()}getErrorMessage(e){return this.assignmentForm.get(e)?.hasError("required")?"Este campo es requerido":""}static{this.\u0275fac=function(a){return new(a||i)(f(se),f(ee),f(te),f(H),f(pe),f(G))}}static{this.\u0275cmp=I({type:i,selectors:[["app-operator-assignment"]],decls:61,vars:19,consts:[["picker1",""],["picker2",""],[1,"operator-assignment-dialog"],["mat-dialog-title",""],[1,"mb-4","p-3","bg-gray-50","rounded-lg"],[1,"flex","items-center","gap-2"],[1,"text-gray-500"],[1,"font-semibold"],[1,"mb-4","p-3","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"flex","items-start","gap-2"],[1,"text-blue-600","mt-0.5"],[1,"text-sm","text-blue-800"],[1,"font-medium","mb-1"],[1,"assignment-form",3,"formGroup"],[1,"form-row"],["appearance","outline",1,"full-width"],["formControlName","sector_id",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["formControlName","street_id",3,"disabled"],["value",""],["diameter","20","class","inline-spinner",4,"ngIf"],[1,"form-row","grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline"],["matInput","","formControlName","valid_from",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","valid_to",3,"matDatepicker"],["align","end"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click","disabled"],[3,"value"],["diameter","20",1,"inline-spinner"]],template:function(a,r){if(a&1){let m=y();n(0,"div",2)(1,"h2",3),o(2),t(),n(3,"mat-dialog-content")(4,"div",4)(5,"div",5)(6,"mat-icon",6),o(7,"person"),t(),n(8,"span",7),o(9),t(),n(10,"span",6),o(11),t()()(),n(12,"div",8)(13,"div",9)(14,"mat-icon",10),o(15,"info"),t(),n(16,"div",11)(17,"p",12),o(18,"Informaci\xF3n importante:"),t(),n(19,"p"),o(20,"Al asignar un nuevo sector, se eliminar\xE1n autom\xE1ticamente todas las asignaciones anteriores del operador. Cada operador solo puede tener un sector asignado a la vez."),t()()()(),n(21,"form",13)(22,"div",14)(23,"mat-form-field",15)(24,"mat-label"),o(25,"Sector *"),t(),n(26,"mat-select",16),_("selectionChange",function(C){return S(m),v(r.onSectorChange(C.value))}),u(27,Tt,2,3,"mat-option",17),t(),u(28,At,2,1,"mat-error",18),t()(),n(29,"div",14)(30,"mat-form-field",15)(31,"mat-label"),o(32,"Calle (Opcional)"),t(),n(33,"mat-select",19)(34,"mat-option",20),o(35,"Sin calle espec\xEDfica"),t(),u(36,Dt,2,2,"mat-option",17),t(),u(37,Pt,1,0,"mat-spinner",21),t()(),n(38,"div",22)(39,"mat-form-field",23)(40,"mat-label"),o(41,"V\xE1lido desde *"),t(),h(42,"input",24)(43,"mat-datepicker-toggle",25)(44,"mat-datepicker",null,0),u(46,Vt,2,1,"mat-error",18),t(),n(47,"mat-form-field",23)(48,"mat-label"),o(49,"V\xE1lido hasta (Opcional)"),t(),h(50,"input",26)(51,"mat-datepicker-toggle",25)(52,"mat-datepicker",null,1),t()()()(),n(54,"mat-dialog-actions",27)(55,"button",28),_("click",function(){return S(m),v(r.onCancel())}),o(56," Cancelar "),t(),n(57,"button",29),_("click",function(){return S(m),v(r.onSubmit())}),u(58,Bt,1,0,"mat-spinner",21)(59,Nt,2,1,"mat-icon",18),o(60),t()()()}if(a&2){let m,p,C=J(45),K=J(53);l(2),g(" ",r.data.isEdit?"Editar Asignaci\xF3n":"Asignar Sector"," "),l(7),x(r.data.operator.name),l(2),g("(",r.data.operator.rut,")"),l(10),d("formGroup",r.assignmentForm),l(6),d("ngForOf",r.sectors),l(),d("ngIf",(m=r.assignmentForm.get("sector_id"))==null?null:m.hasError("required")),l(5),d("disabled",r.loadingStreets),l(3),d("ngForOf",r.streets),l(),d("ngIf",r.loadingStreets),l(5),d("matDatepicker",C),l(),d("for",C),l(3),d("ngIf",(p=r.assignmentForm.get("valid_from"))==null?null:p.hasError("required")),l(4),d("matDatepicker",K),l(),d("for",K),l(4),d("disabled",r.loading),l(2),d("disabled",r.loading||r.assignmentForm.invalid),l(),d("ngIf",r.loading),l(),d("ngIf",!r.loading),l(),g(" ",r.data.isEdit?"Actualizar":"Asignar"," ")}},dependencies:[k,be,w,de,ae,R,j,oe,le,me,ie,Oe,ye,Ie,D,A,T,re,we,q,z,U,W,F,V,P,N,B,$,L,ze,Ne,Re,je,Ee],styles:[".operator-assignment-dialog[_ngcontent-%COMP%]{min-width:500px;max-width:600px}.assignment-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{margin-bottom:16px}.assignment-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.inline-spinner[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-content[_ngcontent-%COMP%]{max-height:70vh;overflow-y:auto}"]})}}return i})();function Rt(i,s){i&1&&(n(0,"th",45),o(1,"Nombre"),t())}function jt(i,s){if(i&1&&(n(0,"td",46)(1,"div",47)(2,"mat-icon",48),o(3,"person"),t(),n(4,"span",49),o(5),t()()()),i&2){let e=s.$implicit;l(5),x(e.name)}}function zt(i,s){i&1&&(n(0,"th",45),o(1,"RUT"),t())}function qt(i,s){if(i&1&&(n(0,"td",46)(1,"span",50),o(2),t()()),i&2){let e=s.$implicit;l(2),x(e.rut||"No asignado")}}function Lt(i,s){i&1&&(n(0,"th",45),o(1,"Email"),t())}function $t(i,s){if(i&1&&(n(0,"td",46)(1,"span",4),o(2),t()()),i&2){let e=s.$implicit;l(2),x(e.email||"No asignado")}}function Gt(i,s){i&1&&(n(0,"th",45),o(1,"Tel\xE9fono"),t())}function Wt(i,s){if(i&1&&(n(0,"td",46)(1,"span",4),o(2),t()()),i&2){let e=s.$implicit;l(2),x(e.phone||"No asignado")}}function Ut(i,s){i&1&&(n(0,"th",45),o(1,"Estado"),t())}function Ht(i,s){if(i&1&&(n(0,"td",46)(1,"span"),o(2),t()()),i&2){let e=s.$implicit,a=c();l(),Se("px-2 py-1 rounded text-xs font-medium status-",a.getStatusColor(e),""),l(),g(" ",a.getStatusText(e)," ")}}function Kt(i,s){i&1&&(n(0,"th",45),o(1,"Acciones"),t())}function Jt(i,s){if(i&1){let e=y();n(0,"button",55),_("click",function(){S(e);let r=c().$implicit,m=c();return v(m.removeAllAssignments(r))}),n(1,"mat-icon"),o(2,"location_off"),t(),o(3," Eliminar Asignaciones "),t()}}function Qt(i,s){if(i&1){let e=y();n(0,"td",46)(1,"button",51)(2,"mat-icon"),o(3,"more_vert"),t()(),n(4,"mat-menu",null,0)(6,"button",52),_("click",function(){let r=S(e).$implicit,m=c();return v(m.viewOperator(r))}),n(7,"mat-icon"),o(8,"visibility"),t(),o(9," Ver detalles "),t(),n(10,"button",52),_("click",function(){let r=S(e).$implicit,m=c();return v(m.editOperator(r))}),n(11,"mat-icon"),o(12,"edit"),t(),o(13," Editar "),t(),n(14,"button",52),_("click",function(){let r=S(e).$implicit,m=c();return v(m.assignOperator(r))}),n(15,"mat-icon"),o(16,"location_on"),t(),o(17," Asignar Sector "),t(),u(18,Jt,4,0,"button",53),n(19,"button",54),_("click",function(){let r=S(e).$implicit,m=c();return v(m.deleteOperator(r))}),n(20,"mat-icon"),o(21,"delete"),t(),o(22," Eliminar "),t()()()}if(i&2){let e=s.$implicit,a=J(5),r=c();l(),d("matMenuTriggerFor",a),l(17),d("ngIf",r.getAssignmentsCount(e)>0)}}function Xt(i,s){i&1&&h(0,"tr",56)}function Yt(i,s){i&1&&h(0,"tr",57)}function Zt(i,s){i&1&&(n(0,"div",58),h(1,"mat-spinner",59),t())}function ei(i,s){i&1&&(n(0,"div",60)(1,"mat-icon",61),o(2,"people"),t(),n(3,"h3",62),o(4,"No hay operadores registrados"),t(),n(5,"p",48),o(6,"Los operadores aparecer\xE1n aqu\xED cuando se registren."),t()())}function ti(i,s){if(i&1){let e=y();n(0,"mat-paginator",63),_("page",function(r){S(e);let m=c();return v(m.onPageChange(r))}),t()}if(i&2){let e=c();d("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}var Ji=(()=>{class i{constructor(e,a,r){this.operatorService=e,this.dialog=a,this.snackBar=r,this._unsubscribeAll=new Q,this.operators=[],this.loading=!1,this.displayedColumns=["name","rut","email","phone","status","actions"],this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.filters={name:"",status:"",sector:""}}ngOnInit(){this.loadOperators()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadOperators(){this.loading=!0;let e=Ce({page:this.currentPage+1,per_page:this.pageSize},this.filters);this.operatorService.getOperators(e).pipe(O(this._unsubscribeAll)).subscribe({next:a=>{this.operators=a.data?.data||[],this.totalItems=a.data?.total||0,this.loading=!1},error:a=>{console.error("Error loading operators:",a),this.loading=!1}})}getAssignmentsCount(e){if(!e.operator_assignments||e.operator_assignments.length===0)return 0;let a=new Set;return e.operator_assignments.forEach(r=>{r.sector&&r.sector.id&&a.add(r.sector.id)}),a.size}getAssignments(e){if(!e.operator_assignments||e.operator_assignments.length===0)return[];let a=[],r=new Set;return e.operator_assignments.forEach(m=>{m.sector&&m.sector.id&&!r.has(m.sector.id)&&(a.push({type:"Sector",name:m.sector.name,id:m.sector.id}),r.add(m.sector.id))}),a}getStatusColor(e){return this.getAssignmentsCount(e)>0?"assigned":"unassigned"}getStatusText(e){return this.getAssignmentsCount(e)>0?"Asignado":"Sin asignar"}createOperator(){this.dialog.open(ce,{width:"600px",data:{isEdit:!1}}).afterClosed().subscribe(a=>{a&&this.loadOperators()})}editOperator(e){this.dialog.open(ce,{width:"600px",data:{isEdit:!0,operator:e}}).afterClosed().subscribe(r=>{r&&this.loadOperators()})}deleteOperator(e){confirm(`\xBFEst\xE1 seguro de eliminar al operador ${e.name}?`)&&this.operatorService.deleteOperator(e.id).subscribe({next:()=>{this.snackBar.open("Operador eliminado correctamente","Cerrar",{duration:3e3}),this.loadOperators()},error:a=>{this.snackBar.open("Error al eliminar operador","Cerrar",{duration:3e3})}})}getAssignedCount(){return this.operators.filter(e=>this.getAssignmentsCount(e)>0).length}getUnassignedCount(){return this.operators.filter(e=>this.getAssignmentsCount(e)===0).length}viewOperator(e){let a=[{label:"Nombre",key:"name",icon:"person",type:"text"},{label:"RUT",key:"rut",icon:"badge",type:"text"},{label:"Email",key:"email",icon:"email",type:"text"},{label:"Tel\xE9fono",key:"phone",icon:"phone",type:"text"},{label:"Estado",key:"status",icon:"toggle_on",type:"badge",badgeColor:m=>m==="ACTIVE"?"success":"error"},{label:"Asignaciones",key:"operator_assignments",icon:"location_on",type:"array",format:m=>!m||m.length===0?["Sin asignaciones"]:m.map(p=>`${p.sector?.name||"Sector"}${p.street?.name?" - "+p.street.name:""}`)},{label:"Fecha de Creaci\xF3n",key:"created_at",icon:"schedule",type:"date"}],r=this.dialog.open(ot,{width:"600px",data:{title:"Detalles del Operador",data:e,fields:a,actions:[{label:"Editar",icon:"edit",color:"primary",action:()=>{r.close(),this.editOperator(e)}},{label:"Asignar",icon:"location_on",color:"accent",action:()=>{r.close(),this.assignOperator(e)}}]}})}removeAllAssignments(e){confirm(`\xBFEst\xE1 seguro de eliminar todas las asignaciones del operador ${e.name}?`)&&this.operatorService.removeAllAssignments(e.id).subscribe({next:a=>{this.snackBar.open(a.message||"Asignaciones eliminadas correctamente","Cerrar",{duration:3e3}),this.loadOperators()},error:a=>{this.snackBar.open("Error al eliminar asignaciones","Cerrar",{duration:3e3})}})}assignOperator(e){this.dialog.open(ue,{width:"600px",data:{operator:e}}).afterClosed().subscribe(r=>{r&&this.loadOperators()})}applyFilters(){this.currentPage=0,this.loadOperators()}clearFilters(){this.filters={name:"",status:"",sector:""},this.currentPage=0,this.loadOperators()}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadOperators()}assignSector(e){this.dialog.open(ue,{width:"600px",data:{isEdit:!1,operator:e}}).afterClosed().subscribe(r=>{r&&this.loadOperators()})}static{this.\u0275fac=function(a){return new(a||i)(f(H),f(Me),f(G))}}static{this.\u0275cmp=I({type:i,selectors:[["app-operators"]],decls:104,vars:12,consts:[["menu","matMenu"],[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-blue-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"p-3","bg-orange-100","rounded-full"],[1,"text-orange-600"],[1,"text-2xl","font-bold","text-orange-600"],[1,"mb-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["appearance","outline"],["matInput","","placeholder","Nombre o email",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],["value","assigned"],["value","unassigned"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","rut"],["matColumnDef","email"],["matColumnDef","phone"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],["mat-header-cell",""],["mat-cell",""],[1,"flex","items-center","gap-2"],[1,"text-gray-500"],[1,"font-semibold"],[1,"text-gray-600","font-mono"],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","","class","text-orange-600",3,"click",4,"ngIf"],["mat-menu-item","",1,"text-red-600",3,"click"],["mat-menu-item","",1,"text-orange-600",3,"click"],["mat-header-row",""],["mat-row",""],[1,"flex","justify-center","items-center","py-8"],["diameter","40"],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"]],template:function(a,r){a&1&&(n(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),o(4,"Operadores"),t(),n(5,"p",4),o(6,"Gestiona los operadores del sistema"),t()(),n(7,"button",5),_("click",function(){return r.createOperator()}),n(8,"mat-icon"),o(9,"add"),t(),o(10," Nuevo Operador "),t()(),n(11,"div",6)(12,"mat-card")(13,"mat-card-content",7)(14,"div",8)(15,"div",9)(16,"mat-icon",10),o(17,"people"),t()(),n(18,"div",11)(19,"p",12),o(20,"Total Operadores"),t(),n(21,"p",13),o(22),t()()()()(),n(23,"mat-card")(24,"mat-card-content",7)(25,"div",8)(26,"div",14)(27,"mat-icon",15),o(28,"check_circle"),t()(),n(29,"div",11)(30,"p",12),o(31,"Asignados"),t(),n(32,"p",16),o(33),t()()()()(),n(34,"mat-card")(35,"mat-card-content",7)(36,"div",8)(37,"div",17)(38,"mat-icon",18),o(39,"warning"),t()(),n(40,"div",11)(41,"p",12),o(42,"Sin Asignar"),t(),n(43,"p",19),o(44),t()()()()()(),n(45,"mat-card",20)(46,"mat-card-content",7)(47,"div",21)(48,"mat-form-field",22)(49,"mat-label"),o(50,"Buscar operador"),t(),n(51,"input",23),Z("ngModelChange",function(p){return Y(r.filters.name,p)||(r.filters.name=p),p}),t()(),n(52,"mat-form-field",22)(53,"mat-label"),o(54,"Estado"),t(),n(55,"mat-select",24),Z("ngModelChange",function(p){return Y(r.filters.status,p)||(r.filters.status=p),p}),n(56,"mat-option",25),o(57,"Todos"),t(),n(58,"mat-option",26),o(59,"Asignado"),t(),n(60,"mat-option",27),o(61,"Sin asignar"),t()()(),n(62,"mat-form-field",22)(63,"mat-label"),o(64,"Sector"),t(),n(65,"mat-select",24),Z("ngModelChange",function(p){return Y(r.filters.sector,p)||(r.filters.sector=p),p}),n(66,"mat-option",25),o(67,"Todos los sectores"),t()()()(),n(68,"div",28)(69,"button",29),_("click",function(){return r.clearFilters()}),n(70,"mat-icon"),o(71,"clear"),t(),o(72," Limpiar "),t(),n(73,"button",5),_("click",function(){return r.applyFilters()}),n(74,"mat-icon"),o(75,"search"),t(),o(76," Filtrar "),t()()()(),n(77,"mat-card")(78,"mat-card-content",7)(79,"div",30)(80,"table",31),E(81,32),u(82,Rt,2,0,"th",33)(83,jt,6,1,"td",34),M(),E(84,35),u(85,zt,2,0,"th",33)(86,qt,3,1,"td",34),M(),E(87,36),u(88,Lt,2,0,"th",33)(89,$t,3,1,"td",34),M(),E(90,37),u(91,Gt,2,0,"th",33)(92,Wt,3,1,"td",34),M(),E(93,38),u(94,Ut,2,0,"th",33)(95,Ht,3,4,"td",34),M(),E(96,39),u(97,Kt,2,0,"th",33)(98,Qt,23,2,"td",34),M(),u(99,Xt,1,0,"tr",40)(100,Yt,1,0,"tr",41),t(),u(101,Zt,2,0,"div",42)(102,ei,7,0,"div",43),t(),u(103,ti,1,5,"mat-paginator",44),t()()()),a&2&&(l(22),x(r.operators.length),l(11),x(r.getAssignedCount()),l(11),x(r.getUnassignedCount()),l(7),X("ngModel",r.filters.name),l(4),X("ngModel",r.filters.status),l(10),X("ngModel",r.filters.sector),l(15),d("dataSource",r.operators),l(19),d("matHeaderRowDef",r.displayedColumns),l(),d("matRowDefColumns",r.displayedColumns),l(),d("ngIf",r.loading),l(),d("ngIf",!r.loading&&r.operators.length===0),l(),d("ngIf",r.totalItems>0))},dependencies:[k,w,Ve,R,j,De,Xe,qe,$e,He,Ge,Le,Ke,We,Ue,Je,Qe,rt,tt,it,V,P,ne,N,B,$,L,nt,D,A,T,q,z,Ae,Fe,ke,Te,et,U,W,F,Ze,Ye],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151}.mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}.status-assigned[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.status-unassigned[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.operators-assignments-list[_ngcontent-%COMP%]{max-height:4rem;overflow-y:auto;padding:.25rem}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:2px}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:2px}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}@media (max-width: 768px){.grid-cols-3[_ngcontent-%COMP%]{grid-template-columns:1fr}.mat-mdc-table[_ngcontent-%COMP%]{font-size:.875rem}}"]})}}return i})();export{Ji as OperatorsComponent};
