import{a as he}from"./chunk-GSBQMD6L.js";import{a as Ee,b as be,c as ve}from"./chunk-JBGLLQFX.js";import{d as _e}from"./chunk-ZEK3ZV5P.js";import{a as se,b as ce,c as ue,d as pe,e as fe,f as ge}from"./chunk-CFZHHQ3I.js";import{a as re,b as ne}from"./chunk-FGUURFJS.js";import{a as oe,b as le}from"./chunk-MB5OSV7M.js";import{a as ae,b as ie}from"./chunk-AGGAQN5G.js";import"./chunk-EOYQYJ3N.js";import{a as S}from"./chunk-VKB6BRO6.js";import{a as me,b as de}from"./chunk-GVLOHDYR.js";import{b as U,c as W}from"./chunk-72F6PA3H.js";import{d as ee,e as te}from"./chunk-ZU6VUINT.js";import{b as V,c as G,d as B,j as L,k as A}from"./chunk-EO526QJS.js";import{A as Z,b as j,d,f as R,g as $,k as z,l as J,n as K,q as Q,u as X,x as Y}from"./chunk-SGTC2IXF.js";import{W as D,fa as q,la as O,oa as H}from"./chunk-56JILNRZ.js";import"./chunk-TTG7A5I5.js";import{d as w}from"./chunk-FDUGCV2L.js";import{m as T,t as P}from"./chunk-IZAOXH6X.js";import{$b as N,Eb as l,Pb as a,Qb as e,Rb as p,bb as o,cb as x,mc as t,nc as I,pb as k,wb as b}from"./chunk-QDWFRTQW.js";import{d as F}from"./chunk-TSRGIXR5.js";function xe(r,c){r&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function Se(r,c){r&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ce(r,c){r&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function ye(r,c){r&1&&(a(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Me(r,c){r&1&&(a(0,"mat-form-field",12)(1,"mat-label"),t(2,"Pago Posterior de Lavado"),e(),a(3,"mat-select",43)(4,"mat-option",19),t(5,"Activado"),e(),a(6,"mat-option",19),t(7,"Desactivado"),e()(),a(8,"mat-hint"),t(9,"Permite que los clientes paguen el lavado al retirar el veh\xEDculo en lugar de inmediatamente"),e()()),r&2&&(o(4),l("value",!0),o(2),l("value",!1))}function Fe(r,c){r&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ne(r,c){r&1&&(a(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function ke(r,c){r&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ie(r,c){r&1&&(a(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Te(r,c){r&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function Pe(r,c){r&1&&(a(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}var dt=(()=>{class r{constructor(i,m,n,f){this.fb=i,this.pricingProfileService=m,this.http=n,this.snackBar=f,this.loading=!1,this.planName="Sin plan",this.generalForm=this.fb.group({name:["STPark - Sistema de Estacionamientos",[d.required]],language:["es",[d.required]],plan_name:["Sin plan"],pos_tuu:[{value:!1,disabled:!0}],boleta_electronica:[{value:!1,disabled:!0}],max_capacity:[0,[d.required,d.min(0)]],car_wash_enabled:[{value:!1,disabled:!0}],car_wash_payment_deferred:[!1]}),this.pricingForm=this.fb.group({price_per_min:[0,[d.required,d.min(0)]],min_amount:[0,[d.required,d.min(0)]],daily_max_amount:[0,[d.required,d.min(0)]],start_time:["00:00",d.required],end_time:["23:59",d.required],is_active:[!0]})}ngOnInit(){this.loadGeneralSettings(),this.loadDefaultPricing()}loadGeneralSettings(){this.loading=!0,this.http.get(`${S.apiUrl}/settings/general`).subscribe({next:i=>{if(i&&i.success&&i.data){console.log("Configuraci\xF3n general cargada:",i.data);let n=i.data.plan_name||"Sin plan";this.planName=n,console.log("Plan name asignado:",this.planName);let m=i.data,{plan_name:f,pos_tuu:C,boleta_electronica:y,car_wash_enabled:v}=m,h=F(m,["plan_name","pos_tuu","boleta_electronica","car_wash_enabled"]);this.generalForm.patchValue(h),setTimeout(()=>{let u=this.generalForm.get("plan_name");u&&(u.disabled&&u.enable({emitEvent:!1}),u.setValue(n,{emitEvent:!1}),setTimeout(()=>{u.disable({emitEvent:!1})},100));let g=this.generalForm.get("pos_tuu");g&&i.data.pos_tuu!==void 0&&(g.disabled&&g.enable({emitEvent:!1}),g.setValue(i.data.pos_tuu,{emitEvent:!1}),setTimeout(()=>{g.disable({emitEvent:!1})},100));let _=this.generalForm.get("boleta_electronica");_&&i.data.boleta_electronica!==void 0&&(_.disabled&&_.enable({emitEvent:!1}),_.setValue(i.data.boleta_electronica,{emitEvent:!1}),setTimeout(()=>{_.disable({emitEvent:!1})},100));let E=this.generalForm.get("car_wash_enabled");if(E&&i.data.car_wash_enabled!==void 0){E.disabled&&E.enable({emitEvent:!1});let s=!!i.data.car_wash_enabled;E.setValue(s,{emitEvent:!1}),setTimeout(()=>{E.disable({emitEvent:!1})},100)}if(i.data.car_wash_enabled===!0){let s=this.generalForm.get("car_wash_payment_deferred");s&&s.enable({emitEvent:!1})}else{let s=this.generalForm.get("car_wash_payment_deferred");s&&(s.setValue(!1,{emitEvent:!1}),s.disable({emitEvent:!1}))}},0)}else console.warn("La respuesta no tiene el formato esperado:",i);this.loading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n general:",i),console.log("No hay configuraci\xF3n general previa, usando valores por defecto"),this.loading=!1}})}loadDefaultPricing(){this.loading=!0,this.http.get(`${S.apiUrl}/settings/default-pricing`).subscribe({next:i=>{i&&i.success&&i.data?(console.log("Configuraci\xF3n de precios cargada:",i.data),this.pricingForm.patchValue(i.data)):console.warn("La respuesta no tiene el formato esperado:",i),this.loading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n de precios:",i),console.log("No hay configuraci\xF3n previa, usando valores por defecto"),this.loading=!1}})}saveSettings(){let i=this.getActiveTab();i==="general"?this.saveGeneralSettings():i==="pricing"&&this.savePricingSettings()}getActiveTab(){let i=document.querySelector("mat-tab-group");if(i){let m=i.querySelector(".mat-mdc-tab-active");if(m){let n=m.querySelector(".mdc-tab__text-label");if(n?.textContent?.toLowerCase().includes("general"))return"general";if(n?.textContent?.toLowerCase().includes("precios"))return"pricing"}}return"general"}saveGeneralSettings(){if(this.generalForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let i=this.generalForm.get("car_wash_payment_deferred"),m=i?i.value:!1,h=this.generalForm.getRawValue(),{pos_tuu:n,boleta_electronica:f,car_wash_enabled:C,plan_name:y}=h,v=F(h,["pos_tuu","boleta_electronica","car_wash_enabled","plan_name"]);v.car_wash_payment_deferred=m,console.log("Settings: Enviando configuraci\xF3n al backend",v),this.http.post(`${S.apiUrl}/settings/general`,v).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n general guardada exitosamente","Cerrar",{duration:3e3}),this.loadGeneralSettings()},error:u=>{console.error("Error al guardar configuraci\xF3n general:",u),this.snackBar.open("Error al guardar la configuraci\xF3n general","Cerrar",{duration:3e3}),this.loading=!1}})}savePricingSettings(){if(this.pricingForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let i=this.pricingForm.value;this.http.post(`${S.apiUrl}/settings/default-pricing`,i).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n de precios guardada exitosamente","Cerrar",{duration:3e3}),this.loading=!1},error:m=>{console.error("Error al guardar configuraci\xF3n de precios:",m),this.snackBar.open("Error al guardar la configuraci\xF3n de precios","Cerrar",{duration:3e3}),this.loading=!1}})}resetSettings(){this.generalForm.reset({name:"STPark - Sistema de Estacionamientos",language:"es",pos_tuu:!1,boleta_electronica:!1,max_capacity:0}),this.pricingForm.reset({price_per_min:0,min_amount:0,daily_max_amount:0,start_time:"00:00",end_time:"23:59",is_active:!0}),this.snackBar.open("Valores restaurados","Cerrar",{duration:2e3})}static{this.\u0275fac=function(m){return new(m||r)(x(Y),x(he),x(w),x(re))}}static{this.\u0275cmp=k({type:r,selectors:[["app-settings"]],decls:160,vars:21,consts:[[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"flex","gap-2"],["mat-stroked-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"w-full"],["label","General"],[1,"p-6"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Nombre del sistema"],[4,"ngIf"],["formControlName","language"],["value","es"],["value","en"],["formControlName","plan_name"],[3,"value"],[2,"display","inline-flex","align-items","center","gap","4px"],[2,"font-size","16px","width","16px","height","16px"],["matInput","","type","number","formControlName","max_capacity","placeholder","0","min","0"],["formControlName","pos_tuu"],["formControlName","boleta_electronica"],["formControlName","car_wash_enabled"],["appearance","outline",4,"ngIf"],["label","Precios"],[1,"space-y-4"],[1,"bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-800","rounded-lg","p-4"],[1,"flex","items-start","gap-3"],[1,"text-blue-600","dark:text-blue-400"],[1,"text-sm","text-blue-800","dark:text-blue-200"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["matInput","","type","number","formControlName","price_per_min","placeholder","0","min","0"],["matInput","","type","number","formControlName","min_amount","placeholder","0","min","0"],["matInput","","type","number","formControlName","daily_max_amount","placeholder","0","min","0"],[1,"my-6"],[1,"text-lg","font-semibold","mb-4"],["matInput","","type","time","formControlName","start_time"],["matInput","","type","time","formControlName","end_time"],[1,"flex","items-center","gap-2","mb-4"],["formControlName","is_active"],["formControlName","car_wash_payment_deferred"]],template:function(m,n){if(m&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),t(4,"Configuraci\xF3n"),e(),a(5,"p",3),t(6,"Configura los par\xE1metros del sistema de estacionamientos"),e()(),a(7,"div",4)(8,"button",5),N("click",function(){return n.resetSettings()}),a(9,"mat-icon"),t(10,"refresh"),e(),t(11," Restaurar "),e(),a(12,"button",6),N("click",function(){return n.saveSettings()}),a(13,"mat-icon"),t(14,"save"),e(),t(15," Guardar "),e()()(),a(16,"mat-tab-group",7)(17,"mat-tab",8)(18,"div",9)(19,"mat-card")(20,"mat-card-header")(21,"mat-card-title"),t(22,"Configuraci\xF3n General"),e(),a(23,"mat-card-subtitle"),t(24,"Par\xE1metros b\xE1sicos del sistema"),e()(),a(25,"mat-card-content")(26,"form",10)(27,"div",11)(28,"mat-form-field",12)(29,"mat-label"),t(30,"Nombre del sistema"),e(),p(31,"input",13),b(32,xe,2,0,"mat-error",14),e(),a(33,"mat-form-field",12)(34,"mat-label"),t(35,"Idioma"),e(),a(36,"mat-select",15)(37,"mat-option",16),t(38,"Espa\xF1ol"),e(),a(39,"mat-option",17),t(40,"English"),e()(),b(41,Se,2,0,"mat-error",14),e(),a(42,"mat-form-field",12)(43,"mat-label"),t(44,"Suscripci\xF3n"),e(),a(45,"mat-select",18)(46,"mat-option",19),t(47),e()(),a(48,"mat-hint")(49,"span",20)(50,"mat-icon",21),t(51,"lock"),e(),t(52," Plan de servicio asociado al estacionamiento (solo lectura) "),e()()(),a(53,"mat-form-field",12)(54,"mat-label"),t(55,"M\xE1xima Capacidad"),e(),p(56,"input",22),a(57,"mat-hint"),t(58,"Cantidad m\xE1xima de veh\xEDculos que pueden estar en el estacionamiento simult\xE1neamente"),e(),b(59,Ce,2,0,"mat-error",14)(60,ye,2,0,"mat-error",14),e(),a(61,"mat-form-field",12)(62,"mat-label"),t(63,"POS TUU"),e(),a(64,"mat-select",23)(65,"mat-option",19),t(66,"Activado"),e(),a(67,"mat-option",19),t(68,"Desactivado"),e()(),a(69,"mat-hint")(70,"span",20)(71,"mat-icon",21),t(72,"lock"),e(),t(73," Solo lectura - Solo administradores pueden modificar este valor "),e()()(),a(74,"mat-form-field",12)(75,"mat-label"),t(76,"Boleta Electr\xF3nica"),e(),a(77,"mat-select",24)(78,"mat-option",19),t(79,"Activado"),e(),a(80,"mat-option",19),t(81,"Desactivado"),e()(),a(82,"mat-hint")(83,"span",20)(84,"mat-icon",21),t(85,"lock"),e(),t(86," Solo lectura - Solo administradores pueden modificar este valor "),e()()(),a(87,"mat-form-field",12)(88,"mat-label"),t(89,"M\xF3dulo de Lavado de Autos"),e(),a(90,"mat-select",25)(91,"mat-option",19),t(92,"Activado"),e(),a(93,"mat-option",19),t(94,"Desactivado"),e()(),a(95,"mat-hint")(96,"span",20)(97,"mat-icon",21),t(98,"lock"),e(),t(99," Solo lectura - Solo administradores pueden modificar este valor "),e()()(),b(100,Me,10,2,"mat-form-field",26),e()()()()()(),a(101,"mat-tab",27)(102,"div",9)(103,"mat-card")(104,"mat-card-header")(105,"mat-card-title"),t(106,"Configuraci\xF3n de Precios por Defecto"),e(),a(107,"mat-card-subtitle"),t(108,"Establece las tarifas por defecto del sistema"),e()(),a(109,"mat-card-content")(110,"div",28)(111,"div",29)(112,"div",30)(113,"mat-icon",31),t(114,"info"),e(),a(115,"div",32)(116,"strong"),t(117,"Nota:"),e(),t(118," Estos precios se utilizar\xE1n como regla de precio por defecto si no existen otras reglas espec\xEDficas para el sector. "),e()()(),a(119,"form",10)(120,"div",33)(121,"mat-form-field",12)(122,"mat-label"),t(123,"Costo por Minuto (CLP)"),e(),p(124,"input",34),a(125,"mat-hint"),t(126,"Precio por cada minuto de estacionamiento"),e(),b(127,Fe,2,0,"mat-error",14)(128,Ne,2,0,"mat-error",14),e(),a(129,"mat-form-field",12)(130,"mat-label"),t(131,"Tarifa M\xEDnima (CLP)"),e(),p(132,"input",35),a(133,"mat-hint"),t(134,"Cantidad m\xEDnima a cobrar"),e(),b(135,ke,2,0,"mat-error",14)(136,Ie,2,0,"mat-error",14),e(),a(137,"mat-form-field",12)(138,"mat-label"),t(139,"Tarifa M\xE1xima (CLP)"),e(),p(140,"input",36),a(141,"mat-hint"),t(142,"L\xEDmite m\xE1ximo a cobrar por d\xEDa"),e(),b(143,Te,2,0,"mat-error",14)(144,Pe,2,0,"mat-error",14),e()(),p(145,"mat-divider",37),a(146,"h3",38),t(147,"Configuraci\xF3n de Horarios"),e(),a(148,"div",11)(149,"mat-form-field",12)(150,"mat-label"),t(151,"Hora de Inicio"),e(),p(152,"input",39),e(),a(153,"mat-form-field",12)(154,"mat-label"),t(155,"Hora de Fin"),e(),p(156,"input",40),e()(),a(157,"div",41)(158,"mat-checkbox",42),t(159,"Regla activa"),e()()()()()()()()()()),m&2){let f,C,y,v,h,u,g,_,E,M,s;o(26),l("formGroup",n.generalForm),o(6),l("ngIf",(f=n.generalForm.get("name"))==null?null:f.hasError("required")),o(9),l("ngIf",(C=n.generalForm.get("language"))==null?null:C.hasError("required")),o(5),l("value",n.planName),o(),I(n.planName),o(12),l("ngIf",(y=n.generalForm.get("max_capacity"))==null?null:y.hasError("required")),o(),l("ngIf",(v=n.generalForm.get("max_capacity"))==null?null:v.hasError("min")),o(5),l("value",!0),o(2),l("value",!1),o(11),l("value",!0),o(2),l("value",!1),o(11),l("value",!0),o(2),l("value",!1),o(7),l("ngIf",((h=n.generalForm.get("car_wash_enabled"))==null?null:h.value)===!0),o(19),l("formGroup",n.pricingForm),o(8),l("ngIf",(u=n.pricingForm.get("price_per_min"))==null?null:u.hasError("required")),o(),l("ngIf",(g=n.pricingForm.get("price_per_min"))==null?null:g.hasError("min")),o(7),l("ngIf",(_=n.pricingForm.get("min_amount"))==null?null:_.hasError("required")),o(),l("ngIf",(E=n.pricingForm.get("min_amount"))==null?null:E.hasError("min")),o(7),l("ngIf",(M=n.pricingForm.get("daily_max_amount"))==null?null:M.hasError("required")),o(),l("ngIf",(s=n.pricingForm.get("daily_max_amount"))==null?null:s.hasError("min"))}},dependencies:[P,T,Z,z,j,J,R,$,X,K,Q,ge,se,ue,fe,pe,ce,H,O,W,U,ve,Ee,be,A,L,V,B,G,te,ee,le,oe,q,de,me,ie,ae,D,_e,ne],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-tab-group[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.config-item[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:8px;padding:1rem;transition:all .2s ease}.config-item[_ngcontent-%COMP%]:hover{border-color:#3b82f6;box-shadow:0 2px 4px #0000001a}@media (max-width: 768px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return r})();export{dt as SettingsComponent};
