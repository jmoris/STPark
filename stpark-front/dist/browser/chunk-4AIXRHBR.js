import{a as K,b as Q}from"./chunk-A23QWCHP.js";import{a as J}from"./chunk-NIHVD5W5.js";import{a as q,b as G}from"./chunk-POSCZER2.js";import"./chunk-ECYJLMJT.js";import{a as P}from"./chunk-VKB6BRO6.js";import{b as U,c as O}from"./chunk-IMRKXFOQ.js";import{e as Y}from"./chunk-5Q7CCL6V.js";import{b as k,j as $,k as z}from"./chunk-K3BNOLHS.js";import{a as H,b as V}from"./chunk-CWSZZ2DY.js";import{f as B,j as N,z as W}from"./chunk-ZTFUS4RN.js";import{fa as L,la as R,oa as j}from"./chunk-QQQ5XT6I.js";import"./chunk-72DR3HUO.js";import"./chunk-YXFY4UXK.js";import{d as I}from"./chunk-EARUC3FY.js";import{s as F}from"./chunk-BAM5RHC5.js";import{$b as f,Eb as p,Lb as u,Nb as S,Ob as E,Pb as i,Qb as n,Rb as g,U as v,bb as s,bc as b,cb as _,f as M,mc as r,nc as h,pb as y,rc as w,sc as T,tc as A,wb as D}from"./chunk-MLNNMN4J.js";import{a as C,b as x}from"./chunk-TSRGIXR5.js";var X=(o,m)=>m.value;function Z(o,m){if(o&1&&(i(0,"mat-option",8),r(1),n()),o&2){let t=m.$implicit;p("value",t.value),s(),h(t.label)}}function tt(o,m){o&1&&(i(0,"div",10),g(1,"mat-spinner",12),n())}function et(o,m){if(o&1&&(i(0,"div",11)(1,"p",13),r(2),n()()),o&2){let t=b();s(2),h(t.error)}}function nt(o,m){if(o&1&&(i(0,"div",14)(1,"fuse-card",15)(2,"div",16)(3,"div")(4,"p",17),r(5,"Total Estacionamientos"),n(),i(6,"h2",3),r(7),n()(),i(8,"div",18)(9,"mat-icon",19),r(10,"business"),n()()()(),i(11,"fuse-card",15)(12,"div",16)(13,"div")(14,"p",17),r(15,"Registrados este mes"),n(),i(16,"h2",3),r(17),n()(),i(18,"div",20)(19,"mat-icon",21),r(20,"trending_up"),n()()()()(),i(21,"fuse-card",15)(22,"h3",22),r(23,"Evoluci\xF3n de Tenants Registrados"),n(),i(24,"div",23),g(25,"apx-chart",24),n()()),o&2){let t=b();s(7),h(t.totalTenants),s(10),h(t.tenantsThisMonth),s(8),p("series",t.tenantsChart.series)("chart",t.tenantsChart.chart)("dataLabels",t.tenantsChart.dataLabels)("stroke",t.tenantsChart.stroke)("xaxis",t.tenantsChart.xaxis)("yaxis",t.tenantsChart.yaxis)("colors",t.tenantsChart.colors)("grid",t.tenantsChart.grid)("tooltip",t.tenantsChart.tooltip)}}var Et=(()=>{class o{constructor(t){this.http=t,this._unsubscribeAll=new M,this.baseUrl=`${P.authApiUrl}/api`,this.loading=!1,this.error=null,this.totalTenants=0,this.tenantsThisMonth=0,this.selectedMonth="",this.availableMonths=[],this.tenantsChart={},this.initializeMonths(),this.selectedMonth=this.getCurrentMonth()}ngOnInit(){this.loadDashboardData(),this.initializeChart()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}initializeMonths(){let t=[],l=new Date;for(let e=11;e>=0;e--){let a=new Date(l.getFullYear(),l.getMonth()-e,1),d=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,c=a.toLocaleDateString("es-CL",{year:"numeric",month:"long"});t.push({value:d,label:c.charAt(0).toUpperCase()+c.slice(1)})}this.availableMonths=t}getCurrentMonth(){let t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`}loadDashboardData(){this.loading=!0,this.error=null;let[t,l]=this.selectedMonth.split("-"),e={year:t,month:l};this.http.get(`${this.baseUrl}/central-admin/dashboard`,{params:e}).pipe(v(this._unsubscribeAll)).subscribe({next:a=>{a.success&&a.data&&(this.totalTenants=a.data.total,this.tenantsThisMonth=a.data.registeredThisMonth,this.updateChart(a.data.monthlyData)),this.loading=!1},error:a=>{console.error("Error loading dashboard data:",a),this.error="Error al cargar los datos del dashboard",this.loading=!1}})}initializeChart(){this.tenantsChart={series:[{name:"Tenants Registrados",data:[]}],chart:{type:"line",height:350,toolbar:{show:!1}},dataLabels:{enabled:!0},stroke:{curve:"smooth",width:3},xaxis:{categories:[]},yaxis:{title:{text:"Cantidad de Tenants"}},colors:["#043476"],grid:{borderColor:"#e7e7e7",row:{colors:["#f3f3f3","transparent"],opacity:.5}},tooltip:{y:{formatter:t=>`${t} tenants`}}}}updateChart(t){let l=t.map(a=>{let[d,c]=a.month.split("-");return new Date(parseInt(d),parseInt(c)-1,1).toLocaleDateString("es-CL",{month:"short",year:"numeric"})}),e=t.map(a=>a.count);this.tenantsChart=x(C({},this.tenantsChart),{series:[{name:"Tenants Registrados",data:e}],xaxis:{categories:l}})}onMonthChange(){this.loadDashboardData()}refreshData(){this.loadDashboardData()}static{this.\u0275fac=function(l){return new(l||o)(_(I))}}static{this.\u0275cmp=y({type:o,selectors:[["app-central-admin-dashboard"]],decls:22,vars:5,consts:[[1,"p-6","w-full"],[1,"mb-8"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"mt-2","text-gray-600"],[1,"flex","items-center","gap-4"],["appearance","outline",1,"w-full","md:w-64"],[3,"ngModelChange","selectionChange","ngModel"],[3,"value"],["mat-raised-button","",1,"rounded-sm",3,"click","disabled"],[1,"flex","justify-center","items-center","py-12"],[1,"mb-6","p-4","bg-red-50","border","border-red-200","rounded-lg"],["diameter","50"],[1,"text-red-800"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6","mb-8"],[1,"p-6"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-gray-600","mb-1"],[1,"p-4","bg-blue-100","rounded-full"],[1,"text-blue-600",2,"font-size","32px","width","32px","height","32px"],[1,"p-4","bg-green-100","rounded-full"],[1,"text-green-600",2,"font-size","32px","width","32px","height","32px"],[1,"text-xl","font-semibold","text-gray-900","mb-4"],["id","tenants-chart"],[3,"series","chart","dataLabels","stroke","xaxis","yaxis","colors","grid","tooltip"]],template:function(l,e){l&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),r(5,"Dashboard Administraci\xF3n Central"),n(),i(6,"p",4),r(7,"Resumen de estacionamientos (tenants) del sistema"),n()(),i(8,"div",5)(9,"mat-form-field",6)(10,"mat-label"),r(11,"Mes"),n(),i(12,"mat-select",7),A("ngModelChange",function(d){return T(e.selectedMonth,d)||(e.selectedMonth=d),d}),f("selectionChange",function(){return e.onMonthChange()}),S(13,Z,2,2,"mat-option",8,X),n()(),i(15,"button",9),f("click",function(){return e.refreshData()}),i(16,"mat-icon"),r(17,"refresh"),n(),r(18," Refrescar "),n()()()(),D(19,tt,2,0,"div",10)(20,et,3,1,"div",11)(21,nt,26,11),n()),l&2&&(s(12),w("ngModel",e.selectedMonth),s(),E(e.availableMonths),s(2),p("disabled",e.loading),s(4),u(e.loading?19:-1),s(),u(e.error&&!e.loading?20:-1),s(),u(!e.loading&&!e.error?21:-1))},dependencies:[F,W,B,N,J,j,R,O,U,V,H,z,$,k,G,q,L,Y,Q,K],styles:["#tenants-chart[_ngcontent-%COMP%]{min-height:350px}"]})}}return o})();export{Et as CentralAdminDashboardComponent};
