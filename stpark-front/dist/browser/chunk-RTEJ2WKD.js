import{a as ve}from"./chunk-Q4BJS35R.js";import{a as he}from"./chunk-NOKTONEF.js";import{c as gt}from"./chunk-ZMAIZYCZ.js";import{a as Y,b as Z,c as $,d as ee}from"./chunk-ZEK3ZV5P.js";import{a as ct,b as pt,c as ut,d as ge,e as _t,f as ft,g as vt}from"./chunk-FJTAFRYA.js";import{a as et,b as tt,c as it,d as nt,e as at,f as rt,g as ot,h as lt,i as mt,j as st,k as dt}from"./chunk-A3W56N53.js";import{a as Ye,c as Ze,f as $e}from"./chunk-CFZHHQ3I.js";import{a as fe,b as Xe}from"./chunk-FGUURFJS.js";import{a as Oe,b as Re,c as qe,d as je}from"./chunk-UQSNXR2K.js";import"./chunk-3FSFXLFF.js";import{a as K,b as X}from"./chunk-MB5OSV7M.js";import{a as re,b as oe,c as Ae,e as Te,f as De,g as ke,h as O}from"./chunk-ZMKJJYLL.js";import"./chunk-EOYQYJ3N.js";import{a as Ne}from"./chunk-ACMTDFES.js";import"./chunk-FWGAGG6F.js";import"./chunk-VKB6BRO6.js";import{b as W,c as H}from"./chunk-72F6PA3H.js";import{d as Q,e as J}from"./chunk-ZU6VUINT.js";import{b as R,c as Ve,d as le,e as Pe,f as q,j,k as B}from"./chunk-EO526QJS.js";import{a as ue,b as _e}from"./chunk-6JXRNXI3.js";import{A as Ke,b as G,d as b,f as U,g as se,h as Be,j as de,k as ce,l as ze,n as Le,o as We,p as He,q as Ge,u as Ue,v as Qe,x as Je,z as pe}from"./chunk-SGTC2IXF.js";import{W as we,fa as N,la as z,na as me,oa as L}from"./chunk-56JILNRZ.js";import"./chunk-TTG7A5I5.js";import{d as Fe}from"./chunk-P2DCSIJY.js";import"./chunk-FDUGCV2L.js";import{l as ne,m as ae,t as P}from"./chunk-IZAOXH6X.js";import{$b as h,Eb as d,Ib as xe,Lc as Me,Pb as i,Qb as t,Rb as x,Sb as T,Tb as D,U as te,Vb as I,bb as l,bc as g,cb as C,f as Ie,fc as ye,gc as be,hc as Se,lc as k,mc as n,nc as v,oa as _,oc as A,pa as f,pb as V,rc as E,sc as M,tc as F,uc as Ee,wb as u}from"./chunk-QDWFRTQW.js";import{a as ie,b as Ce}from"./chunk-TSRGIXR5.js";function Nt(a,s){if(a&1&&(i(0,"mat-option",35),n(1),t()),a&2){let e=s.$implicit;d("value",e.id),l(),A(" ",e.name||e.id," ")}}function Ot(a,s){a&1&&(i(0,"mat-error"),n(1," El estacionamiento es requerido "),t())}function Rt(a,s){a&1&&(i(0,"mat-error"),n(1," El nombre del cliente es requerido "),t())}function qt(a,s){a&1&&(i(0,"mat-error"),n(1," Debe tener al menos 2 caracteres "),t())}function jt(a,s){a&1&&(i(0,"mat-error"),n(1," El RUT es requerido "),t())}function Bt(a,s){a&1&&(i(0,"mat-error"),n(1," La fecha de emisi\xF3n es requerida "),t())}function zt(a,s){a&1&&(i(0,"mat-error"),n(1," La descripci\xF3n es requerida "),t())}function Lt(a,s){a&1&&(i(0,"mat-error"),n(1," Debe tener al menos 2 caracteres "),t())}function Wt(a,s){a&1&&(i(0,"mat-error"),n(1," La cantidad es requerida "),t())}function Ht(a,s){a&1&&(i(0,"mat-error"),n(1," La cantidad debe ser mayor a 0 "),t())}function Gt(a,s){a&1&&(i(0,"mat-error"),n(1," El precio unitario es requerido "),t())}function Ut(a,s){a&1&&(i(0,"mat-error"),n(1," El precio debe ser mayor o igual a 0 "),t())}function Qt(a,s){a&1&&(i(0,"mat-error"),n(1," El subtotal es requerido "),t())}function Jt(a,s){if(a&1){let e=I();i(0,"div",36)(1,"div",37)(2,"h4",38),n(3),t(),i(4,"button",39),h("click",function(){let r=_(e).index,m=g();return f(m.removeItem(r))}),i(5,"mat-icon"),n(6,"delete"),t()()(),i(7,"div",6)(8,"mat-form-field",40)(9,"mat-label"),n(10,"Descripci\xF3n"),t(),x(11,"input",41),i(12,"mat-icon",10),n(13,"description"),t(),u(14,zt,2,0,"mat-error",11)(15,Lt,2,0,"mat-error",11),t(),i(16,"mat-form-field",7)(17,"mat-label"),n(18,"Cantidad"),t(),x(19,"input",42),i(20,"mat-icon",10),n(21,"numbers"),t(),u(22,Wt,2,0,"mat-error",11)(23,Ht,2,0,"mat-error",11),t(),i(24,"mat-form-field",7)(25,"mat-label"),n(26,"Precio Unitario"),t(),x(27,"input",43),i(28,"mat-icon",10),n(29,"attach_money"),t(),u(30,Gt,2,0,"mat-error",11)(31,Ut,2,0,"mat-error",11),t(),i(32,"mat-form-field",7)(33,"mat-label"),n(34,"Subtotal"),t(),x(35,"input",44),i(36,"mat-icon",10),n(37,"calculate"),t(),i(38,"mat-hint"),n(39,"Calculado autom\xE1ticamente"),t(),u(40,Qt,2,0,"mat-error",11),t(),i(41,"mat-form-field",40)(42,"mat-label"),n(43,"Notas del Item"),t(),x(44,"textarea",45),i(45,"mat-icon",10),n(46,"note"),t()()()()}if(a&2){let e,o,r,m,p,c,S,y=s.index,w=g();d("formGroupName",y),l(3),A("Item ",y+1,""),l(),d("disabled",w.itemsFormArray.length===1),l(10),d("ngIf",(e=w.itemsFormArray.at(y).get("description"))==null?null:e.hasError("required")),l(),d("ngIf",(o=w.itemsFormArray.at(y).get("description"))==null?null:o.hasError("minlength")),l(7),d("ngIf",(r=w.itemsFormArray.at(y).get("quantity"))==null?null:r.hasError("required")),l(),d("ngIf",(m=w.itemsFormArray.at(y).get("quantity"))==null?null:m.hasError("min")),l(7),d("ngIf",(p=w.itemsFormArray.at(y).get("unit_price"))==null?null:p.hasError("required")),l(),d("ngIf",(c=w.itemsFormArray.at(y).get("unit_price"))==null?null:c.hasError("min")),l(9),d("ngIf",(S=w.itemsFormArray.at(y).get("subtotal"))==null?null:S.hasError("required"))}}function Kt(a,s){a&1&&x(0,"mat-spinner",46)}function Xt(a,s){if(a&1&&(i(0,"span"),n(1),t()),a&2){let e=g();l(),v(e.data.isEdit?"Actualizar":"Crear")}}function Yt(a,s){a&1&&(i(0,"span"),n(1,"Guardando..."),t())}var wt=(()=>{class a{get itemsFormArray(){return this.invoiceForm.get("items")}constructor(e,o,r,m,p,c){this.fb=e,this.dialogRef=o,this.data=r,this.invoiceService=m,this.tenantService=p,this.snackBar=c,this.loading=!1}ngOnInit(){this.invoiceForm=this.createForm(),this.data.isEdit&&this.data.invoice?setTimeout(()=>{this.loadInvoiceData()},50):(this.addItem(),setTimeout(()=>{this.calculateTotals()},100)),this.invoiceForm.get("tenant_id")?.valueChanges.subscribe(e=>{e&&!this.data.isEdit&&this.loadTenantBillingData(e)})}createForm(){let o=new Date().toISOString().split("T")[0];return this.fb.group({tenant_id:["",b.required],client_name:["",[b.required,b.minLength(2)]],client_rut:["",[b.required]],emission_date:[o,b.required],notes:[""],items:this.fb.array([]),_net_amount:[0],_iva_amount:[0],_total_amount:[0]})}loadInvoiceData(){if(this.data.invoice){let e={tenant_id:this.data.invoice.tenant?.id||"",client_name:this.data.invoice.client_name,client_rut:this.data.invoice.client_rut,emission_date:this.data.invoice.emission_date,notes:this.data.invoice.notes||""};this.data.invoice.items&&this.data.invoice.items.length>0?this.data.invoice.items.forEach(o=>{this.addItem(o)}):this.addItem(),this.invoiceForm.patchValue(e,{emitEvent:!1})}}loadTenantBillingData(e){let o=this.data.tenants.find(r=>r.id===e);if(o){if(o.razon_social||o.rut){let r={};o.razon_social&&(r.client_name=o.razon_social),o.rut&&(r.client_rut=o.rut),Object.keys(r).length>0&&this.invoiceForm.patchValue(r,{emitEvent:!1})}}else this.tenantService.getTenant(e).subscribe({next:r=>{if(r.success&&r.data){let m=r.data,p={};m.razon_social&&(p.client_name=m.razon_social),m.rut&&(p.client_rut=m.rut),Object.keys(p).length>0&&this.invoiceForm.patchValue(p,{emitEvent:!1})}},error:r=>{console.error("Error loading tenant billing data:",r)}})}createItemFormGroup(e){let o=e?.quantity||1,r=e?.unit_price||0,m=e?.subtotal||o*r;return this.fb.group({description:[e?.description||"",[b.required,b.minLength(2)]],quantity:[o,[b.required,b.min(1)]],unit_price:[r,[b.required,b.min(0)]],subtotal:[m,[b.required,b.min(0)]],notes:[e?.notes||""]})}addItem(e){let o=this.createItemFormGroup(e);o.get("quantity")?.valueChanges.subscribe(()=>{this.calculateItemSubtotal(o)}),o.get("unit_price")?.valueChanges.subscribe(()=>{this.calculateItemSubtotal(o)}),this.itemsFormArray.push(o),this.calculateItemSubtotal(o)}removeItem(e){this.itemsFormArray.removeAt(e),this.calculateTotals()}calculateItemSubtotal(e){let o=parseFloat(e.get("quantity")?.value)||0,r=parseFloat(e.get("unit_price")?.value)||0,m=o*r;e.patchValue({subtotal:Math.round(m*100)/100},{emitEvent:!1}),this.calculateTotals()}calculateTotals(){let e=0;this.itemsFormArray.controls.forEach(c=>{let S=parseFloat(c.get("subtotal")?.value)||0;e+=S}),e=Math.round(e*100)/100;let r=Math.round(e*(19/100)*100)/100,m=Math.round((e+r)*100)/100,p=this.invoiceForm.value;this.invoiceForm.patchValue(Ce(ie({},p),{_net_amount:e,_iva_amount:r,_total_amount:m}),{emitEvent:!1})}getErrorMessage(e){let o=this.invoiceForm.get(e);return o?.hasError("required")?"Este campo es requerido":o?.hasError("minlength")?"Debe tener al menos 2 caracteres":o?.hasError("min")?"El valor debe ser mayor o igual a 0":"Campo inv\xE1lido"}getItemErrorMessage(e,o){let m=this.itemsFormArray.at(e)?.get(o);return m?.hasError("required")?"Este campo es requerido":m?.hasError("minlength")?"Debe tener al menos 2 caracteres":m?.hasError("min")?"El valor debe ser mayor o igual a 0":"Campo inv\xE1lido"}onSubmit(){if(this.invoiceForm.valid&&this.itemsFormArray.length>0){this.loading=!0,this.calculateTotals();let e=this.invoiceForm.value,o=e.emission_date;if(o instanceof Date)o=o.toISOString().split("T")[0];else if(typeof o=="string"){let m=new Date(o);isNaN(m.getTime())||(o=m.toISOString().split("T")[0])}let r={tenant_id:e.tenant_id,client_name:e.client_name.trim(),client_rut:e.client_rut.trim(),emission_date:o,status:this.data.isEdit&&this.data.invoice?.status||"PENDING_REVIEW",notes:e.notes?.trim()||"",net_amount:this.invoiceForm.get("_net_amount")?.value||0,iva_amount:this.invoiceForm.get("_iva_amount")?.value||0,total_amount:this.invoiceForm.get("_total_amount")?.value||0,items:this.itemsFormArray.controls.map(m=>{let p=m.value,c=parseInt(p.quantity)||0,S=parseFloat(p.unit_price)||0,y=parseFloat(p.subtotal)||c*S;return{description:p.description.trim(),quantity:c,unit_price:S,subtotal:y,notes:p.notes?.trim()||""}})};this.data.isEdit&&this.data.invoice?this.invoiceService.updateInvoice(this.data.invoice.id,r).subscribe({next:m=>{this.loading=!1,this.snackBar.open("Factura actualizada exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:m=>{this.loading=!1,console.error("Error updating invoice:",m);let p=m.error?.message||m.error?.errors||"Error al actualizar factura";this.snackBar.open(p,"Cerrar",{duration:5e3})}}):this.invoiceService.createInvoice(r).subscribe({next:m=>{this.loading=!1,this.snackBar.open("Factura creada exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:m=>{this.loading=!1,console.error("Error creating invoice:",m);let p=m.error?.message||m.error?.errors||"Error al crear factura";this.snackBar.open(p,"Cerrar",{duration:5e3})}})}else this.invoiceForm.markAllAsTouched(),this.itemsFormArray.length===0&&this.snackBar.open("Debe agregar al menos un item a la factura","Cerrar",{duration:3e3})}onCancel(){this.dialogRef.close(!1)}formatAmount(e){return this.invoiceService.formatAmount(e)}get netAmount(){return this.invoiceForm.get("_net_amount")||this.calculateTotals(),parseFloat(this.invoiceForm.get("_net_amount")?.value)||0}get ivaAmount(){return this.invoiceForm.get("_iva_amount")||this.calculateTotals(),parseFloat(this.invoiceForm.get("_iva_amount")?.value)||0}get totalAmount(){return this.invoiceForm.get("_total_amount")||this.calculateTotals(),parseFloat(this.invoiceForm.get("_total_amount")?.value)||0}static{this.\u0275fac=function(o){return new(o||a)(C(Je),C(re),C(oe),C(he),C(ve),C(fe))}}static{this.\u0275cmp=V({type:a,selectors:[["app-invoice-form"]],decls:86,vars:19,consts:[["picker",""],["mat-dialog-title",""],[1,"mr-2"],[1,"space-y-4",3,"formGroup"],[1,"mb-6"],[1,"text-lg","font-semibold","mb-4","text-gray-700"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline",1,"w-full"],["formControlName","tenant_id"],[3,"value",4,"ngFor","ngForOf"],["matPrefix",""],[4,"ngIf"],["matInput","","formControlName","client_name","placeholder","Nombre completo del cliente"],["matInput","","formControlName","client_rut","placeholder","12345678-9"],["matInput","","formControlName","emission_date",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","notes","rows","3","placeholder","Notas adicionales sobre la factura"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","font-semibold","text-gray-700"],["type","button","mat-raised-button","","color","primary",3,"click"],["formArrayName","items",1,"space-y-4"],["class","border border-gray-200 rounded-lg p-4",3,"formGroupName",4,"ngFor","ngForOf"],[1,"mb-6","border-t-2","border-gray-300","pt-4"],[1,"flex","justify-end"],[1,"w-80","space-y-2"],[1,"flex","justify-between"],[1,"text-gray-600","font-medium"],[1,"font-semibold","text-gray-900"],[1,"flex","justify-between","text-lg","font-bold","border-t-2","border-gray-300","pt-2"],[1,"text-gray-900"],[1,"text-blue-600"],["align","end",1,"p-4"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20","class","inline-block mr-2",4,"ngIf"],[3,"value"],[1,"border","border-gray-200","rounded-lg","p-4",3,"formGroupName"],[1,"flex","justify-between","items-start","mb-4"],[1,"text-md","font-medium","text-gray-700"],["type","button","mat-icon-button","","color","warn",3,"click","disabled"],["appearance","outline",1,"w-full","md:col-span-2"],["matInput","","formControlName","description","placeholder","Descripci\xF3n del item"],["matInput","","type","number","formControlName","quantity","placeholder","1","min","1"],["matInput","","type","number","formControlName","unit_price","placeholder","0","min","0","step","0.01"],["matInput","","type","number","formControlName","subtotal","readonly",""],["matInput","","formControlName","notes","rows","2","placeholder","Notas adicionales sobre este item"],["diameter","20",1,"inline-block","mr-2"]],template:function(o,r){if(o&1){let m=I();i(0,"h2",1)(1,"mat-icon",2),n(2,"receipt"),t(),n(3),t(),i(4,"mat-dialog-content")(5,"form",3)(6,"div",4)(7,"h3",5),n(8,"Informaci\xF3n de la Factura"),t(),i(9,"div",6)(10,"mat-form-field",7)(11,"mat-label"),n(12,"Estacionamiento"),t(),i(13,"mat-select",8),u(14,Nt,2,2,"mat-option",9),t(),i(15,"mat-icon",10),n(16,"local_parking"),t(),u(17,Ot,2,0,"mat-error",11),t(),i(18,"mat-form-field",7)(19,"mat-label"),n(20,"Nombre del Cliente"),t(),x(21,"input",12),i(22,"mat-icon",10),n(23,"person"),t(),u(24,Rt,2,0,"mat-error",11)(25,qt,2,0,"mat-error",11),t(),i(26,"mat-form-field",7)(27,"mat-label"),n(28,"RUT del Cliente"),t(),x(29,"input",13),i(30,"mat-icon",10),n(31,"badge"),t(),u(32,jt,2,0,"mat-error",11),t(),i(33,"mat-form-field",7)(34,"mat-label"),n(35,"Fecha de Emisi\xF3n"),t(),x(36,"input",14)(37,"mat-datepicker-toggle",15)(38,"mat-datepicker",null,0),i(40,"mat-icon",10),n(41,"calendar_today"),t(),u(42,Bt,2,0,"mat-error",11),t()(),i(43,"mat-form-field",7)(44,"mat-label"),n(45,"Notas"),t(),x(46,"textarea",16),i(47,"mat-icon",10),n(48,"note"),t()()(),i(49,"div",4)(50,"div",17)(51,"h3",18),n(52,"Items de la Factura"),t(),i(53,"button",19),h("click",function(){return _(m),f(r.addItem())}),i(54,"mat-icon"),n(55,"add"),t(),n(56," Agregar Item "),t()(),i(57,"div",20),u(58,Jt,47,10,"div",21),t()(),i(59,"div",22)(60,"h3",5),n(61,"Totales"),t(),i(62,"div",23)(63,"div",24)(64,"div",25)(65,"span",26),n(66,"Monto Neto:"),t(),i(67,"span",27),n(68),t()(),i(69,"div",25)(70,"span",26),n(71,"IVA (19%):"),t(),i(72,"span",27),n(73),t()(),i(74,"div",28)(75,"span",29),n(76,"Total:"),t(),i(77,"span",30),n(78),t()()()()()()(),i(79,"mat-dialog-actions",31)(80,"button",32),h("click",function(){return _(m),f(r.onCancel())}),n(81," Cancelar "),t(),i(82,"button",33),h("click",function(){return _(m),f(r.onSubmit())}),u(83,Kt,1,0,"mat-spinner",34)(84,Xt,2,1,"span",11)(85,Yt,2,0,"span",11),t()()}if(o&2){let m,p,c,S,y,w=k(39);l(3),A(" ",r.data.isEdit?"Editar Factura":"Nueva Factura",`
`),l(2),d("formGroup",r.invoiceForm),l(9),d("ngForOf",r.data.tenants),l(3),d("ngIf",(m=r.invoiceForm.get("tenant_id"))==null?null:m.hasError("required")),l(7),d("ngIf",(p=r.invoiceForm.get("client_name"))==null?null:p.hasError("required")),l(),d("ngIf",(c=r.invoiceForm.get("client_name"))==null?null:c.hasError("minlength")),l(7),d("ngIf",(S=r.invoiceForm.get("client_rut"))==null?null:S.hasError("required")),l(4),d("matDatepicker",w),l(),d("for",w),l(5),d("ngIf",(y=r.invoiceForm.get("emission_date"))==null?null:y.hasError("required")),l(16),d("ngForOf",r.itemsFormArray.controls),l(10),v(r.formatAmount(r.netAmount)),l(5),v(r.formatAmount(r.ivaAmount)),l(5),v(r.formatAmount(r.totalAmount)),l(2),d("disabled",r.loading),l(2),d("disabled",r.loading||r.invoiceForm.invalid||r.itemsFormArray.length===0),l(),d("ngIf",r.loading),l(),d("ngIf",!r.loading),l(),d("ngIf",r.loading)}},dependencies:[P,ne,ae,Ke,ce,G,ze,U,se,Ue,Le,Ge,We,He,O,Te,ke,De,B,j,R,le,Ve,Pe,q,J,Q,L,z,me,H,W,X,K,N,_e,ue,ee,Y,Z,$,we],styles:[".mr-2[_ngcontent-%COMP%]{margin-right:.5rem}.space-y-4[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:1rem}.space-y-2[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:.5rem}.mb-4[_ngcontent-%COMP%]{margin-bottom:1rem}.mb-6[_ngcontent-%COMP%]{margin-bottom:1.5rem}.mt-4[_ngcontent-%COMP%]{margin-top:1rem}.pt-2[_ngcontent-%COMP%]{padding-top:.5rem}.pt-4[_ngcontent-%COMP%]{padding-top:1rem}.p-4[_ngcontent-%COMP%]{padding:1rem}.inline-block[_ngcontent-%COMP%]{display:inline-block}"]})}}return a})();var At=(()=>{class a{constructor(e,o){this.dialogRef=e,this.data=o,this.paymentMethod="CASH",this.paymentDate=new Date().toISOString().split("T")[0],this.reference="",this.notes=""}ngOnInit(){}getPaymentMethodLabel(e){return{CASH:"Efectivo",TRANSFER:"Transferencia",CARD:"Tarjeta"}[e]}onCancel(){this.dialogRef.close()}onConfirm(){!this.paymentMethod||!this.paymentDate||this.dialogRef.close({paymentMethod:this.paymentMethod,paymentDate:this.paymentDate,reference:this.reference,notes:this.notes})}formatAmount(e){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}static{this.\u0275fac=function(o){return new(o||a)(C(re),C(oe))}}static{this.\u0275cmp=V({type:a,selectors:[["app-invoice-payment"]],decls:62,vars:9,consts:[["picker",""],[1,"p-6"],[1,"text-2xl","font-bold","text-gray-900","mb-4"],[1,"mb-6"],[1,"bg-gray-50","p-4","rounded","border","border-gray-200"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"text-gray-600","mb-1"],[1,"font-semibold"],[1,"font-semibold","text-blue-600","text-lg"],[3,"ngSubmit"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["name","paymentMethod","required","",3,"ngModelChange","ngModel"],["value","CASH"],["value","TRANSFER"],["value","CARD"],["matInput","","name","paymentDate","required","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],["matInput","","name","reference","placeholder","Opcional",3,"ngModelChange","ngModel"],["matInput","","rows","3","name","notes","placeholder","Notas adicionales sobre el pago",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-3","mt-6","pt-4","border-t"],["type","button","mat-stroked-button","",1,"no-rounded",3,"click"],["type","submit","mat-raised-button","","color","primary",1,"no-rounded"]],template:function(o,r){if(o&1){let m=I();i(0,"div",1)(1,"h2",2),n(2,"Registrar Pago de Factura"),t(),i(3,"div",3)(4,"div",4)(5,"div",5)(6,"div")(7,"p",6),n(8,"Folio"),t(),i(9,"p",7),n(10),t()(),i(11,"div")(12,"p",6),n(13,"Cliente"),t(),i(14,"p",7),n(15),t()(),i(16,"div")(17,"p",6),n(18,"Monto Total"),t(),i(19,"p",8),n(20),t()(),i(21,"div")(22,"p",6),n(23,"Estado Actual"),t(),i(24,"p",7),n(25,"Sin pago registrado"),t()()()()(),i(26,"form",9),h("ngSubmit",function(){return _(m),f(r.onConfirm())}),i(27,"div",10)(28,"mat-form-field",11)(29,"mat-label"),n(30,"M\xE9todo de Pago"),t(),i(31,"mat-select",12),F("ngModelChange",function(c){return _(m),M(r.paymentMethod,c)||(r.paymentMethod=c),f(c)}),i(32,"mat-option",13),n(33,"Efectivo"),t(),i(34,"mat-option",14),n(35,"Transferencia"),t(),i(36,"mat-option",15),n(37,"Tarjeta"),t()()(),i(38,"mat-form-field",11)(39,"mat-label"),n(40,"Fecha de Pago"),t(),i(41,"input",16),F("ngModelChange",function(c){return _(m),M(r.paymentDate,c)||(r.paymentDate=c),f(c)}),t(),x(42,"mat-datepicker-toggle",17)(43,"mat-datepicker",null,0),t(),i(45,"mat-form-field",11)(46,"mat-label"),n(47,"Referencia / N\xFAmero de Transacci\xF3n"),t(),i(48,"input",18),F("ngModelChange",function(c){return _(m),M(r.reference,c)||(r.reference=c),f(c)}),t(),i(49,"mat-hint"),n(50,"N\xFAmero de transferencia, comprobante, etc."),t()(),i(51,"mat-form-field",11)(52,"mat-label"),n(53,"Notas"),t(),i(54,"textarea",19),F("ngModelChange",function(c){return _(m),M(r.notes,c)||(r.notes=c),f(c)}),t()()(),i(55,"div",20)(56,"button",21),h("click",function(){return _(m),f(r.onCancel())}),n(57," Cancelar "),t(),i(58,"button",22)(59,"mat-icon"),n(60,"payment"),t(),n(61," Registrar Pago "),t()()()()}if(o&2){let m=k(44);l(10),v(r.data.invoice.folio||"Sin folio"),l(5),v(r.data.invoice.client_name),l(5),v(r.formatAmount(r.data.invoice.total_amount)),l(11),E("ngModel",r.paymentMethod),l(10),d("matDatepicker",m),E("ngModel",r.paymentDate),l(),d("for",m),l(6),E("ngModel",r.reference),l(6),E("ngModel",r.notes)}},dependencies:[P,pe,ce,G,U,se,Qe,de,Be,O,L,z,B,j,R,le,q,X,K,N,J,Q,ee,Y,Z,$,H,W],styles:[".no-rounded{border-radius:0!important}"]})}}return a})();function Zt(a,s){if(a&1){let e=I();i(0,"button",30),h("click",function(){_(e);let r=g();return f(r.goToPendingInvoices())}),i(1,"mat-icon"),n(2,"pending_actions"),t(),n(3," Facturas Pendientes "),t()}}function $t(a,s){a&1&&(i(0,"div",31),x(1,"mat-spinner",32),t())}function ei(a,s){a&1&&(i(0,"th",58),n(1,"Folio"),t())}function ti(a,s){if(a&1&&(i(0,"td",59)(1,"span",60),n(2),t()()),a&2){let e=s.$implicit;l(2),v(e.folio||"Sin folio")}}function ii(a,s){a&1&&(i(0,"th",61),n(1,"Estacionamiento"),t())}function ni(a,s){if(a&1&&(i(0,"td",59)(1,"span",62),n(2),t()()),a&2){let e=s.$implicit;l(2),v(e.tenant_name||(e.tenant==null?null:e.tenant.name)||"N/A")}}function ai(a,s){a&1&&(i(0,"th",63),n(1,"Cliente"),t())}function ri(a,s){if(a&1&&(i(0,"td",59)(1,"span",64),n(2),t()()),a&2){let e=s.$implicit;l(2),v(e.client_name)}}function oi(a,s){a&1&&(i(0,"th",65),n(1,"RUT Cliente"),t())}function li(a,s){if(a&1&&(i(0,"td",59)(1,"span",66),n(2),t()()),a&2){let e=s.$implicit,o=g(2);l(2),v(o.formatRut(e.client_rut))}}function mi(a,s){a&1&&(i(0,"th",67),n(1,"Fecha de Emisi\xF3n"),t())}function si(a,s){if(a&1&&(i(0,"td",59),n(1),t()),a&2){let e=s.$implicit,o=g(2);l(),A(" ",o.formatDate(e.emission_date)," ")}}function di(a,s){a&1&&(i(0,"th",68),n(1,"Fecha de Pago"),t())}function ci(a,s){if(a&1&&(i(0,"td",59),n(1),t()),a&2){let e=s.$implicit,o=g(2);l(),A(" ",e.payment_date?o.formatDate(e.payment_date):"-"," ")}}function pi(a,s){a&1&&(i(0,"th",69),n(1,"Monto Total"),t())}function ui(a,s){if(a&1&&(i(0,"td",59)(1,"span",70),n(2),t()()),a&2){let e=s.$implicit,o=g(2);l(2),A(" ",o.formatAmount(e.total_amount)," ")}}function _i(a,s){a&1&&(i(0,"th",71),n(1,"Estado"),t())}function fi(a,s){if(a&1&&(i(0,"td",59)(1,"span",72),n(2),t()()),a&2){let e=s.$implicit,o=g(2);l(),xe("bg-"+o.getStatusColor(e.status)+"-100 text-"+o.getStatusColor(e.status)+"-800"),l(),A(" ",o.getStatusLabel(e.status)," ")}}function gi(a,s){a&1&&(i(0,"th",61),n(1,"Acciones"),t())}function vi(a,s){if(a&1){let e=I();i(0,"button",74),h("click",function(){_(e);let r=g().$implicit,m=g(2);return f(m.openPaymentModal(r))}),i(1,"mat-icon"),n(2,"payment"),t(),n(3," Pagar "),t()}}function hi(a,s){if(a&1){let e=I();i(0,"td",59)(1,"button",73)(2,"mat-icon"),n(3,"more_vert"),t()(),i(4,"mat-menu",null,2)(6,"button",74),h("click",function(){let r=_(e).$implicit,m=g(2);return f(m.showInvoiceDetails(r))}),i(7,"mat-icon"),n(8,"visibility"),t(),n(9," Ver detalles "),t(),i(10,"button",75)(11,"mat-icon"),n(12,"print"),t(),n(13," Imprimir "),t(),u(14,vi,4,0,"button",76),t()()}if(a&2){let e=s.$implicit,o=k(5);l(),d("matMenuTriggerFor",o),l(13),d("ngIf",e.status==="UNPAID")}}function xi(a,s){a&1&&x(0,"tr",77)}function Ci(a,s){a&1&&x(0,"tr",78)}function Ii(a,s){a&1&&(i(0,"div",79)(1,"mat-icon",80),n(2,"receipt"),t(),i(3,"h3",81),n(4,"No hay facturas registradas"),t(),i(5,"p",82),n(6,"Las facturas aparecer\xE1n aqu\xED cuando se generen."),t()())}function yi(a,s){if(a&1){let e=I();i(0,"mat-paginator",83),h("page",function(r){_(e);let m=g(2);return f(m.onPageChange(r))}),t()}if(a&2){let e=g(2);d("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}function bi(a,s){if(a&1){let e=I();i(0,"mat-card")(1,"mat-card-content",33)(2,"div",34)(3,"table",35),h("matSortChange",function(r){_(e);let m=g();return f(m.onSortChange(r))}),T(4,36),u(5,ei,2,0,"th",37)(6,ti,3,1,"td",38),D(),T(7,39),u(8,ii,2,0,"th",40)(9,ni,3,1,"td",38),D(),T(10,41),u(11,ai,2,0,"th",42)(12,ri,3,1,"td",38),D(),T(13,43),u(14,oi,2,0,"th",44)(15,li,3,1,"td",38),D(),T(16,45),u(17,mi,2,0,"th",46)(18,si,2,1,"td",38),D(),T(19,47),u(20,di,2,0,"th",48)(21,ci,2,1,"td",38),D(),T(22,49),u(23,pi,2,0,"th",50)(24,ui,3,1,"td",38),D(),T(25,51),u(26,_i,2,0,"th",52)(27,fi,3,3,"td",38),D(),T(28,53),u(29,gi,2,0,"th",40)(30,hi,15,2,"td",38),D(),u(31,xi,1,0,"tr",54)(32,Ci,1,0,"tr",55),t(),u(33,Ii,7,0,"div",56),t(),u(34,yi,1,5,"mat-paginator",57),t()()}if(a&2){let e=g();l(3),d("dataSource",e.invoices)("matSortActive",e.sortBy)("matSortDirection",e.sortOrder)("matSortDisableClear",!0),l(28),d("matHeaderRowDef",e.displayedColumns),l(),d("matRowDefColumns",e.displayedColumns),l(),d("ngIf",!e.loading&&e.invoices.length===0),l(),d("ngIf",e.totalItems>0)}}function Si(a,s){a&1&&(i(0,"div",90),x(1,"mat-spinner",32),t())}function Ei(a,s){if(a&1){let e=I();i(0,"div",91)(1,"div")(2,"h2",5),n(3,"Detalle de Factura"),t(),i(4,"p",92),n(5),t()(),i(6,"button",93),h("click",function(){_(e);let r=g(2);return f(r.closeDetailsModal())}),i(7,"mat-icon"),n(8,"close"),t()()()}if(a&2){let e=g(2);l(5),A("Folio: ",e.selectedInvoice.folio||"Sin folio (pendiente de emisi\xF3n)","")}}function Mi(a,s){if(a&1&&(i(0,"div")(1,"p",97),n(2,"Estacionamiento"),t(),i(3,"p",70),n(4),t()()),a&2){let e=g(3);l(4),v(e.selectedInvoice.tenant_name||(e.selectedInvoice.tenant==null?null:e.selectedInvoice.tenant.name))}}function Fi(a,s){if(a&1&&(i(0,"tr",119)(1,"td",120),n(2),t(),i(3,"td",121),n(4),t(),i(5,"td",122),n(6),t(),i(7,"td",123),n(8),t()()),a&2){let e=s.$implicit,o=g(4);l(2),v(e.description),l(2),v(e.quantity),l(2),v(o.formatAmount(e.unit_price)),l(2),v(o.formatAmount(e.subtotal))}}function wi(a,s){if(a&1&&(i(0,"div",34)(1,"table",113)(2,"thead")(3,"tr",114)(4,"th",115),n(5,"Descripci\xF3n"),t(),i(6,"th",116),n(7,"Cantidad"),t(),i(8,"th",117),n(9,"Precio Unitario"),t(),i(10,"th",117),n(11,"Subtotal (Neto)"),t()()(),i(12,"tbody"),u(13,Fi,9,4,"tr",118),t()()()),a&2){let e=g(3);l(13),d("ngForOf",e.selectedInvoice.items)}}function Ai(a,s){a&1&&(i(0,"div",124)(1,"mat-icon",125),n(2,"inventory_2"),t(),i(3,"p",82),n(4,"No hay items registrados en esta factura"),t()())}function Ti(a,s){if(a&1&&(i(0,"div",126)(1,"p",127),n(2,"Notas:"),t(),i(3,"p",128),n(4),t()()),a&2){let e=g(3);l(4),v(e.selectedInvoice.notes)}}function Di(a,s){if(a&1&&(i(0,"div",94)(1,"div",10)(2,"h3",95),n(3,"Informaci\xF3n General"),t(),i(4,"div",96)(5,"div")(6,"p",97),n(7,"Estado"),t(),i(8,"span",98),n(9),t()(),u(10,Mi,5,1,"div",28),i(11,"div")(12,"p",97),n(13,"Cliente"),t(),i(14,"p",99),n(15),t()(),i(16,"div")(17,"p",97),n(18,"RUT Cliente"),t(),i(19,"p",100),n(20),t()(),i(21,"div")(22,"p",97),n(23,"Fecha Emisi\xF3n"),t(),i(24,"p",99),n(25),t()(),i(26,"div")(27,"p",97),n(28,"Fecha Pago"),t(),i(29,"p",99),n(30),t()()()(),i(31,"div",10)(32,"h3",95),n(33,"Detalle de Items"),t(),u(34,wi,14,1,"div",101)(35,Ai,5,0,"div",102),t(),i(36,"div",103)(37,"div",104)(38,"div",105)(39,"div",106)(40,"span",107),n(41,"Monto Neto:"),t(),i(42,"span",108),n(43),t()(),i(44,"div",106)(45,"span",107),n(46,"IVA:"),t(),i(47,"span",108),n(48),t()(),i(49,"div",109)(50,"span",110),n(51,"Total:"),t(),i(52,"span",111),n(53),t()()()()(),u(54,Ti,5,1,"div",112),t()),a&2){let e=g(2);l(8),xe("bg-"+e.getStatusColor(e.selectedInvoice.status)+"-100 text-"+e.getStatusColor(e.selectedInvoice.status)+"-800"),l(),A(" ",e.getStatusLabel(e.selectedInvoice.status)," "),l(),d("ngIf",e.selectedInvoice.tenant_name||(e.selectedInvoice.tenant==null?null:e.selectedInvoice.tenant.name)),l(5),v(e.selectedInvoice.client_name),l(5),v(e.formatRut(e.selectedInvoice.client_rut)),l(5),v(e.formatDate(e.selectedInvoice.emission_date)),l(5),v(e.selectedInvoice.payment_date?e.formatDate(e.selectedInvoice.payment_date):"No pagada"),l(4),d("ngIf",e.selectedInvoice.items&&e.selectedInvoice.items.length>0),l(),d("ngIf",!e.selectedInvoice.items||e.selectedInvoice.items.length===0),l(8),v(e.formatAmount(e.selectedInvoice.net_amount)),l(5),v(e.formatAmount(e.selectedInvoice.iva_amount)),l(5),v(e.formatAmount(e.selectedInvoice.total_amount)),l(),d("ngIf",e.selectedInvoice.notes)}}function ki(a,s){if(a&1){let e=I();i(0,"div",129)(1,"button",130),h("click",function(){_(e);let r=g(2);return f(r.closeDetailsModal())}),n(2," Cerrar "),t(),i(3,"button",131)(4,"mat-icon"),n(5,"print"),t(),n(6," Imprimir "),t()()}}function Vi(a,s){if(a&1){let e=I();i(0,"div",84),h("click",function(){_(e);let r=g();return f(r.closeDetailsModal())}),i(1,"div",85),h("click",function(r){return _(e),f(r.stopPropagation())}),u(2,Si,2,0,"div",86)(3,Ei,9,1,"div",87)(4,Di,55,14,"div",88)(5,ki,7,0,"div",89),t()()}if(a&2){let e=g();l(2),d("ngIf",e.loadingDetails),l(),d("ngIf",!e.loadingDetails&&e.selectedInvoice),l(),d("ngIf",!e.loadingDetails&&e.selectedInvoice),l(),d("ngIf",!e.loadingDetails&&e.selectedInvoice)}}var kn=(()=>{class a{constructor(e,o,r,m,p,c,S){this.invoiceService=e,this.tenantService=o,this.authService=r,this.router=m,this.dialog=p,this.snackBar=c,this.cdr=S,this._unsubscribeAll=new Ie,this.sortInitialized=!1,this.invoices=[],this.loading=!1,this.displayedColumns=["folio","tenant_name","client_name","client_rut","emission_date","payment_date","total_amount","status","actions"],this.showDetailsModal=!1,this.selectedInvoice=null,this.loadingDetails=!1,this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.sortBy="folio",this.sortOrder="desc",this.filters={folio:"",client_name:"",client_rut:"",status:"",emission_date_from:"",emission_date_to:""},this.tenants=[],this.isCentralAdmin=!1,this.isCentralAdmin=this.authService.isCentralAdminMode()}ngOnInit(){this.loadInvoices(),this.loadTenants()}ngAfterViewInit(){this.initializeSort()}initializeSort(){let e=()=>{if(!this.loading&&this.sort&&!this.sortInitialized)try{this.sort.active=this.sortBy,this.sort.direction=this.sortOrder,this.sortInitialized=!0,this.cdr.detectChanges()}catch(o){console.error("Error initializing sort:",o),this.sortInitialized||setTimeout(e,100)}else!this.sortInitialized&&!this.loading&&setTimeout(e,100)};setTimeout(e,0)}onSortChange(e){e.active&&(this.sortBy=e.active,this.sortOrder=e.direction==="asc"?"asc":"desc",this.currentPage=0,this.loadInvoices())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadTenants(){this.tenantService.getTenants({per_page:1e3}).pipe(te(this._unsubscribeAll)).subscribe({next:e=>{this.tenants=e.data?.data||[]},error:e=>{console.error("Error loading tenants:",e)}})}loadInvoices(){this.loading=!0;let e=ie({page:this.currentPage+1,per_page:this.pageSize,sort_by:this.sortBy,sort_order:this.sortOrder},this.filters);this.invoiceService.getInvoices(e).pipe(te(this._unsubscribeAll)).subscribe({next:o=>{this.invoices=o.data?.data||[],this.totalItems=o.data?.total||0,this.loading=!1,setTimeout(()=>{this.sortInitialized?this.sort&&(this.sort.active=this.sortBy,this.sort.direction=this.sortOrder):this.initializeSort()},50)},error:o=>{console.error("Error loading invoices:",o),this.loading=!1}})}formatAmount(e){return this.invoiceService.formatAmount(e)}formatDate(e){return this.invoiceService.formatDate(e)}formatRut(e){return this.invoiceService.formatRut(e)}getStatusColor(e){return this.invoiceService.getStatusColor(e)}getStatusLabel(e){return this.invoiceService.getStatusLabel(e)}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadInvoices()}applyFilters(){this.currentPage=0,this.loadInvoices()}clearFilters(){this.filters={folio:"",client_name:"",client_rut:"",status:"",emission_date_from:"",emission_date_to:""},this.currentPage=0,this.loadInvoices()}createInvoice(){this.dialog.open(wt,{width:"900px",maxWidth:"95vw",maxHeight:"95vh",data:{isEdit:!1,tenants:this.tenants}}).afterClosed().subscribe(o=>{o&&this.loadInvoices()})}showInvoiceDetails(e){this.showDetailsModal=!0,this.loadingDetails=!0,this.selectedInvoice=null,this.invoiceService.getInvoice(e.id).pipe(te(this._unsubscribeAll)).subscribe({next:o=>{this.selectedInvoice=o.data,this.loadingDetails=!1},error:o=>{console.error("Error loading invoice details:",o),this.loadingDetails=!1,this.closeDetailsModal()}})}closeDetailsModal(){this.showDetailsModal=!1,this.selectedInvoice=null,this.loadingDetails=!1}goToPendingInvoices(){this.router.navigate(["/central-admin/invoices/pending"])}openPaymentModal(e){this.dialog.open(At,{width:"600px",maxWidth:"95vw",data:{invoice:e}}).afterClosed().subscribe(r=>{r&&this.processPayment(e.id,r)})}processPayment(e,o){this.loading=!0,this.invoiceService.payInvoice(e,o).pipe(te(this._unsubscribeAll)).subscribe({next:r=>{this.snackBar.open("Pago registrado exitosamente","Cerrar",{duration:3e3}),this.loadInvoices()},error:r=>{console.error("Error processing payment:",r),this.snackBar.open("Error al registrar pago: "+(r.error?.message||"Error desconocido"),"Cerrar",{duration:5e3}),this.loading=!1}})}static{this.\u0275fac=function(o){return new(o||a)(C(he),C(ve),C(Ne),C(Fe),C(Ae),C(fe),C(Me))}}static{this.\u0275cmp=V({type:a,selectors:[["app-central-admin-invoices"]],viewQuery:function(o,r){if(o&1&&ye(ge,5),o&2){let m;be(m=Se())&&(r.sort=m.first)}},features:[Ee([{provide:ct,useValue:vt()}])],decls:68,vars:14,consts:[["pickerFrom",""],["pickerTo",""],["menu","matMenu"],[1,"p-6","w-full"],[1,"mb-6","flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"flex","gap-2"],["mat-raised-button","","color","accent","class","no-rounded",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",1,"no-rounded",3,"click"],[1,"mb-6"],[1,"p-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["appearance","outline"],["matInput","","placeholder","Buscar por folio",3,"ngModelChange","ngModel"],["matInput","","placeholder","Nombre del cliente",3,"ngModelChange","ngModel"],["matInput","","placeholder","RUT del cliente",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],["value","UNPAID"],["value","PAID"],["value","OVERDUE"],["value","CANCELLED"],["matInput","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"no-rounded",3,"click"],["class","flex justify-center items-center h-64",4,"ngIf"],[4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",3,"click",4,"ngIf"],["mat-raised-button","","color","accent",1,"no-rounded",3,"click"],[1,"flex","justify-center","items-center","h-64"],["diameter","50"],[1,"p-0"],[1,"overflow-x-auto"],["mat-table","","matSort","",1,"w-full",3,"matSortChange","dataSource","matSortActive","matSortDirection","matSortDisableClear"],["matColumnDef","folio"],["mat-header-cell","","mat-sort-header","folio",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","tenant_name"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","client_name"],["mat-header-cell","","mat-sort-header","client_name",4,"matHeaderCellDef"],["matColumnDef","client_rut"],["mat-header-cell","","mat-sort-header","client_rut",4,"matHeaderCellDef"],["matColumnDef","emission_date"],["mat-header-cell","","mat-sort-header","emission_date",4,"matHeaderCellDef"],["matColumnDef","payment_date"],["mat-header-cell","","mat-sort-header","payment_date",4,"matHeaderCellDef"],["matColumnDef","total_amount"],["mat-header-cell","","mat-sort-header","total_amount",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","status",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],["mat-header-cell","","mat-sort-header","folio"],["mat-cell",""],[1,"font-mono","font-semibold"],["mat-header-cell",""],[1,"font-medium","text-blue-600"],["mat-header-cell","","mat-sort-header","client_name"],[1,"font-medium"],["mat-header-cell","","mat-sort-header","client_rut"],[1,"font-mono"],["mat-header-cell","","mat-sort-header","emission_date"],["mat-header-cell","","mat-sort-header","payment_date"],["mat-header-cell","","mat-sort-header","total_amount"],[1,"font-semibold","text-blue-600"],["mat-header-cell","","mat-sort-header","status"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["mat-menu-item","",3,"click",4,"ngIf"],["mat-header-row",""],["mat-row",""],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"text-gray-500"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-white","rounded-lg","shadow-xl","max-w-4xl","w-full","mx-4","max-h-[90vh]","flex","flex-col",3,"click"],["class","flex justify-center items-center p-12",4,"ngIf"],["class","flex justify-between items-center p-6 border-b bg-white sticky top-0 z-10",4,"ngIf"],["class","p-6 overflow-y-auto flex-1",4,"ngIf"],["class","flex justify-end gap-3 p-6 pt-4 border-t border-gray-200 bg-white sticky bottom-0",4,"ngIf"],[1,"flex","justify-center","items-center","p-12"],[1,"flex","justify-between","items-center","p-6","border-b","bg-white","sticky","top-0","z-10"],[1,"text-sm","text-gray-500","mt-1"],["mat-icon-button","",1,"text-gray-500","hover:text-gray-700",3,"click"],[1,"p-6","overflow-y-auto","flex-1"],[1,"text-lg","font-semibold","mb-4","text-gray-900"],[1,"grid","grid-cols-2","gap-4"],[1,"text-sm","text-gray-600","mb-1"],[1,"px-3","py-1","rounded-full","text-xs","font-medium","inline-block"],[1,"font-semibold"],[1,"font-semibold","font-mono"],["class","overflow-x-auto",4,"ngIf"],["class","text-center py-8 bg-gray-50 rounded border border-gray-200",4,"ngIf"],[1,"border-t-2","border-gray-300","pt-4","mb-6"],[1,"flex","justify-end"],[1,"w-80"],[1,"flex","justify-between","mb-3"],[1,"text-gray-600","font-medium"],[1,"font-semibold","text-gray-900"],[1,"flex","justify-between","text-lg","font-bold","border-t-2","border-gray-300","pt-3"],[1,"text-gray-900"],[1,"text-blue-600"],["class","p-4 bg-gray-50 rounded-lg border border-gray-200",4,"ngIf"],[1,"w-full","border-collapse","border","border-gray-300"],[1,"bg-gray-100"],[1,"border","border-gray-300","p-3","text-left","text-sm","font-semibold","text-gray-700"],[1,"border","border-gray-300","p-3","text-center","text-sm","font-semibold","text-gray-700"],[1,"border","border-gray-300","p-3","text-right","text-sm","font-semibold","text-gray-700"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50"],[1,"border","border-gray-300","p-3"],[1,"border","border-gray-300","p-3","text-center"],[1,"border","border-gray-300","p-3","text-right"],[1,"border","border-gray-300","p-3","text-right","font-semibold"],[1,"text-center","py-8","bg-gray-50","rounded","border","border-gray-200"],[1,"text-gray-400","text-4xl","mb-2"],[1,"p-4","bg-gray-50","rounded-lg","border","border-gray-200"],[1,"text-sm","font-semibold","text-gray-700","mb-2"],[1,"text-sm","text-gray-600","whitespace-pre-wrap"],[1,"flex","justify-end","gap-3","p-6","pt-4","border-t","border-gray-200","bg-white","sticky","bottom-0"],["mat-stroked-button","",3,"click"],["mat-raised-button","","color","primary"]],template:function(o,r){if(o&1){let m=I();i(0,"div",3)(1,"div",4)(2,"div")(3,"h1",5),n(4,"Facturas"),t(),i(5,"p",6),n(6,"Todas las facturas generadas en el sistema"),t()(),i(7,"div",7),u(8,Zt,4,0,"button",8),i(9,"button",9),h("click",function(){return _(m),f(r.createInvoice())}),i(10,"mat-icon"),n(11,"add"),t(),n(12," Nueva Factura "),t()()(),i(13,"mat-card",10)(14,"mat-card-content",11)(15,"div",12)(16,"mat-form-field",13)(17,"mat-label"),n(18,"Folio"),t(),i(19,"input",14),F("ngModelChange",function(c){return _(m),M(r.filters.folio,c)||(r.filters.folio=c),f(c)}),t()(),i(20,"mat-form-field",13)(21,"mat-label"),n(22,"Cliente"),t(),i(23,"input",15),F("ngModelChange",function(c){return _(m),M(r.filters.client_name,c)||(r.filters.client_name=c),f(c)}),t()(),i(24,"mat-form-field",13)(25,"mat-label"),n(26,"RUT Cliente"),t(),i(27,"input",16),F("ngModelChange",function(c){return _(m),M(r.filters.client_rut,c)||(r.filters.client_rut=c),f(c)}),t()(),i(28,"mat-form-field",13)(29,"mat-label"),n(30,"Estado"),t(),i(31,"mat-select",17),F("ngModelChange",function(c){return _(m),M(r.filters.status,c)||(r.filters.status=c),f(c)}),i(32,"mat-option",18),n(33,"Todos"),t(),i(34,"mat-option",19),n(35,"Sin pago registrado"),t(),i(36,"mat-option",20),n(37,"Pago registrado"),t(),i(38,"mat-option",21),n(39,"Factura vencida"),t(),i(40,"mat-option",22),n(41,"Cancelada"),t()()(),i(42,"mat-form-field",13)(43,"mat-label"),n(44,"Fecha desde"),t(),i(45,"input",23),F("ngModelChange",function(c){return _(m),M(r.filters.emission_date_from,c)||(r.filters.emission_date_from=c),f(c)}),t(),x(46,"mat-datepicker-toggle",24)(47,"mat-datepicker",null,0),t(),i(49,"mat-form-field",13)(50,"mat-label"),n(51,"Fecha hasta"),t(),i(52,"input",23),F("ngModelChange",function(c){return _(m),M(r.filters.emission_date_to,c)||(r.filters.emission_date_to=c),f(c)}),t(),x(53,"mat-datepicker-toggle",24)(54,"mat-datepicker",null,1),t()(),i(56,"div",25)(57,"button",26),h("click",function(){return _(m),f(r.clearFilters())}),i(58,"mat-icon"),n(59,"clear"),t(),n(60," Limpiar "),t(),i(61,"button",9),h("click",function(){return _(m),f(r.applyFilters())}),i(62,"mat-icon"),n(63,"search"),t(),n(64," Filtrar "),t()()()(),u(65,$t,2,0,"div",27)(66,bi,35,8,"mat-card",28)(67,Vi,6,4,"div",29),t()}if(o&2){let m=k(48),p=k(55);l(8),d("ngIf",r.isCentralAdmin),l(11),E("ngModel",r.filters.folio),l(4),E("ngModel",r.filters.client_name),l(4),E("ngModel",r.filters.client_rut),l(4),E("ngModel",r.filters.status),l(14),d("matDatepicker",m),E("ngModel",r.filters.emission_date_from),l(),d("for",m),l(6),d("matDatepicker",p),E("ngModel",r.filters.emission_date_to),l(),d("for",p),l(12),d("ngIf",r.loading),l(),d("ngIf",!r.loading),l(),d("ngIf",r.showDetailsModal)}},dependencies:[P,ne,ae,pe,G,U,de,dt,et,it,ot,nt,tt,lt,at,rt,mt,st,$e,Ye,Ze,L,z,me,H,W,_e,ue,B,j,R,q,J,Q,ee,Y,Z,$,X,K,N,je,Re,Oe,qe,gt,ut,pt,ft,ge,_t,O,Xe],styles:[".no-rounded{border-radius:0!important}"]})}}return a})();export{kn as CentralAdminInvoicesComponent};
