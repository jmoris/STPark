import{a as xe,b as _e}from"./chunk-A23QWCHP.js";import{a as De}from"./chunk-TGLYR4EM.js";import{c as ye}from"./chunk-TCOXJXET.js";import{a as he}from"./chunk-NIHVD5W5.js";import{a as Ce}from"./chunk-7TD3HKIE.js";import{a as Se}from"./chunk-455LXW3U.js";import{a as Me}from"./chunk-PDSVMDVN.js";import{a as ue,b as be,c as fe,d as ve}from"./chunk-EEUJEGPN.js";import{d as ne}from"./chunk-IDWAZBHT.js";import{b as ie}from"./chunk-FSA3IEFI.js";import{b as ge}from"./chunk-POSCZER2.js";import"./chunk-ECYJLMJT.js";import{a as ae}from"./chunk-VKB6BRO6.js";import{b as ee,c as te}from"./chunk-IMRKXFOQ.js";import{d as le,e as me}from"./chunk-5Q7CCL6V.js";import{b as G,f as U,j as Z,k as J}from"./chunk-K3BNOLHS.js";import{a as ce,b as pe}from"./chunk-CWSZZ2DY.js";import{b as re,f as oe,j as se,z as de}from"./chunk-ZTFUS4RN.js";import{J as j,Q as I,S as k,T as $,U as H,V as W,W as q,la as K,na as Q,oa as X}from"./chunk-QQQ5XT6I.js";import"./chunk-72DR3HUO.js";import"./chunk-YXFY4UXK.js";import{d as Y}from"./chunk-EARUC3FY.js";import{k as F,l as N,m as R,s as V}from"./chunk-BAM5RHC5.js";import{$ as B,$b as f,Eb as l,Pb as a,Qb as t,Rb as u,U as _,Vb as P,bb as r,bc as y,cb as v,f as z,lc as S,mc as n,nc as p,oa as g,oc as x,pa as h,pb as D,pc as T,qb as O,rc as M,sc as E,tc as w,uc as L,wb as C}from"./chunk-MLNNMN4J.js";import"./chunk-TSRGIXR5.js";var Ee=(()=>{class s{static \u0275fac=function(o){return new(o||s)};static \u0275mod=O({type:s});static \u0275inj=B({imports:[j,I,I]})}return s})();function Ie(s,m){s&1&&(a(0,"div",24),u(1,"mat-spinner",25),t())}function ke(s,m){if(s&1&&(a(0,"div",26)(1,"fuse-alert",27),n(2),t()()),s&2){let e=y();r(),l("dismissible",!0),r(),x(" ",e.error," ")}}function Ae(s,m){if(s&1&&(a(0,"div",61)(1,"div",62),u(2,"div",63),a(3,"div")(4,"p",64),n(5),t(),a(6,"p",53),n(7),t()()(),a(8,"div",65)(9,"p",53),n(10),t(),a(11,"p",66),n(12),t()()()),s&2){let e=m.$implicit,o=y(2);r(5),p(e.plate),r(2),p(e.sector==null?null:e.sector.name),r(3),p(o.getElapsedTime(e.started_at)),r(2),p(o.formatDate(e.started_at))}}function ze(s,m){s&1&&(a(0,"div",67),n(1," No hay sesiones activas "),t())}function Be(s,m){if(s&1&&(a(0,"div")(1,"div",28)(2,"fuse-card",29)(3,"div",30)(4,"div",31)(5,"mat-icon",32),n(6,"attach_money"),t()(),a(7,"div",33)(8,"p",34),n(9,"Ingresos Hoy"),t(),a(10,"p",35),n(11),t()()()(),a(12,"fuse-card",29)(13,"div",30)(14,"div",36)(15,"mat-icon",37),n(16,"directions_car"),t()(),a(17,"div",33)(18,"p",34),n(19,"Sesiones Hoy"),t(),a(20,"p",35),n(21),t()()()(),a(22,"fuse-card",29)(23,"div",30)(24,"div",38)(25,"mat-icon",39),n(26,"receipt"),t()(),a(27,"div",33)(28,"p",34),n(29,"Ticket Promedio"),t(),a(30,"p",35),n(31),t()()()(),a(32,"fuse-card",29)(33,"div",30)(34,"div",40)(35,"mat-icon",41),n(36,"schedule"),t()(),a(37,"div",33)(38,"p",34),n(39,"Sesiones Activas"),t(),a(40,"p",35),n(41),t()()()(),a(42,"fuse-card",29)(43,"div",30)(44,"div",42)(45,"mat-icon",43),n(46,"warning"),t()(),a(47,"div",33)(48,"p",34),n(49,"Deudas Pendientes"),t(),a(50,"p",35),n(51),t()()()(),a(52,"fuse-card",29)(53,"div",30)(54,"div",44)(55,"mat-icon",45),n(56,"local_parking"),t()(),a(57,"div",46)(58,"p",34),n(59,"Nivel de Ocupaci\xF3n"),t(),a(60,"p",47),n(61),t(),a(62,"p",48),n(63),t()()()()(),a(64,"div",49)(65,"fuse-card",50)(66,"div",51)(67,"h3",52),n(68,"Ventas por Sector"),t(),a(69,"p",53),n(70,"Distribuci\xF3n de ingresos por sector"),t()(),a(71,"div",54),u(72,"apx-chart",55),t()(),a(73,"fuse-card",50)(74,"div",51)(75,"h3",52),n(76,"Pagos por M\xE9todo"),t(),a(77,"p",53),n(78,"Distribuci\xF3n de pagos por m\xE9todo"),t()(),a(79,"div",54),u(80,"apx-chart",56),t()()(),a(81,"div",49)(82,"fuse-card",50)(83,"div",51)(84,"h3",52),n(85,"Sesiones Activas por Hora"),t(),a(86,"p",53),n(87,"Distribuci\xF3n temporal de sesiones activas"),t()(),a(88,"div",54),u(89,"apx-chart",57),t()(),a(90,"fuse-card",50)(91,"div",51)(92,"h3",52),n(93,"Sesiones Activas"),t(),a(94,"p",53),n(95),t()(),a(96,"div",54)(97,"div",58),C(98,Ae,13,4,"div",59)(99,ze,2,0,"div",60),t()()()()()),s&2){let e=y();r(11),p(e.formatAmount(e.stats.totalRevenue)),r(10),p(e.stats.totalSessions),r(10),p(e.formatAmount(e.stats.averageTicket)),r(10),p(e.stats.activeSessions),r(10),p(e.formatAmount(e.stats.pendingDebts)),r(3),l("ngClass",e.getOccupancyBgColor()),r(),l("ngClass",e.getOccupancyIconColor()),r(5),l("ngClass",e.getOccupancyColor()),r(),x(" ",e.occupancyPercentage,"% "),r(2),T(" ",e.stats.activeSessions," / ",e.maxCapacity>0?e.maxCapacity:"N/A"," veh\xEDculos "),r(9),l("series",e.salesChart.series)("chart",e.salesChart.chart)("plotOptions",e.salesChart.plotOptions)("dataLabels",e.salesChart.dataLabels)("xaxis",e.salesChart.xaxis)("yaxis",e.salesChart.yaxis)("colors",e.salesChart.colors)("tooltip",e.salesChart.tooltip),r(8),l("series",e.paymentsChart.series)("chart",e.paymentsChart.chart)("labels",e.paymentsChart.labels)("colors",e.paymentsChart.colors)("legend",e.paymentsChart.legend)("tooltip",e.paymentsChart.tooltip),r(9),l("series",e.sessionsChart.series)("chart",e.sessionsChart.chart)("xaxis",e.sessionsChart.xaxis)("yaxis",e.sessionsChart.yaxis)("colors",e.sessionsChart.colors)("fill",e.sessionsChart.fill),r(6),x("",e.dashboardData.active_sessions.count," sesiones activas"),r(3),l("ngForOf",e.dashboardData.active_sessions.sessions),r(),l("ngIf",e.dashboardData.active_sessions.sessions.length===0)}}var Oe={parse:{dateInput:"DD/MM/YYYY"},display:{dateInput:"DD/MM/YYYY",monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}},A=class extends W{format(m,e){if(e==="DD/MM/YYYY"){let o=m.getDate().toString().padStart(2,"0"),i=(m.getMonth()+1).toString().padStart(2,"0"),d=m.getFullYear();return`${o}/${i}/${d}`}return super.format(m,e)}parse(m){if(m&&m.match(/^\d{2}\/\d{2}\/\d{4}$/)){let[e,o,i]=m.split("/");return new Date(parseInt(i),parseInt(o)-1,parseInt(e))}return super.parse(m)}},_t=(()=>{class s{constructor(e,o,i,d,c){this.reportService=e,this.sessionService=o,this.paymentService=i,this.debtService=d,this.http=c,this._unsubscribeAll=new z,this.dashboardData=null,this.loading=!1,this.error=null,this.selectedDate=new Date,this.salesChart={},this.paymentsChart={},this.sessionsChart={},this.stats={totalRevenue:0,totalSessions:0,averageTicket:0,pendingDebts:0,activeSessions:0},this.maxCapacity=0,this.occupancyPercentage=0}ngOnInit(){this.loadDashboardData(),this.loadMaxCapacity(),this.initializeCharts()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}formatDateLocal(e){let o=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0");return`${o}-${i}-${d}`}loadDashboardData(){this.loading=!0,this.error=null;let e=this.formatDateLocal(this.selectedDate);this.reportService.getDashboard(e).pipe(_(this._unsubscribeAll)).subscribe({next:o=>{this.dashboardData=o.data,this.updateStats(),this.updateCharts(),this.loading=!1},error:o=>{this.error="Error al cargar datos del dashboard",this.loading=!1,console.error("Error loading dashboard:",o)}})}onDateChange(){this.loadDashboardData()}updateStats(){this.dashboardData&&(this.stats={totalRevenue:this.dashboardData.today_sales.total_amount,totalSessions:this.dashboardData.today_sales.count,averageTicket:this.dashboardData.today_sales.count>0?this.dashboardData.today_sales.total_amount/this.dashboardData.today_sales.count:0,pendingDebts:this.dashboardData.pending_debts.total_amount,activeSessions:this.dashboardData.active_sessions.count},this.calculateOccupancy())}loadMaxCapacity(){this.http.get(`${ae.apiUrl}/settings/general`).pipe(_(this._unsubscribeAll)).subscribe({next:e=>{e&&e.success&&e.data&&(this.maxCapacity=e.data.max_capacity||0,this.calculateOccupancy())},error:e=>{console.error("Error al cargar m\xE1xima capacidad:",e),this.maxCapacity=0}})}calculateOccupancy(){this.maxCapacity>0?this.occupancyPercentage=Math.round(this.stats.activeSessions/this.maxCapacity*100):this.occupancyPercentage=0}getOccupancyColor(){return this.occupancyPercentage>=90?"text-red-600":this.occupancyPercentage>=70?"text-orange-600":this.occupancyPercentage>=50?"text-yellow-600":"text-green-600"}getOccupancyBgColor(){return this.occupancyPercentage>=90?"bg-red-100":this.occupancyPercentage>=70?"bg-orange-100":this.occupancyPercentage>=50?"bg-yellow-100":"bg-green-100"}getOccupancyIconColor(){return this.occupancyPercentage>=90?"text-red-600":this.occupancyPercentage>=70?"text-orange-600":this.occupancyPercentage>=50?"text-yellow-600":"text-green-600"}updateCharts(){this.dashboardData&&(this.updateSalesChart(),this.updatePaymentsChart(),this.updateSessionsChart())}updateSalesChart(){let e=this.dashboardData.today_sales.by_sector,o=Object.entries(e).map(([i,d])=>({x:i,y:d.total}));this.salesChart={series:[{name:"Ventas",data:o}],chart:{type:"bar",height:400,toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!1},xaxis:{categories:Object.keys(e)},yaxis:{labels:{formatter:i=>this.formatAmount(i)}},colors:["#3B82F6"],tooltip:{y:{formatter:i=>this.formatAmount(i)}}}}updatePaymentsChart(){let e=this.dashboardData.today_payments.by_method,o=Object.entries(e).map(([i,d])=>({x:this.paymentService.getPaymentMethodLabel(i),y:d.total}));this.paymentsChart={series:Object.values(e).map(i=>i.total),chart:{type:"donut",height:400},labels:Object.keys(e).map(i=>this.paymentService.getPaymentMethodLabel(i)),colors:["#10B981","#3B82F6","#8B5CF6","#F59E0B"],legend:{position:"bottom"},tooltip:{y:{formatter:i=>this.formatAmount(i)}}}}updateSessionsChart(){let e=this.dashboardData.sessions_by_hour||[],o=e.map(i=>({x:`${i.hour.toString().padStart(2,"0")}:00`,y:i.count}));this.sessionsChart={series:[{name:"Sesiones Activas",data:o}],chart:{type:"area",height:400,toolbar:{show:!1},zoom:{enabled:!1}},stroke:{curve:"smooth",width:3},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.4,opacityTo:.1,stops:[0,90,100]}},xaxis:{categories:e.map(i=>`${i.hour.toString().padStart(2,"0")}:00`),labels:{rotate:-45,rotateAlways:!1}},yaxis:{title:{text:"Sesiones"},min:0},colors:["#3B82F6"],markers:{size:4,hover:{size:6},strokeWidth:2,strokeColors:["#3B82F6"],fillOpacity:1},grid:{borderColor:"#e5e7eb",strokeDashArray:4},tooltip:{y:{formatter:i=>`${i} sesiones`}}}}initializeCharts(){this.salesChart={series:[],chart:{type:"bar"}},this.paymentsChart={series:[],chart:{type:"donut"}},this.sessionsChart={series:[],chart:{type:"area"}}}formatAmount(e){return this.reportService.formatAmount(e)}formatDate(e){return this.reportService.formatDate(e)}refreshData(){this.loadDashboardData()}exportReport(){let e=this.formatDateLocal(this.selectedDate),o={date_from:e,date_to:e};this.reportService.exportToPdf("sales",o)}getStatusColor(e){return this.sessionService.getStatusColor(e)}getStatusLabel(e){return this.sessionService.getStatusLabel(e)}getPaymentMethodColor(e){return this.paymentService.getPaymentMethodColor(e)}getPaymentMethodLabel(e){return this.paymentService.getPaymentMethodLabel(e)}getElapsedTime(e){let o=new Date(e),d=Math.floor((new Date().getTime()-o.getTime())/1e3);return this.sessionService.formatDuration(d)}static{this.\u0275fac=function(o){return new(o||s)(v(De),v(Ce),v(Se),v(Me),v(Y))}}static{this.\u0275cmp=D({type:s,selectors:[["app-dashboard"]],features:[L([{provide:$,useClass:A,deps:[k]},{provide:H,useValue:Oe},{provide:k,useValue:"es-CL"}])],decls:50,vars:13,consts:[["picker",""],["pickerDesktop",""],[1,"p-6","w-full"],[1,"mb-8"],[1,"block","md:hidden"],[1,"mb-2"],[1,"text-3xl","font-bold","text-gray-900"],[1,"mb-4"],[1,"text-gray-600"],[1,"flex","flex-col","items-start","gap-4"],["appearance","outline",1,"w-full"],["matInput","","placeholder","dd/mm/yyyy",3,"ngModelChange","dateChange","matDatepicker","ngModel"],["matIconSuffix","",3,"for"],[1,"flex","items-center","justify-center","gap-4","w-full"],["mat-raised-button","",1,"rounded-sm",3,"click","disabled"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click","disabled"],[1,"hidden","md:flex","items-center","justify-between"],[1,"mt-2","text-gray-600"],[1,"flex","items-center","gap-4"],["appearance","outline",1,"w-48"],["mat-icon-button","",1,"rounded-sm",3,"click","disabled"],["class","flex justify-center items-center h-64",4,"ngIf"],["class","mb-6",4,"ngIf"],[4,"ngIf"],[1,"flex","justify-center","items-center","h-64"],["diameter","50"],[1,"mb-6"],["type","error",3,"dismissible"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-6","gap-6","mb-8"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-green-100","rounded-lg"],[1,"text-green-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-gray-900"],[1,"p-3","bg-blue-100","rounded-lg"],[1,"text-blue-600"],[1,"p-3","bg-purple-100","rounded-lg"],[1,"text-purple-600"],[1,"p-3","bg-orange-100","rounded-lg"],[1,"text-orange-600"],[1,"p-3","bg-red-100","rounded-lg"],[1,"text-red-600"],[1,"p-3","rounded-lg",3,"ngClass"],[3,"ngClass"],[1,"ml-4","flex-1"],[1,"text-2xl","font-bold",3,"ngClass"],[1,"text-xs","text-gray-500","mt-1"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-8"],[1,"flex","flex-col"],[1,"px-6","pt-4","pb-3","border-b","border-gray-200"],[1,"text-lg","font-semibold","text-gray-900","mb-1"],[1,"text-sm","text-gray-600"],[1,"p-6","flex-1"],[3,"series","chart","plotOptions","dataLabels","xaxis","yaxis","colors","tooltip"],[3,"series","chart","labels","colors","legend","tooltip"],[3,"series","chart","xaxis","yaxis","colors","fill"],[1,"space-y-3","max-h-80","overflow-y-auto"],["class","flex items-center justify-between p-3 bg-gray-50 rounded-lg",4,"ngFor","ngForOf"],["class","text-center py-8 text-gray-500",4,"ngIf"],[1,"flex","items-center","justify-between","p-3","bg-gray-50","rounded-lg"],[1,"flex","items-center","space-x-3"],[1,"w-3","h-3","bg-green-500","rounded-full"],[1,"font-medium","text-gray-900"],[1,"text-right"],[1,"text-xs","text-gray-500"],[1,"text-center","py-8","text-gray-500"]],template:function(o,i){if(o&1){let d=P();a(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h1",6),n(5,"Dashboard"),t()(),a(6,"div",7)(7,"p",8),n(8,"Resumen general del sistema de estacionamientos"),t()(),a(9,"div",9)(10,"mat-form-field",10)(11,"mat-label"),n(12,"Fecha"),t(),a(13,"input",11),w("ngModelChange",function(b){return g(d),E(i.selectedDate,b)||(i.selectedDate=b),h(b)}),f("dateChange",function(){return g(d),h(i.onDateChange())}),t(),u(14,"mat-datepicker-toggle",12)(15,"mat-datepicker",null,0),t(),a(17,"div",13)(18,"button",14),f("click",function(){return g(d),h(i.refreshData())}),a(19,"mat-icon"),n(20,"refresh"),t(),n(21," Refrescar "),t(),a(22,"button",15),f("click",function(){return g(d),h(i.exportReport())}),a(23,"mat-icon"),n(24,"download"),t(),n(25," Exportar "),t()()()(),a(26,"div",16)(27,"div")(28,"h1",6),n(29,"Dashboard"),t(),a(30,"p",17),n(31,"Resumen general del sistema de estacionamientos"),t()(),a(32,"div",18)(33,"mat-form-field",19)(34,"mat-label"),n(35,"Fecha"),t(),a(36,"input",11),w("ngModelChange",function(b){return g(d),E(i.selectedDate,b)||(i.selectedDate=b),h(b)}),f("dateChange",function(){return g(d),h(i.onDateChange())}),t(),u(37,"mat-datepicker-toggle",12)(38,"mat-datepicker",null,1),t(),a(40,"button",20),f("click",function(){return g(d),h(i.refreshData())}),a(41,"mat-icon"),n(42,"refresh"),t()(),a(43,"button",15),f("click",function(){return g(d),h(i.exportReport())}),a(44,"mat-icon"),n(45,"download"),t(),n(46," Exportar "),t()()()(),C(47,Ie,2,0,"div",21)(48,ke,3,2,"div",22)(49,Be,100,34,"div",23),t()}if(o&2){let d=S(16),c=S(39);r(13),l("matDatepicker",d),M("ngModel",i.selectedDate),r(),l("for",d),r(4),l("disabled",i.loading),r(4),l("disabled",!i.dashboardData),r(14),l("matDatepicker",c),M("ngModel",i.selectedDate),r(),l("for",c),r(3),l("disabled",i.loading),r(3),l("disabled",!i.dashboardData),r(4),l("ngIf",i.loading),r(),l("ngIf",i.error),r(),l("ngIf",i.dashboardData&&!i.loading)}},dependencies:[V,F,N,R,de,re,oe,se,he,X,K,Q,te,ee,pe,ce,ve,ue,be,fe,q,J,Z,G,U,me,le,ge,ye,Ee,ie,ne,_e,xe],styles:[".apx-chart[_ngcontent-%COMP%]{width:100%}.stats-card[_ngcontent-%COMP%]{transition:transform .2s ease-in-out}.stats-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.active-session-item[_ngcontent-%COMP%]{transition:background-color .2s ease-in-out}.active-session-item[_ngcontent-%COMP%]:hover{background-color:#0000000d}.quick-action-button[_ngcontent-%COMP%]{height:48px;min-width:120px}.quick-action-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}@media (max-width: 768px){.grid-cols-6[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (max-width: 480px){.grid-cols-6[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return s})();export{A as CustomDateAdapter,Oe as DATE_FORMATS,_t as DashboardComponent};
