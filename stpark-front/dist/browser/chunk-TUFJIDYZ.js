import{a as _e}from"./chunk-GZ2D5TE3.js";import{a as Fe}from"./chunk-QU4WFXUG.js";import{a as ke}from"./chunk-ZMZZWBL4.js";import{a as ue,b as fe,c as he,d as ge,e as Re,f as Se,g as ve,h as xe,i as be,j as ye,k as Ce}from"./chunk-CCGP22DJ.js";import{a as Te,b as Ee,c as Me,d as we,e as De,f as Ie}from"./chunk-NB6DWIHZ.js";import{a as se,b as le,c as pe,d as de}from"./chunk-VOI6ZFOM.js";import{a as me,b as ce}from"./chunk-F3KLSFSR.js";import{b as Z}from"./chunk-CSAVAYTO.js";import"./chunk-LKYHZS4A.js";import"./chunk-VKB6BRO6.js";import{b as Q,c as X}from"./chunk-7EGXZGVT.js";import{b as ae}from"./chunk-7AXTM6W3.js";import{b as G,f as U,j as Y,k as $,o as oe,p as ne}from"./chunk-FMD5N6HP.js";import{b as ee,f as te,j as re,w as ie}from"./chunk-SOR2HQFJ.js";import{W as N,fa as z,la as q,na as J,oa as K}from"./chunk-AHUY5V3P.js";import"./chunk-CQGOYTFO.js";import"./chunk-7OGW3PNS.js";import{l as B,m as H,p as j,s as L}from"./chunk-TQARHOKX.js";import{$b as v,Eb as d,Fc as E,Gb as T,Hc as M,Lc as W,Pb as e,Qb as t,Rb as g,Sb as R,Tb as S,U as w,Vb as A,bb as a,bc as D,cb as C,f as V,lc as k,mc as o,nc as _,oa as f,oc as F,pa as h,pb as P,pc as O,rc as x,sc as b,tc as y,vc as I,wb as c}from"./chunk-BSJZAB7M.js";import"./chunk-TSRGIXR5.js";var Ve=()=>[],Oe=()=>["plate","started_at","ended_at","sector","operator","duration","amount"];function Pe(i,s){i&1&&g(0,"div",44)}function Ae(i,s){i&1&&g(0,"div",44)}function We(i,s){i&1&&g(0,"div",44)}function Be(i,s){i&1&&g(0,"div",44)}function He(i,s){if(i&1&&(e(0,"mat-option",38),o(1),t()),i&2){let r=s.$implicit;d("value",r.id),a(),_(r.name)}}function je(i,s){if(i&1&&(e(0,"mat-option",38),o(1),t()),i&2){let r=s.$implicit;d("value",r.id),a(),_(r.name)}}function Le(i,s){i&1&&(e(0,"span"),o(1,"Resultados - Reporte de Ventas"),t())}function Ne(i,s){i&1&&(e(0,"span"),o(1,"Resultados - Reporte de Deudas"),t())}function ze(i,s){i&1&&(e(0,"span"),o(1,"Resultados - Reporte de Sesiones"),t())}function Ge(i,s){i&1&&(e(0,"span"),o(1,"Resultados - Reporte por Operador"),t())}function Ue(i,s){i&1&&(e(0,"th",67),o(1,"Placa"),t())}function Ye(i,s){if(i&1&&(e(0,"td",68),o(1),t()),i&2){let r=s.$implicit;a(),_(r.plate)}}function $e(i,s){i&1&&(e(0,"th",67),o(1,"Fecha Inicio"),t())}function qe(i,s){if(i&1&&(e(0,"td",68),o(1),E(2,"date"),t()),i&2){let r=s.$implicit;a(),_(M(2,1,r.started_at,"dd/MM/yyyy HH:mm"))}}function Je(i,s){i&1&&(e(0,"th",67),o(1,"Fecha Fin"),t())}function Ke(i,s){if(i&1&&(e(0,"td",68),o(1),E(2,"date"),t()),i&2){let r=s.$implicit;a(),_(M(2,1,r.ended_at,"dd/MM/yyyy HH:mm"))}}function Qe(i,s){i&1&&(e(0,"th",67),o(1,"Sector"),t())}function Xe(i,s){if(i&1&&(e(0,"td",68),o(1),t()),i&2){let r=s.$implicit;a(),_(r.sector)}}function Ze(i,s){i&1&&(e(0,"th",67),o(1,"Operador"),t())}function et(i,s){if(i&1&&(e(0,"td",68),o(1),t()),i&2){let r=s.$implicit;a(),_(r.operator)}}function tt(i,s){i&1&&(e(0,"th",67),o(1,"Duraci\xF3n"),t())}function rt(i,s){if(i&1&&(e(0,"td",68),o(1),t()),i&2){let r=s.$implicit;a(),_(r.duration_formatted||"N/A")}}function it(i,s){i&1&&(e(0,"th",67),o(1,"Monto"),t())}function ot(i,s){if(i&1&&(e(0,"td",68),o(1),t()),i&2){let r=s.$implicit,l=D(3);a(),_(l.reportService.formatAmount(r.amount||0))}}function nt(i,s){i&1&&g(0,"tr",69)}function at(i,s){i&1&&g(0,"tr",70)}function st(i,s){i&1&&(e(0,"div",71)(1,"p",72),o(2,"No hay datos para mostrar"),t()())}function lt(i,s){if(i&1&&(e(0,"div",53)(1,"table",54),R(2,55),c(3,Ue,2,0,"th",56)(4,Ye,2,1,"td",57),S(),R(5,58),c(6,$e,2,0,"th",56)(7,qe,3,4,"td",57),S(),R(8,59),c(9,Je,2,0,"th",56)(10,Ke,3,4,"td",57),S(),R(11,60),c(12,Qe,2,0,"th",56)(13,Xe,2,1,"td",57),S(),R(14,61),c(15,Ze,2,0,"th",56)(16,et,2,1,"td",57),S(),R(17,62),c(18,tt,2,0,"th",56)(19,rt,2,1,"td",57),S(),R(20,63),c(21,it,2,0,"th",56)(22,ot,2,1,"td",57),S(),c(23,nt,1,0,"tr",64)(24,at,1,0,"tr",65),t(),c(25,st,3,0,"div",66),t()),i&2){let r=D(2);a(),d("dataSource",r.currentReport.sessions||I(4,Ve)),a(22),d("matHeaderRowDef",I(5,Oe)),a(),d("matRowDefColumns",I(6,Oe)),a(),d("ngIf",!r.currentReport.sessions||r.currentReport.sessions.length===0)}}function pt(i,s){if(i&1&&(e(0,"mat-card",28)(1,"mat-card-header")(2,"mat-card-title"),c(3,Le,2,0,"span",45)(4,Ne,2,0,"span",45)(5,ze,2,0,"span",45)(6,Ge,2,0,"span",45),t(),e(7,"mat-card-subtitle"),o(8),E(9,"date"),E(10,"date"),t()(),e(11,"mat-card-content",9)(12,"div",46)(13,"div",47)(14,"p",15),o(15,"Total Registros"),t(),e(16,"p",48),o(17),t()(),e(18,"div",49)(19,"p",15),o(20,"Monto Total"),t(),e(21,"p",17),o(22),t()(),e(23,"div",50)(24,"p",15),o(25,"Per\xEDodo"),t(),e(26,"p",51),o(27),t()()(),c(28,lt,26,7,"div",52),t()()),i&2){let r=D();a(3),d("ngIf",r.currentReportType==="sales"),a(),d("ngIf",r.currentReportType==="debts"),a(),d("ngIf",r.currentReportType==="sessions"),a(),d("ngIf",r.currentReportType==="operator"),a(2),O(" Per\xEDodo: ",M(9,11,r.filters.date_from,"dd/MM/yyyy")," - ",M(10,14,r.filters.date_to,"dd/MM/yyyy")," "),a(9),F(" ",r.currentReport.total_sales||r.currentReport.total_sessions||r.currentReport.total_debts||0," "),a(5),F(" ",r.reportService.formatAmount(r.currentReport.total_amount||0)," "),a(5),O(" ",r.currentReport.period==null?null:r.currentReport.period.from," - ",r.currentReport.period==null?null:r.currentReport.period.to," "),a(),d("ngIf",r.currentReportType==="sales"||r.currentReportType==="sessions")}}var Ht=(()=>{class i{constructor(r,l,n,m){this.reportService=r,this.sectorService=l,this.operatorService=n,this.cdr=m,this._unsubscribeAll=new V,this.loading=!1,this.dashboardData=null,this.filters={date_from:new Date(new Date().setDate(new Date().getDate()-7)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0],sector_id:void 0,operator_id:void 0},this.selectedReportType="sales",this.sectors=[],this.operators=[],this.currentReport=null,this.currentReportType="",this.displayedColumns=["plate","started_at","ended_at","sector","operator","duration","amount"]}ngOnInit(){this.loadDashboardData(),this.loadFiltersData()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadDashboardData(){this.loading=!0,this.reportService.getDashboard().pipe(w(this._unsubscribeAll)).subscribe({next:r=>{this.dashboardData=r.data,this.loading=!1},error:r=>{console.error("Error loading dashboard data:",r),this.loading=!1}})}loadFiltersData(){this.sectorService.getSectors().subscribe({next:r=>{this.sectors=r.data.data||[]},error:r=>console.error("Error loading sectors:",r)}),this.operatorService.getAllOperators().subscribe({next:r=>{this.operators=r.data||[]},error:r=>console.error("Error loading operators:",r)})}onCardClick(r){this.selectedReportType=r}generateReportFromFilters(){this.generateReport(this.selectedReportType)}generateReport(r){this.currentReportType=r,this.loading=!0;let l={date_from:this.filters.date_from,date_to:this.filters.date_to};this.filters.sector_id&&(l.sector_id=this.filters.sector_id),this.filters.operator_id&&(l.operator_id=this.filters.operator_id);let n;switch(r){case"sales":n=this.reportService.getSalesReport(l);break;case"debts":n=this.reportService.getDebtsReport(l);break;case"sessions":n=this.reportService.getSessionsReport(l);break;case"operator":if(!l.operator_id){alert("Debe seleccionar un operador"),this.loading=!1;return}n=this.reportService.getOperatorReport(l);break;default:this.loading=!1;return}n.pipe(w(this._unsubscribeAll)).subscribe({next:m=>{this.currentReport=m.data,this.loading=!1,this.cdr.detectChanges()},error:m=>{console.error("Error generating report:",m),this.loading=!1}})}exportReport(r){if(this.currentReport&&this.currentReportType===r){this.exportCurrentReport();return}this.currentReportType=r,this.loading=!0;let l={date_from:this.filters.date_from,date_to:this.filters.date_to};this.filters.sector_id&&(l.sector_id=this.filters.sector_id),this.filters.operator_id&&(l.operator_id=this.filters.operator_id);let n;switch(r){case"sales":n=this.reportService.getSalesReport(l);break;case"debts":n=this.reportService.getDebtsReport(l);break;case"sessions":n=this.reportService.getSessionsReport(l);break;case"operator":if(!l.operator_id){alert("Debe seleccionar un operador"),this.loading=!1;return}n=this.reportService.getOperatorReport(l);break;default:this.loading=!1;return}n.pipe(w(this._unsubscribeAll)).subscribe({next:m=>{this.currentReport=m.data,this.loading=!1,this.cdr.detectChanges(),this.exportCurrentReport()},error:m=>{console.error("Error generating report:",m),this.loading=!1}})}exportCurrentReport(){if(!this.currentReport)return;let r=[],l="reporte";switch(this.currentReportType){case"sales":r=this.currentReport.sessions||[],l="reporte-ventas";break;case"sessions":r=this.currentReport.sessions||[],l="reporte-sesiones";break;case"debts":r=this.currentReport.debts||[],l="reporte-deudas";break;case"operator":r=this.currentReport.sessions||[],l="reporte-operador";break}this.reportService.exportToCSV(r,l)}clearFilters(){this.filters={date_from:new Date(new Date().setDate(new Date().getDate()-7)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0],sector_id:void 0,operator_id:void 0},this.currentReport=null,this.currentReportType=""}getTotalSales(){return this.currentReport&&this.currentReportType==="sales"?this.reportService.formatAmount(this.currentReport.total_amount||0):this.dashboardData?.today_sales?.total_amount?this.reportService.formatAmount(this.dashboardData.today_sales.total_amount):"$0"}getTotalPayments(){return this.currentReport&&this.currentReportType==="payments"?this.currentReport.total_payments||0:this.dashboardData?.today_payments?.count||0}getTotalDebts(){return this.currentReport&&this.currentReportType==="debts"?this.currentReport.total_debts||0:this.dashboardData?.pending_debts?.count||0}getTotalDebtsAmount(){return this.currentReport&&this.currentReportType==="debts"?this.reportService.formatAmount(this.currentReport.total_amount||0):this.dashboardData?.pending_debts?.total_amount?this.reportService.formatAmount(this.dashboardData.pending_debts.total_amount):"$0"}getOperatorCount(){return this.currentReport&&this.currentReportType==="operator"&&this.currentReport.sessions?.total||0}getSessionsCount(){return this.currentReport&&this.currentReportType==="sessions"?(this.currentReport.total_sessions||0).toString():this.dashboardData?.active_sessions?.count!==void 0?this.dashboardData.active_sessions.count.toString():"0"}getPaymentMethodLabel(r){return{CASH:"Efectivo",CARD:"Tarjeta",WEBPAY:"Webpay",TRANSFER:"Transferencia"}[r]||r}static{this.\u0275fac=function(l){return new(l||i)(C(_e),C(ke),C(Fe),C(W))}}static{this.\u0275cmp=P({type:i,selectors:[["app-reports"]],decls:138,vars:38,consts:[["picker1",""],["picker2",""],[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-6"],[1,"relative","hover:shadow-lg","transition-all"],["class","absolute inset-0 bg-gray-300 bg-opacity-30 z-10 rounded-lg",4,"ngIf"],[1,"p-6"],[1,"flex","items-center","mb-4"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"ml-4"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-green-600"],["mat-icon-button","",3,"click"],[1,"p-3","bg-red-100","rounded-full"],[1,"text-red-600"],[1,"text-2xl","font-bold","text-red-600"],[1,"p-3","bg-purple-100","rounded-full"],[1,"text-purple-600"],[1,"text-2xl","font-bold","text-purple-600"],[1,"p-3","bg-orange-100","rounded-full"],[1,"text-orange-600"],[1,"text-2xl","font-bold","text-orange-600"],[1,"mt-6"],[1,"grid","grid-cols-1","md:grid-cols-5","gap-4"],["appearance","outline"],[3,"ngModelChange","ngModel"],["value","sales"],["value","debts"],["value","operator"],["value","sessions"],["matInput","","type","text","placeholder","dd/mm/yyyy",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"flex","justify-end","gap-4","mt-6"],["mat-stroked-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["class","mt-6",4,"ngIf"],[1,"absolute","inset-0","bg-gray-300","bg-opacity-30","z-10","rounded-lg"],[4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6"],[1,"bg-blue-50","p-4","rounded-lg"],[1,"text-2xl","font-bold","text-blue-600"],[1,"bg-green-50","p-4","rounded-lg"],[1,"bg-purple-50","p-4","rounded-lg"],[1,"text-lg","font-semibold","text-purple-600"],["class","overflow-x-auto",4,"ngIf"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","plate"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","started_at"],["matColumnDef","ended_at"],["matColumnDef","sector"],["matColumnDef","operator"],["matColumnDef","duration"],["matColumnDef","amount"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","text-center py-8",4,"ngIf"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"text-center","py-8"],[1,"text-gray-500"]],template:function(l,n){if(l&1){let m=A();e(0,"div",2)(1,"div",3)(2,"div")(3,"h1",4),o(4,"Reportes"),t(),e(5,"p",5),o(6,"Genera y exporta reportes del sistema"),t()()(),e(7,"div",6)(8,"mat-card",7),c(9,Pe,1,0,"div",8),e(10,"mat-card-content",9)(11,"div",10)(12,"div",11)(13,"mat-icon",12),o(14,"trending_up"),t()(),e(15,"div",13)(16,"h3",14),o(17,"Reporte de Ventas"),t(),e(18,"p",15),o(19,"An\xE1lisis de ventas por per\xEDodo"),t()()(),e(20,"div",16)(21,"span",17),o(22),t(),e(23,"button",18),v("click",function(p){return f(m),n.exportReport("sales"),h(p.stopPropagation())}),e(24,"mat-icon"),o(25,"download"),t()()()()(),e(26,"mat-card",7),c(27,Ae,1,0,"div",8),e(28,"mat-card-content",9)(29,"div",10)(30,"div",19)(31,"mat-icon",20),o(32,"account_balance_wallet"),t()(),e(33,"div",13)(34,"h3",14),o(35,"Reporte de Deudas"),t(),e(36,"p",15),o(37,"An\xE1lisis de deudas pendientes"),t()()(),e(38,"div",16)(39,"span",21),o(40),t(),e(41,"button",18),v("click",function(p){return f(m),n.exportReport("debts"),h(p.stopPropagation())}),e(42,"mat-icon"),o(43,"download"),t()()()()(),e(44,"mat-card",7),c(45,We,1,0,"div",8),e(46,"mat-card-content",9)(47,"div",10)(48,"div",22)(49,"mat-icon",23),o(50,"people"),t()(),e(51,"div",13)(52,"h3",14),o(53,"Reporte por Operador"),t(),e(54,"p",15),o(55,"Rendimiento por operador"),t()()(),e(56,"div",16)(57,"span",24),o(58),t(),e(59,"button",18),v("click",function(p){return f(m),n.exportReport("operator"),h(p.stopPropagation())}),e(60,"mat-icon"),o(61,"download"),t()()()()(),e(62,"mat-card",7),c(63,Be,1,0,"div",8),e(64,"mat-card-content",9)(65,"div",10)(66,"div",25)(67,"mat-icon",26),o(68,"schedule"),t()(),e(69,"div",13)(70,"h3",14),o(71,"Reporte de Sesiones"),t(),e(72,"p",15),o(73,"Todas las sesiones del per\xEDodo"),t()()(),e(74,"div",16)(75,"span",27),o(76),t(),e(77,"button",18),v("click",function(p){return f(m),n.exportReport("sessions"),h(p.stopPropagation())}),e(78,"mat-icon"),o(79,"download"),t()()()()()(),e(80,"mat-card",28)(81,"mat-card-header")(82,"mat-card-title"),o(83,"Filtros de Reporte"),t(),e(84,"mat-card-subtitle"),o(85,"Configura los par\xE1metros para generar reportes personalizados"),t()(),e(86,"mat-card-content",9)(87,"div",29)(88,"mat-form-field",30)(89,"mat-label"),o(90,"Tipo de Reporte"),t(),e(91,"mat-select",31),y("ngModelChange",function(p){return f(m),b(n.selectedReportType,p)||(n.selectedReportType=p),h(p)}),e(92,"mat-option",32),o(93,"Reporte de Ventas"),t(),e(94,"mat-option",33),o(95,"Reporte de Deudas"),t(),e(96,"mat-option",34),o(97,"Reporte por Operador"),t(),e(98,"mat-option",35),o(99,"Reporte de Sesiones"),t()()(),e(100,"mat-form-field",30)(101,"mat-label"),o(102,"Fecha desde"),t(),e(103,"input",36),y("ngModelChange",function(p){return f(m),b(n.filters.date_from,p)||(n.filters.date_from=p),h(p)}),t(),g(104,"mat-datepicker-toggle",37)(105,"mat-datepicker",null,0),t(),e(107,"mat-form-field",30)(108,"mat-label"),o(109,"Fecha hasta"),t(),e(110,"input",36),y("ngModelChange",function(p){return f(m),b(n.filters.date_to,p)||(n.filters.date_to=p),h(p)}),t(),g(111,"mat-datepicker-toggle",37)(112,"mat-datepicker",null,1),t(),e(114,"mat-form-field",30)(115,"mat-label"),o(116,"Sector"),t(),e(117,"mat-select",31),y("ngModelChange",function(p){return f(m),b(n.filters.sector_id,p)||(n.filters.sector_id=p),h(p)}),e(118,"mat-option",38),o(119,"Todos los sectores"),t(),c(120,He,2,2,"mat-option",39),t()(),e(121,"mat-form-field",30)(122,"mat-label"),o(123,"Operador"),t(),e(124,"mat-select",31),y("ngModelChange",function(p){return f(m),b(n.filters.operator_id,p)||(n.filters.operator_id=p),h(p)}),e(125,"mat-option",38),o(126,"Todos los operadores"),t(),c(127,je,2,2,"mat-option",39),t()()(),e(128,"div",40)(129,"button",41),v("click",function(){return f(m),h(n.clearFilters())}),e(130,"mat-icon"),o(131,"refresh"),t(),o(132," Limpiar "),t(),e(133,"button",42),v("click",function(){return f(m),h(n.generateReportFromFilters())}),e(134,"mat-icon"),o(135,"search"),t(),o(136," Generar Reporte "),t()()()(),c(137,pt,29,17,"mat-card",43),t()}if(l&2){let m=k(106),u=k(113);a(8),T("cursor-pointer",n.selectedReportType==="sales")("opacity-50",n.selectedReportType!=="sales"),a(),d("ngIf",n.selectedReportType!=="sales"),a(13),_(n.getTotalSales()),a(4),T("cursor-pointer",n.selectedReportType==="debts")("opacity-50",n.selectedReportType!=="debts"),a(),d("ngIf",n.selectedReportType!=="debts"),a(13),_(n.getTotalDebtsAmount()),a(4),T("cursor-pointer",n.selectedReportType==="operator")("opacity-50",n.selectedReportType!=="operator"),a(),d("ngIf",n.selectedReportType!=="operator"),a(13),_(n.getOperatorCount()),a(4),T("cursor-pointer",n.selectedReportType==="sessions")("opacity-50",n.selectedReportType!=="sessions"),a(),d("ngIf",n.selectedReportType!=="sessions"),a(13),_(n.getSessionsCount()),a(15),x("ngModel",n.selectedReportType),a(12),d("matDatepicker",m),x("ngModel",n.filters.date_from),a(),d("for",m),a(6),d("matDatepicker",u),x("ngModel",n.filters.date_to),a(),d("for",u),a(6),x("ngModel",n.filters.sector_id),a(),d("value",void 0),a(2),d("ngForOf",n.sectors),a(4),x("ngModel",n.filters.operator_id),a(),d("value",void 0),a(2),d("ngForOf",n.operators),a(10),d("ngIf",n.currentReport&&n.currentReportType)}},dependencies:[L,B,H,j,ie,ee,te,re,Ie,Te,Me,De,we,Ee,K,q,J,X,Q,ae,$,Y,G,U,ne,oe,de,se,le,pe,ce,me,z,Ce,ue,he,ve,ge,fe,xe,Re,Se,be,ye,N,Z],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f;transition:box-shadow .3s ease}.mat-mdc-card[_ngcontent-%COMP%]:hover{box-shadow:0 10px 25px #00000026}@media (max-width: 768px){.grid-cols-3[_ngcontent-%COMP%], .grid-cols-4[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return i})();export{Ht as ReportsComponent};
