import{a as Ke}from"./chunk-3K23HDUD.js";import{o as _e,q as be,u as Ce,v as xe}from"./chunk-IS5LCSW4.js";import{a as ye}from"./chunk-N3PSIUVN.js";import{a as je,b as qe,c as Ge}from"./chunk-B4562CJV.js";import{a as We,b as Be,c as He,d as T,e as $e,f as Re,g as Je}from"./chunk-EIOBBUXT.js";import{a as Pe,b as we,c as Oe,d as Ie,e as Te,f as ke,g as Le,h as Ne,i as Ae,j as Fe,k as Ve,l as ze}from"./chunk-JQJEW66P.js";import{a as Ue,c as Qe,f as Ye}from"./chunk-LQ6VDMYR.js";import{a as he,b as Me,c as ve,d as Se}from"./chunk-22A5ZCIO.js";import{a as De,b as Ee}from"./chunk-3XUFRE2P.js";import{_ as fe}from"./chunk-GI2EMKD6.js";import{a as ne,b as ae,c as oe,d as re}from"./chunk-WUZYVV4A.js";import"./chunk-VW6GL46F.js";import"./chunk-5BYKA3OK.js";import"./chunk-VKB6BRO6.js";import{b as te,c as ie}from"./chunk-VZDRD6LA.js";import{d as ce,e as pe}from"./chunk-FPQM25CI.js";import{a as ue,b as ge}from"./chunk-INOVVGPP.js";import{b as Q,f as Y,j as J,k as K}from"./chunk-PXBHKAGM.js";import{b as le,f as se,j as de,x as me}from"./chunk-EGGCURRC.js";import{ga as U,ma as X,oa as Z,pa as ee}from"./chunk-CVYDX437.js";import"./chunk-CQGOYTFO.js";import"./chunk-7OGW3PNS.js";import{k as q,l as G,m as O,s as I}from"./chunk-TQARHOKX.js";import{$b as C,Eb as m,Hb as B,Ib as P,Pb as i,Qb as t,Rb as x,Sb as S,Tb as D,U as k,Vb as E,bb as o,bc as c,cb as W,f as F,fc as H,gc as $,hc as R,lc as L,mc as a,na as V,nc as p,oa as f,oc as y,pa as _,pb as w,rc as h,sc as M,tc as v,uc as j,vc as N,wb as g,ya as z}from"./chunk-BSJZAB7M.js";import{a as A}from"./chunk-TSRGIXR5.js";var tt=()=>({width:"45rem"}),it=()=>({"1199px":"70vw","575px":"90vw"});function nt(n,s){n&1&&(i(0,"div",4)(1,"div",5),x(2,"div",6),i(3,"p",7),a(4,"Cargando detalles de la deuda..."),t()()())}function at(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Patente:"),t(),i(3,"span",13),a(4),t()()),n&2){let e=c(3);o(4),p(e.debt.parking_session.plate)}}function ot(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Sector:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(3);o(4),p(e.debt.parking_session.sector.name)}}function rt(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Calle:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(3);o(4),p(e.debt.parking_session.street.name)}}function lt(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Inicio:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(3);o(4),p(e.formatDate(e.debt.parking_session.started_at))}}function st(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Fin:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(3);o(4),p(e.formatDate(e.debt.parking_session.ended_at))}}function dt(n,s){if(n&1&&(i(0,"div",9)(1,"h3"),a(2,"Sesi\xF3n Asociada"),t(),i(3,"div",10)(4,"div",11)(5,"label"),a(6,"ID de Sesi\xF3n:"),t(),i(7,"span",12),a(8),t()(),g(9,at,5,1,"div",19)(10,ot,5,1,"div",19)(11,rt,5,1,"div",19)(12,lt,5,1,"div",19)(13,st,5,1,"div",19),t()()),n&2){let e=c(2);o(8),p(e.debt.session_id),o(),m("ngIf",e.debt.parking_session),o(),m("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.sector),o(),m("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.street),o(),m("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.started_at),o(),m("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.ended_at)}}function mt(n,s){if(n&1&&(i(0,"div",22)(1,"div",23)(2,"span",24),a(3),t(),i(4,"span",25),a(5),t()(),i(6,"div",26),a(7),t()()),n&2){let e=s.$implicit,r=c(3);o(3),p(e.method),o(2),p(r.formatAmount(e.amount)),o(2),p(r.formatDate(e.created_at))}}function ct(n,s){if(n&1&&(i(0,"div",9)(1,"h3"),a(2,"Pagos Realizados"),t(),i(3,"div",20),g(4,mt,8,3,"div",21),t()()),n&2){let e=c(2);o(4),m("ngForOf",e.debt.payments)}}function pt(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Liquidada:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(2);o(4),p(e.formatDate(e.debt.settled_at))}}function ut(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Actualizada:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(2);o(4),p(e.formatDate(e.debt.updated_at))}}function gt(n,s){if(n&1&&(i(0,"div",8)(1,"div",9)(2,"h3"),a(3,"Informaci\xF3n de la Deuda"),t(),i(4,"div",10)(5,"div",11)(6,"label"),a(7,"ID:"),t(),i(8,"span",12),a(9),t()(),i(10,"div",11)(11,"label"),a(12,"Placa:"),t(),i(13,"span",13),a(14),t()(),i(15,"div",11)(16,"label"),a(17,"Monto:"),t(),i(18,"span",14),a(19),t()(),i(20,"div",11)(21,"label"),a(22,"Origen:"),t(),i(23,"div",15),x(24,"i",16),i(25,"span"),a(26),t()()(),i(27,"div",11)(28,"label"),a(29,"Estado:"),t(),i(30,"span",17),a(31),t()()()(),g(32,dt,14,6,"div",18)(33,ct,5,1,"div",18),i(34,"div",9)(35,"h3"),a(36,"Auditor\xEDa"),t(),i(37,"div",10)(38,"div",11)(39,"label"),a(40,"Creada:"),t(),i(41,"span"),a(42),t()(),g(43,pt,5,1,"div",19)(44,ut,5,1,"div",19),t()()()),n&2){let e=c();o(9),p(e.debt.id),o(5),p(e.debt.plate),o(5),p(e.formatAmount(e.debt.principal_amount)),o(5),P(e.getOriginIcon(e.debt.origin)),o(2),p(e.getOriginText(e.debt.origin)),o(4),m("ngClass","status-"+e.getStatusColor(e.debt.status)),o(),y(" ",e.getStatusText(e.debt.status)," "),o(),m("ngIf",e.debt.session_id),o(),m("ngIf",e.debt.payments&&e.debt.payments.length>0),o(9),p(e.formatDate(e.debt.created_at)),o(),m("ngIf",e.debt.settled_at),o(),m("ngIf",e.debt.updated_at&&e.debt.updated_at!==e.debt.created_at)}}function ft(n,s){if(n&1){let e=E();i(0,"div",27)(1,"button",28),C("click",function(){f(e);let l=c();return _(l.closeModal())}),t(),i(2,"button",29),C("click",function(){f(e);let l=c();return _(l.printDebt())}),t()()}}var Xe=(()=>{class n{constructor(){this.visible=!1,this.debt=null,this.visibleChange=new z}ngOnChanges(){}closeModal(){this.visible=!1,this.visibleChange.emit(!1)}formatAmount(e){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e).replace("CLP","$")}formatDate(e){if(!e)return"N/A";let r=new Date(e);if(isNaN(r.getTime()))return"N/A";let l=r.toLocaleDateString("es-CL",{day:"2-digit",month:"2-digit",year:"numeric"}),d=r.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${l} ${d}`}getStatusText(e){switch(e){case"PENDING":return"Pendiente";case"SETTLED":return"Liquidada";case"CANCELLED":return"Cancelada";default:return e}}getStatusColor(e){switch(e){case"PENDING":return"orange";case"SETTLED":return"green";case"CANCELLED":return"red";default:return"gray"}}getOriginText(e){switch(e){case"SESSION":return"Sesi\xF3n de Estacionamiento";case"FINE":return"Multa";case"MANUAL":return"Manual";default:return e}}getOriginIcon(e){switch(e){case"SESSION":return"pi-car";case"FINE":return"pi-exclamation-triangle";case"MANUAL":return"pi-user-edit";default:return"pi-question-circle"}}printDebt(){if(!this.debt)return;let e=window.open("","_blank");if(e){let r=this.generateDebtReceiptHtml();e.document.write(r),e.document.close(),e.print()}}generateDebtReceiptHtml(){return this.debt?`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Detalle de Deuda - ${this.debt.id}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          .header { text-align: center; margin-bottom: 30px; }
          .receipt-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
          .receipt-info { font-size: 14px; color: #666; }
          .section { margin-bottom: 20px; }
          .section-title { font-size: 16px; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #ccc; }
          .detail-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
          .detail-label { font-weight: bold; }
          .amount { font-size: 18px; font-weight: bold; color: #dc2626; }
          .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #666; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="receipt-title">DETALLE DE DEUDA</div>
          <div class="receipt-info">STPark - Sistema de Estacionamientos</div>
        </div>
        
        <div class="section">
          <div class="section-title">Informaci\xF3n de la Deuda</div>
          <div class="detail-row">
            <span class="detail-label">ID de Deuda:</span>
            <span>${this.debt.id}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Placa:</span>
            <span>${this.debt.plate}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Monto:</span>
            <span class="amount">${this.formatAmount(this.debt.principal_amount)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Origen:</span>
            <span>${this.getOriginText(this.debt.origin)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Estado:</span>
            <span>${this.getStatusText(this.debt.status)}</span>
          </div>
        </div>
        
        ${this.debt.session_id?`
        <div class="section">
          <div class="section-title">Informaci\xF3n de la Sesi\xF3n</div>
          <div class="detail-row">
            <span class="detail-label">ID de Sesi\xF3n:</span>
            <span>${this.debt.session_id}</span>
          </div>
        </div>
        `:""}
        
        <div class="section">
          <div class="section-title">Informaci\xF3n de Auditor\xEDa</div>
          <div class="detail-row">
            <span class="detail-label">Creada:</span>
            <span>${this.formatDate(this.debt.created_at)}</span>
          </div>
          ${this.debt.settled_at?`
          <div class="detail-row">
            <span class="detail-label">Liquidada:</span>
            <span>${this.formatDate(this.debt.settled_at)}</span>
          </div>
          `:""}
        </div>
        
        <div class="footer">
          <div>Fecha de impresi\xF3n: ${this.formatDate(new Date().toISOString())}</div>
          <div>Gracias por usar STPark</div>
        </div>
      </body>
      </html>
    `:""}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=w({type:n,selectors:[["app-debt-details-modal"]],inputs:{visible:"visible",debt:"debt"},outputs:{visibleChange:"visibleChange"},features:[V],decls:4,vars:13,consts:[["header","DETALLES DE LA DEUDA",3,"visibleChange","visible","modal","breakpoints","draggable","resizable","closable","closeOnEscape"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","debt-details",4,"ngIf"],["pTemplate","footer"],[1,"flex","justify-center","items-center","py-8"],[1,"text-center"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600","mx-auto","mb-4"],[1,"text-gray-600"],[1,"debt-details"],[1,"detail-section"],[1,"detail-grid","compact"],[1,"detail-item"],[1,"font-mono"],[1,"plate"],[1,"amount"],[1,"origin-info"],[1,"origin-icon"],[1,"status",3,"ngClass"],["class","detail-section",4,"ngIf"],["class","detail-item",4,"ngIf"],[1,"payments-list"],["class","payment-item",4,"ngFor","ngForOf"],[1,"payment-item"],[1,"payment-info"],[1,"payment-method"],[1,"payment-amount"],[1,"payment-date"],[1,"flex","justify-end","gap-2"],["pButton","","type","button","label","Cerrar","icon","pi pi-times",1,"p-button-text",3,"click"],["pButton","","type","button","label","Imprimir","icon","pi pi-print",1,"p-button-outlined",3,"click"]],template:function(r,l){r&1&&(i(0,"p-dialog",0),v("visibleChange",function(b){return M(l.visible,b)||(l.visible=b),b}),C("visibleChange",function(b){return l.visibleChange.emit(b)}),g(1,nt,5,0,"div",1)(2,gt,45,13,"div",2)(3,ft,3,0,"ng-template",3),t()),r&2&&(B(N(11,tt)),h("visible",l.visible),m("modal",!0)("breakpoints",N(12,it))("draggable",!1)("resizable",!1)("closable",!1)("closeOnEscape",!1),o(),m("ngIf",!l.debt),o(),m("ngIf",l.debt))},dependencies:[I,q,G,O,xe,Ce,fe,be,_e],styles:[".debt-details[_ngcontent-%COMP%]   .detail-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.debt-details[_ngcontent-%COMP%]   .detail-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#374151;margin-bottom:.75rem;padding-bottom:.25rem;border-bottom:1px solid #e5e7eb}.debt-details[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:.75rem}.debt-details[_ngcontent-%COMP%]   .detail-grid.compact[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.5rem}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500;color:#6b7280;text-transform:uppercase;letter-spacing:.05em}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem;color:#111827;font-weight:500}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .font-mono[_ngcontent-%COMP%]{font-family:Monaco,Menlo,Ubuntu Mono,monospace;background-color:#f3f4f6;padding:.25rem .5rem;border-radius:.25rem;font-size:.875rem}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .plate[_ngcontent-%COMP%]{font-family:Monaco,Menlo,Ubuntu Mono,monospace;background-color:#dbeafe;color:#1e40af;padding:.25rem .5rem;border-radius:.25rem;font-weight:600;text-transform:uppercase}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;color:#dc2626}.debt-details[_ngcontent-%COMP%]   .origin-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.debt-details[_ngcontent-%COMP%]   .origin-info[_ngcontent-%COMP%]   .origin-icon[_ngcontent-%COMP%]{font-size:1.25rem;color:#6b7280}.debt-details[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .75rem;border-radius:9999px;font-size:.875rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em}.debt-details[_ngcontent-%COMP%]   .status.status-orange[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.debt-details[_ngcontent-%COMP%]   .status.status-green[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.debt-details[_ngcontent-%COMP%]   .status.status-red[_ngcontent-%COMP%]{background-color:#fee2e2;color:#991b1b}.debt-details[_ngcontent-%COMP%]   .status.status-gray[_ngcontent-%COMP%]{background-color:#f3f4f6;color:#6b7280}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background-color:#f9fafb;border-radius:.5rem;margin-bottom:.5rem;border-left:4px solid #10b981}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-info[_ngcontent-%COMP%]   .payment-method[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#374151}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-info[_ngcontent-%COMP%]   .payment-amount[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#059669}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-date[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280}@media (max-width: 768px){.debt-details[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%], .debt-details[_ngcontent-%COMP%]   .detail-grid.compact[_ngcontent-%COMP%]{grid-template-columns:1fr}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:1rem}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}[_nghost-%COMP%]     .p-dialog-footer{padding:1rem 1.5rem;border-top:1px solid #e5e7eb;background-color:#f9fafb}"]})}}return n})();function _t(n,s){n&1&&(i(0,"th",56),a(1,"Placa"),t())}function bt(n,s){if(n&1&&(i(0,"td",57)(1,"span",58),a(2),t()()),n&2){let e=s.$implicit;o(2),p(e.plate)}}function Ct(n,s){n&1&&(i(0,"th",59),a(1,"Monto"),t())}function xt(n,s){if(n&1&&(i(0,"td",57)(1,"span",60),a(2),t()()),n&2){let e=s.$implicit,r=c();o(2),y(" ",r.formatAmount(e.principal_amount)," ")}}function ht(n,s){n&1&&(i(0,"th",61),a(1,"Origen"),t())}function Mt(n,s){if(n&1&&(i(0,"td",57)(1,"mat-chip-set")(2,"mat-chip"),a(3),t()()()),n&2){let e=s.$implicit,r=c();o(2),P("bg-"+r.getOriginColor(e.origin)+"-100 text-"+r.getOriginColor(e.origin)+"-800"),o(),y(" ",r.getOriginLabel(e.origin)," ")}}function vt(n,s){n&1&&(i(0,"th",62),a(1,"Estado"),t())}function St(n,s){if(n&1&&(i(0,"td",57)(1,"span",63),a(2),t()()),n&2){let e=s.$implicit,r=c();o(),P("bg-"+r.getStatusColor(e.status)+"-100 text-"+r.getStatusColor(e.status)+"-800"),o(),y(" ",e.status==="PENDING"?"Pendiente":"Liquidada"," ")}}function Dt(n,s){n&1&&(i(0,"th",64),a(1,"Fecha"),t())}function Et(n,s){if(n&1&&(i(0,"td",57),a(1),t()),n&2){let e=s.$implicit,r=c();o(),y(" ",r.formatDate(e.created_at)," ")}}function yt(n,s){n&1&&(i(0,"th",65),a(1,"Acciones"),t())}function Pt(n,s){if(n&1){let e=E();i(0,"button",67),C("click",function(){f(e);let l=c().$implicit,d=c();return _(d.settleDebt(l))}),i(1,"mat-icon"),a(2,"payment"),t(),a(3," Liquidar deuda "),t()}}function wt(n,s){if(n&1){let e=E();i(0,"td",57)(1,"button",66)(2,"mat-icon"),a(3,"more_vert"),t()(),i(4,"mat-menu",null,1)(6,"button",67),C("click",function(){let l=f(e).$implicit,d=c();return _(d.showDebtDetails(l))}),i(7,"mat-icon"),a(8,"visibility"),t(),a(9," Ver detalles "),t(),g(10,Pt,4,0,"button",68),i(11,"button",67),C("click",function(){let l=f(e).$implicit,d=c();return _(d.printDebt(l))}),i(12,"mat-icon"),a(13,"print"),t(),a(14," Imprimir "),t()()()}if(n&2){let e=s.$implicit,r=L(5);o(),m("matMenuTriggerFor",r),o(9),m("ngIf",e.status==="PENDING")}}function Ot(n,s){n&1&&x(0,"tr",69)}function It(n,s){n&1&&x(0,"tr",70)}function Tt(n,s){n&1&&(i(0,"div",71),x(1,"mat-spinner",72),t())}function kt(n,s){n&1&&(i(0,"div",73)(1,"mat-icon",74),a(2,"account_balance_wallet"),t(),i(3,"h3",75),a(4,"No hay deudas registradas"),t(),i(5,"p",76),a(6,"Las deudas aparecer\xE1n aqu\xED cuando se generen."),t()())}function Lt(n,s){if(n&1){let e=E();i(0,"mat-paginator",77),C("page",function(l){f(e);let d=c();return _(d.onPageChange(l))}),t()}if(n&2){let e=c();m("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}var yi=(()=>{class n{constructor(e){this.debtService=e,this._unsubscribeAll=new F,this.debts=[],this.dataSource=new ze([]),this.loading=!1,this.displayedColumns=["plate","amount","origin","status","created_at","actions"],this.showDetailsModal=!1,this.selectedDebt=null,this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.filters={plate:"",origin:"",status:"",date_from:""}}ngOnInit(){this.loadDebts()}ngAfterViewInit(){this.dataSource.sort=this.sort}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadDebts(){this.loading=!0;let e=A({page:this.currentPage+1,per_page:this.pageSize},this.filters);this.debtService.getDebts(e).pipe(k(this._unsubscribeAll)).subscribe({next:r=>{this.debts=r.data?.data||[],this.dataSource.data=this.debts,this.totalItems=r.data?.total||0,this.loading=!1},error:r=>{console.error("Error loading debts:",r),this.loading=!1}})}formatAmount(e){return this.debtService.formatAmount(e)}formatDate(e){if(!e)return"N/A";let r=new Date(e);if(isNaN(r.getTime()))return"N/A";let l=r.toLocaleDateString("es-CL",{day:"2-digit",month:"2-digit",year:"numeric"}),d=r.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${l} ${d}`}getStatusColor(e){switch(e){case"PENDING":return"orange";case"SETTLED":return"green";default:return"gray"}}getOriginColor(e){switch(e){case"SESSION":return"blue";case"FINE":return"red";case"MANUAL":return"purple";default:return"gray"}}getOriginLabel(e){switch(e){case"SESSION":return"Sesi\xF3n";case"FINE":return"Multa";case"MANUAL":return"Manual";default:return e}}getPendingCount(){return this.debts.filter(e=>e.status==="PENDING").length}getSettledCount(){return this.debts.filter(e=>e.status==="SETTLED").length}getTotalPending(){return this.debts.filter(e=>e.status==="PENDING").reduce((e,r)=>e+r.principal_amount,0)}settleDebt(e){console.log("Settling debt:",e)}showDebtDetails(e){this.loading=!0,this.debtService.getDebt(e.id).pipe(k(this._unsubscribeAll)).subscribe({next:r=>{this.selectedDebt=r.data,this.showDetailsModal=!0,this.loading=!1},error:r=>{console.error("Error loading debt details:",r),this.loading=!1}})}closeDetailsModal(){this.showDetailsModal=!1,this.selectedDebt=null}printDebt(e){console.log("Printing debt:",e)}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadDebts()}applyFilters(){this.currentPage=0,this.loadDebts()}clearFilters(){this.filters={plate:"",origin:"",status:"",date_from:""},this.currentPage=0,this.loadDebts()}static{this.\u0275fac=function(r){return new(r||n)(W(ye))}}static{this.\u0275cmp=w({type:n,selectors:[["app-debts"]],viewQuery:function(r,l){if(r&1&&H(T,5),r&2){let d;$(d=R())&&(l.sort=d.first)}},features:[j([{provide:We,useValue:Je()}])],decls:113,vars:17,consts:[["picker",""],["menu","matMenu"],[1,"p-6","w-full"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-orange-100","rounded-full"],[1,"text-orange-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-orange-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"text-2xl","font-bold","text-blue-600"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],["appearance","outline"],["matInput","","placeholder","ABC123",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],["value","SESSION"],["value","FINE"],["value","MANUAL"],["value","PENDING"],["value","SETTLED"],["matInput","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"overflow-x-auto"],["mat-table","","matSort","",1,"w-full",3,"dataSource"],["matColumnDef","plate"],["mat-header-cell","","mat-sort-header","plate",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","amount"],["mat-header-cell","","mat-sort-header","principal_amount",4,"matHeaderCellDef"],["matColumnDef","origin"],["mat-header-cell","","mat-sort-header","origin",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","status",4,"matHeaderCellDef"],["matColumnDef","created_at"],["mat-header-cell","","mat-sort-header","created_at",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],[3,"visibleChange","visible","debt"],["mat-header-cell","","mat-sort-header","plate"],["mat-cell",""],[1,"font-mono","font-semibold"],["mat-header-cell","","mat-sort-header","principal_amount"],[1,"font-semibold","text-red-600"],["mat-header-cell","","mat-sort-header","origin"],["mat-header-cell","","mat-sort-header","status"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],["mat-header-cell","","mat-sort-header","created_at"],["mat-header-cell",""],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-header-row",""],["mat-row",""],[1,"flex","justify-center","items-center","py-8"],["diameter","40"],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"text-gray-500"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"]],template:function(r,l){if(r&1){let d=E();i(0,"div",2)(1,"div",3)(2,"h1",4),a(3,"Deudas"),t(),i(4,"p",5),a(5,"Gestiona las deudas pendientes y liquidadas"),t()(),i(6,"div",6)(7,"mat-card")(8,"mat-card-content",7)(9,"div",8)(10,"div",9)(11,"mat-icon",10),a(12,"pending"),t()(),i(13,"div",11)(14,"p",12),a(15,"Pendientes"),t(),i(16,"p",13),a(17),t()()()()(),i(18,"mat-card")(19,"mat-card-content",7)(20,"div",8)(21,"div",14)(22,"mat-icon",15),a(23,"check_circle"),t()(),i(24,"div",11)(25,"p",12),a(26,"Liquidadas"),t(),i(27,"p",16),a(28),t()()()()(),i(29,"mat-card")(30,"mat-card-content",7)(31,"div",8)(32,"div",17)(33,"mat-icon",18),a(34,"account_balance_wallet"),t()(),i(35,"div",11)(36,"p",12),a(37,"Total Pendiente"),t(),i(38,"p",19),a(39),t()()()()()(),i(40,"mat-card",3)(41,"mat-card-content",7)(42,"div",20)(43,"mat-form-field",21)(44,"mat-label"),a(45,"Placa del veh\xEDculo"),t(),i(46,"input",22),v("ngModelChange",function(u){return f(d),M(l.filters.plate,u)||(l.filters.plate=u),_(u)}),t()(),i(47,"mat-form-field",21)(48,"mat-label"),a(49,"Origen"),t(),i(50,"mat-select",23),v("ngModelChange",function(u){return f(d),M(l.filters.origin,u)||(l.filters.origin=u),_(u)}),i(51,"mat-option",24),a(52,"Todos"),t(),i(53,"mat-option",25),a(54,"Sesi\xF3n"),t(),i(55,"mat-option",26),a(56,"Multa"),t(),i(57,"mat-option",27),a(58,"Manual"),t()()(),i(59,"mat-form-field",21)(60,"mat-label"),a(61,"Estado"),t(),i(62,"mat-select",23),v("ngModelChange",function(u){return f(d),M(l.filters.status,u)||(l.filters.status=u),_(u)}),i(63,"mat-option",24),a(64,"Todos"),t(),i(65,"mat-option",28),a(66,"Pendiente"),t(),i(67,"mat-option",29),a(68,"Liquidada"),t()()(),i(69,"mat-form-field",21)(70,"mat-label"),a(71,"Fecha desde"),t(),i(72,"input",30),v("ngModelChange",function(u){return f(d),M(l.filters.date_from,u)||(l.filters.date_from=u),_(u)}),t(),x(73,"mat-datepicker-toggle",31)(74,"mat-datepicker",null,0),t()(),i(76,"div",32)(77,"button",33),C("click",function(){return f(d),_(l.clearFilters())}),i(78,"mat-icon"),a(79,"clear"),t(),a(80," Limpiar "),t(),i(81,"button",34),C("click",function(){return f(d),_(l.applyFilters())}),i(82,"mat-icon"),a(83,"search"),t(),a(84," Filtrar "),t()()()(),i(85,"mat-card")(86,"mat-card-content",7)(87,"div",35)(88,"table",36),S(89,37),g(90,_t,2,0,"th",38)(91,bt,3,1,"td",39),D(),S(92,40),g(93,Ct,2,0,"th",41)(94,xt,3,1,"td",39),D(),S(95,42),g(96,ht,2,0,"th",43)(97,Mt,4,3,"td",39),D(),S(98,44),g(99,vt,2,0,"th",45)(100,St,3,3,"td",39),D(),S(101,46),g(102,Dt,2,0,"th",47)(103,Et,2,1,"td",39),D(),S(104,48),g(105,yt,2,0,"th",49)(106,wt,15,2,"td",39),D(),g(107,Ot,1,0,"tr",50)(108,It,1,0,"tr",51),t(),g(109,Tt,2,0,"div",52)(110,kt,7,0,"div",53),t(),g(111,Lt,1,5,"mat-paginator",54),t()(),i(112,"app-debt-details-modal",55),v("visibleChange",function(u){return f(d),M(l.showDetailsModal,u)||(l.showDetailsModal=u),_(u)}),C("visibleChange",function(){return f(d),_(l.closeDetailsModal())}),t()()}if(r&2){let d=L(75);o(17),p(l.getPendingCount()),o(11),p(l.getSettledCount()),o(11),p(l.formatAmount(l.getTotalPending())),o(7),h("ngModel",l.filters.plate),o(4),h("ngModel",l.filters.origin),o(12),h("ngModel",l.filters.status),o(10),m("matDatepicker",d),h("ngModel",l.filters.date_from),o(),m("for",d),o(15),m("dataSource",l.dataSource),o(19),m("matHeaderRowDef",l.displayedColumns),o(),m("matRowDefColumns",l.displayedColumns),o(),m("ngIf",l.loading),o(),m("ngIf",!l.loading&&l.debts.length===0),o(),m("ngIf",l.totalItems>0),o(),h("visible",l.showDetailsModal),m("debt",l.selectedDebt)}},dependencies:[I,O,me,le,se,de,Ve,Pe,Oe,Le,Ie,we,Ne,Te,ke,Ae,Fe,Ye,Ue,Qe,ee,X,Z,ie,te,ge,ue,Ke,K,J,Q,Y,pe,ce,Se,he,Me,ve,Ee,De,U,re,ae,ne,oe,Ge,je,qe,He,Be,Re,T,$e,Xe],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151}.mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}.status-pending[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.status-settled[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.origin-session[_ngcontent-%COMP%]{background-color:#dbeafe;color:#1e40af}.origin-fine[_ngcontent-%COMP%]{background-color:#fee2e2;color:#dc2626}.origin-manual[_ngcontent-%COMP%]{background-color:#e9d5ff;color:#7c3aed}.mat-mdc-chip[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500}@media (max-width: 768px){.grid-cols-3[_ngcontent-%COMP%], .grid-cols-4[_ngcontent-%COMP%]{grid-template-columns:1fr}.mat-mdc-table[_ngcontent-%COMP%]{font-size:.875rem}}"]})}}return n})();export{yi as DebtsComponent};
