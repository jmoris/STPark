import{a as at}from"./chunk-VWULJZWU.js";import{a as J}from"./chunk-T4SBZZYB.js";import{c as rt}from"./chunk-ZMAIZYCZ.js";import{a as ot}from"./chunk-WH2LTFTW.js";import{a as Ye,b as Ze,c as et,d as X,e as tt,f as it,g as nt}from"./chunk-FJTAFRYA.js";import{a as ze,b as Le,c as He,d as We,e as qe,f as Ue,g as Ge,h as Qe,i as Xe,j as Je,k as Ke}from"./chunk-A3W56N53.js";import{a as je,c as $e,f as Ve}from"./chunk-CFZHHQ3I.js";import{a as U}from"./chunk-FGUURFJS.js";import{a as Me,b as ye,c as Fe,d as Te}from"./chunk-UQSNXR2K.js";import"./chunk-3FSFXLFF.js";import{a as G,b as Q}from"./chunk-MB5OSV7M.js";import"./chunk-AGGAQN5G.js";import{a as he,b as xe,c as Ce,h as ve}from"./chunk-ZMKJJYLL.js";import"./chunk-EOYQYJ3N.js";import{a as Ee}from"./chunk-VKB6BRO6.js";import{a as Re,b as Be}from"./chunk-GVLOHDYR.js";import{b as B,c as j}from"./chunk-72F6PA3H.js";import{d as L,e as H}from"./chunk-ZU6VUINT.js";import{b as D,c as be,j as O,k as P}from"./chunk-EO526QJS.js";import{a as W,b as q}from"./chunk-6JXRNXI3.js";import{A as Ne,b as $,d as V,f as z,g as Ie,j as we,k as ke,n as De,q as Oe,x as Pe,z as Ae}from"./chunk-SGTC2IXF.js";import{fa as k,la as A,na as N,oa as R}from"./chunk-56JILNRZ.js";import"./chunk-TTG7A5I5.js";import{d as Se}from"./chunk-FDUGCV2L.js";import{l as T,m as I,t as w}from"./chunk-IZAOXH6X.js";import{$b as _,Eb as d,Ib as x,Pb as n,Qb as i,Rb as h,Sb as C,Tb as v,U as y,Vb as Y,_ as de,bb as l,bc as p,cb as g,da as ce,f as me,fc as pe,gc as ue,hc as fe,lc as _e,mc as a,nc as S,oa as b,oc as f,pa as E,pb as F,pc as Z,rc as ee,sc as te,tc as ie,uc as ge,wb as u}from"./chunk-QDWFRTQW.js";import"./chunk-TSRGIXR5.js";var K=(()=>{class t{constructor(e){this.http=e,this.baseUrl=`${Ee.apiUrl}/streets`}getStreets(e={}){return this.http.get(this.baseUrl,{params:e})}getStreet(e){return this.http.get(`${this.baseUrl}/${e}`)}createStreet(e){return this.http.post(this.baseUrl,e)}updateStreet(e,r){return this.http.put(`${this.baseUrl}/${e}`,r)}deleteStreet(e){return this.http.delete(`${this.baseUrl}/${e}`)}static{this.\u0275fac=function(r){return new(r||t)(ce(Se))}}static{this.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function vt(t,m){if(t&1&&(n(0,"mat-option",26),a(1),n(2,"span",27),a(3),i()()),t&2){let e=m.$implicit,r=p();d("value",e.id),l(),f(" ",e.name," "),l(2),f("(",r.getSectorTypeText(e),")")}}function bt(t,m){if(t&1&&(n(0,"mat-error"),a(1),i()),t&2){let e=p();l(),f(" ",e.getErrorMessage("sector_id")," ")}}function Et(t,m){t&1&&(n(0,"span"),a(1," Los sectores privados manejan direcciones espec\xEDficas (ej: Av. Principal 123) "),i())}function Mt(t,m){t&1&&(n(0,"span"),a(1," Los sectores p\xFAblicos manejan calles completas o rangos de cuadras "),i())}function yt(t,m){if(t&1&&(n(0,"div",28)(1,"div",29)(2,"mat-icon"),a(3),i(),n(4,"span",30),a(5),i()(),n(6,"p",31),u(7,Et,2,0,"span",10)(8,Mt,2,0,"span",10),i()()),t&2){let e=p();x("bg-"+e.getSectorTypeColor(e.selectedSector)+"-50 border border-"+e.getSectorTypeColor(e.selectedSector)+"-200"),l(2),x("text-"+e.getSectorTypeColor(e.selectedSector)+"-600"),l(),f(" ",e.selectedSector.is_private?"lock":"public"," "),l(),x("text-"+e.getSectorTypeColor(e.selectedSector)+"-800"),l(),f(" Sector ",e.getSectorTypeText(e.selectedSector)," "),l(),x("text-"+e.getSectorTypeColor(e.selectedSector)+"-700"),l(),d("ngIf",e.selectedSector.is_private),l(),d("ngIf",!e.selectedSector.is_private)}}function Ft(t,m){if(t&1&&(n(0,"mat-error"),a(1),i()),t&2){let e=p();l(),f(" ",e.getErrorMessage("name")," ")}}function Tt(t,m){if(t&1&&(n(0,"mat-error"),a(1),i()),t&2){let e=p();l(),f(" ",e.getErrorMessage("name")," ")}}function It(t,m){t&1&&(n(0,"div",6)(1,"mat-form-field",12)(2,"mat-label"),a(3,"N\xFAmero de Direcci\xF3n"),i(),h(4,"input",32),i()())}function wt(t,m){t&1&&(n(0,"div",6)(1,"mat-form-field",12)(2,"mat-label"),a(3,"Rango de Cuadras (Opcional)"),i(),h(4,"input",33),i()())}function kt(t,m){if(t&1&&(n(0,"span"),a(1),i()),t&2){let e,r=p(2);l(),Z(" ",(e=r.streetForm.get("name"))==null?null:e.value," ",(e=r.streetForm.get("address_number"))==null?null:e.value," ")}}function Dt(t,m){if(t&1&&(n(0,"span"),a(1),i()),t&2){let e,r=p(2);l(),f(" ",(e=r.streetForm.get("name"))==null?null:e.value," [N\xFAmero] ")}}function Ot(t,m){if(t&1&&(n(0,"span"),a(1),i()),t&2){let e,r=p(2);l(),Z(" ",(e=r.streetForm.get("name"))==null?null:e.value," (Cuadras ",(e=r.streetForm.get("block_range"))==null?null:e.value,") ")}}function Pt(t,m){if(t&1&&(n(0,"span"),a(1),i()),t&2){let e,r=p(2);l(),f(" ",(e=r.streetForm.get("name"))==null?null:e.value," ")}}function At(t,m){if(t&1&&(n(0,"div",34)(1,"h4",35),a(2,"Vista Previa:"),i(),n(3,"div",29)(4,"mat-icon",27),a(5,"road"),i(),n(6,"span",36),u(7,kt,2,2,"span",10)(8,Dt,2,1,"span",10)(9,Ot,2,2,"span",10)(10,Pt,2,1,"span",10),i()()()),t&2){let e,r,o,s,c=p();l(7),d("ngIf",((e=c.streetForm.get("is_specific_address"))==null?null:e.value)&&((e=c.streetForm.get("address_number"))==null?null:e.value)),l(),d("ngIf",((r=c.streetForm.get("is_specific_address"))==null?null:r.value)&&!((r=c.streetForm.get("address_number"))!=null&&r.value)),l(),d("ngIf",!((o=c.streetForm.get("is_specific_address"))!=null&&o.value)&&((o=c.streetForm.get("block_range"))==null?null:o.value)),l(),d("ngIf",!((s=c.streetForm.get("is_specific_address"))!=null&&s.value)&&!((s=c.streetForm.get("block_range"))!=null&&s.value))}}function Nt(t,m){t&1&&h(0,"mat-spinner",37)}function Rt(t,m){if(t&1&&(n(0,"mat-icon"),a(1),i()),t&2){let e=p();l(),S(e.data.isEdit?"save":"add")}}var re=(()=>{class t{constructor(e,r,o,s,c,M){this.fb=e,this.dialogRef=r,this.data=o,this.streetService=s,this.sectorService=c,this.snackBar=M,this.loading=!1,this.sectors=[],this.selectedSector=null,this.streetForm=this.createForm()}ngOnInit(){this.loadSectors(),this.data.isEdit&&this.data.street&&this.loadStreetData()}createForm(){return this.fb.group({sector_id:["",[V.required]],name:["",[V.required,V.minLength(2)]],address_number:[""],address_type:["STREET"],block_range:[""],is_specific_address:[!1],notes:[""]})}loadSectors(){this.sectorService.getSectors().subscribe({next:e=>{this.sectors=e.data?.data||[]},error:e=>{console.error("Error loading sectors:",e),this.snackBar.open("Error al cargar sectores","Cerrar",{duration:3e3})}})}loadStreetData(){this.data.street&&(this.streetForm.patchValue({sector_id:this.data.street.sector_id,name:this.data.street.name,address_number:this.data.street.address_number||"",address_type:this.data.street.address_type||"STREET",block_range:this.data.street.block_range||"",is_specific_address:this.data.street.is_specific_address||!1,notes:this.data.street.notes||""}),this.onSectorChange(this.data.street.sector_id))}onSectorChange(e){this.selectedSector=this.sectors.find(r=>r.id===e)||null,this.selectedSector?.is_private?this.streetForm.patchValue({is_specific_address:!0,address_type:"ADDRESS"}):this.streetForm.patchValue({is_specific_address:!1,address_type:"STREET"})}onAddressTypeChange(){this.streetForm.get("is_specific_address")?.value?this.streetForm.patchValue({address_type:"ADDRESS",block_range:""}):this.streetForm.patchValue({address_type:"STREET",address_number:""})}onSubmit(){if(this.streetForm.valid){this.loading=!0;let e=this.streetForm.value;this.data.isEdit&&this.data.street?this.streetService.updateStreet(this.data.street.id,e).subscribe({next:r=>{this.loading=!1,this.snackBar.open("Calle actualizada correctamente","Cerrar",{duration:3e3}),this.dialogRef.close(r.data)},error:r=>{this.loading=!1,this.snackBar.open("Error al actualizar calle","Cerrar",{duration:3e3})}}):this.streetService.createStreet(e).subscribe({next:r=>{this.loading=!1,this.snackBar.open("Calle creada correctamente","Cerrar",{duration:3e3}),this.dialogRef.close(r.data)},error:r=>{this.loading=!1,console.error("Error creating street:",r);let o="Error al crear calle";(r.error?.error_code==="PLAN_LIMIT_EXCEEDED"&&r.error?.message||r.error?.message)&&(o=r.error.message),this.snackBar.open(o,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}else this.snackBar.open("Por favor, complete todos los campos requeridos","Cerrar",{duration:3e3})}onCancel(){this.dialogRef.close()}getErrorMessage(e){let r=this.streetForm.get(e);return r?.hasError("required")?"Este campo es requerido":r?.hasError("minlength")?"M\xEDnimo 2 caracteres":""}getSectorTypeText(e){return e.is_private?"Privado":"P\xFAblico"}getSectorTypeColor(e){return e.is_private?"purple":"blue"}static{this.\u0275fac=function(r){return new(r||t)(g(Pe),g(he),g(xe),g(K),g(J),g(U))}}static{this.\u0275cmp=F({type:t,selectors:[["app-street-form"]],decls:51,vars:17,consts:[[1,"street-form-dialog"],[1,"dialog-header"],[1,"dialog-title"],["mat-icon-button","",1,"close-button",3,"click"],[1,"dialog-content"],[1,"street-form",3,"formGroup"],[1,"form-row"],["appearance","outline",1,"full-width"],["formControlName","sector_id",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["class","mb-4 p-3 rounded-lg",3,"class",4,"ngIf"],["appearance","outline",1,"half-width"],["formControlName","address_type",3,"selectionChange"],["value","STREET"],["value","ADDRESS"],[1,"half-width","flex","items-center"],["formControlName","is_specific_address",3,"change"],["matInput","","formControlName","name",3,"placeholder"],["class","form-row",4,"ngIf"],["matInput","","formControlName","notes","rows","3","placeholder","Informaci\xF3n adicional sobre esta calle/direcci\xF3n"],["class","mt-4 p-3 bg-gray-50 rounded-lg",4,"ngIf"],[1,"dialog-actions"],["mat-button","",1,"rounded-sm",3,"click","disabled"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click","disabled"],["diameter","20","class","inline-spinner",4,"ngIf"],[3,"value"],[1,"text-gray-500"],[1,"mb-4","p-3","rounded-lg"],[1,"flex","items-center","gap-2"],[1,"font-medium"],[1,"text-sm","mt-1"],["matInput","","formControlName","address_number","placeholder","Ej: 123"],["matInput","","formControlName","block_range","placeholder","Ej: 100-200"],[1,"mt-4","p-3","bg-gray-50","rounded-lg"],[1,"font-medium","text-gray-700","mb-2"],[1,"font-semibold"],["diameter","20",1,"inline-spinner"]],template:function(r,o){if(r&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),a(3),i(),n(4,"button",3),_("click",function(){return o.onCancel()}),n(5,"mat-icon"),a(6,"close"),i()()(),n(7,"div",4)(8,"form",5)(9,"div",6)(10,"mat-form-field",7)(11,"mat-label"),a(12,"Sector *"),i(),n(13,"mat-select",8),_("selectionChange",function(c){return o.onSectorChange(c.value)}),u(14,vt,4,3,"mat-option",9),i(),u(15,bt,2,1,"mat-error",10),i()(),u(16,yt,9,12,"div",11),n(17,"div",6)(18,"mat-form-field",12)(19,"mat-label"),a(20,"Tipo de Direcci\xF3n"),i(),n(21,"mat-select",13),_("selectionChange",function(){return o.onAddressTypeChange()}),n(22,"mat-option",14),a(23,"Calle Completa"),i(),n(24,"mat-option",15),a(25,"Direcci\xF3n Espec\xEDfica"),i()()(),n(26,"div",16)(27,"mat-checkbox",17),_("change",function(){return o.onAddressTypeChange()}),a(28," Es direcci\xF3n espec\xEDfica "),i()()(),n(29,"div",6)(30,"mat-form-field",7)(31,"mat-label"),a(32),i(),h(33,"input",18),u(34,Ft,2,1,"mat-error",10)(35,Tt,2,1,"mat-error",10),i()(),u(36,It,5,0,"div",19)(37,wt,5,0,"div",19),n(38,"div",6)(39,"mat-form-field",7)(40,"mat-label"),a(41,"Notas"),i(),h(42,"textarea",20),i()(),u(43,At,11,4,"div",21),i()(),n(44,"div",22)(45,"button",23),_("click",function(){return o.onCancel()}),a(46," Cancelar "),i(),n(47,"button",24),_("click",function(){return o.onSubmit()}),u(48,Nt,1,0,"mat-spinner",25)(49,Rt,2,1,"mat-icon",10),a(50),i()()()),r&2){let s,c,M,ne,ae,oe,le,se;l(3),f(" ",o.data.isEdit?"Editar Calle/Direcci\xF3n":"Nueva Calle/Direcci\xF3n"," "),l(5),d("formGroup",o.streetForm),l(6),d("ngForOf",o.sectors),l(),d("ngIf",(s=o.streetForm.get("sector_id"))==null?null:s.hasError("required")),l(),d("ngIf",o.selectedSector),l(16),f("",((c=o.streetForm.get("is_specific_address"))!=null&&c.value,"Nombre de la Calle")," *"),l(),d("placeholder",(M=o.streetForm.get("is_specific_address"))!=null&&M.value?"Ej: Avenida Principal":"Ej: Calle Central"),l(),d("ngIf",(ne=o.streetForm.get("name"))==null?null:ne.hasError("required")),l(),d("ngIf",(ae=o.streetForm.get("name"))==null?null:ae.hasError("minlength")),l(),d("ngIf",(oe=o.streetForm.get("is_specific_address"))==null?null:oe.value),l(),d("ngIf",!((le=o.streetForm.get("is_specific_address"))!=null&&le.value)),l(6),d("ngIf",(se=o.streetForm.get("name"))==null?null:se.value),l(2),d("disabled",o.loading),l(2),d("disabled",o.loading||o.streetForm.invalid),l(),d("ngIf",o.loading),l(),d("ngIf",!o.loading),l(),f(" ",o.data.isEdit?"Actualizar":"Crear"," ")}},dependencies:[w,T,I,Ne,ke,$,z,Ie,De,Oe,ve,P,O,D,be,H,L,R,A,N,j,B,Q,G,k,Be,Re,q,W],styles:[".street-form-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:90vh;width:100%}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem 1.5rem 0;border-bottom:1px solid #e5e7eb;margin-bottom:1rem}.dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:#111827}.close-button[_ngcontent-%COMP%]{margin-left:auto}.dialog-content[_ngcontent-%COMP%]{flex:1;padding:0 1.5rem;overflow-y:auto}.dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1rem 1.5rem 1.5rem;border-top:1px solid #e5e7eb;margin-top:1rem}.street-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-start}.full-width[_ngcontent-%COMP%], .half-width[_ngcontent-%COMP%]{flex:1}.inline-spinner[_ngcontent-%COMP%]{margin-right:.5rem}@media (max-width: 768px){.street-form-dialog[_ngcontent-%COMP%]{min-width:auto;width:100%;max-height:95vh}.form-row[_ngcontent-%COMP%]{flex-direction:column}.half-width[_ngcontent-%COMP%]{width:100%}.dialog-header[_ngcontent-%COMP%]{padding:1rem 1rem 0}.dialog-content[_ngcontent-%COMP%]{padding:0 1rem}.dialog-actions[_ngcontent-%COMP%]{padding:1rem}}"]})}}return t})();function Bt(t,m){if(t&1&&(n(0,"mat-option",52),a(1),i()),t&2){let e=m.$implicit;d("value",e.id),l(),f(" ",e.name," ")}}function jt(t,m){t&1&&(n(0,"th",53),a(1,"Direcci\xF3n"),i())}function $t(t,m){if(t&1&&(n(0,"td",54)(1,"div",55)(2,"mat-icon",56),a(3,"road"),i(),n(4,"span",57),a(5),i()()()),t&2){let e=m.$implicit,r=p();l(5),S(r.getFullAddress(e))}}function Vt(t,m){t&1&&(n(0,"th",58),a(1,"Sector"),i())}function zt(t,m){if(t&1&&(n(0,"td",54)(1,"div",55)(2,"mat-icon",56),a(3,"location_city"),i(),n(4,"span"),a(5),i()()()),t&2){let e=m.$implicit,r=p();l(5),S(r.getSectorName(e))}}function Lt(t,m){t&1&&(n(0,"th",59),a(1,"Tipo"),i())}function Ht(t,m){if(t&1&&(n(0,"td",54)(1,"span",60),a(2),i()()),t&2){let e=m.$implicit,r=p();l(),x("bg-"+r.getAddressTypeColor(e)+"-100 text-"+r.getAddressTypeColor(e)+"-800"),l(),f(" ",r.getAddressType(e)," ")}}function Wt(t,m){t&1&&(n(0,"th",61),a(1,"Sesiones"),i())}function qt(t,m){if(t&1&&(n(0,"td",54)(1,"div",62)(2,"mat-icon",63),a(3,"directions_car"),i(),n(4,"span"),a(5),i()()()),t&2){let e=m.$implicit,r=p();l(5),S(r.getSessionsCountText(e))}}function Ut(t,m){t&1&&(n(0,"th",64),a(1,"Operadores"),i())}function Gt(t,m){if(t&1&&(n(0,"td",54)(1,"div",62)(2,"mat-icon",63),a(3,"people"),i(),n(4,"span"),a(5),i()()()),t&2){let e=m.$implicit,r=p();l(5),S(r.getOperatorsCountText(e))}}function Qt(t,m){t&1&&(n(0,"th",65),a(1,"Acciones"),i())}function Xt(t,m){if(t&1){let e=Y();n(0,"td",54)(1,"button",66)(2,"mat-icon"),a(3,"more_vert"),i()(),n(4,"mat-menu",null,0)(6,"button",67),_("click",function(){let o=b(e).$implicit,s=p();return E(s.viewStreet(o))}),n(7,"mat-icon"),a(8,"visibility"),i(),a(9," Ver detalles "),i(),n(10,"button",67),_("click",function(){let o=b(e).$implicit,s=p();return E(s.editStreet(o))}),n(11,"mat-icon"),a(12,"edit"),i(),a(13," Editar "),i(),n(14,"button",68),_("click",function(){let o=b(e).$implicit,s=p();return E(s.deleteStreet(o))}),n(15,"mat-icon"),a(16,"delete"),i(),a(17," Eliminar "),i()()()}if(t&2){let e=_e(5);l(),d("matMenuTriggerFor",e)}}function Jt(t,m){t&1&&h(0,"tr",69)}function Kt(t,m){t&1&&h(0,"tr",70)}function Yt(t,m){t&1&&(n(0,"div",71),h(1,"mat-spinner",72),i())}function Zt(t,m){t&1&&(n(0,"div",73)(1,"mat-icon",74),a(2,"road"),i(),n(3,"h3",75),a(4,"No hay calles registradas"),i(),n(5,"p",56),a(6,"Las calles aparecer\xE1n aqu\xED cuando se registren."),i()())}function ei(t,m){if(t&1){let e=Y();n(0,"mat-paginator",76),_("page",function(o){b(e);let s=p();return E(s.onPageChange(o))}),i()}if(t&2){let e=p();d("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}var $i=(()=>{class t{constructor(e,r,o,s){this.streetService=e,this.sectorService=r,this.dialog=o,this.snackBar=s,this._unsubscribeAll=new me,this.streets=[],this.sectors=[],this.loading=!1,this.displayedColumns=["name","sector","type","sessions_count","operators_count","actions"],this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.sortBy="name",this.sortOrder="asc",this.filters={name:"",sector_id:""}}ngOnInit(){this.loadSectors(),this.loadStreets()}ngAfterViewInit(){this.sort&&this.sort.sortChange.pipe(y(this._unsubscribeAll)).subscribe(e=>{this.sortBy=e.active,this.sortOrder=e.direction==="asc"?"asc":"desc",this.currentPage=0,this.loadStreets()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadStreets(){this.loading=!0;let e={page:this.currentPage+1,per_page:this.pageSize,sort_by:this.sortBy,sort_order:this.sortOrder};this.filters.name&&this.filters.name.trim()!==""&&(e.name=this.filters.name),this.filters.sector_id&&this.filters.sector_id!==""&&(e.sector_id=this.filters.sector_id),this.streetService.getStreets(e).pipe(y(this._unsubscribeAll)).subscribe({next:r=>{this.streets=r.data?.data||[],this.totalItems=r.data?.total||0,this.loading=!1},error:r=>{console.error("Error loading streets:",r),this.loading=!1}})}loadSectors(){this.sectorService.getSectors().pipe(y(this._unsubscribeAll)).subscribe({next:e=>{this.sectors=e.data?.data||[]},error:e=>{console.error("Error loading sectors:",e)}})}getSectorName(e){return e.sector?.name||"Sector no encontrado"}getFullAddress(e){return e.is_specific_address&&e.address_number?`${e.name} ${e.address_number}`:e.block_range?`${e.name} (Cuadras ${e.block_range})`:e.name}getAddressType(e){return e.is_specific_address?"Direcci\xF3n Espec\xEDfica":"Calle Completa"}getAddressTypeColor(e){return e.is_specific_address?"purple":"blue"}getSessionsCount(e){return e.sessions_count!==void 0?e.sessions_count:e.parking_sessions?.length||0}getOperatorsCount(e){return e.operators_count!==void 0?e.operators_count:e.operator_assignments?.length||0}getSessionsCountText(e){let r=this.getSessionsCount(e);return`${r} sesi\xF3n${r!==1?"es":""}`}getOperatorsCountText(e){let r=this.getOperatorsCount(e);return`${r} operador${r!==1?"es":""}`}createStreet(){this.dialog.open(re,{width:"600px",data:{isEdit:!1}}).afterClosed().subscribe(r=>{r&&this.loadStreets()})}editStreet(e){this.dialog.open(re,{width:"600px",data:{isEdit:!0,street:e}}).afterClosed().subscribe(o=>{o&&this.loadStreets()})}deleteStreet(e){confirm(`\xBFEst\xE1 seguro de eliminar la calle ${e.name}?`)&&this.streetService.deleteStreet(e.id).subscribe({next:()=>{this.snackBar.open("Calle eliminada correctamente","Cerrar",{duration:3e3}),this.loadStreets()},error:r=>{this.snackBar.open("Error al eliminar calle","Cerrar",{duration:3e3})}})}viewStreet(e){let r=[{label:"Direcci\xF3n Completa",key:"name",icon:"road",type:"text",format:s=>this.getFullAddress(e)},{label:"Sector",key:"sector.name",icon:"location_city",type:"text"},{label:"Tipo de Direcci\xF3n",key:"is_specific_address",icon:"category",type:"badge",format:s=>s?"Direcci\xF3n Espec\xEDfica":"Calle Completa",badgeColor:s=>s?"accent":"primary"},{label:"N\xFAmero de Direcci\xF3n",key:"address_number",icon:"tag",type:"text"},{label:"Rango de Cuadras",key:"block_range",icon:"straighten",type:"text"},{label:"Sesiones de Estacionamiento",key:"sessions_count",icon:"directions_car",type:"text",format:s=>{let c=s??(e.parking_sessions?e.parking_sessions.length:0);return`${c} sesi\xF3n${c!==1?"es":""}`}},{label:"Operadores Asignados",key:"operators_count",icon:"people",type:"text",format:s=>{let c=s??(e.operator_assignments?e.operator_assignments.length:0);return`${c} operador${c!==1?"es":""}`}},{label:"Notas",key:"notes",icon:"note",type:"text"},{label:"Fecha de Creaci\xF3n",key:"created_at",icon:"schedule",type:"date"}],o=this.dialog.open(at,{width:"600px",data:{title:"Detalles de la Calle/Direcci\xF3n",data:e,fields:r,actions:[{label:"Editar",icon:"edit",color:"primary",action:()=>{o.close(),this.editStreet(e)}}]}})}getTotalStreetsCount(){return this.totalItems}getStreetsWithSessions(){return this.streets.reduce((e,r)=>e+this.getSessionsCount(r),0)}getStreetsWithOperators(){return this.streets.reduce((e,r)=>e+this.getOperatorsCount(r),0)}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadStreets()}applyFilters(){this.currentPage=0,this.loadStreets()}clearFilters(){this.filters={name:"",sector_id:""},this.currentPage=0,this.loadStreets()}static{this.\u0275fac=function(r){return new(r||t)(g(K),g(J),g(Ce),g(U))}}static{this.\u0275cmp=F({type:t,selectors:[["app-streets"]],viewQuery:function(r,o){if(r&1&&pe(X,5),r&2){let s;ue(s=fe())&&(o.sort=s.first)}},features:[ge([{provide:Ye,useValue:nt()}])],decls:106,vars:15,consts:[["menu","matMenu"],[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6","mb-6"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-blue-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"p-3","bg-purple-100","rounded-full"],[1,"text-purple-600"],[1,"text-2xl","font-bold","text-purple-600"],[1,"p-3","bg-orange-100","rounded-full"],[1,"text-orange-600"],[1,"text-2xl","font-bold","text-orange-600"],[1,"mb-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["appearance","outline"],["matInput","","placeholder","Nombre de la calle",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],[1,"overflow-x-auto"],["mat-table","","matSort","",1,"w-full",3,"dataSource","matSortActive","matSortDirection"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","name",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","sector"],["mat-header-cell","","mat-sort-header","sector_id",4,"matHeaderCellDef"],["matColumnDef","type"],["mat-header-cell","","mat-sort-header","is_specific_address",4,"matHeaderCellDef"],["matColumnDef","sessions_count"],["mat-header-cell","","mat-sort-header","sessions_count",4,"matHeaderCellDef"],["matColumnDef","operators_count"],["mat-header-cell","","mat-sort-header","operators_count",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],[3,"value"],["mat-header-cell","","mat-sort-header","name"],["mat-cell",""],[1,"flex","items-center","gap-2"],[1,"text-gray-500"],[1,"font-semibold"],["mat-header-cell","","mat-sort-header","sector_id"],["mat-header-cell","","mat-sort-header","is_specific_address"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],["mat-header-cell","","mat-sort-header","sessions_count"],[1,"flex","items-center","gap-1"],[1,"text-sm","text-gray-500"],["mat-header-cell","","mat-sort-header","operators_count"],["mat-header-cell",""],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"text-red-600",3,"click"],["mat-header-row",""],["mat-row",""],[1,"flex","justify-center","items-center","py-8"],["diameter","40"],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"]],template:function(r,o){r&1&&(n(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),a(4,"Calles"),i(),n(5,"p",4),a(6,"Gestiona las calles del sistema"),i()(),n(7,"button",5),_("click",function(){return o.createStreet()}),n(8,"mat-icon"),a(9,"add"),i(),a(10," Nueva Calle "),i()(),n(11,"div",6)(12,"mat-card")(13,"mat-card-content",7)(14,"div",8)(15,"div",9)(16,"mat-icon",10),a(17,"route"),i()(),n(18,"div",11)(19,"p",12),a(20,"Total Calles"),i(),n(21,"p",13),a(22),i()()()()(),n(23,"mat-card")(24,"mat-card-content",7)(25,"div",8)(26,"div",14)(27,"mat-icon",15),a(28,"directions_car"),i()(),n(29,"div",11)(30,"p",12),a(31,"Total Sesiones"),i(),n(32,"p",16),a(33),i()()()()(),n(34,"mat-card")(35,"mat-card-content",7)(36,"div",8)(37,"div",17)(38,"mat-icon",18),a(39,"people"),i()(),n(40,"div",11)(41,"p",12),a(42,"Total Operadores"),i(),n(43,"p",19),a(44),i()()()()(),n(45,"mat-card")(46,"mat-card-content",7)(47,"div",8)(48,"div",20)(49,"mat-icon",21),a(50,"location_city"),i()(),n(51,"div",11)(52,"p",12),a(53,"Sectores"),i(),n(54,"p",22),a(55),i()()()()()(),n(56,"mat-card",23)(57,"mat-card-content",7)(58,"div",24)(59,"mat-form-field",25)(60,"mat-label"),a(61,"Buscar calle"),i(),n(62,"input",26),ie("ngModelChange",function(c){return te(o.filters.name,c)||(o.filters.name=c),c}),i()(),n(63,"mat-form-field",25)(64,"mat-label"),a(65,"Sector"),i(),n(66,"mat-select",27),ie("ngModelChange",function(c){return te(o.filters.sector_id,c)||(o.filters.sector_id=c),c}),n(67,"mat-option",28),a(68,"Todos los sectores"),i(),u(69,Bt,2,2,"mat-option",29),i()()(),n(70,"div",30)(71,"button",31),_("click",function(){return o.clearFilters()}),n(72,"mat-icon"),a(73,"clear"),i(),a(74," Limpiar "),i(),n(75,"button",5),_("click",function(){return o.applyFilters()}),n(76,"mat-icon"),a(77,"search"),i(),a(78," Filtrar "),i()()()(),n(79,"mat-card")(80,"mat-card-content",7)(81,"div",32)(82,"table",33),C(83,34),u(84,jt,2,0,"th",35)(85,$t,6,1,"td",36),v(),C(86,37),u(87,Vt,2,0,"th",38)(88,zt,6,1,"td",36),v(),C(89,39),u(90,Lt,2,0,"th",40)(91,Ht,3,3,"td",36),v(),C(92,41),u(93,Wt,2,0,"th",42)(94,qt,6,1,"td",36),v(),C(95,43),u(96,Ut,2,0,"th",44)(97,Gt,6,1,"td",36),v(),C(98,45),u(99,Qt,2,0,"th",46)(100,Xt,18,1,"td",36),v(),u(101,Jt,1,0,"tr",47)(102,Kt,1,0,"tr",48),i(),u(103,Yt,2,0,"div",49)(104,Zt,7,0,"div",50),i(),u(105,ei,1,5,"mat-paginator",51),i()()()),r&2&&(l(22),S(o.getTotalStreetsCount()),l(11),S(o.getStreetsWithSessions()),l(11),S(o.getStreetsWithOperators()),l(11),S(o.sectors.length),l(7),ee("ngModel",o.filters.name),l(4),ee("ngModel",o.filters.sector_id),l(3),d("ngForOf",o.sectors),l(13),d("dataSource",o.streets)("matSortActive",o.sortBy)("matSortDirection",o.sortOrder),l(19),d("matHeaderRowDef",o.displayedColumns),l(),d("matRowDefColumns",o.displayedColumns),l(),d("ngIf",o.loading),l(),d("ngIf",!o.loading&&o.streets.length===0),l(),d("ngIf",o.totalItems>0))},dependencies:[w,T,I,Ae,$,z,we,Ke,ze,He,Ge,We,Le,Qe,qe,Ue,Xe,Je,Ve,je,$e,R,A,N,j,B,q,W,ot,P,O,D,H,L,Te,ye,Me,Fe,rt,Q,G,k,et,Ze,it,X,tt],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151}.mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}@media (max-width: 768px){.grid-cols-4[_ngcontent-%COMP%]{grid-template-columns:1fr}.mat-mdc-table[_ngcontent-%COMP%]{font-size:.875rem}}"]})}}return t})();export{$i as StreetsComponent};
