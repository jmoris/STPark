import{a as xe}from"./chunk-7M455HP6.js";import{a as _e,b as Ee,c as be}from"./chunk-TCOXJXET.js";import{d as ge}from"./chunk-EEUJEGPN.js";import{a as se,b as de,c as ce,d as pe,e as ue,f as fe}from"./chunk-N7KP3IEB.js";import{a as ie,b as re}from"./chunk-FSRW5HPF.js";import{a as ne,b as oe}from"./chunk-POSCZER2.js";import{a as te,b as ae}from"./chunk-KEI4KRBM.js";import"./chunk-ECYJLMJT.js";import{a as v}from"./chunk-VKB6BRO6.js";import{a as le,b as me}from"./chunk-RDXEG6SZ.js";import{b as H,c as U}from"./chunk-IMRKXFOQ.js";import{d as Z,e as ee}from"./chunk-5Q7CCL6V.js";import{b as w,c as B,d as G,j as V,k as L}from"./chunk-K3BNOLHS.js";import{A as Y,b as j,d as s,f as R,g as $,k as z,l as J,n as K,q as Q,u as W,x as X}from"./chunk-ZTFUS4RN.js";import{W as q,fa as D,la as O,oa as A}from"./chunk-QQQ5XT6I.js";import"./chunk-YXFY4UXK.js";import{d as P}from"./chunk-EARUC3FY.js";import{m as I,s as T}from"./chunk-BAM5RHC5.js";import{$b as C,Eb as l,Pb as a,Qb as e,Rb as p,bb as o,cb as x,mc as t,nc as k,pb as N,wb as _}from"./chunk-MLNNMN4J.js";import{d as S}from"./chunk-TSRGIXR5.js";function ve(n,d){n&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function he(n,d){n&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function Se(n,d){n&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ce(n,d){n&1&&(a(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Me(n,d){n&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function ye(n,d){n&1&&(a(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Fe(n,d){n&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ne(n,d){n&1&&(a(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function ke(n,d){n&1&&(a(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ie(n,d){n&1&&(a(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}var lt=(()=>{class n{constructor(i,m,r,c){this.fb=i,this.pricingProfileService=m,this.http=r,this.snackBar=c,this.loading=!1,this.planName="Sin plan",this.generalForm=this.fb.group({name:["STPark - Sistema de Estacionamientos",[s.required]],language:["es",[s.required]],plan_name:["Sin plan"],pos_tuu:[{value:!1,disabled:!0}],boleta_electronica:[{value:!1,disabled:!0}],max_capacity:[0,[s.required,s.min(0)]]}),this.pricingForm=this.fb.group({price_per_min:[0,[s.required,s.min(0)]],min_amount:[0,[s.required,s.min(0)]],daily_max_amount:[0,[s.required,s.min(0)]],start_time:["00:00",s.required],end_time:["23:59",s.required],is_active:[!0]})}ngOnInit(){this.loadGeneralSettings(),this.loadDefaultPricing()}loadGeneralSettings(){this.loading=!0,this.http.get(`${v.apiUrl}/settings/general`).subscribe({next:i=>{if(i&&i.success&&i.data){console.log("Configuraci\xF3n general cargada:",i.data);let r=i.data.plan_name||"Sin plan";this.planName=r,console.log("Plan name asignado:",this.planName);let m=i.data,{plan_name:c,pos_tuu:E,boleta_electronica:b}=m,h=S(m,["plan_name","pos_tuu","boleta_electronica"]);this.generalForm.patchValue(h),setTimeout(()=>{let u=this.generalForm.get("plan_name");u&&(u.disabled&&u.enable({emitEvent:!1}),u.setValue(r,{emitEvent:!1}),setTimeout(()=>{u.disable({emitEvent:!1})},100));let f=this.generalForm.get("pos_tuu");f&&i.data.pos_tuu!==void 0&&(f.disabled&&f.enable({emitEvent:!1}),f.setValue(i.data.pos_tuu,{emitEvent:!1}),setTimeout(()=>{f.disable({emitEvent:!1})},100));let g=this.generalForm.get("boleta_electronica");g&&i.data.boleta_electronica!==void 0&&(g.disabled&&g.enable({emitEvent:!1}),g.setValue(i.data.boleta_electronica,{emitEvent:!1}),setTimeout(()=>{g.disable({emitEvent:!1})},100))},0)}else console.warn("La respuesta no tiene el formato esperado:",i);this.loading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n general:",i),console.log("No hay configuraci\xF3n general previa, usando valores por defecto"),this.loading=!1}})}loadDefaultPricing(){this.loading=!0,this.http.get(`${v.apiUrl}/settings/default-pricing`).subscribe({next:i=>{i&&i.success&&i.data?(console.log("Configuraci\xF3n de precios cargada:",i.data),this.pricingForm.patchValue(i.data)):console.warn("La respuesta no tiene el formato esperado:",i),this.loading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n de precios:",i),console.log("No hay configuraci\xF3n previa, usando valores por defecto"),this.loading=!1}})}saveSettings(){let i=this.getActiveTab();i==="general"?this.saveGeneralSettings():i==="pricing"&&this.savePricingSettings()}getActiveTab(){let i=document.querySelector("mat-tab-group");if(i){let m=i.querySelector(".mat-mdc-tab-active");if(m){let r=m.querySelector(".mdc-tab__text-label");if(r?.textContent?.toLowerCase().includes("general"))return"general";if(r?.textContent?.toLowerCase().includes("precios"))return"pricing"}}return"general"}saveGeneralSettings(){if(this.generalForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let E=this.generalForm.getRawValue(),{pos_tuu:i,boleta_electronica:m,plan_name:r}=E,c=S(E,["pos_tuu","boleta_electronica","plan_name"]);this.http.post(`${v.apiUrl}/settings/general`,c).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n general guardada exitosamente","Cerrar",{duration:3e3}),this.loading=!1},error:b=>{console.error("Error al guardar configuraci\xF3n general:",b),this.snackBar.open("Error al guardar la configuraci\xF3n general","Cerrar",{duration:3e3}),this.loading=!1}})}savePricingSettings(){if(this.pricingForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let i=this.pricingForm.value;this.http.post(`${v.apiUrl}/settings/default-pricing`,i).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n de precios guardada exitosamente","Cerrar",{duration:3e3}),this.loading=!1},error:m=>{console.error("Error al guardar configuraci\xF3n de precios:",m),this.snackBar.open("Error al guardar la configuraci\xF3n de precios","Cerrar",{duration:3e3}),this.loading=!1}})}resetSettings(){this.generalForm.reset({name:"STPark - Sistema de Estacionamientos",language:"es",pos_tuu:!1,boleta_electronica:!1,max_capacity:0}),this.pricingForm.reset({price_per_min:0,min_amount:0,daily_max_amount:0,start_time:"00:00",end_time:"23:59",is_active:!0}),this.snackBar.open("Valores restaurados","Cerrar",{duration:2e3})}static{this.\u0275fac=function(m){return new(m||n)(x(X),x(xe),x(P),x(ie))}}static{this.\u0275cmp=N({type:n,selectors:[["app-settings"]],decls:146,vars:18,consts:[[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"flex","gap-2"],["mat-stroked-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"w-full"],["label","General"],[1,"p-6"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Nombre del sistema"],[4,"ngIf"],["formControlName","language"],["value","es"],["value","en"],["formControlName","plan_name"],[3,"value"],[2,"display","inline-flex","align-items","center","gap","4px"],[2,"font-size","16px","width","16px","height","16px"],["matInput","","type","number","formControlName","max_capacity","placeholder","0","min","0"],["formControlName","pos_tuu"],["formControlName","boleta_electronica"],["label","Precios"],[1,"space-y-4"],[1,"bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-800","rounded-lg","p-4"],[1,"flex","items-start","gap-3"],[1,"text-blue-600","dark:text-blue-400"],[1,"text-sm","text-blue-800","dark:text-blue-200"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["matInput","","type","number","formControlName","price_per_min","placeholder","0","min","0"],["matInput","","type","number","formControlName","min_amount","placeholder","0","min","0"],["matInput","","type","number","formControlName","daily_max_amount","placeholder","0","min","0"],[1,"my-6"],[1,"text-lg","font-semibold","mb-4"],["matInput","","type","time","formControlName","start_time"],["matInput","","type","time","formControlName","end_time"],[1,"flex","items-center","gap-2","mb-4"],["formControlName","is_active"]],template:function(m,r){if(m&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),t(4,"Configuraci\xF3n"),e(),a(5,"p",3),t(6,"Configura los par\xE1metros del sistema de estacionamientos"),e()(),a(7,"div",4)(8,"button",5),C("click",function(){return r.resetSettings()}),a(9,"mat-icon"),t(10,"refresh"),e(),t(11," Restaurar "),e(),a(12,"button",6),C("click",function(){return r.saveSettings()}),a(13,"mat-icon"),t(14,"save"),e(),t(15," Guardar "),e()()(),a(16,"mat-tab-group",7)(17,"mat-tab",8)(18,"div",9)(19,"mat-card")(20,"mat-card-header")(21,"mat-card-title"),t(22,"Configuraci\xF3n General"),e(),a(23,"mat-card-subtitle"),t(24,"Par\xE1metros b\xE1sicos del sistema"),e()(),a(25,"mat-card-content")(26,"form",10)(27,"div",11)(28,"mat-form-field",12)(29,"mat-label"),t(30,"Nombre del sistema"),e(),p(31,"input",13),_(32,ve,2,0,"mat-error",14),e(),a(33,"mat-form-field",12)(34,"mat-label"),t(35,"Idioma"),e(),a(36,"mat-select",15)(37,"mat-option",16),t(38,"Espa\xF1ol"),e(),a(39,"mat-option",17),t(40,"English"),e()(),_(41,he,2,0,"mat-error",14),e(),a(42,"mat-form-field",12)(43,"mat-label"),t(44,"Suscripci\xF3n"),e(),a(45,"mat-select",18)(46,"mat-option",19),t(47),e()(),a(48,"mat-hint")(49,"span",20)(50,"mat-icon",21),t(51,"lock"),e(),t(52," Plan de servicio asociado al estacionamiento (solo lectura) "),e()()(),a(53,"mat-form-field",12)(54,"mat-label"),t(55,"M\xE1xima Capacidad"),e(),p(56,"input",22),a(57,"mat-hint"),t(58,"Cantidad m\xE1xima de veh\xEDculos que pueden estar en el estacionamiento simult\xE1neamente"),e(),_(59,Se,2,0,"mat-error",14)(60,Ce,2,0,"mat-error",14),e(),a(61,"mat-form-field",12)(62,"mat-label"),t(63,"POS TUU"),e(),a(64,"mat-select",23)(65,"mat-option",19),t(66,"Activado"),e(),a(67,"mat-option",19),t(68,"Desactivado"),e()(),a(69,"mat-hint")(70,"span",20)(71,"mat-icon",21),t(72,"lock"),e(),t(73," Solo lectura - Solo administradores pueden modificar este valor "),e()()(),a(74,"mat-form-field",12)(75,"mat-label"),t(76,"Boleta Electr\xF3nica"),e(),a(77,"mat-select",24)(78,"mat-option",19),t(79,"Activado"),e(),a(80,"mat-option",19),t(81,"Desactivado"),e()(),a(82,"mat-hint")(83,"span",20)(84,"mat-icon",21),t(85,"lock"),e(),t(86," Solo lectura - Solo administradores pueden modificar este valor "),e()()()()()()()()(),a(87,"mat-tab",25)(88,"div",9)(89,"mat-card")(90,"mat-card-header")(91,"mat-card-title"),t(92,"Configuraci\xF3n de Precios por Defecto"),e(),a(93,"mat-card-subtitle"),t(94,"Establece las tarifas por defecto del sistema"),e()(),a(95,"mat-card-content")(96,"div",26)(97,"div",27)(98,"div",28)(99,"mat-icon",29),t(100,"info"),e(),a(101,"div",30)(102,"strong"),t(103,"Nota:"),e(),t(104," Estos precios se utilizar\xE1n como regla de precio por defecto si no existen otras reglas espec\xEDficas para el sector. "),e()()(),a(105,"form",10)(106,"div",31)(107,"mat-form-field",12)(108,"mat-label"),t(109,"Costo por Minuto (CLP)"),e(),p(110,"input",32),a(111,"mat-hint"),t(112,"Precio por cada minuto de estacionamiento"),e(),_(113,Me,2,0,"mat-error",14)(114,ye,2,0,"mat-error",14),e(),a(115,"mat-form-field",12)(116,"mat-label"),t(117,"Tarifa M\xEDnima (CLP)"),e(),p(118,"input",33),a(119,"mat-hint"),t(120,"Cantidad m\xEDnima a cobrar"),e(),_(121,Fe,2,0,"mat-error",14)(122,Ne,2,0,"mat-error",14),e(),a(123,"mat-form-field",12)(124,"mat-label"),t(125,"Tarifa M\xE1xima (CLP)"),e(),p(126,"input",34),a(127,"mat-hint"),t(128,"L\xEDmite m\xE1ximo a cobrar por d\xEDa"),e(),_(129,ke,2,0,"mat-error",14)(130,Ie,2,0,"mat-error",14),e()(),p(131,"mat-divider",35),a(132,"h3",36),t(133,"Configuraci\xF3n de Horarios"),e(),a(134,"div",11)(135,"mat-form-field",12)(136,"mat-label"),t(137,"Hora de Inicio"),e(),p(138,"input",37),e(),a(139,"mat-form-field",12)(140,"mat-label"),t(141,"Hora de Fin"),e(),p(142,"input",38),e()(),a(143,"div",39)(144,"mat-checkbox",40),t(145,"Regla activa"),e()()()()()()()()()()),m&2){let c,E,b,h,u,f,g,M,y,F;o(26),l("formGroup",r.generalForm),o(6),l("ngIf",(c=r.generalForm.get("name"))==null?null:c.hasError("required")),o(9),l("ngIf",(E=r.generalForm.get("language"))==null?null:E.hasError("required")),o(5),l("value",r.planName),o(),k(r.planName),o(12),l("ngIf",(b=r.generalForm.get("max_capacity"))==null?null:b.hasError("required")),o(),l("ngIf",(h=r.generalForm.get("max_capacity"))==null?null:h.hasError("min")),o(5),l("value",!0),o(2),l("value",!1),o(11),l("value",!0),o(2),l("value",!1),o(25),l("formGroup",r.pricingForm),o(8),l("ngIf",(u=r.pricingForm.get("price_per_min"))==null?null:u.hasError("required")),o(),l("ngIf",(f=r.pricingForm.get("price_per_min"))==null?null:f.hasError("min")),o(7),l("ngIf",(g=r.pricingForm.get("min_amount"))==null?null:g.hasError("required")),o(),l("ngIf",(M=r.pricingForm.get("min_amount"))==null?null:M.hasError("min")),o(7),l("ngIf",(y=r.pricingForm.get("daily_max_amount"))==null?null:y.hasError("required")),o(),l("ngIf",(F=r.pricingForm.get("daily_max_amount"))==null?null:F.hasError("min"))}},dependencies:[T,I,Y,z,j,J,R,$,W,K,Q,fe,se,ce,ue,pe,de,A,O,U,H,be,_e,Ee,L,V,w,G,B,ee,Z,oe,ne,D,me,le,ae,te,q,ge,re],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-tab-group[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.config-item[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:8px;padding:1rem;transition:all .2s ease}.config-item[_ngcontent-%COMP%]:hover{border-color:#3b82f6;box-shadow:0 2px 4px #0000001a}@media (max-width: 768px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return n})();export{lt as SettingsComponent};
