import{a as Ke}from"./chunk-NOKTONEF.js";import{c as Ye}from"./chunk-ZMAIZYCZ.js";import{a as De,b as ke,c as Te,d as Pe}from"./chunk-ZEK3ZV5P.js";import{a as He,b as Ue,c as qe,d as W,e as Ge,f as Qe,g as Je}from"./chunk-FJTAFRYA.js";import{a as Ae,b as Fe,c as Ve,d as Oe,e as ze,f as We,g as Re,h as Be,i as je,j as Le,k as Ne}from"./chunk-A3W56N53.js";import{a as Ee,c as Me,f as we}from"./chunk-CFZHHQ3I.js";import{a as Ie,b as be}from"./chunk-FGUURFJS.js";import{a as se,b as ce,c as de,d as pe}from"./chunk-UQSNXR2K.js";import"./chunk-3FSFXLFF.js";import{a as ye,b as Se}from"./chunk-MB5OSV7M.js";import{a as B,b as j,c as ie,e as L,f as N,g as H,h as A}from"./chunk-ZMKJJYLL.js";import"./chunk-EOYQYJ3N.js";import{a as me}from"./chunk-ACMTDFES.js";import"./chunk-FWGAGG6F.js";import"./chunk-VKB6BRO6.js";import{b as O,c as z}from"./chunk-72F6PA3H.js";import{d as ve,e as xe}from"./chunk-ZU6VUINT.js";import{b as ne,f as ae,j as oe,k as re}from"./chunk-EO526QJS.js";import{a as he,b as Ce}from"./chunk-6JXRNXI3.js";import{b as _e,f as ue,j as fe,z as ge}from"./chunk-SGTC2IXF.js";import{fa as te,la as F,na as le,oa as V}from"./chunk-56JILNRZ.js";import"./chunk-TTG7A5I5.js";import{b as $,d as ee}from"./chunk-P2DCSIJY.js";import"./chunk-FDUGCV2L.js";import{l as X,m as Z,t as P}from"./chunk-IZAOXH6X.js";import{$b as v,Eb as s,Ib as R,Lc as K,Pb as n,Qb as t,Rb as S,Sb as C,Tb as I,U as D,Vb as y,bb as l,bc as d,cb as h,f as q,fc as G,gc as Q,hc as Y,lc as T,mc as a,nc as u,oa as f,oc as b,pa as g,pb as k,rc as E,sc as M,tc as w,uc as J,wb as _}from"./chunk-QDWFRTQW.js";import{a as U}from"./chunk-TSRGIXR5.js";function Ze(i,m){i&1&&(n(0,"p",23),a(1,"Todas las facturas generadas en el sistema"),t())}function $e(i,m){i&1&&(n(0,"p",23),a(1,"Gestiona las facturas de tu estacionamiento"),t())}function et(i,m){i&1&&(C(0),n(1,"mat-option",24),a(2,"Sin pago registrado"),t(),n(3,"mat-option",25),a(4,"Pago registrado"),t(),I())}function tt(i,m){i&1&&(C(0),n(1,"mat-option",24),a(2,"Sin pago registrado"),t(),n(3,"mat-option",25),a(4,"Pago registrado"),t(),n(5,"mat-option",26),a(6,"Factura vencida"),t(),n(7,"mat-option",27),a(8,"Cancelada"),t(),I())}function it(i,m){i&1&&(n(0,"div",28),S(1,"mat-spinner",29),t())}function nt(i,m){i&1&&(n(0,"th",55),a(1,"Folio"),t())}function at(i,m){if(i&1&&(n(0,"td",56)(1,"span",57),a(2),t()()),i&2){let e=m.$implicit;l(2),u(e.folio)}}function ot(i,m){i&1&&(n(0,"th",58),a(1,"Estacionamiento"),t())}function rt(i,m){if(i&1&&(n(0,"td",56)(1,"span",59),a(2),t()()),i&2){let e=m.$implicit;l(2),u(e.tenant_name||(e.tenant==null?null:e.tenant.name)||"N/A")}}function lt(i,m){i&1&&(n(0,"th",60),a(1,"Cliente"),t())}function mt(i,m){if(i&1&&(n(0,"td",56)(1,"span",61),a(2),t()()),i&2){let e=m.$implicit;l(2),u(e.client_name)}}function st(i,m){i&1&&(n(0,"th",62),a(1,"RUT Cliente"),t())}function ct(i,m){if(i&1&&(n(0,"td",56)(1,"span",63),a(2),t()()),i&2){let e=m.$implicit,o=d(2);l(2),u(o.formatRut(e.client_rut))}}function dt(i,m){i&1&&(n(0,"th",64),a(1,"Fecha Emisi\xF3n"),t())}function pt(i,m){if(i&1&&(n(0,"td",56),a(1),t()),i&2){let e=m.$implicit,o=d(2);l(),b(" ",o.formatDate(e.emission_date)," ")}}function _t(i,m){i&1&&(n(0,"th",65),a(1,"Fecha Pago"),t())}function ut(i,m){if(i&1&&(n(0,"td",56),a(1),t()),i&2){let e=m.$implicit,o=d(2);l(),b(" ",e.payment_date?o.formatDate(e.payment_date):"-"," ")}}function ft(i,m){i&1&&(n(0,"th",66),a(1,"Monto Total"),t())}function gt(i,m){if(i&1&&(n(0,"td",56)(1,"span",67),a(2),t()()),i&2){let e=m.$implicit,o=d(2);l(2),b(" ",o.formatAmount(e.total_amount)," ")}}function vt(i,m){i&1&&(n(0,"th",68),a(1,"Estado"),t())}function xt(i,m){if(i&1&&(n(0,"td",56)(1,"span",69),a(2),t()()),i&2){let e=m.$implicit,o=d(2);l(),R("bg-"+o.getStatusColor(e.status)+"-100 text-"+o.getStatusColor(e.status)+"-800"),l(),b(" ",o.getStatusLabel(e.status)," ")}}function ht(i,m){i&1&&(n(0,"th",58),a(1,"Acciones"),t())}function Ct(i,m){if(i&1){let e=y();n(0,"button",75),v("click",function(){f(e);let r=d().$implicit,c=d(2);return g(c.payInvoice(r))}),n(1,"mat-icon"),a(2,"payment"),t(),n(3,"span"),a(4,"Pagar"),t()()}}function It(i,m){i&1&&(n(0,"button",72)(1,"mat-icon"),a(2,"edit"),t(),a(3," Editar "),t())}function bt(i,m){if(i&1){let e=y();n(0,"td",56)(1,"button",70)(2,"mat-icon"),a(3,"more_vert"),t()(),n(4,"mat-menu",null,2)(6,"button",71),v("click",function(){let r=f(e).$implicit,c=d(2);return g(c.showInvoiceDetails(r))}),n(7,"mat-icon"),a(8,"visibility"),t(),a(9," Ver detalles "),t(),n(10,"button",72)(11,"mat-icon"),a(12,"print"),t(),a(13," Imprimir "),t(),_(14,Ct,5,0,"button",73)(15,It,4,0,"button",74),t()()}if(i&2){let e=m.$implicit,o=T(5),r=d(2);l(),s("matMenuTriggerFor",o),l(13),s("ngIf",!r.isCentralAdminMode&&e.status==="UNPAID"),l(),s("ngIf",r.isCentralAdminMode&&e.status==="PENDING")}}function yt(i,m){i&1&&S(0,"tr",76)}function St(i,m){i&1&&S(0,"tr",77)}function Et(i,m){i&1&&(n(0,"div",78)(1,"mat-icon",79),a(2,"receipt"),t(),n(3,"h3",80),a(4,"No hay facturas registradas"),t(),n(5,"p",81),a(6,"Las facturas aparecer\xE1n aqu\xED cuando se generen."),t()())}function Mt(i,m){if(i&1){let e=y();n(0,"mat-paginator",82),v("page",function(r){f(e);let c=d(2);return g(c.onPageChange(r))}),t()}if(i&2){let e=d(2);s("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}function wt(i,m){if(i&1){let e=y();n(0,"mat-card")(1,"mat-card-content",30)(2,"div",31)(3,"table",32),v("matSortChange",function(r){f(e);let c=d();return g(c.onSortChange(r))}),C(4,33),_(5,nt,2,0,"th",34)(6,at,3,1,"td",35),I(),C(7,36),_(8,ot,2,0,"th",37)(9,rt,3,1,"td",35),I(),C(10,38),_(11,lt,2,0,"th",39)(12,mt,3,1,"td",35),I(),C(13,40),_(14,st,2,0,"th",41)(15,ct,3,1,"td",35),I(),C(16,42),_(17,dt,2,0,"th",43)(18,pt,2,1,"td",35),I(),C(19,44),_(20,_t,2,0,"th",45)(21,ut,2,1,"td",35),I(),C(22,46),_(23,ft,2,0,"th",47)(24,gt,3,1,"td",35),I(),C(25,48),_(26,vt,2,0,"th",49)(27,xt,3,3,"td",35),I(),C(28,50),_(29,ht,2,0,"th",37)(30,bt,16,3,"td",35),I(),_(31,yt,1,0,"tr",51)(32,St,1,0,"tr",52),t(),_(33,Et,7,0,"div",53),t(),_(34,Mt,1,5,"mat-paginator",54),t()()}if(i&2){let e=d();l(3),s("dataSource",e.invoices)("matSortActive",e.sortBy)("matSortDirection",e.sortOrder)("matSortDisableClear",!0),l(28),s("matHeaderRowDef",e.displayedColumns),l(),s("matRowDefColumns",e.displayedColumns),l(),s("ngIf",!e.loading&&e.invoices.length===0),l(),s("ngIf",e.totalItems>0)}}function Dt(i,m){i&1&&(n(0,"div",89),S(1,"mat-spinner",29),t())}function kt(i,m){if(i&1){let e=y();n(0,"div",90)(1,"div")(2,"h2",5),a(3,"Detalle de Factura"),t(),n(4,"p",91),a(5),t()(),n(6,"button",92),v("click",function(){f(e);let r=d(2);return g(r.closeDetailsModal())}),n(7,"mat-icon"),a(8,"close"),t()()()}if(i&2){let e=d(2);l(5),b("Folio: ",e.selectedInvoice.folio,"")}}function Tt(i,m){if(i&1&&(n(0,"div")(1,"p",96),a(2,"Estacionamiento"),t(),n(3,"p",67),a(4),t()()),i&2){let e=d(3);l(4),u(e.selectedInvoice.tenant_name||(e.selectedInvoice.tenant==null?null:e.selectedInvoice.tenant.name))}}function Pt(i,m){if(i&1&&(n(0,"div")(1,"p",96),a(2,"Sesi\xF3n de Estacionamiento"),t(),n(3,"p",98),a(4),t()()),i&2){let e=d(3);l(4),b("ID: ",e.selectedInvoice.parking_session_id,"")}}function At(i,m){if(i&1&&(n(0,"div")(1,"p",96),a(2,"Venta"),t(),n(3,"p",98),a(4),t()()),i&2){let e=d(3);l(4),b("ID: ",e.selectedInvoice.sale_id,"")}}function Ft(i,m){if(i&1&&(n(0,"tr",119)(1,"td",120),a(2),t(),n(3,"td",121),a(4),t(),n(5,"td",122),a(6),t(),n(7,"td",123),a(8),t()()),i&2){let e=m.$implicit,o=d(4);l(2),u(e.description),l(2),u(e.quantity),l(2),u(o.formatAmount(e.unit_price)),l(2),u(o.formatAmount(e.subtotal))}}function Vt(i,m){if(i&1&&(n(0,"div",31)(1,"table",113)(2,"thead")(3,"tr",114)(4,"th",115),a(5,"Descripci\xF3n"),t(),n(6,"th",116),a(7,"Cantidad"),t(),n(8,"th",117),a(9,"Precio Unitario"),t(),n(10,"th",117),a(11,"Subtotal (Neto)"),t()()(),n(12,"tbody"),_(13,Ft,9,4,"tr",118),t()()()),i&2){let e=d(3);l(13),s("ngForOf",e.selectedInvoice.items)}}function Ot(i,m){i&1&&(n(0,"div",124)(1,"mat-icon",125),a(2,"inventory_2"),t(),n(3,"p",81),a(4,"No hay items registrados en esta factura"),t()())}function zt(i,m){if(i&1&&(n(0,"div",126)(1,"p",127),a(2,"Notas:"),t(),n(3,"p",128),a(4),t()()),i&2){let e=d(3);l(4),u(e.selectedInvoice.notes)}}function Wt(i,m){if(i&1&&(n(0,"div",129)(1,"div",130)(2,"div")(3,"p"),a(4),t()(),n(5,"div")(6,"p"),a(7),t()()()()),i&2){let e=d(3);l(4),b("Fecha de creaci\xF3n: ",e.selectedInvoice.created_at?e.formatDate(e.selectedInvoice.created_at):"N/A",""),l(3),b("\xDAltima actualizaci\xF3n: ",e.selectedInvoice.updated_at?e.formatDate(e.selectedInvoice.updated_at):"N/A","")}}function Rt(i,m){if(i&1&&(n(0,"div",93)(1,"div",4)(2,"h3",94),a(3,"Informaci\xF3n General"),t(),n(4,"div",95)(5,"div")(6,"p",96),a(7,"Estado"),t(),n(8,"span",97),a(9),t()(),_(10,Tt,5,1,"div",15),n(11,"div")(12,"p",96),a(13,"Cliente"),t(),n(14,"p",98),a(15),t()(),n(16,"div")(17,"p",96),a(18,"RUT Cliente"),t(),n(19,"p",99),a(20),t()(),n(21,"div")(22,"p",96),a(23,"Fecha Emisi\xF3n"),t(),n(24,"p",98),a(25),t()(),n(26,"div")(27,"p",96),a(28,"Fecha Pago"),t(),n(29,"p",98),a(30),t()(),_(31,Pt,5,1,"div",15)(32,At,5,1,"div",15),t()(),n(33,"div",4)(34,"h3",94),a(35,"Detalle de Items"),t(),_(36,Vt,14,1,"div",100)(37,Ot,5,0,"div",101),t(),n(38,"div",102)(39,"div",103)(40,"div",104)(41,"div",105)(42,"span",106),a(43,"Monto Neto:"),t(),n(44,"span",107),a(45),t()(),n(46,"div",105)(47,"span",106),a(48,"IVA:"),t(),n(49,"span",107),a(50),t()(),n(51,"div",108)(52,"span",109),a(53,"Total:"),t(),n(54,"span",110),a(55),t()()()()(),_(56,zt,5,1,"div",111)(57,Wt,8,2,"div",112),t()),i&2){let e=d(2);l(8),R("bg-"+e.getStatusColor(e.selectedInvoice.status)+"-100 text-"+e.getStatusColor(e.selectedInvoice.status)+"-800"),l(),b(" ",e.getStatusLabel(e.selectedInvoice.status)," "),l(),s("ngIf",e.isCentralAdminMode&&(e.selectedInvoice.tenant_name||(e.selectedInvoice.tenant==null?null:e.selectedInvoice.tenant.name))),l(5),u(e.selectedInvoice.client_name),l(5),u(e.formatRut(e.selectedInvoice.client_rut)),l(5),u(e.formatDate(e.selectedInvoice.emission_date)),l(5),u(e.selectedInvoice.payment_date?e.formatDate(e.selectedInvoice.payment_date):"No pagada"),l(),s("ngIf",e.selectedInvoice.parking_session_id),l(),s("ngIf",e.selectedInvoice.sale_id),l(4),s("ngIf",e.selectedInvoice.items&&e.selectedInvoice.items.length>0),l(),s("ngIf",!e.selectedInvoice.items||e.selectedInvoice.items.length===0),l(8),u(e.formatAmount(e.selectedInvoice.net_amount)),l(5),u(e.formatAmount(e.selectedInvoice.iva_amount)),l(5),u(e.formatAmount(e.selectedInvoice.total_amount)),l(),s("ngIf",e.selectedInvoice.notes),l(),s("ngIf",e.isCentralAdminMode)}}function Bt(i,m){if(i&1){let e=y();n(0,"div",131)(1,"button",132),v("click",function(){f(e);let r=d(2);return g(r.closeDetailsModal())}),a(2," Cerrar "),t(),n(3,"button",133)(4,"mat-icon"),a(5,"print"),t(),a(6," Imprimir "),t()()}}function jt(i,m){if(i&1){let e=y();n(0,"div",83),v("click",function(){f(e);let r=d();return g(r.closeDetailsModal())}),n(1,"div",84),v("click",function(r){return f(e),g(r.stopPropagation())}),_(2,Dt,2,0,"div",85)(3,kt,9,1,"div",86)(4,Rt,58,17,"div",87)(5,Bt,7,0,"div",88),t()()}if(i&2){let e=d();l(2),s("ngIf",e.loadingDetails),l(),s("ngIf",!e.loadingDetails&&e.selectedInvoice),l(),s("ngIf",!e.loadingDetails&&e.selectedInvoice),l(),s("ngIf",!e.loadingDetails&&e.selectedInvoice)}}var Ti=(()=>{class i{constructor(e,o,r,c,x,p,Xe){this.invoiceService=e,this.authService=o,this.cdr=r,this.dialog=c,this.route=x,this.router=p,this.snackBar=Xe,this._unsubscribeAll=new q,this.sortInitialized=!1,this.invoices=[],this.loading=!1,this.isCentralAdminMode=!1,this.displayedColumns=[],this.showDetailsModal=!1,this.selectedInvoice=null,this.loadingDetails=!1,this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.sortBy="folio",this.sortOrder="desc",this.filters={folio:"",client_name:"",client_rut:"",status:"",emission_date_from:"",emission_date_to:""}}ngOnInit(){this.isCentralAdminMode=this.authService.isCentralAdminMode(),this.isCentralAdminMode?this.displayedColumns=["folio","tenant_name","client_name","client_rut","emission_date","payment_date","total_amount","status","actions"]:this.displayedColumns=["folio","client_name","client_rut","emission_date","payment_date","total_amount","status","actions"],this.checkPaymentStatus(),this.loadInvoices()}checkPaymentStatus(){this.route.queryParams.pipe(D(this._unsubscribeAll)).subscribe(e=>{let o=e.payment,r=e.invoice_id;if(o&&r)switch(this.router.navigate([],{relativeTo:this.route,queryParams:{},replaceUrl:!0}),o){case"success":this.snackBar.open("\xA1Pago realizado exitosamente! La factura ha sido actualizada.","Cerrar",{duration:5e3,panelClass:["success-snackbar"],horizontalPosition:"end",verticalPosition:"top"}),this.loadInvoices();break;case"failed":this.snackBar.open("El pago no pudo ser procesado. Por favor, intente nuevamente.","Cerrar",{duration:5e3,panelClass:["error-snackbar"],horizontalPosition:"end",verticalPosition:"top"});break;case"cancelled":this.snackBar.open("El pago fue cancelado.","Cerrar",{duration:4e3,panelClass:["warning-snackbar"],horizontalPosition:"end",verticalPosition:"top"});break;case"error":this.snackBar.open("Ocurri\xF3 un error al procesar el pago. Por favor, contacte con soporte si el problema persiste.","Cerrar",{duration:6e3,panelClass:["error-snackbar"],horizontalPosition:"end",verticalPosition:"top"});break}})}ngAfterViewInit(){this.initializeSort()}initializeSort(){let e=()=>{if(!this.loading&&this.sort&&!this.sortInitialized)try{this.sort.active=this.sortBy,this.sort.direction=this.sortOrder,this.sortInitialized=!0,this.cdr.detectChanges()}catch(o){console.error("Error initializing sort:",o),this.sortInitialized||setTimeout(e,100)}else!this.sortInitialized&&!this.loading&&setTimeout(e,100)};setTimeout(e,0)}onSortChange(e){e.active&&(this.sortBy=e.active,this.sortOrder=e.direction==="asc"?"asc":"desc",this.currentPage=0,this.loadInvoices())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadInvoices(){this.loading=!0;let e=U({page:this.currentPage+1,per_page:this.pageSize,sort_by:this.sortBy,sort_order:this.sortOrder},this.filters);this.invoiceService.getInvoices(e).pipe(D(this._unsubscribeAll)).subscribe({next:o=>{this.invoices=o.data?.data||[],this.totalItems=o.data?.total||0,this.loading=!1,setTimeout(()=>{this.sortInitialized?this.sort&&(this.sort.active=this.sortBy,this.sort.direction=this.sortOrder):this.initializeSort()},50)},error:o=>{console.error("Error loading invoices:",o),this.loading=!1}})}formatAmount(e){return this.invoiceService.formatAmount(e)}formatDate(e){return this.invoiceService.formatDate(e)}formatRut(e){return this.invoiceService.formatRut(e)}getStatusColor(e){return this.invoiceService.getStatusColor(e)}getStatusLabel(e){return this.invoiceService.getStatusLabel(e)}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadInvoices()}applyFilters(){this.currentPage=0,this.loadInvoices()}clearFilters(){this.filters={folio:"",client_name:"",client_rut:"",status:"",emission_date_from:"",emission_date_to:""},this.currentPage=0,this.loadInvoices()}showInvoiceDetails(e){this.showDetailsModal=!0,this.loadingDetails=!0,this.selectedInvoice=null,this.invoiceService.getInvoice(e.id).pipe(D(this._unsubscribeAll)).subscribe({next:o=>{this.selectedInvoice=o.data,this.loadingDetails=!1},error:o=>{console.error("Error loading invoice details:",o),this.loadingDetails=!1,this.closeDetailsModal()}})}closeDetailsModal(){this.showDetailsModal=!1,this.selectedInvoice=null,this.loadingDetails=!1}payInvoice(e){if(!e.id){console.error("La factura no tiene ID");return}this.dialog.open(Lt,{width:"500px",maxWidth:"90vw",disableClose:!0,data:{folio:e.folio,amount:this.formatAmount(e.total_amount)}}).afterClosed().subscribe(r=>{r&&this.initiateWebPayPayment(e)})}initiateWebPayPayment(e){e.id&&(this.loading=!0,this.invoiceService.initiateWebPayPayment(e.id).pipe(D(this._unsubscribeAll)).subscribe({next:o=>{this.loading=!1,o.success&&o.data?this.submitWebPayForm(o.data.url,o.data.token):this.showError("Error al iniciar el pago. Por favor, intente nuevamente.")},error:o=>{this.loading=!1,console.error("Error al iniciar pago:",o);let r=o.error?.message||"Error al iniciar el pago. Por favor, intente nuevamente.";this.showError(r)}}))}submitWebPayForm(e,o){let r=document.createElement("form");r.method="POST",r.action=e,r.style.display="none";let c=document.createElement("input");c.type="hidden",c.name="token_ws",c.value=o,r.appendChild(c),document.body.appendChild(r),r.submit()}showError(e){this.dialog.open(Nt,{width:"500px",maxWidth:"90vw",disableClose:!1,data:{message:e}})}static{this.\u0275fac=function(o){return new(o||i)(h(Ke),h(me),h(K),h(ie),h($),h(ee),h(Ie))}}static{this.\u0275cmp=k({type:i,selectors:[["app-invoices"]],viewQuery:function(o,r){if(o&1&&G(W,5),o&2){let c;Q(c=Y())&&(r.sort=c.first)}},features:[J([{provide:He,useValue:Je()}])],decls:55,vars:17,consts:[["pickerFrom",""],["pickerTo",""],["menu","matMenu"],[1,"p-6","w-full"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-900"],["class","text-gray-600",4,"ngIf"],[1,"p-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["appearance","outline"],["matInput","","placeholder","Buscar por folio",3,"ngModelChange","ngModel"],["matInput","","placeholder","Nombre del cliente",3,"ngModelChange","ngModel"],["matInput","","placeholder","RUT del cliente",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],[4,"ngIf"],["matInput","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],["class","flex justify-center items-center h-64",4,"ngIf"],["class","invoice-detail-modal-overlay",3,"click",4,"ngIf"],[1,"text-gray-600"],["value","UNPAID"],["value","PAID"],["value","OVERDUE"],["value","CANCELLED"],[1,"flex","justify-center","items-center","h-64"],["diameter","50"],[1,"p-0"],[1,"overflow-x-auto"],["mat-table","","matSort","",1,"w-full",3,"matSortChange","dataSource","matSortActive","matSortDirection","matSortDisableClear"],["matColumnDef","folio"],["mat-header-cell","","mat-sort-header","folio",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","tenant_name"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","client_name"],["mat-header-cell","","mat-sort-header","client_name",4,"matHeaderCellDef"],["matColumnDef","client_rut"],["mat-header-cell","","mat-sort-header","client_rut",4,"matHeaderCellDef"],["matColumnDef","emission_date"],["mat-header-cell","","mat-sort-header","emission_date",4,"matHeaderCellDef"],["matColumnDef","payment_date"],["mat-header-cell","","mat-sort-header","payment_date",4,"matHeaderCellDef"],["matColumnDef","total_amount"],["mat-header-cell","","mat-sort-header","total_amount",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","status",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],["mat-header-cell","","mat-sort-header","folio"],["mat-cell",""],[1,"font-mono","font-semibold"],["mat-header-cell",""],[1,"font-medium","text-blue-600"],["mat-header-cell","","mat-sort-header","client_name"],[1,"font-medium"],["mat-header-cell","","mat-sort-header","client_rut"],[1,"font-mono"],["mat-header-cell","","mat-sort-header","emission_date"],["mat-header-cell","","mat-sort-header","payment_date"],["mat-header-cell","","mat-sort-header","total_amount"],[1,"font-semibold","text-blue-600"],["mat-header-cell","","mat-sort-header","status"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["mat-menu-item","","class","pay-invoice-button",3,"click",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["mat-menu-item","",1,"pay-invoice-button",3,"click"],["mat-header-row",""],["mat-row",""],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"text-gray-500"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"],[1,"invoice-detail-modal-overlay",3,"click"],[1,"invoice-detail-modal-content",3,"click"],["class","flex justify-center items-center p-12",4,"ngIf"],["class","flex justify-between items-center p-6 border-b bg-white sticky top-0 z-10",4,"ngIf"],["class","p-6 overflow-y-auto flex-1",4,"ngIf"],["class","flex justify-end gap-3 p-6 pt-4 border-t border-gray-200 bg-white sticky bottom-0",4,"ngIf"],[1,"flex","justify-center","items-center","p-12"],[1,"flex","justify-between","items-center","p-6","border-b","bg-white","sticky","top-0","z-10"],[1,"text-sm","text-gray-500","mt-1"],["mat-icon-button","",1,"text-gray-500","hover:text-gray-700",3,"click"],[1,"p-6","overflow-y-auto","flex-1"],[1,"text-lg","font-semibold","mb-4","text-gray-900"],[1,"grid","grid-cols-2","gap-4"],[1,"text-sm","text-gray-600","mb-1"],[1,"px-3","py-1","rounded-full","text-xs","font-medium","inline-block"],[1,"font-semibold"],[1,"font-semibold","font-mono"],["class","overflow-x-auto",4,"ngIf"],["class","text-center py-8 bg-gray-50 rounded border border-gray-200",4,"ngIf"],[1,"border-t-2","border-gray-300","pt-4","mb-6"],[1,"flex","justify-end"],[1,"w-80"],[1,"flex","justify-between","mb-3"],[1,"text-gray-600","font-medium"],[1,"font-semibold","text-gray-900"],[1,"flex","justify-between","text-lg","font-bold","border-t-2","border-gray-300","pt-3"],[1,"text-gray-900"],[1,"text-blue-600"],["class","p-4 bg-gray-50 rounded-lg border border-gray-200",4,"ngIf"],["class","mt-6 pt-4 border-t border-gray-200",4,"ngIf"],[1,"w-full","border-collapse","border","border-gray-300"],[1,"bg-gray-100"],[1,"border","border-gray-300","p-3","text-left","text-sm","font-semibold","text-gray-700"],[1,"border","border-gray-300","p-3","text-center","text-sm","font-semibold","text-gray-700"],[1,"border","border-gray-300","p-3","text-right","text-sm","font-semibold","text-gray-700"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50"],[1,"border","border-gray-300","p-3"],[1,"border","border-gray-300","p-3","text-center"],[1,"border","border-gray-300","p-3","text-right"],[1,"border","border-gray-300","p-3","text-right","font-semibold"],[1,"text-center","py-8","bg-gray-50","rounded","border","border-gray-200"],[1,"text-gray-400","text-4xl","mb-2"],[1,"p-4","bg-gray-50","rounded-lg","border","border-gray-200"],[1,"text-sm","font-semibold","text-gray-700","mb-2"],[1,"text-sm","text-gray-600","whitespace-pre-wrap"],[1,"mt-6","pt-4","border-t","border-gray-200"],[1,"grid","grid-cols-2","gap-4","text-xs","text-gray-500"],[1,"flex","justify-end","gap-3","p-6","pt-4","border-t","border-gray-200","bg-white","sticky","bottom-0"],["mat-stroked-button","",3,"click"],["mat-raised-button","","color","primary"]],template:function(o,r){if(o&1){let c=y();n(0,"div",3)(1,"div",4)(2,"h1",5),a(3,"Facturas"),t(),_(4,Ze,2,0,"p",6)(5,$e,2,0,"p",6),t(),n(6,"mat-card",4)(7,"mat-card-content",7)(8,"div",8)(9,"mat-form-field",9)(10,"mat-label"),a(11,"Folio"),t(),n(12,"input",10),w("ngModelChange",function(p){return f(c),M(r.filters.folio,p)||(r.filters.folio=p),g(p)}),t()(),n(13,"mat-form-field",9)(14,"mat-label"),a(15,"Cliente"),t(),n(16,"input",11),w("ngModelChange",function(p){return f(c),M(r.filters.client_name,p)||(r.filters.client_name=p),g(p)}),t()(),n(17,"mat-form-field",9)(18,"mat-label"),a(19,"RUT Cliente"),t(),n(20,"input",12),w("ngModelChange",function(p){return f(c),M(r.filters.client_rut,p)||(r.filters.client_rut=p),g(p)}),t()(),n(21,"mat-form-field",9)(22,"mat-label"),a(23,"Estado"),t(),n(24,"mat-select",13),w("ngModelChange",function(p){return f(c),M(r.filters.status,p)||(r.filters.status=p),g(p)}),n(25,"mat-option",14),a(26,"Todos"),t(),_(27,et,5,0,"ng-container",15)(28,tt,9,0,"ng-container",15),t()(),n(29,"mat-form-field",9)(30,"mat-label"),a(31,"Fecha desde"),t(),n(32,"input",16),w("ngModelChange",function(p){return f(c),M(r.filters.emission_date_from,p)||(r.filters.emission_date_from=p),g(p)}),t(),S(33,"mat-datepicker-toggle",17)(34,"mat-datepicker",null,0),t(),n(36,"mat-form-field",9)(37,"mat-label"),a(38,"Fecha hasta"),t(),n(39,"input",16),w("ngModelChange",function(p){return f(c),M(r.filters.emission_date_to,p)||(r.filters.emission_date_to=p),g(p)}),t(),S(40,"mat-datepicker-toggle",17)(41,"mat-datepicker",null,1),t()(),n(43,"div",18)(44,"button",19),v("click",function(){return f(c),g(r.clearFilters())}),n(45,"mat-icon"),a(46,"clear"),t(),a(47," Limpiar "),t(),n(48,"button",20),v("click",function(){return f(c),g(r.applyFilters())}),n(49,"mat-icon"),a(50,"search"),t(),a(51," Filtrar "),t()()()(),_(52,it,2,0,"div",21)(53,wt,35,8,"mat-card",15)(54,jt,6,4,"div",22),t()}if(o&2){let c=T(35),x=T(42);l(4),s("ngIf",r.isCentralAdminMode),l(),s("ngIf",!r.isCentralAdminMode),l(7),E("ngModel",r.filters.folio),l(4),E("ngModel",r.filters.client_name),l(4),E("ngModel",r.filters.client_rut),l(4),E("ngModel",r.filters.status),l(3),s("ngIf",!r.isCentralAdminMode),l(),s("ngIf",r.isCentralAdminMode),l(4),s("matDatepicker",c),E("ngModel",r.filters.emission_date_from),l(),s("for",c),l(6),s("matDatepicker",x),E("ngModel",r.filters.emission_date_to),l(),s("for",x),l(12),s("ngIf",r.loading),l(),s("ngIf",!r.loading),l(),s("ngIf",r.showDetailsModal)}},dependencies:[P,X,Z,ge,_e,ue,fe,Ne,Ae,Ve,Re,Oe,Fe,Be,ze,We,je,Le,we,Ee,Me,V,F,le,z,O,Ce,he,re,oe,ne,ae,xe,ve,Pe,De,ke,Te,Se,ye,te,pe,ce,se,de,Ye,qe,Ue,Qe,W,Ge,A,be],styles:["table[_ngcontent-%COMP%]{width:100%}.mat-column-folio[_ngcontent-%COMP%]{width:10%}.mat-column-tenant_name[_ngcontent-%COMP%]{width:15%}.mat-column-client_name[_ngcontent-%COMP%]{width:18%}.mat-column-client_rut[_ngcontent-%COMP%]{width:12%}.mat-column-emission_date[_ngcontent-%COMP%], .mat-column-payment_date[_ngcontent-%COMP%]{width:10%}.mat-column-net_amount[_ngcontent-%COMP%], .mat-column-iva_amount[_ngcontent-%COMP%], .mat-column-total_amount[_ngcontent-%COMP%]{width:10%;text-align:right}.mat-column-status[_ngcontent-%COMP%]{width:10%}.mat-column-actions[_ngcontent-%COMP%]{width:6%;text-align:center}  .pay-invoice-button{color:#16a34a!important}  .pay-invoice-button .mat-icon{color:#16a34a!important}  .pay-invoice-button span{color:#16a34a!important;font-weight:600!important}  .pay-invoice-button:hover{background-color:#dcfce7!important}@media (max-width: 768px){.mat-column-client_name[_ngcontent-%COMP%], .mat-column-client_rut[_ngcontent-%COMP%]{display:none}}  .success-snackbar{background-color:#16a34a!important;color:#fff!important}  .success-snackbar .mat-mdc-snack-bar-action{color:#fff!important}  .error-snackbar{background-color:#dc2626!important;color:#fff!important}  .error-snackbar .mat-mdc-snack-bar-action{color:#fff!important}  .warning-snackbar{background-color:#ea580c!important;color:#fff!important}  .warning-snackbar .mat-mdc-snack-bar-action{color:#fff!important}.invoice-detail-modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:9999!important;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.invoice-detail-modal-content[_ngcontent-%COMP%]{background-color:#fff;border-radius:.5rem;box-shadow:0 20px 25px -5px #0000001a,0 10px 10px -5px #0000000a;max-width:56rem;width:100%;margin:1rem;max-height:90vh;display:flex;flex-direction:column;z-index:10000!important;position:relative}"]})}}return i})(),Lt=(()=>{class i{constructor(e,o){this.dialogRef=e,this.data=o}onNoClick(){this.dialogRef.close(!1)}onYesClick(){this.dialogRef.close(!0)}static{this.\u0275fac=function(o){return new(o||i)(h(B),h(j))}}static{this.\u0275cmp=k({type:i,selectors:[["app-webpay-confirm-dialog"]],decls:28,vars:2,consts:[[1,"p-6"],[1,"flex","items-center","mb-4"],[1,"text-blue-600","text-5xl","mr-4"],["mat-dialog-title","",1,"text-2xl","font-bold","text-gray-900","m-0"],[1,"mb-6"],[1,"bg-blue-50","p-4","rounded-lg"],[1,"text-gray-700","mb-2"],[1,"font-semibold"],[1,"text-gray-700"],[1,"text-blue-600","font-bold","text-xl"],[1,"text-gray-600","mt-4"],["align","end",1,"gap-2"],["mat-stroked-button","",1,"rounded-sm",3,"click"],["mat-raised-button","","color","primary","cdkFocusInitial","",1,"rounded-sm",3,"click"]],template:function(o,r){o&1&&(n(0,"div",0)(1,"div",1)(2,"mat-icon",2),a(3,"payment"),t(),n(4,"h2",3),a(5,"Confirmar Pago"),t()(),n(6,"mat-dialog-content",4)(7,"div",5)(8,"p",6)(9,"span",7),a(10,"Factura:"),t(),a(11),t(),n(12,"p",8)(13,"span",7),a(14,"Monto a pagar:"),t(),n(15,"span",9),a(16),t()()(),n(17,"p",10),a(18," Ser\xE1s redirigido a WebPay para completar el pago de forma segura. "),t()(),n(19,"mat-dialog-actions",11)(20,"button",12),v("click",function(){return r.onNoClick()}),n(21,"mat-icon"),a(22,"close"),t(),a(23," Cancelar "),t(),n(24,"button",13),v("click",function(){return r.onYesClick()}),n(25,"mat-icon"),a(26,"payment"),t(),a(27," Continuar con el Pago "),t()()()),o&2&&(l(11),b(" ",r.data.folio," "),l(5),u(r.data.amount))},dependencies:[P,A,L,H,N,V,F,z,O],encapsulation:2})}}return i})(),Nt=(()=>{class i{constructor(e,o){this.dialogRef=e,this.data=o}onClose(){this.dialogRef.close()}static{this.\u0275fac=function(o){return new(o||i)(h(B),h(j))}}static{this.\u0275cmp=k({type:i,selectors:[["app-webpay-error-dialog"]],decls:15,vars:1,consts:[[1,"p-6"],[1,"flex","items-center","mb-4"],[1,"text-red-600","text-5xl","mr-4"],["mat-dialog-title","",1,"text-2xl","font-bold","text-gray-900","m-0"],[1,"mb-6"],[1,"bg-red-50","p-4","rounded-lg","border","border-red-200"],[1,"text-red-800"],["align","end"],["mat-raised-button","","color","primary","cdkFocusInitial","",1,"rounded-sm",3,"click"]],template:function(o,r){o&1&&(n(0,"div",0)(1,"div",1)(2,"mat-icon",2),a(3,"error"),t(),n(4,"h2",3),a(5,"Error en el Pago"),t()(),n(6,"mat-dialog-content",4)(7,"div",5)(8,"p",6),a(9),t()()(),n(10,"mat-dialog-actions",7)(11,"button",8),v("click",function(){return r.onClose()}),n(12,"mat-icon"),a(13,"check"),t(),a(14," Aceptar "),t()()()),o&2&&(l(9),u(r.data.message))},dependencies:[P,A,L,H,N,V,F,z,O],encapsulation:2})}}return i})();export{Ti as InvoicesComponent,Lt as WebPayConfirmDialogComponent,Nt as WebPayErrorDialogComponent};
