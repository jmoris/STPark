import{a as U}from"./chunk-N3LDMRIB.js";import{a as gt}from"./chunk-J2G3Y6LG.js";import{a as ce}from"./chunk-ZMFSOZJA.js";import{c as st}from"./chunk-ICPS6N2F.js";import{a as ut}from"./chunk-GQXICOHE.js";import{a as it,b as ot,c as nt,d as pe,e as at,f as lt,g as ct}from"./chunk-TU7IT4N6.js";import{a as We,b as Ue,c as Qe,d as Ke,e as Xe,f as Je,g as Ye,h as Ze,i as et,j as tt,k as rt}from"./chunk-Y6UNS2UZ.js";import{a as mt,c as dt,f as pt}from"./chunk-N7KP3IEB.js";import{a as Le,b as $e,c as He,d as Ge}from"./chunk-EEUJEGPN.js";import"./chunk-KEI4KRBM.js";import{a as H}from"./chunk-FSRW5HPF.js";import{a as ee,b as te,c as ke,e as Fe,f as Te,g as Ae,h as re}from"./chunk-65NYBKEE.js";import{a as Pe,b as Be,c as Ve,d as Ne}from"./chunk-IDWAZBHT.js";import"./chunk-FSA3IEFI.js";import{a as G,b as W}from"./chunk-POSCZER2.js";import"./chunk-ECYJLMJT.js";import"./chunk-VKB6BRO6.js";import{b as qe}from"./chunk-RDXEG6SZ.js";import{b as V,c as N}from"./chunk-IMRKXFOQ.js";import{d as z,e as q}from"./chunk-5Q7CCL6V.js";import{a as L,b as $}from"./chunk-CWSZZ2DY.js";import{b as T,c as ie,f as De,j as A,k as D}from"./chunk-K3BNOLHS.js";import{A as de,b as R,d as b,f as j,g as ne,j as Re,k as ae,n as le,q as se,w as je,x as me,z as ze}from"./chunk-ZTFUS4RN.js";import{W as we,fa as F,la as P,na as oe,oa as B}from"./chunk-QQQ5XT6I.js";import"./chunk-YXFY4UXK.js";import"./chunk-EARUC3FY.js";import{l as Ie,m as w,s as k}from"./chunk-BAM5RHC5.js";import{$b as _,Eb as d,Jb as ve,Pb as o,Qb as r,Rb as h,Sb as E,Tb as O,U as M,Vb as I,bb as l,bc as c,cb as f,f as X,fc as be,gc as Me,hc as Ee,lc as K,mc as n,nc as x,oa as S,oc as g,pa as v,pb as y,pc as Oe,rc as J,sc as Y,tc as Z,uc as ye,wb as u}from"./chunk-MLNNMN4J.js";import{a as Se}from"./chunk-TSRGIXR5.js";function kt(i,m){if(i&1&&(o(0,"mat-error"),n(1),r()),i&2){let e=c();l(),g(" ",e.getErrorMessage("name")," ")}}function Ft(i,m){if(i&1&&(o(0,"mat-error"),n(1),r()),i&2){let e=c();l(),g(" ",e.getErrorMessage("name")," ")}}function Tt(i,m){if(i&1&&(o(0,"mat-error"),n(1),r()),i&2){let e=c();l(),g(" ",e.getErrorMessage("rut")," ")}}function At(i,m){if(i&1&&(o(0,"mat-error"),n(1),r()),i&2){let e=c();l(),g(" ",e.getErrorMessage("rut")," ")}}function Dt(i,m){if(i&1&&(o(0,"mat-error"),n(1),r()),i&2){let e=c();l(),g(" ",e.getErrorMessage("email")," ")}}function Pt(i,m){if(i&1&&(o(0,"mat-error"),n(1),r()),i&2){let e=c();l(),g(" ",e.getErrorMessage("email")," ")}}function Bt(i,m){if(i&1&&(o(0,"mat-error"),n(1),r()),i&2){let e=c();l(),g(" ",e.getErrorMessage("phone")," ")}}function Vt(i,m){if(i&1&&(o(0,"mat-error"),n(1),r()),i&2){let e=c();l(),g(" ",e.getErrorMessage("phone")," ")}}function Nt(i,m){if(i&1&&(o(0,"mat-error"),n(1),r()),i&2){let e=c();l(),g(" ",e.getErrorMessage("pin")," ")}}function Rt(i,m){i&1&&h(0,"mat-spinner",21)}function jt(i,m){if(i&1&&(o(0,"mat-icon"),n(1),r()),i&2){let e=c();l(),x(e.data.isEdit?"save":"add")}}var ue=(()=>{class i{constructor(e,a,t,s,p,C){this.fb=e,this.dialogRef=a,this.data=t,this.operatorService=s,this.sectorService=p,this.snackBar=C,this.loading=!1,this.sectors=[],this.operatorForm=this.createForm()}ngOnInit(){this.loadSectors(),this.data.isEdit&&this.data.operator&&this.loadOperatorData()}createForm(){return this.fb.group({name:["",[b.required,b.minLength(2)]],rut:["",[b.required,b.pattern(/^[0-9]+-[0-9kK]{1}$/)]],email:["",[b.email]],phone:["",[b.pattern(/^[+]?[\d\s-()]+$/)]],pin:["",[b.pattern(/^[0-9]{6}$/)]],status:["ACTIVE"]})}loadSectors(){this.sectorService.getSectors().subscribe({next:e=>{this.sectors=e.data?.data||[]},error:e=>{console.error("Error loading sectors:",e),this.snackBar.open("Error al cargar sectores","Cerrar",{duration:3e3})}})}loadOperatorData(){this.data.operator&&this.operatorForm.patchValue({name:this.data.operator.name,rut:this.data.operator.rut,email:this.data.operator.email||"",phone:this.data.operator.phone||"",pin:this.data.operator.pin||"",status:this.data.operator.status||"ACTIVE"})}onSubmit(){if(this.operatorForm.valid){this.loading=!0;let e=this.operatorForm.value;if(this.data.isEdit&&this.data.operator){let a=Number(this.data.operator.id);this.operatorService.updateOperator(a,e).subscribe({next:t=>{this.loading=!1,this.snackBar.open("Operador actualizado correctamente","Cerrar",{duration:3e3}),this.dialogRef.close(t.data)},error:t=>{this.loading=!1,console.error("Error updating operator:",t),this.snackBar.open("Error al actualizar operador","Cerrar",{duration:3e3})}})}else this.operatorService.createOperator(e).subscribe({next:a=>{this.loading=!1,this.snackBar.open("Operador creado correctamente","Cerrar",{duration:3e3}),this.dialogRef.close(a.data)},error:a=>{this.loading=!1,console.error("Error creating operator:",a);let t="Error al crear operador";(a.error?.error_code==="PLAN_LIMIT_EXCEEDED"&&a.error?.message||a.error?.message)&&(t=a.error.message),this.snackBar.open(t,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}})}else this.snackBar.open("Por favor, complete todos los campos requeridos","Cerrar",{duration:3e3})}onCancel(){this.dialogRef.close()}getErrorMessage(e){let a=this.operatorForm.get(e);return a?.hasError("required")?"Este campo es requerido":a?.hasError("email")?"Ingrese un email v\xE1lido":a?.hasError("minlength")?"M\xEDnimo 2 caracteres":a?.hasError("pattern")?e==="rut"?"Formato de RUT inv\xE1lido (ej: 12.345.678-9)":e==="pin"?"El PIN debe tener exactamente 6 d\xEDgitos":"Formato de tel\xE9fono inv\xE1lido":""}static{this.\u0275fac=function(a){return new(a||i)(f(me),f(ee),f(te),f(U),f(ce),f(H))}}static{this.\u0275cmp=y({type:i,selectors:[["app-operator-form"]],decls:56,vars:16,consts:[[1,"operator-form-dialog"],[1,"dialog-header"],[1,"dialog-title"],["mat-icon-button","",1,"close-button",3,"click"],[1,"dialog-content"],[1,"operator-form",3,"formGroup"],[1,"form-row"],["appearance","outline",1,"half-width"],["matInput","","formControlName","name","placeholder","Ingrese el nombre completo"],[4,"ngIf"],["matInput","","formControlName","rut","placeholder","12.345.678-9"],["matInput","","formControlName","email","type","email","placeholder","operador@ejemplo.com"],["matInput","","formControlName","phone","placeholder","+56 9 1234 5678"],["matInput","","formControlName","pin","placeholder","123456","maxlength","6"],["formControlName","status"],["value","ACTIVE"],["value","INACTIVE"],[1,"dialog-actions"],["mat-button","",1,"rounded-sm",3,"click","disabled"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click","disabled"],["diameter","20","class","inline-spinner",4,"ngIf"],["diameter","20",1,"inline-spinner"]],template:function(a,t){if(a&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),n(3),r(),o(4,"button",3),_("click",function(){return t.onCancel()}),o(5,"mat-icon"),n(6,"close"),r()()(),o(7,"div",4)(8,"form",5)(9,"div",6)(10,"mat-form-field",7)(11,"mat-label"),n(12,"Nombre completo"),r(),h(13,"input",8),u(14,kt,2,1,"mat-error",9)(15,Ft,2,1,"mat-error",9),r(),o(16,"mat-form-field",7)(17,"mat-label"),n(18,"RUT"),r(),h(19,"input",10),u(20,Tt,2,1,"mat-error",9)(21,At,2,1,"mat-error",9),r()(),o(22,"div",6)(23,"mat-form-field",7)(24,"mat-label"),n(25,"Email"),r(),h(26,"input",11),u(27,Dt,2,1,"mat-error",9)(28,Pt,2,1,"mat-error",9),r(),o(29,"mat-form-field",7)(30,"mat-label"),n(31,"Tel\xE9fono"),r(),h(32,"input",12),u(33,Bt,2,1,"mat-error",9)(34,Vt,2,1,"mat-error",9),r()(),o(35,"div",6)(36,"mat-form-field",7)(37,"mat-label"),n(38,"PIN (6 d\xEDgitos)"),r(),h(39,"input",13),u(40,Nt,2,1,"mat-error",9),r(),o(41,"mat-form-field",7)(42,"mat-label"),n(43,"Estado"),r(),o(44,"mat-select",14)(45,"mat-option",15),n(46,"Activo"),r(),o(47,"mat-option",16),n(48,"Inactivo"),r()()()()()(),o(49,"div",17)(50,"button",18),_("click",function(){return t.onCancel()}),n(51," Cancelar "),r(),o(52,"button",19),_("click",function(){return t.onSubmit()}),u(53,Rt,1,0,"mat-spinner",20)(54,jt,2,1,"mat-icon",9),n(55),r()()()),a&2){let s,p,C,Q,fe,_e,he,xe,Ce;l(3),g(" ",t.data.isEdit?"Editar Operador":"Nuevo Operador"," "),l(5),d("formGroup",t.operatorForm),l(6),d("ngIf",(s=t.operatorForm.get("name"))==null?null:s.hasError("required")),l(),d("ngIf",(p=t.operatorForm.get("name"))==null?null:p.hasError("minlength")),l(5),d("ngIf",(C=t.operatorForm.get("rut"))==null?null:C.hasError("required")),l(),d("ngIf",(Q=t.operatorForm.get("rut"))==null?null:Q.hasError("pattern")),l(6),d("ngIf",(fe=t.operatorForm.get("email"))==null?null:fe.hasError("required")),l(),d("ngIf",(_e=t.operatorForm.get("email"))==null?null:_e.hasError("email")),l(5),d("ngIf",(he=t.operatorForm.get("phone"))==null?null:he.hasError("required")),l(),d("ngIf",(xe=t.operatorForm.get("phone"))==null?null:xe.hasError("pattern")),l(6),d("ngIf",(Ce=t.operatorForm.get("pin"))==null?null:Ce.hasError("pattern")),l(10),d("disabled",t.loading),l(2),d("disabled",t.loading||t.operatorForm.invalid),l(),d("ngIf",t.loading),l(),d("ngIf",!t.loading),l(),g(" ",t.data.isEdit?"Actualizar":"Crear"," ")}},dependencies:[k,w,de,ae,R,j,ne,je,le,se,re,D,A,T,ie,q,z,B,P,oe,N,V,W,G,F,qe,$,L],styles:[".operator-form-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:90vh;width:100%}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem 1.5rem 0;border-bottom:1px solid #e5e7eb;margin-bottom:1rem}.dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:#111827}.close-button[_ngcontent-%COMP%]{margin-left:auto}.dialog-content[_ngcontent-%COMP%]{flex:1;padding:0 1.5rem;overflow-y:auto}.dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1rem 1.5rem 1.5rem;border-top:1px solid #e5e7eb;margin-top:1rem}.operator-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-start}.full-width[_ngcontent-%COMP%]{width:100%}.half-width[_ngcontent-%COMP%]{flex:1}.inline-spinner[_ngcontent-%COMP%]{margin-right:8px}@media (max-width: 600px){.operator-form-dialog[_ngcontent-%COMP%]{max-height:95vh}.form-row[_ngcontent-%COMP%]{flex-direction:column}.half-width[_ngcontent-%COMP%]{width:100%}.dialog-header[_ngcontent-%COMP%]{padding:1rem 1rem 0}.dialog-content[_ngcontent-%COMP%]{padding:0 1rem}.dialog-actions[_ngcontent-%COMP%]{padding:1rem}}"]})}}return i})();function zt(i,m){if(i&1&&(o(0,"mat-option",30),n(1),r()),i&2){let e=m.$implicit;d("value",e.id),l(),Oe(" ",e.name," (",e.is_private?"Privado":"P\xFAblico",") ")}}function qt(i,m){if(i&1&&(o(0,"mat-error"),n(1),r()),i&2){let e=c();l(),g(" ",e.getErrorMessage("sector_id")," ")}}function Lt(i,m){if(i&1&&(o(0,"mat-option",30),n(1),r()),i&2){let e=m.$implicit;d("value",e.id),l(),g(" ",e.name," ")}}function $t(i,m){i&1&&h(0,"mat-spinner",31)}function Ht(i,m){if(i&1&&(o(0,"mat-error"),n(1),r()),i&2){let e=c();l(),g(" ",e.getErrorMessage("valid_from")," ")}}function Gt(i,m){i&1&&h(0,"mat-spinner",31)}function Wt(i,m){if(i&1&&(o(0,"mat-icon"),n(1),r()),i&2){let e=c();l(),x(e.data.isEdit?"save":"add")}}var ge=(()=>{class i{constructor(e,a,t,s,p,C){this.fb=e,this.dialogRef=a,this.data=t,this.operatorService=s,this.sectorService=p,this.snackBar=C,this._unsubscribeAll=new X,this.loading=!1,this.sectors=[],this.streets=[],this.loadingStreets=!1,this.assignmentForm=this.createForm()}ngOnInit(){this.loadSectors(),this.data.isEdit&&this.data.assignment&&this.loadAssignmentData()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}createForm(){return this.fb.group({sector_id:["",[b.required]],street_id:[""],valid_from:["",[b.required]],valid_to:[""]})}loadSectors(){this.sectorService.getSectors().pipe(M(this._unsubscribeAll)).subscribe({next:e=>{this.sectors=e.data?.data||[]},error:e=>{console.error("Error loading sectors:",e),this.snackBar.open("Error al cargar sectores","Cerrar",{duration:3e3})}})}onSectorChange(e){this.streets=[],this.assignmentForm.patchValue({street_id:""}),e&&this.loadStreetsBySector(e)}loadStreetsBySector(e){this.loadingStreets=!0,this.sectorService.getSectorStreets(e).pipe(M(this._unsubscribeAll)).subscribe({next:a=>{this.streets=a.data||[],this.loadingStreets=!1},error:a=>{console.error("Error loading streets:",a),this.snackBar.open("Error al cargar calles","Cerrar",{duration:3e3}),this.loadingStreets=!1}})}loadAssignmentData(){this.data.assignment&&(this.assignmentForm.patchValue({sector_id:this.data.assignment.sector_id,street_id:this.data.assignment.street_id,valid_from:this.data.assignment.valid_from,valid_to:this.data.assignment.valid_to}),this.data.assignment.sector_id&&this.loadStreetsBySector(this.data.assignment.sector_id))}onSubmit(){if(this.assignmentForm.valid){this.loading=!0;let e=this.assignmentForm.value;e.valid_from&&(e.valid_from=new Date(e.valid_from).toISOString().split("T")[0]),e.valid_to&&(e.valid_to=new Date(e.valid_to).toISOString().split("T")[0]),this.operatorService.assignOperator(this.data.operator.id,e).pipe(M(this._unsubscribeAll)).subscribe({next:a=>{let t=a.message||"Asignaci\xF3n realizada exitosamente";this.snackBar.open(t,"Cerrar",{duration:4e3}),this.dialogRef.close(!0)},error:a=>{console.error("Error assigning operator:",a),this.snackBar.open("Error al asignar operador","Cerrar",{duration:3e3}),this.loading=!1}})}else this.snackBar.open("Por favor, complete todos los campos requeridos","Cerrar",{duration:3e3})}onCancel(){this.dialogRef.close()}getErrorMessage(e){return this.assignmentForm.get(e)?.hasError("required")?"Este campo es requerido":""}static{this.\u0275fac=function(a){return new(a||i)(f(me),f(ee),f(te),f(U),f(ce),f(H))}}static{this.\u0275cmp=y({type:i,selectors:[["app-operator-assignment"]],decls:61,vars:19,consts:[["picker1",""],["picker2",""],[1,"operator-assignment-dialog"],["mat-dialog-title",""],[1,"mb-4","p-3","bg-gray-50","rounded-lg"],[1,"flex","items-center","gap-2"],[1,"text-gray-500"],[1,"font-semibold"],[1,"mb-4","p-3","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"flex","items-start","gap-2"],[1,"text-blue-600","mt-0.5"],[1,"text-sm","text-blue-800"],[1,"font-medium","mb-1"],[1,"assignment-form",3,"formGroup"],[1,"form-row"],["appearance","outline",1,"full-width"],["formControlName","sector_id",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["formControlName","street_id",3,"disabled"],["value",""],["diameter","20","class","inline-spinner",4,"ngIf"],[1,"form-row","grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline"],["matInput","","formControlName","valid_from",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","valid_to",3,"matDatepicker"],["align","end"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click","disabled"],[3,"value"],["diameter","20",1,"inline-spinner"]],template:function(a,t){if(a&1){let s=I();o(0,"div",2)(1,"h2",3),n(2),r(),o(3,"mat-dialog-content")(4,"div",4)(5,"div",5)(6,"mat-icon",6),n(7,"person"),r(),o(8,"span",7),n(9),r(),o(10,"span",6),n(11),r()()(),o(12,"div",8)(13,"div",9)(14,"mat-icon",10),n(15,"info"),r(),o(16,"div",11)(17,"p",12),n(18,"Informaci\xF3n importante:"),r(),o(19,"p"),n(20,"Al asignar un nuevo sector, se eliminar\xE1n autom\xE1ticamente todas las asignaciones anteriores del operador. Cada operador solo puede tener un sector asignado a la vez."),r()()()(),o(21,"form",13)(22,"div",14)(23,"mat-form-field",15)(24,"mat-label"),n(25,"Sector *"),r(),o(26,"mat-select",16),_("selectionChange",function(C){return S(s),v(t.onSectorChange(C.value))}),u(27,zt,2,3,"mat-option",17),r(),u(28,qt,2,1,"mat-error",18),r()(),o(29,"div",14)(30,"mat-form-field",15)(31,"mat-label"),n(32,"Calle (Opcional)"),r(),o(33,"mat-select",19)(34,"mat-option",20),n(35,"Sin calle espec\xEDfica"),r(),u(36,Lt,2,2,"mat-option",17),r(),u(37,$t,1,0,"mat-spinner",21),r()(),o(38,"div",22)(39,"mat-form-field",23)(40,"mat-label"),n(41,"V\xE1lido desde *"),r(),h(42,"input",24)(43,"mat-datepicker-toggle",25)(44,"mat-datepicker",null,0),u(46,Ht,2,1,"mat-error",18),r(),o(47,"mat-form-field",23)(48,"mat-label"),n(49,"V\xE1lido hasta (Opcional)"),r(),h(50,"input",26)(51,"mat-datepicker-toggle",25)(52,"mat-datepicker",null,1),r()()()(),o(54,"mat-dialog-actions",27)(55,"button",28),_("click",function(){return S(s),v(t.onCancel())}),n(56," Cancelar "),r(),o(57,"button",29),_("click",function(){return S(s),v(t.onSubmit())}),u(58,Gt,1,0,"mat-spinner",21)(59,Wt,2,1,"mat-icon",18),n(60),r()()()}if(a&2){let s,p,C=K(45),Q=K(53);l(2),g(" ",t.data.isEdit?"Editar Asignaci\xF3n":"Asignar Sector"," "),l(7),x(t.data.operator.name),l(2),g("(",t.data.operator.rut,")"),l(10),d("formGroup",t.assignmentForm),l(6),d("ngForOf",t.sectors),l(),d("ngIf",(s=t.assignmentForm.get("sector_id"))==null?null:s.hasError("required")),l(5),d("disabled",t.loadingStreets),l(3),d("ngForOf",t.streets),l(),d("ngIf",t.loadingStreets),l(5),d("matDatepicker",C),l(),d("for",C),l(3),d("ngIf",(p=t.assignmentForm.get("valid_from"))==null?null:p.hasError("required")),l(4),d("matDatepicker",Q),l(),d("for",Q),l(4),d("disabled",t.loading),l(2),d("disabled",t.loading||t.assignmentForm.invalid),l(),d("ngIf",t.loading),l(),d("ngIf",!t.loading),l(),g(" ",t.data.isEdit?"Actualizar":"Asignar"," ")}},dependencies:[k,Ie,w,de,ae,R,j,ne,le,se,re,Fe,Ae,Te,D,A,T,ie,De,q,z,W,G,F,B,P,N,V,$,L,Ge,Le,$e,He,we],styles:[".operator-assignment-dialog[_ngcontent-%COMP%]{min-width:500px;max-width:600px}.assignment-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{margin-bottom:16px}.assignment-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.inline-spinner[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-content[_ngcontent-%COMP%]{max-height:70vh;overflow-y:auto}"]})}}return i})();function Ut(i,m){i&1&&(o(0,"th",50),n(1,"Nombre"),r())}function Qt(i,m){if(i&1&&(o(0,"td",51)(1,"div",52)(2,"mat-icon",53),n(3,"person"),r(),o(4,"span",54),n(5),r()()()),i&2){let e=m.$implicit;l(5),x(e.name)}}function Kt(i,m){i&1&&(o(0,"th",55),n(1,"RUT"),r())}function Xt(i,m){if(i&1&&(o(0,"td",51)(1,"span",56),n(2),r()()),i&2){let e=m.$implicit;l(2),x(e.rut||"No asignado")}}function Jt(i,m){i&1&&(o(0,"th",57),n(1,"Email"),r())}function Yt(i,m){if(i&1&&(o(0,"td",51)(1,"span",4),n(2),r()()),i&2){let e=m.$implicit;l(2),x(e.email||"No asignado")}}function Zt(i,m){i&1&&(o(0,"th",58),n(1,"Tel\xE9fono"),r())}function er(i,m){if(i&1&&(o(0,"td",51)(1,"span",4),n(2),r()()),i&2){let e=m.$implicit;l(2),x(e.phone||"No asignado")}}function tr(i,m){i&1&&(o(0,"th",59),n(1,"Estado"),r())}function rr(i,m){if(i&1&&(o(0,"td",51)(1,"span"),n(2),r()()),i&2){let e=m.$implicit,a=c();l(),ve("px-2 py-1 rounded text-xs font-medium status-",a.getStatusColor(e),""),l(),g(" ",a.getStatusText(e)," ")}}function ir(i,m){i&1&&(o(0,"th",60),n(1,"Acciones"),r())}function or(i,m){if(i&1){let e=I();o(0,"button",65),_("click",function(){S(e);let t=c().$implicit,s=c();return v(s.removeAllAssignments(t))}),o(1,"mat-icon"),n(2,"location_off"),r(),n(3," Eliminar Asignaciones "),r()}}function nr(i,m){if(i&1){let e=I();o(0,"td",51)(1,"button",61)(2,"mat-icon"),n(3,"more_vert"),r()(),o(4,"mat-menu",null,0)(6,"button",62),_("click",function(){let t=S(e).$implicit,s=c();return v(s.viewOperator(t))}),o(7,"mat-icon"),n(8,"visibility"),r(),n(9," Ver detalles "),r(),o(10,"button",62),_("click",function(){let t=S(e).$implicit,s=c();return v(s.editOperator(t))}),o(11,"mat-icon"),n(12,"edit"),r(),n(13," Editar "),r(),o(14,"button",62),_("click",function(){let t=S(e).$implicit,s=c();return v(s.assignOperator(t))}),o(15,"mat-icon"),n(16,"location_on"),r(),n(17," Asignar Sector "),r(),u(18,or,4,0,"button",63),o(19,"button",64),_("click",function(){let t=S(e).$implicit,s=c();return v(s.deleteOperator(t))}),o(20,"mat-icon"),n(21,"delete"),r(),n(22," Eliminar "),r()()()}if(i&2){let e=m.$implicit,a=K(5),t=c();l(),d("matMenuTriggerFor",a),l(17),d("ngIf",t.getAssignmentsCount(e)>0)}}function ar(i,m){i&1&&h(0,"tr",66)}function lr(i,m){i&1&&h(0,"tr",67)}function sr(i,m){i&1&&(o(0,"div",68),h(1,"mat-spinner",69),r())}function mr(i,m){i&1&&(o(0,"div",70)(1,"mat-icon",71),n(2,"people"),r(),o(3,"h3",72),n(4,"No hay operadores registrados"),r(),o(5,"p",53),n(6,"Los operadores aparecer\xE1n aqu\xED cuando se registren."),r()())}function dr(i,m){if(i&1){let e=I();o(0,"mat-paginator",73),_("page",function(t){S(e);let s=c();return v(s.onPageChange(t))}),r()}if(i&2){let e=c();d("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}var li=(()=>{class i{constructor(e,a,t){this.operatorService=e,this.dialog=a,this.snackBar=t,this._unsubscribeAll=new X,this.operators=[],this.loading=!1,this.displayedColumns=["name","rut","email","phone","status","actions"],this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.sortBy="name",this.sortOrder="asc",this.filters={name:"",status:"",sector:""}}ngOnInit(){this.loadOperators()}ngAfterViewInit(){this.sort&&this.sort.sortChange.pipe(M(this._unsubscribeAll)).subscribe(e=>{this.sortBy=e.active,this.sortOrder=e.direction==="asc"?"asc":"desc",this.currentPage=0,this.loadOperators()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadOperators(){this.loading=!0;let e=Se({page:this.currentPage+1,per_page:this.pageSize,sort_by:this.sortBy,sort_order:this.sortOrder},this.filters);this.operatorService.getOperators(e).pipe(M(this._unsubscribeAll)).subscribe({next:a=>{this.operators=a.data?.data||[],this.totalItems=a.data?.total||0,this.loading=!1},error:a=>{console.error("Error loading operators:",a),this.loading=!1}})}getAssignmentsCount(e){if(!e.operator_assignments||e.operator_assignments.length===0)return 0;let a=new Set;return e.operator_assignments.forEach(t=>{t.sector&&t.sector.id&&a.add(t.sector.id)}),a.size}getAssignments(e){if(!e.operator_assignments||e.operator_assignments.length===0)return[];let a=[],t=new Set;return e.operator_assignments.forEach(s=>{s.sector&&s.sector.id&&!t.has(s.sector.id)&&(a.push({type:"Sector",name:s.sector.name,id:s.sector.id}),t.add(s.sector.id))}),a}getStatusColor(e){return this.getAssignmentsCount(e)>0?"assigned":"unassigned"}getStatusText(e){return this.getAssignmentsCount(e)>0?"Asignado":"Sin asignar"}createOperator(){this.dialog.open(ue,{width:"600px",data:{isEdit:!1}}).afterClosed().subscribe(a=>{a&&this.loadOperators()})}editOperator(e){this.dialog.open(ue,{width:"600px",data:{isEdit:!0,operator:e}}).afterClosed().subscribe(t=>{t&&this.loadOperators()})}deleteOperator(e){confirm(`\xBFEst\xE1 seguro de eliminar al operador ${e.name}?`)&&this.operatorService.deleteOperator(e.id).subscribe({next:()=>{this.snackBar.open("Operador eliminado correctamente","Cerrar",{duration:3e3}),this.loadOperators()},error:a=>{this.snackBar.open("Error al eliminar operador","Cerrar",{duration:3e3})}})}getAssignedCount(){return this.operators.filter(e=>this.getAssignmentsCount(e)>0).length}getUnassignedCount(){return this.operators.filter(e=>this.getAssignmentsCount(e)===0).length}viewOperator(e){let a=[{label:"Nombre",key:"name",icon:"person",type:"text"},{label:"RUT",key:"rut",icon:"badge",type:"text"},{label:"Email",key:"email",icon:"email",type:"text"},{label:"Tel\xE9fono",key:"phone",icon:"phone",type:"text"},{label:"Estado",key:"status",icon:"toggle_on",type:"badge",badgeColor:s=>s==="ACTIVE"?"success":"error"},{label:"Asignaciones",key:"operator_assignments",icon:"location_on",type:"array",format:s=>!s||s.length===0?["Sin asignaciones"]:s.map(p=>`${p.sector?.name||"Sector"}${p.street?.name?" - "+p.street.name:""}`)},{label:"Fecha de Creaci\xF3n",key:"created_at",icon:"schedule",type:"date"}],t=this.dialog.open(gt,{width:"600px",data:{title:"Detalles del Operador",data:e,fields:a,actions:[{label:"Editar",icon:"edit",color:"primary",action:()=>{t.close(),this.editOperator(e)}},{label:"Asignar",icon:"location_on",color:"accent",action:()=>{t.close(),this.assignOperator(e)}}]}})}removeAllAssignments(e){confirm(`\xBFEst\xE1 seguro de eliminar todas las asignaciones del operador ${e.name}?`)&&this.operatorService.removeAllAssignments(e.id).subscribe({next:a=>{this.snackBar.open(a.message||"Asignaciones eliminadas correctamente","Cerrar",{duration:3e3}),this.loadOperators()},error:a=>{this.snackBar.open("Error al eliminar asignaciones","Cerrar",{duration:3e3})}})}assignOperator(e){this.dialog.open(ge,{width:"600px",data:{operator:e}}).afterClosed().subscribe(t=>{t&&this.loadOperators()})}applyFilters(){this.currentPage=0,this.loadOperators()}clearFilters(){this.filters={name:"",status:"",sector:""},this.currentPage=0,this.loadOperators()}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadOperators()}assignSector(e){this.dialog.open(ge,{width:"600px",data:{isEdit:!1,operator:e}}).afterClosed().subscribe(t=>{t&&this.loadOperators()})}static{this.\u0275fac=function(a){return new(a||i)(f(U),f(ke),f(H))}}static{this.\u0275cmp=y({type:i,selectors:[["app-operators"]],viewQuery:function(a,t){if(a&1&&be(pe,5),a&2){let s;Me(s=Ee())&&(t.sort=s.first)}},features:[ye([{provide:it,useValue:ct()}])],decls:104,vars:14,consts:[["menu","matMenu"],[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-blue-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"p-3","bg-orange-100","rounded-full"],[1,"text-orange-600"],[1,"text-2xl","font-bold","text-orange-600"],[1,"mb-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["appearance","outline"],["matInput","","placeholder","Nombre o email",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],["value","assigned"],["value","unassigned"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],[1,"overflow-x-auto"],["mat-table","","matSort","",1,"w-full",3,"dataSource","matSortActive","matSortDirection"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","name",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","rut"],["mat-header-cell","","mat-sort-header","rut",4,"matHeaderCellDef"],["matColumnDef","email"],["mat-header-cell","","mat-sort-header","email",4,"matHeaderCellDef"],["matColumnDef","phone"],["mat-header-cell","","mat-sort-header","phone",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","status",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],["mat-header-cell","","mat-sort-header","name"],["mat-cell",""],[1,"flex","items-center","gap-2"],[1,"text-gray-500"],[1,"font-semibold"],["mat-header-cell","","mat-sort-header","rut"],[1,"text-gray-600","font-mono"],["mat-header-cell","","mat-sort-header","email"],["mat-header-cell","","mat-sort-header","phone"],["mat-header-cell","","mat-sort-header","status"],["mat-header-cell",""],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","","class","text-orange-600",3,"click",4,"ngIf"],["mat-menu-item","",1,"text-red-600",3,"click"],["mat-menu-item","",1,"text-orange-600",3,"click"],["mat-header-row",""],["mat-row",""],[1,"flex","justify-center","items-center","py-8"],["diameter","40"],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"]],template:function(a,t){a&1&&(o(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),n(4,"Operadores"),r(),o(5,"p",4),n(6,"Gestiona los operadores del sistema"),r()(),o(7,"button",5),_("click",function(){return t.createOperator()}),o(8,"mat-icon"),n(9,"add"),r(),n(10," Nuevo Operador "),r()(),o(11,"div",6)(12,"mat-card")(13,"mat-card-content",7)(14,"div",8)(15,"div",9)(16,"mat-icon",10),n(17,"people"),r()(),o(18,"div",11)(19,"p",12),n(20,"Total Operadores"),r(),o(21,"p",13),n(22),r()()()()(),o(23,"mat-card")(24,"mat-card-content",7)(25,"div",8)(26,"div",14)(27,"mat-icon",15),n(28,"check_circle"),r()(),o(29,"div",11)(30,"p",12),n(31,"Asignados"),r(),o(32,"p",16),n(33),r()()()()(),o(34,"mat-card")(35,"mat-card-content",7)(36,"div",8)(37,"div",17)(38,"mat-icon",18),n(39,"warning"),r()(),o(40,"div",11)(41,"p",12),n(42,"Sin Asignar"),r(),o(43,"p",19),n(44),r()()()()()(),o(45,"mat-card",20)(46,"mat-card-content",7)(47,"div",21)(48,"mat-form-field",22)(49,"mat-label"),n(50,"Buscar operador"),r(),o(51,"input",23),Z("ngModelChange",function(p){return Y(t.filters.name,p)||(t.filters.name=p),p}),r()(),o(52,"mat-form-field",22)(53,"mat-label"),n(54,"Estado"),r(),o(55,"mat-select",24),Z("ngModelChange",function(p){return Y(t.filters.status,p)||(t.filters.status=p),p}),o(56,"mat-option",25),n(57,"Todos"),r(),o(58,"mat-option",26),n(59,"Asignado"),r(),o(60,"mat-option",27),n(61,"Sin asignar"),r()()(),o(62,"mat-form-field",22)(63,"mat-label"),n(64,"Sector"),r(),o(65,"mat-select",24),Z("ngModelChange",function(p){return Y(t.filters.sector,p)||(t.filters.sector=p),p}),o(66,"mat-option",25),n(67,"Todos los sectores"),r()()()(),o(68,"div",28)(69,"button",29),_("click",function(){return t.clearFilters()}),o(70,"mat-icon"),n(71,"clear"),r(),n(72," Limpiar "),r(),o(73,"button",5),_("click",function(){return t.applyFilters()}),o(74,"mat-icon"),n(75,"search"),r(),n(76," Filtrar "),r()()()(),o(77,"mat-card")(78,"mat-card-content",7)(79,"div",30)(80,"table",31),E(81,32),u(82,Ut,2,0,"th",33)(83,Qt,6,1,"td",34),O(),E(84,35),u(85,Kt,2,0,"th",36)(86,Xt,3,1,"td",34),O(),E(87,37),u(88,Jt,2,0,"th",38)(89,Yt,3,1,"td",34),O(),E(90,39),u(91,Zt,2,0,"th",40)(92,er,3,1,"td",34),O(),E(93,41),u(94,tr,2,0,"th",42)(95,rr,3,4,"td",34),O(),E(96,43),u(97,ir,2,0,"th",44)(98,nr,23,2,"td",34),O(),u(99,ar,1,0,"tr",45)(100,lr,1,0,"tr",46),r(),u(101,sr,2,0,"div",47)(102,mr,7,0,"div",48),r(),u(103,dr,1,5,"mat-paginator",49),r()()()),a&2&&(l(22),x(t.operators.length),l(11),x(t.getAssignedCount()),l(11),x(t.getUnassignedCount()),l(7),J("ngModel",t.filters.name),l(4),J("ngModel",t.filters.status),l(10),J("ngModel",t.filters.sector),l(15),d("dataSource",t.operators)("matSortActive",t.sortBy)("matSortDirection",t.sortOrder),l(19),d("matHeaderRowDef",t.displayedColumns),l(),d("matRowDefColumns",t.displayedColumns),l(),d("ngIf",t.loading),l(),d("ngIf",!t.loading&&t.operators.length===0),l(),d("ngIf",t.totalItems>0))},dependencies:[k,w,ze,R,j,Re,rt,We,Qe,Ye,Ke,Ue,Ze,Xe,Je,et,tt,pt,mt,dt,B,P,oe,N,V,$,L,ut,D,A,T,q,z,Ne,Be,Pe,Ve,st,W,G,F,nt,ot,lt,pe,at],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151}.mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}.status-assigned[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.status-unassigned[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.operators-assignments-list[_ngcontent-%COMP%]{max-height:4rem;overflow-y:auto;padding:.25rem}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:2px}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:2px}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}@media (max-width: 768px){.grid-cols-3[_ngcontent-%COMP%]{grid-template-columns:1fr}.mat-mdc-table[_ngcontent-%COMP%]{font-size:.875rem}}"]})}}return i})();export{li as OperatorsComponent};
