import{a as he}from"./chunk-HQDJMMZR.js";import{a as pe,b as ue,c as ge}from"./chunk-6Z4HXFAI.js";import{a as fe,b as _e,c as Ee,d as xe,e as Se,f as be}from"./chunk-NB6DWIHZ.js";import{d as de}from"./chunk-F3RZXQG2.js";import{a as se,b as ce}from"./chunk-VH6ICZSD.js";import{a as ie,b as ae}from"./chunk-BFKOMUGM.js";import{a as ne,b as oe}from"./chunk-QYKB6O4W.js";import"./chunk-JQ7ZGKDS.js";import{a as f}from"./chunk-VKB6BRO6.js";import{a as me,b as le}from"./chunk-M6EHWIYJ.js";import{b as H,c as j}from"./chunk-7EGXZGVT.js";import{d as te,e as re}from"./chunk-7QQT45KE.js";import{b as B,c as L,d as V,j as U,k as A}from"./chunk-DO3SX6N4.js";import{b as R,d,f as $,g as Z,k as J,l as K,n as Q,o as W,s as X,v as Y,y as ee}from"./chunk-EGGCURRC.js";import{W as G,fa as w,la as O,oa as z}from"./chunk-AHUY5V3P.js";import"./chunk-CQGOYTFO.js";import{d as D}from"./chunk-7OGW3PNS.js";import{m as P,s as N}from"./chunk-TQARHOKX.js";import{$b as E,Eb as m,Pb as r,Qb as e,Rb as p,bb as o,cb as g,mc as t,pb as k,wb as c}from"./chunk-BSJZAB7M.js";import{a as _,d as q}from"./chunk-TSRGIXR5.js";function ve(a,s){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ce(a,s){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Me(a,s){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function ye(a,s){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Fe(a,s){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ie(a,s){a&1&&(r(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Te(a,s){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function qe(a,s){a&1&&(r(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function ke(a,s){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Pe(a,s){a&1&&(r(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Ne(a,s){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function De(a,s){a&1&&(r(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}var ct=(()=>{class a{constructor(i,l,n,u){this.fb=i,this.pricingProfileService=l,this.http=n,this.snackBar=u,this.loading=!1,this.generalForm=this.fb.group({name:["STPark - Sistema de Estacionamientos",[d.required]],currency:["CLP",[d.required]],timezone:["America/Santiago",[d.required]],language:["es",[d.required]],pos_tuu:[{value:!1,disabled:!0}],max_capacity:[0,[d.required,d.min(0)]]}),this.pricingForm=this.fb.group({price_per_min:[0,[d.required,d.min(0)]],min_amount:[0,[d.required,d.min(0)]],daily_max_amount:[0,[d.required,d.min(0)]],start_time:["00:00",d.required],end_time:["23:59",d.required],is_active:[!0]})}ngOnInit(){this.loadGeneralSettings(),this.loadDefaultPricing()}loadGeneralSettings(){this.loading=!0,this.http.get(`${f.apiUrl}/settings/general`).subscribe({next:i=>{if(i&&i.success&&i.data){console.log("Configuraci\xF3n general cargada:",i.data);let l=this.generalForm.getRawValue();this.generalForm.patchValue(_(_({},l),i.data))}else console.warn("La respuesta no tiene el formato esperado:",i);this.loading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n general:",i),console.log("No hay configuraci\xF3n general previa, usando valores por defecto"),this.loading=!1}})}loadDefaultPricing(){this.loading=!0,this.http.get(`${f.apiUrl}/settings/default-pricing`).subscribe({next:i=>{i&&i.success&&i.data?(console.log("Configuraci\xF3n de precios cargada:",i.data),this.pricingForm.patchValue(i.data)):console.warn("La respuesta no tiene el formato esperado:",i),this.loading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n de precios:",i),console.log("No hay configuraci\xF3n previa, usando valores por defecto"),this.loading=!1}})}saveSettings(){let i=this.getActiveTab();i==="general"?this.saveGeneralSettings():i==="pricing"&&this.savePricingSettings()}getActiveTab(){let i=document.querySelector("mat-tab-group");if(i){let l=i.querySelector(".mat-mdc-tab-active");if(l){let n=l.querySelector(".mdc-tab__text-label");if(n?.textContent?.toLowerCase().includes("general"))return"general";if(n?.textContent?.toLowerCase().includes("precios"))return"pricing"}}return"general"}saveGeneralSettings(){if(this.generalForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let n=this.generalForm.getRawValue(),{pos_tuu:i}=n,l=q(n,["pos_tuu"]);this.http.post(`${f.apiUrl}/settings/general`,l).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n general guardada exitosamente","Cerrar",{duration:3e3}),this.loading=!1},error:u=>{console.error("Error al guardar configuraci\xF3n general:",u),this.snackBar.open("Error al guardar la configuraci\xF3n general","Cerrar",{duration:3e3}),this.loading=!1}})}savePricingSettings(){if(this.pricingForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let i=this.pricingForm.value;this.http.post(`${f.apiUrl}/settings/default-pricing`,i).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n de precios guardada exitosamente","Cerrar",{duration:3e3}),this.loading=!1},error:l=>{console.error("Error al guardar configuraci\xF3n de precios:",l),this.snackBar.open("Error al guardar la configuraci\xF3n de precios","Cerrar",{duration:3e3}),this.loading=!1}})}resetSettings(){this.generalForm.reset({name:"STPark - Sistema de Estacionamientos",currency:"CLP",timezone:"America/Santiago",language:"es",pos_tuu:!1,max_capacity:0}),this.pricingForm.reset({price_per_min:0,min_amount:0,daily_max_amount:0,start_time:"00:00",end_time:"23:59",is_active:!0}),this.snackBar.open("Valores restaurados","Cerrar",{duration:2e3})}static{this.\u0275fac=function(l){return new(l||a)(g(Y),g(he),g(D),g(ne))}}static{this.\u0275cmp=k({type:a,selectors:[["app-settings"]],decls:140,vars:16,consts:[[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"flex","gap-2"],["mat-stroked-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"w-full"],["label","General"],[1,"p-6"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Nombre del sistema"],[4,"ngIf"],["formControlName","currency"],["value","CLP"],["value","USD"],["formControlName","timezone"],["value","America/Santiago"],["value","UTC"],["formControlName","language"],["value","es"],["value","en"],["matInput","","type","number","formControlName","max_capacity","placeholder","0","min","0"],["formControlName","pos_tuu","disabled",""],[3,"value"],[2,"display","inline-flex","align-items","center","gap","4px"],[2,"font-size","16px","width","16px","height","16px"],["label","Precios"],[1,"space-y-4"],[1,"bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-800","rounded-lg","p-4"],[1,"flex","items-start","gap-3"],[1,"text-blue-600","dark:text-blue-400"],[1,"text-sm","text-blue-800","dark:text-blue-200"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["matInput","","type","number","formControlName","price_per_min","placeholder","0","min","0"],["matInput","","type","number","formControlName","min_amount","placeholder","0","min","0"],["matInput","","type","number","formControlName","daily_max_amount","placeholder","0","min","0"],[1,"my-6"],[1,"text-lg","font-semibold","mb-4"],["matInput","","type","time","formControlName","start_time"],["matInput","","type","time","formControlName","end_time"],[1,"flex","items-center","gap-2","mb-4"],["formControlName","is_active"]],template:function(l,n){if(l&1&&(r(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),t(4,"Configuraci\xF3n"),e(),r(5,"p",3),t(6,"Configura los par\xE1metros del sistema de estacionamientos"),e()(),r(7,"div",4)(8,"button",5),E("click",function(){return n.resetSettings()}),r(9,"mat-icon"),t(10,"refresh"),e(),t(11," Restaurar "),e(),r(12,"button",6),E("click",function(){return n.saveSettings()}),r(13,"mat-icon"),t(14,"save"),e(),t(15," Guardar "),e()()(),r(16,"mat-tab-group",7)(17,"mat-tab",8)(18,"div",9)(19,"mat-card")(20,"mat-card-header")(21,"mat-card-title"),t(22,"Configuraci\xF3n General"),e(),r(23,"mat-card-subtitle"),t(24,"Par\xE1metros b\xE1sicos del sistema"),e()(),r(25,"mat-card-content")(26,"form",10)(27,"div",11)(28,"mat-form-field",12)(29,"mat-label"),t(30,"Nombre del sistema"),e(),p(31,"input",13),c(32,ve,2,0,"mat-error",14),e(),r(33,"mat-form-field",12)(34,"mat-label"),t(35,"Moneda"),e(),r(36,"mat-select",15)(37,"mat-option",16),t(38,"Peso Chileno (CLP)"),e(),r(39,"mat-option",17),t(40,"D\xF3lar Americano (USD)"),e()(),c(41,Ce,2,0,"mat-error",14),e(),r(42,"mat-form-field",12)(43,"mat-label"),t(44,"Zona horaria"),e(),r(45,"mat-select",18)(46,"mat-option",19),t(47,"Santiago (GMT-3)"),e(),r(48,"mat-option",20),t(49,"UTC (GMT+0)"),e()(),c(50,Me,2,0,"mat-error",14),e(),r(51,"mat-form-field",12)(52,"mat-label"),t(53,"Idioma"),e(),r(54,"mat-select",21)(55,"mat-option",22),t(56,"Espa\xF1ol"),e(),r(57,"mat-option",23),t(58,"English"),e()(),c(59,ye,2,0,"mat-error",14),e(),r(60,"mat-form-field",12)(61,"mat-label"),t(62,"M\xE1xima Capacidad"),e(),p(63,"input",24),r(64,"mat-hint"),t(65,"Cantidad m\xE1xima de veh\xEDculos que pueden estar en el estacionamiento simult\xE1neamente"),e(),c(66,Fe,2,0,"mat-error",14)(67,Ie,2,0,"mat-error",14),e(),r(68,"mat-form-field",12)(69,"mat-label"),t(70,"POS TUU"),e(),r(71,"mat-select",25)(72,"mat-option",26),t(73,"Activado"),e(),r(74,"mat-option",26),t(75,"Desactivado"),e()(),r(76,"mat-hint")(77,"span",27)(78,"mat-icon",28),t(79,"lock"),e(),t(80," Solo lectura - Solo administradores pueden modificar este valor "),e()()()()()()()()(),r(81,"mat-tab",29)(82,"div",9)(83,"mat-card")(84,"mat-card-header")(85,"mat-card-title"),t(86,"Configuraci\xF3n de Precios por Defecto"),e(),r(87,"mat-card-subtitle"),t(88,"Establece las tarifas por defecto del sistema"),e()(),r(89,"mat-card-content")(90,"div",30)(91,"div",31)(92,"div",32)(93,"mat-icon",33),t(94,"info"),e(),r(95,"div",34)(96,"strong"),t(97,"Nota:"),e(),t(98," Estos precios se utilizar\xE1n como regla de precio por defecto si no existen otras reglas espec\xEDficas para el sector. "),e()()(),r(99,"form",10)(100,"div",35)(101,"mat-form-field",12)(102,"mat-label"),t(103,"Costo por Minuto (CLP)"),e(),p(104,"input",36),r(105,"mat-hint"),t(106,"Precio por cada minuto de estacionamiento"),e(),c(107,Te,2,0,"mat-error",14)(108,qe,2,0,"mat-error",14),e(),r(109,"mat-form-field",12)(110,"mat-label"),t(111,"Tarifa M\xEDnima (CLP)"),e(),p(112,"input",37),r(113,"mat-hint"),t(114,"Cantidad m\xEDnima a cobrar"),e(),c(115,ke,2,0,"mat-error",14)(116,Pe,2,0,"mat-error",14),e(),r(117,"mat-form-field",12)(118,"mat-label"),t(119,"Tarifa M\xE1xima (CLP)"),e(),p(120,"input",38),r(121,"mat-hint"),t(122,"L\xEDmite m\xE1ximo a cobrar por d\xEDa"),e(),c(123,Ne,2,0,"mat-error",14)(124,De,2,0,"mat-error",14),e()(),p(125,"mat-divider",39),r(126,"h3",40),t(127,"Configuraci\xF3n de Horarios"),e(),r(128,"div",11)(129,"mat-form-field",12)(130,"mat-label"),t(131,"Hora de Inicio"),e(),p(132,"input",41),e(),r(133,"mat-form-field",12)(134,"mat-label"),t(135,"Hora de Fin"),e(),p(136,"input",42),e()(),r(137,"div",43)(138,"mat-checkbox",44),t(139,"Regla activa"),e()()()()()()()()()()),l&2){let u,x,S,b,h,v,C,M,y,F,I,T;o(26),m("formGroup",n.generalForm),o(6),m("ngIf",(u=n.generalForm.get("name"))==null?null:u.hasError("required")),o(9),m("ngIf",(x=n.generalForm.get("currency"))==null?null:x.hasError("required")),o(9),m("ngIf",(S=n.generalForm.get("timezone"))==null?null:S.hasError("required")),o(9),m("ngIf",(b=n.generalForm.get("language"))==null?null:b.hasError("required")),o(7),m("ngIf",(h=n.generalForm.get("max_capacity"))==null?null:h.hasError("required")),o(),m("ngIf",(v=n.generalForm.get("max_capacity"))==null?null:v.hasError("min")),o(5),m("value",!0),o(2),m("value",!1),o(25),m("formGroup",n.pricingForm),o(8),m("ngIf",(C=n.pricingForm.get("price_per_min"))==null?null:C.hasError("required")),o(),m("ngIf",(M=n.pricingForm.get("price_per_min"))==null?null:M.hasError("min")),o(7),m("ngIf",(y=n.pricingForm.get("min_amount"))==null?null:y.hasError("required")),o(),m("ngIf",(F=n.pricingForm.get("min_amount"))==null?null:F.hasError("min")),o(7),m("ngIf",(I=n.pricingForm.get("daily_max_amount"))==null?null:I.hasError("required")),o(),m("ngIf",(T=n.pricingForm.get("daily_max_amount"))==null?null:T.hasError("min"))}},dependencies:[N,P,ee,J,R,K,$,Z,X,Q,W,be,fe,Ee,Se,xe,_e,z,O,j,H,ge,pe,ue,A,U,B,V,L,re,te,ce,se,w,le,me,ae,ie,G,de,oe],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-tab-group[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.config-item[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:8px;padding:1rem;transition:all .2s ease}.config-item[_ngcontent-%COMP%]:hover{border-color:#3b82f6;box-shadow:0 2px 4px #0000001a}@media (max-width: 768px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return a})();export{ct as SettingsComponent};
