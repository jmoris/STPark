import{a as rt}from"./chunk-6KBHBSH5.js";import{c as ot}from"./chunk-ZMAIZYCZ.js";import{a as G,b as J,c as K,d as Q,e as X,f as Z,g as tt,h as et,i as it,j as nt,k as at}from"./chunk-A3W56N53.js";import{a as W,b as V,c as Y,e as q,f as z}from"./chunk-CFZHHQ3I.js";import{a as $,b as U}from"./chunk-FGUURFJS.js";import"./chunk-EOYQYJ3N.js";import{a as B}from"./chunk-FWGAGG6F.js";import"./chunk-VKB6BRO6.js";import{b as j,c as N}from"./chunk-72F6PA3H.js";import"./chunk-EO526QJS.js";import{a as H,b as F}from"./chunk-6JXRNXI3.js";import"./chunk-XMMUWBM2.js";import{la as P,na as O,oa as L}from"./chunk-56JILNRZ.js";import"./chunk-TTG7A5I5.js";import{b as R,d as k}from"./chunk-P2DCSIJY.js";import"./chunk-FDUGCV2L.js";import{m as T,t as A}from"./chunk-IZAOXH6X.js";import{$b as E,Eb as d,Gb as u,Pb as i,Qb as e,Rb as v,Sb as g,Tb as b,U as h,Vb as M,bb as o,bc as m,cb as x,f as y,mc as n,nc as s,oa as I,oc as _,pa as D,pb as w,pc as C,wb as f}from"./chunk-QDWFRTQW.js";import"./chunk-TSRGIXR5.js";function dt(a,l){if(a&1){let t=M();i(0,"button",8),E("click",function(){I(t);let c=m();return D(c.downloadReport("pdf"))}),i(1,"mat-icon"),n(2,"picture_as_pdf"),e(),n(3," Descargar PDF "),e()}}function st(a,l){a&1&&(i(0,"div",9),v(1,"mat-spinner",10),e())}function ct(a,l){if(a&1&&(i(0,"mat-card",13)(1,"mat-card-content",14)(2,"div",15)(3,"div",31)(4,"mat-icon",32),n(5,"account_balance_wallet"),e()(),i(6,"div",17)(7,"p",18),n(8,"Efectivo Esperado"),e(),i(9,"p",33),n(10),e()()()()()),a&2){let t=m(2);o(10),s(t.formatAmount(t.totals.cash_expected))}}function mt(a,l){if(a&1&&(i(0,"mat-card",13)(1,"mat-card-content",14)(2,"div",15)(3,"div",34)(4,"mat-icon",35),n(5,"payments"),e()(),i(6,"div",17)(7,"p",18),n(8,"Efectivo Cobrado"),e(),i(9,"p",36),n(10),e()()()()()),a&2){let t=m(2);o(10),s(t.formatAmount(t.totals.cash_collected))}}function ft(a,l){if(a&1&&(i(0,"mat-card",13)(1,"mat-card-content",14)(2,"div",15)(3,"div",16)(4,"mat-icon"),n(5),e()(),i(6,"div",17)(7,"p",18),n(8,"Diferencia"),e(),i(9,"p",37),n(10),e()()()()()),a&2){let t=m(2);o(3),u("bg-red-100",t.shift.cash_over_short<0)("bg-green-100",t.shift.cash_over_short>0),o(),u("text-red-600",t.shift.cash_over_short<0)("text-green-600",t.shift.cash_over_short>0),o(),_(" ",t.shift.cash_over_short<0?"trending_down":"trending_up"," "),o(4),u("text-red-600",t.shift.cash_over_short<0)("text-green-600",t.shift.cash_over_short>0),o(),_(" ",t.formatAmount(t.shift.cash_over_short)," ")}}function pt(a,l){if(a&1&&(i(0,"div",38)(1,"span",26),n(2,"Cierre"),e(),i(3,"span",29),n(4),e()()),a&2){let t=m(2);o(4),s(t.formatDate(t.shift.closed_at))}}function _t(a,l){if(a&1&&(i(0,"div",25)(1,"span",26),n(2,"Retiros"),e(),i(3,"span",43),n(4),e()()),a&2){let t=m(3);o(4),_("-",t.formatAmount(t.totals.cash_withdrawals),"")}}function ut(a,l){if(a&1&&(i(0,"div",25)(1,"span",26),n(2,"Dep\xF3sitos"),e(),i(3,"span",39),n(4),e()()),a&2){let t=m(3);o(4),_("+",t.formatAmount(t.totals.cash_deposits),"")}}function ht(a,l){if(a&1&&(i(0,"div",38)(1,"span",26),n(2,"Efectivo Declarado"),e(),i(3,"span",28),n(4),e()()),a&2){let t=m(3);o(4),s(t.formatAmount(t.totals.cash_declared))}}function xt(a,l){if(a&1&&(i(0,"mat-card",13)(1,"mat-card-header",22)(2,"mat-card-title",23)(3,"mat-icon"),n(4,"account_balance"),e(),n(5," Flujo de Efectivo "),e()(),i(6,"mat-card-content")(7,"div",24)(8,"div",25)(9,"span",26),n(10,"Fondo Inicial"),e(),i(11,"span",28),n(12),e()(),i(13,"div",25)(14,"span",26),n(15,"Efectivo Cobrado"),e(),i(16,"span",39),n(17),e()(),f(18,_t,5,1,"div",40)(19,ut,5,1,"div",40),i(20,"div",41)(21,"span",42),n(22,"Efectivo Esperado"),e(),i(23,"span",33),n(24),e()(),f(25,ht,5,1,"div",30),e()()()),a&2){let t=m(2);o(12),s(t.formatAmount(t.totals.opening_float)),o(5),_("+",t.formatAmount(t.totals.cash_collected),""),o(),d("ngIf",t.totals.cash_withdrawals>0),o(),d("ngIf",t.totals.cash_deposits>0),o(5),s(t.formatAmount(t.totals.cash_expected)),o(),d("ngIf",t.totals.cash_declared!==null&&t.totals.cash_declared!==void 0)}}function vt(a,l){if(a&1&&(i(0,"div",38)(1,"div",45)(2,"mat-icon",64),n(3,"local_car_wash"),e(),i(4,"span",47),n(5,"Lavados de Autos"),e()(),i(6,"div",48)(7,"span",49),n(8),e(),i(9,"div",50),n(10),e()()()),a&2){let t=m(3);o(8),s(t.formatAmount(t.totals.car_washes_total)),o(2),C("",t.totals.car_washes_count||0," ",t.totals.car_washes_count===1?"lavado":"lavados","")}}function gt(a,l){a&1&&(i(0,"th",65),n(1,"M\xE9todo de Pago"),e())}function bt(a,l){if(a&1&&(i(0,"td",66)(1,"div",23)(2,"mat-icon",67),n(3),e(),i(4,"span",68),n(5),e()()()),a&2){let t=l.$implicit,r=m(3);o(3),s(r.getMethodIcon(t.method)),o(2),s(r.getMethodText(t.method))}}function St(a,l){a&1&&(i(0,"th",69),n(1,"Transacciones"),e())}function Et(a,l){if(a&1&&(i(0,"td",70)(1,"span",71),n(2),e()()),a&2){let t=l.$implicit;o(2),s(t.count)}}function Ct(a,l){a&1&&(i(0,"th",69),n(1,"Monto Total"),e())}function yt(a,l){if(a&1&&(i(0,"td",70)(1,"span",72),n(2),e()()),a&2){let t=l.$implicit,r=m(3);o(2),s(r.formatAmount(t.collected))}}function It(a,l){a&1&&v(0,"tr",73)}function Dt(a,l){a&1&&v(0,"tr",74)}function wt(a,l){if(a&1&&(i(0,"mat-card",13)(1,"mat-card-header",22)(2,"mat-card-title",23)(3,"mat-icon"),n(4,"receipt_long"),e(),n(5," Ventas y Pagos por M\xE9todo "),e()(),i(6,"mat-card-content")(7,"div",44)(8,"div",38)(9,"div",45)(10,"mat-icon",46),n(11,"local_parking"),e(),i(12,"span",47),n(13,"Estacionamiento"),e()(),i(14,"div",48)(15,"span",49),n(16),e(),i(17,"div",50),n(18),e()()(),f(19,vt,11,3,"div",30),i(20,"div",51)(21,"span",28),n(22,"Total Ventas:"),e(),i(23,"span",52),n(24),e()()(),i(25,"div",53)(26,"table",54),g(27,55),f(28,gt,2,0,"th",56)(29,bt,6,2,"td",57),b(),g(30,58),f(31,St,2,0,"th",59)(32,Et,3,1,"td",60),b(),g(33,61),f(34,Ct,2,0,"th",59)(35,yt,3,1,"td",60),b(),f(36,It,1,0,"tr",62)(37,Dt,1,0,"tr",63),e()()()()),a&2){let t=m(2);o(16),s(t.formatAmount(t.totals.parking_sales_total||0)),o(2),C("",t.totals.tickets_count||0," ",t.totals.tickets_count===1?"ticket":"tickets",""),o(),d("ngIf",t.carWashEnabled&&t.totals.car_washes_total!==void 0&&t.totals.car_washes_total>0),o(5),s(t.formatAmount(t.totals.sales_total)),o(2),d("dataSource",t.totals.payments_by_method),o(10),d("matHeaderRowDef",t.displayedColumns),o(),d("matRowDefColumns",t.displayedColumns)}}function Mt(a,l){if(a&1&&(i(0,"div",11)(1,"div",12)(2,"mat-card",13)(3,"mat-card-content",14)(4,"div",15)(5,"div",16)(6,"mat-icon"),n(7),e()(),i(8,"div",17)(9,"p",18),n(10,"Estado"),e(),i(11,"p",19),n(12),e()()()()(),f(13,ct,11,1,"mat-card",20)(14,mt,11,1,"mat-card",20)(15,ft,11,14,"mat-card",20),e(),i(16,"div",21)(17,"mat-card",13)(18,"mat-card-header",22)(19,"mat-card-title",23)(20,"mat-icon"),n(21,"info"),e(),n(22," Informaci\xF3n del Turno "),e()(),i(23,"mat-card-content")(24,"div",24)(25,"div",25)(26,"span",26),n(27,"Turno ID"),e(),i(28,"span",27),n(29),e()(),i(30,"div",25)(31,"span",26),n(32,"Operador"),e(),i(33,"span",28),n(34),e()(),i(35,"div",25)(36,"span",26),n(37,"Sector"),e(),i(38,"span",28),n(39),e()(),i(40,"div",25)(41,"span",26),n(42,"Apertura"),e(),i(43,"span",29),n(44),e()(),f(45,pt,5,1,"div",30),e()()(),f(46,xt,26,6,"mat-card",20),e(),f(47,wt,38,8,"mat-card",20),e()),a&2){let t=m();o(5),u("bg-green-100",t.shift.status==="OPEN")("bg-blue-100",t.shift.status==="CLOSED")("bg-red-100",t.shift.status==="CANCELED"),o(),u("text-green-600",t.shift.status==="OPEN")("text-blue-600",t.shift.status==="CLOSED")("text-red-600",t.shift.status==="CANCELED"),o(),_(" ",t.shift.status==="OPEN"?"stopwatch":t.shift.status==="CLOSED"?"check_circle":"cancel"," "),o(4),u("text-green-600",t.shift.status==="OPEN")("text-blue-600",t.shift.status==="CLOSED")("text-red-600",t.shift.status==="CANCELED"),o(),_(" ",t.shift.status==="OPEN"?"Abierto":t.shift.status==="CLOSED"?"Cerrado":"Cancelado"," "),o(),d("ngIf",t.totals),o(),d("ngIf",t.totals),o(),d("ngIf",t.shift.cash_over_short!==null&&t.shift.cash_over_short!==void 0),o(14),_("#",t.shift.id.substring(0,8),""),o(5),s((t.shift.operator==null?null:t.shift.operator.name)||"N/A"),o(5),s((t.shift.sector==null?null:t.shift.sector.name)||"N/A"),o(5),s(t.formatDate(t.shift.opened_at)),o(),d("ngIf",t.shift.closed_at),o(),d("ngIf",t.totals),o(),d("ngIf",t.totals&&t.totals.payments_by_method&&t.totals.payments_by_method.length>0)}}var Jt=(()=>{class a{constructor(t,r,c,p,S){this.route=t,this.router=r,this.shiftService=c,this.snackBar=p,this.configService=S,this._unsubscribeAll=new y,this.shift=null,this.totals=null,this.report=null,this.loading=!1,this.shiftId="",this.carWashEnabled=!1,this.displayedColumns=["method","collected","count"]}ngOnInit(){this.shiftId=this.route.snapshot.paramMap.get("id")||"",this.loadConfig(),this.shiftId&&this.loadShift()}loadConfig(){this.configService.systemConfig$.pipe(h(this._unsubscribeAll)).subscribe(t=>{this.carWashEnabled=t?.car_wash_enabled===!0}),this.configService.loadConfig()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadShift(){this.loading=!0,this.shiftService.getShift(this.shiftId).pipe(h(this._unsubscribeAll)).subscribe({next:t=>{t.success&&t.data&&(this.shift=t.data.shift,this.totals=t.data.totals,this.loadReport()),this.loading=!1},error:t=>{console.error("Error loading shift:",t),this.loading=!1}})}loadReport(){this.shiftService.getShiftReport(this.shiftId).pipe(h(this._unsubscribeAll)).subscribe({next:t=>{t.success&&t.data&&(this.report=t.data)},error:t=>console.error("Error loading report:",t)})}formatAmount(t){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP"}).format(t)}formatDate(t){if(!t)return"-";let r=new Date(t);if(isNaN(r.getTime()))return"-";let c=r.toLocaleDateString("es-CL",{day:"2-digit",month:"2-digit",year:"numeric"}),p=r.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${c} ${p}`}getMethodIcon(t){switch(t){case"CASH":return"payments";case"CARD":return"credit_card";case"WEBPAY":return"account_balance";case"TRANSFER":return"account_balance_wallet";default:return"payment"}}getMethodText(t){switch(t){case"CASH":return"Efectivo";case"CARD":return"Tarjeta";case"WEBPAY":return"Webpay";case"TRANSFER":return"Transferencia";default:return t}}goBack(){this.router.navigate(["/parking/shifts"])}downloadReport(t="pdf"){t==="pdf"?this.shiftService.downloadShiftReportPdf(this.shiftId).pipe(h(this._unsubscribeAll)).subscribe({next:r=>{let c=window.URL.createObjectURL(r),p=document.createElement("a");p.href=c;let S=this.shiftId.substring(0,8),lt=new Date().toISOString().split("T")[0];p.download=`reporte-turno-${S}-${lt}.pdf`,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(c),this.snackBar.open("Reporte descargado exitosamente","Cerrar",{duration:3e3})},error:r=>{console.error("Error downloading report:",r),this.snackBar.open("Error al descargar el reporte","Cerrar",{duration:3e3})}}):this.shiftService.getShiftReport(this.shiftId,t).pipe(h(this._unsubscribeAll)).subscribe({next:r=>{r.success&&console.log("Report:",r.data)},error:r=>{console.error("Error downloading report:",r),this.snackBar.open("Error al obtener el reporte","Cerrar",{duration:3e3})}})}static{this.\u0275fac=function(r){return new(r||a)(x(R),x(k),x(rt),x($),x(B))}}static{this.\u0275cmp=w({type:a,selectors:[["app-shift-detail"]],decls:11,vars:3,consts:[[1,"p-6","w-full"],[1,"flex","items-center","gap-4","mb-6"],["mat-icon-button","",1,"rounded-sm",3,"click"],[1,"text-2xl","font-bold","text-gray-900"],[1,"flex-1"],["mat-raised-button","","color","primary","class","rounded-sm",3,"click",4,"ngIf"],["class","flex justify-center items-center h-64",4,"ngIf"],["class","space-y-6",4,"ngIf"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"flex","justify-center","items-center","h-64"],["diameter","50"],[1,"space-y-6"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6"],[1,"rounded-lg"],[1,"p-6"],[1,"flex","items-center","mb-2"],[1,"p-3","rounded-full"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-lg","font-bold"],["class","rounded-lg",4,"ngIf"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"pb-4"],[1,"flex","items-center","gap-2"],[1,"space-y-4"],[1,"flex","items-center","justify-between","py-2","border-b","border-gray-100"],[1,"text-gray-600","font-medium"],[1,"font-mono","text-sm","font-semibold"],[1,"font-semibold","text-gray-900"],[1,"text-sm"],["class","flex items-center justify-between py-2",4,"ngIf"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"text-xl","font-bold","text-blue-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-xl","font-bold","text-green-600"],[1,"text-xl","font-bold"],[1,"flex","items-center","justify-between","py-2"],[1,"font-semibold","text-green-600"],["class","flex items-center justify-between py-2 border-b border-gray-100",4,"ngIf"],[1,"flex","items-center","justify-between","py-3","border-t-2","border-blue-200","bg-blue-50","px-2","-mx-2","rounded"],[1,"font-semibold","text-blue-900"],[1,"font-semibold","text-red-600"],[1,"mb-6","space-y-3","pb-4","border-b","border-gray-200"],[1,"flex","items-center","gap-3"],[1,"text-blue-600","text-lg"],[1,"text-gray-700","font-medium"],[1,"text-right"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","justify-between","py-2","pt-3","border-t","border-gray-200"],[1,"text-xl","font-bold","text-gray-900"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","method"],["mat-header-cell","","class","font-semibold",4,"matHeaderCellDef"],["mat-cell","","class","py-4",4,"matCellDef"],["matColumnDef","count"],["mat-header-cell","","class","font-semibold text-right",4,"matHeaderCellDef"],["mat-cell","","class","text-right",4,"matCellDef"],["matColumnDef","collected"],["mat-header-row","","class","border-b-2 border-gray-200",4,"matHeaderRowDef"],["mat-row","","class","border-b border-gray-100",4,"matRowDef","matRowDefColumns"],[1,"text-green-600","text-lg"],["mat-header-cell","",1,"font-semibold"],["mat-cell","",1,"py-4"],[1,"text-gray-400","text-sm"],[1,"font-medium"],["mat-header-cell","",1,"font-semibold","text-right"],["mat-cell","",1,"text-right"],[1,"font-semibold"],[1,"font-bold","text-gray-900"],["mat-header-row","",1,"border-b-2","border-gray-200"],["mat-row","",1,"border-b","border-gray-100"]],template:function(r,c){r&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),E("click",function(){return c.goBack()}),i(3,"mat-icon"),n(4,"arrow_back"),e()(),i(5,"h1",3),n(6,"Detalle de Turno"),e(),v(7,"span",4),f(8,dt,4,0,"button",5),e(),f(9,st,2,0,"div",6)(10,Mt,48,30,"div",7),e()),r&2&&(o(8),d("ngIf",(c.shift==null?null:c.shift.status)==="CLOSED"),o(),d("ngIf",c.loading),o(),d("ngIf",!c.loading&&c.shift))},dependencies:[A,T,z,W,Y,q,V,L,P,O,N,j,F,H,ot,at,G,K,tt,Q,J,et,X,Z,it,nt,U],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f;border-radius:8px}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151}.mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}@media (max-width: 768px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}"]})}}return a})();export{Jt as ShiftDetailComponent};
