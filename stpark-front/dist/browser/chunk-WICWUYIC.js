import{_ as d,c as a}from"./chunk-MLNNMN4J.js";import{g as i}from"./chunk-TSRGIXR5.js";var f=(()=>{class s{constructor(){}printEntryTicket(e){return new a(t=>{this.isMobileApp()?this.printEntryTicketMobile(e).then(r=>t.next(r)).catch(r=>t.next({success:!1,message:"Error al imprimir: "+r.message,printed:!1})):t.next({success:!0,message:"Ticket de entrada generado (modo web)",printed:!1})})}printExitTicket(e,t,r){return new a(n=>{this.isMobileApp()?this.printExitTicketMobile(e,t,r).then(c=>n.next(c)).catch(c=>n.next({success:!1,message:"Error al imprimir: "+c.message,printed:!1})):n.next({success:!0,message:"Ticket de salida generado (modo web)",printed:!1})})}printPaymentReceipt(e,t){return new a(r=>{this.isMobileApp()?this.printPaymentReceiptMobile(e,t).then(n=>r.next(n)).catch(n=>r.next({success:!1,message:"Error al imprimir: "+n.message,printed:!1})):r.next({success:!0,message:"Recibo de pago generado (modo web)",printed:!1})})}checkPrinterStatus(){return new a(e=>{this.isMobileApp()?this.checkPrinterStatusMobile().then(t=>e.next(t)).catch(t=>e.next({connected:!1,device_name:void 0})):e.next({connected:!1,device_name:void 0})})}connectPrinter(){return new a(e=>{this.isMobileApp()?this.connectPrinterMobile().then(t=>e.next(t)).catch(t=>e.next({success:!1,message:"Error al conectar: "+t.message})):e.next({success:!1,message:"No disponible en modo web"})})}disconnectPrinter(){return new a(e=>{this.isMobileApp()?this.disconnectPrinterMobile().then(t=>e.next(t)).catch(t=>e.next({success:!1,message:"Error al desconectar: "+t.message})):e.next({success:!1,message:"No disponible en modo web"})})}isMobileApp(){return typeof window.ReactNativeWebView<"u"||typeof window.ReactNative<"u"||navigator.userAgent.includes("ReactNative")}printEntryTicketMobile(e){return i(this,null,function*(){try{let t=yield window.bluetoothPrinterService.printParkingTicket({plate:e.plate,sector:e.sector?.name||"N/A",street:e.street?.name||"N/A",operator:e.operator?.name||"N/A",time:this.formatDateTime(e.started_at),session_id:e.id});return{success:t,message:t?"Ticket de entrada impreso exitosamente":"Error al imprimir ticket de entrada",printed:t}}catch(t){return{success:!1,message:"Error al imprimir ticket de entrada: "+t.message,printed:!1}}})}printExitTicketMobile(e,t,r){return i(this,null,function*(){try{let n=yield window.bluetoothPrinterService.printPaymentReceipt({plate:e.plate,sector:e.sector?.name||"N/A",street:e.street?.name||"N/A",operator:e.operator?.name||"N/A",started_at:e.started_at,ended_at:e.ended_at,duration:this.calculateDuration(e.started_at,e.ended_at),total_amount:t.net_amount,payment_method:r.payment_method,amount_paid:r.amount,change:r.change||0,session_id:e.id});return{success:n,message:n?"Ticket de salida impreso exitosamente":"Error al imprimir ticket de salida",printed:n}}catch(n){return{success:!1,message:"Error al imprimir ticket de salida: "+n.message,printed:!1}}})}printPaymentReceiptMobile(e,t){return i(this,null,function*(){try{let r=yield window.bluetoothPrinterService.printPaymentReceipt({plate:e.plate,amount:t.amount,payment_method:t.payment_method,payment_date:new Date().toISOString(),session_id:e.id});return{success:r,message:r?"Recibo de pago impreso exitosamente":"Error al imprimir recibo de pago",printed:r}}catch(r){return{success:!1,message:"Error al imprimir recibo de pago: "+r.message,printed:!1}}})}checkPrinterStatusMobile(){return i(this,null,function*(){try{let e=yield window.bluetoothPrinterService.isConnected(),t=yield window.bluetoothPrinterService.getConnectedDevice();return{connected:e,device_name:t?.device_name}}catch{return{connected:!1,device_name:void 0}}})}connectPrinterMobile(){return i(this,null,function*(){try{return{success:!0,message:"Impresora conectada exitosamente"}}catch(e){return{success:!1,message:"Error al conectar impresora: "+e.message}}})}disconnectPrinterMobile(){return i(this,null,function*(){try{let e=yield window.bluetoothPrinterService.disconnect();return{success:e,message:e?"Impresora desconectada exitosamente":"Error al desconectar impresora"}}catch(e){return{success:!1,message:"Error al desconectar impresora: "+e.message}}})}calculateDuration(e,t){if(!t)return"N/A";let r=new Date(e),c=new Date(t).getTime()-r.getTime(),o=Math.floor(c/(1e3*60));if(o<60)return`${o} minutos`;{let m=Math.floor(o/60),l=o%60;return`${m}h ${l}m`}}formatAmount(e){return`$${e.toLocaleString("es-CL")}`}formatDateTime(e){return new Date(e).toLocaleString("es-CL")}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=d({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{f as a};
