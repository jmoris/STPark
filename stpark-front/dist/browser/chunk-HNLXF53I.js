import{a as Je}from"./chunk-H4P7QJPG.js";import{o as he,q as xe,u as Me,v as ve}from"./chunk-IS5LCSW4.js";import{a as Ie}from"./chunk-VLZZSPQF.js";import{a as Ne,b as We,c as $e,d as V,e as je,f as Ge,g as qe}from"./chunk-SKUWBD6D.js";import{a as Oe,b as Te,c as ke,d as Ae,e as Fe,f as Ve,g as Le,h as Re,i as ze,j as Be,k as He}from"./chunk-EYHG6JIJ.js";import{a as Ue,c as Ye,f as Qe}from"./chunk-O24YRI2L.js";import{a as Pe,b as be,c as Se,d as Ee}from"./chunk-PFLL6SKJ.js";import{a as we,b as De}from"./chunk-7XMR7DBQ.js";import{_ as Ce}from"./chunk-GI2EMKD6.js";import{a as re,b as le,c as se,d as me}from"./chunk-E7BFUDNM.js";import"./chunk-G7M3T37K.js";import"./chunk-UF23LYQO.js";import"./chunk-VKB6BRO6.js";import{b as ae,c as oe}from"./chunk-U3LSFXAC.js";import{d as ge,e as _e}from"./chunk-PKSNJV5O.js";import{a as fe,b as ye}from"./chunk-VKOFSPQJ.js";import{b as K,f as X,j as Z,k as ee}from"./chunk-L3L2HYJX.js";import{b as de,f as pe,j as ce,x as ue}from"./chunk-EGGCURRC.js";import{fa as J,la as te,na as ne,oa as ie}from"./chunk-JXZZYULX.js";import"./chunk-CQGOYTFO.js";import"./chunk-7OGW3PNS.js";import{k as q,m as k,p as A,s as F}from"./chunk-TQARHOKX.js";import{$b as C,Eb as m,Fc as b,Hb as j,Hc as S,Ib as I,Pb as n,Qb as t,Rb as h,Sb as E,Tb as w,U as L,Vb as D,bb as o,bc as c,cb as $,f as H,fc as G,gc as U,hc as Y,lc as T,mc as i,na as N,nc as u,oa as f,oc as x,pa as y,pb as O,rc as M,sc as v,tc as P,uc as Q,vc as R,wb as _,ya as W}from"./chunk-BSJZAB7M.js";import{a as B}from"./chunk-TSRGIXR5.js";var et=()=>({width:"45rem",margin:"auto"}),tt=()=>({"1199px":"70vw","575px":"90vw"});function nt(a,s){a&1&&(n(0,"div",4)(1,"div",5),h(2,"div",6),n(3,"p",7),i(4,"Cargando detalles del pago..."),t()()())}function it(a,s){if(a&1&&(n(0,"div",11)(1,"label"),i(2,"Procesado:"),t(),n(3,"span"),i(4),b(5,"date"),t()()),a&2){let e=c(3);o(4),u(S(5,1,e.payment.processed_at,"dd/MM/yyyy HH:mm"))}}function at(a,s){if(a&1&&(n(0,"div",9)(1,"h3"),i(2,"Transacci\xF3n"),t(),n(3,"div",10)(4,"div",11)(5,"label"),i(6,"ID:"),t(),n(7,"span",12),i(8),t()(),_(9,it,6,4,"div",18),t()()),a&2){let e=c(2);o(8),u(e.payment.transaction_id),o(),m("ngIf",e.payment.processed_at)}}function ot(a,s){if(a&1&&(n(0,"div",11)(1,"label"),i(2,"Sector:"),t(),n(3,"span"),i(4),t()()),a&2){let e=c(3);o(4),u(e.payment.parking_session.sector.name)}}function rt(a,s){if(a&1&&(n(0,"div",11)(1,"label"),i(2,"Calle:"),t(),n(3,"span"),i(4),t()()),a&2){let e=c(3);o(4),u(e.payment.parking_session.street.name)}}function lt(a,s){if(a&1&&(n(0,"div",11)(1,"label"),i(2,"Fin:"),t(),n(3,"span"),i(4),b(5,"date"),t()()),a&2){let e=c(3);o(4),u(S(5,1,e.payment.parking_session.ended_at,"dd/MM HH:mm"))}}function st(a,s){if(a&1&&(n(0,"div",11)(1,"label"),i(2,"Duraci\xF3n:"),t(),n(3,"span",20),i(4),t()()),a&2){let e=c(3);o(4),u(e.getSessionDuration(e.payment.parking_session))}}function mt(a,s){if(a&1&&(n(0,"div",9)(1,"h3"),i(2,"Sesi\xF3n de Estacionamiento"),t(),n(3,"div",10)(4,"div",11)(5,"label"),i(6,"ID:"),t(),n(7,"span",12),i(8),t()(),n(9,"div",11)(10,"label"),i(11,"Patente:"),t(),n(12,"span",19),i(13),t()(),_(14,ot,5,1,"div",18)(15,rt,5,1,"div",18),n(16,"div",11)(17,"label"),i(18,"Inicio:"),t(),n(19,"span"),i(20),b(21,"date"),t()(),_(22,lt,6,4,"div",18)(23,st,5,1,"div",18),n(24,"div",11)(25,"label"),i(26,"Estado:"),t(),n(27,"span",16),i(28),t()()()()),a&2){let e=c(2);o(8),u(e.payment.parking_session.id),o(5),u(e.payment.parking_session.plate),o(),m("ngIf",e.payment.parking_session.sector),o(),m("ngIf",e.payment.parking_session.street),o(5),u(S(21,9,e.payment.parking_session.started_at,"dd/MM HH:mm")),o(2),m("ngIf",e.payment.parking_session.ended_at),o(),m("ngIf",e.getSessionDuration(e.payment.parking_session)),o(4),m("ngClass","status-"+e.payment.parking_session.status.toLowerCase()),o(),x(" ",e.getSessionStatusText(e.payment.parking_session.status)," ")}}function dt(a,s){if(a&1&&(n(0,"div",9)(1,"h3"),i(2,"Venta"),t(),n(3,"div",10)(4,"div",11)(5,"label"),i(6,"ID:"),t(),n(7,"span",12),i(8),t()(),n(9,"div",11)(10,"label"),i(11,"Bruto:"),t(),n(12,"span"),i(13),t()(),n(14,"div",11)(15,"label"),i(16,"Descuento:"),t(),n(17,"span",21),i(18),t()(),n(19,"div",11)(20,"label"),i(21,"Neto:"),t(),n(22,"span",22),i(23),t()(),n(24,"div",11)(25,"label"),i(26,"Estado:"),t(),n(27,"span",16),i(28),t()()()()),a&2){let e=c(2);o(8),u(e.payment.sale.id),o(5),u(e.formatAmount(e.payment.sale.gross_amount)),o(5),u(e.formatAmount(e.payment.sale.discount_amount)),o(5),u(e.formatAmount(e.payment.sale.net_amount)),o(4),m("ngClass","status-"+e.payment.sale.status.toLowerCase()),o(),x(" ",e.getSaleStatusText(e.payment.sale.status)," ")}}function pt(a,s){if(a&1&&(n(0,"div",11)(1,"label"),i(2,"Actualizado:"),t(),n(3,"span"),i(4),b(5,"date"),t()()),a&2){let e=c(2);o(4),u(S(5,1,e.payment.updated_at,"dd/MM/yyyy HH:mm"))}}function ct(a,s){if(a&1&&(n(0,"div",8)(1,"div",9)(2,"h3"),i(3,"Informaci\xF3n del Pago"),t(),n(4,"div",10)(5,"div",11)(6,"label"),i(7,"ID:"),t(),n(8,"span",12),i(9),t()(),n(10,"div",11)(11,"label"),i(12,"Monto:"),t(),n(13,"span",13),i(14),t()(),n(15,"div",11)(16,"label"),i(17,"M\xE9todo:"),t(),n(18,"div",14),h(19,"i",15),n(20,"span"),i(21),t()()(),n(22,"div",11)(23,"label"),i(24,"Estado:"),t(),n(25,"span",16),i(26),t()()()(),_(27,at,10,2,"div",17)(28,mt,29,12,"div",17)(29,dt,29,6,"div",17),n(30,"div",9)(31,"h3"),i(32,"Auditor\xEDa"),t(),n(33,"div",10)(34,"div",11)(35,"label"),i(36,"Creado:"),t(),n(37,"span"),i(38),b(39,"date"),t()(),_(40,pt,6,4,"div",18),t()()()),a&2){let e=c();o(9),u(e.payment.id),o(5),u(e.formatAmount(e.payment.amount)),o(5),I(e.getMethodIcon(e.payment.method)),o(2),u(e.getMethodText(e.payment.method)),o(4),m("ngClass","status-"+e.getStatusColor(e.payment.status)),o(),x(" ",e.getStatusText(e.payment.status)," "),o(),m("ngIf",e.payment.transaction_id),o(),m("ngIf",e.payment.parking_session),o(),m("ngIf",e.payment.sale),o(9),u(S(39,12,e.payment.created_at,"dd/MM/yyyy HH:mm")),o(2),m("ngIf",e.payment.updated_at&&e.payment.updated_at!==e.payment.created_at)}}function ut(a,s){if(a&1){let e=D();n(0,"div",23)(1,"button",24),C("click",function(){f(e);let r=c();return y(r.closeModal())}),t(),n(2,"button",25),C("click",function(){f(e);let r=c();return y(r.printReceipt())}),t()()}}var Ke=(()=>{class a{constructor(){this.visible=!1,this.payment=null,this.visibleChange=new W}ngOnChanges(){}closeModal(){this.visible=!1,this.visibleChange.emit(!1)}formatAmount(e){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e).replace("CLP","$")}getStatusText(e){switch(e){case"COMPLETED":return"Completado";case"PENDING":return"Pendiente";case"FAILED":return"Fallido";case"REFUNDED":return"Reembolsado";default:return e}}getStatusColor(e){switch(e){case"COMPLETED":return"green";case"PENDING":return"orange";case"FAILED":return"red";case"REFUNDED":return"blue";default:return"gray"}}getMethodText(e){switch(e){case"CASH":return"Efectivo";case"CARD":return"Tarjeta";case"WEBPAY":return"Webpay";case"TRANSFER":return"Transferencia";default:return e}}getMethodIcon(e){switch(e){case"CASH":return"pi-money-bill";case"CARD":return"pi-credit-card";case"WEBPAY":return"pi-globe";case"TRANSFER":return"pi-send";default:return"pi-money-bill"}}getSessionDuration(e){if(!e||!e.started_at||!e.ended_at)return null;let l=new Date(e.started_at),d=new Date(e.ended_at).getTime()-l.getTime(),g=Math.floor(d/(1e3*60));if(g<60)return`${g} minutos`;let p=Math.floor(g/60),z=g%60;return z===0?`${p} hora${p>1?"s":""}`:`${p}h ${z}m`}getSessionStatusText(e){switch(e){case"CREATED":return"Creada";case"ACTIVE":return"Activa";case"TO_PAY":return"Por Pagar";case"PAID":return"Pagada";case"CLOSED":return"Cerrada";case"CANCELED":return"Cancelada";default:return e}}getSaleStatusText(e){switch(e){case"PENDING":return"Pendiente";case"PAID":return"Pagada";case"PARTIAL":return"Parcial";case"CANCELED":return"Cancelada";case"REFUNDED":return"Reembolsada";default:return e}}printReceipt(){if(!this.payment)return;let e=window.open("","_blank");if(e){let l=this.generateReceiptHtml();e.document.write(l),e.document.close(),e.print()}}generateReceiptHtml(){return this.payment?`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Recibo de Pago - ${this.payment.id}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          .header { text-align: center; margin-bottom: 30px; }
          .receipt-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
          .receipt-info { font-size: 14px; color: #666; }
          .section { margin-bottom: 20px; }
          .section-title { font-size: 16px; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #ccc; }
          .detail-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
          .detail-label { font-weight: bold; }
          .amount { font-size: 18px; font-weight: bold; color: #059669; }
          .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #666; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="receipt-title">RECIBO DE PAGO</div>
          <div class="receipt-info">STPark - Sistema de Estacionamientos</div>
        </div>
        
        <div class="section">
          <div class="section-title">Informaci\xF3n del Pago</div>
          <div class="detail-row">
            <span class="detail-label">ID de Pago:</span>
            <span>${this.payment.id}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Monto:</span>
            <span class="amount">${this.formatAmount(this.payment.amount)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">M\xE9todo:</span>
            <span>${this.getMethodText(this.payment.method)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Estado:</span>
            <span>${this.getStatusText(this.payment.status)}</span>
          </div>
          ${this.payment.transaction_id?`
          <div class="detail-row">
            <span class="detail-label">ID Transacci\xF3n:</span>
            <span>${this.payment.transaction_id}</span>
          </div>
          `:""}
        </div>
        
        ${this.payment.parking_session?`
        <div class="section">
          <div class="section-title">Informaci\xF3n de la Sesi\xF3n</div>
          <div class="detail-row">
            <span class="detail-label">Patente:</span>
            <span>${this.payment.parking_session.plate}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Inicio:</span>
            <span>${new Date(this.payment.parking_session.started_at).toLocaleString("es-CL")}</span>
          </div>
          ${this.payment.parking_session.ended_at?`
          <div class="detail-row">
            <span class="detail-label">Fin:</span>
            <span>${new Date(this.payment.parking_session.ended_at).toLocaleString("es-CL")}</span>
          </div>
          `:""}
          ${this.getSessionDuration(this.payment.parking_session)?`
          <div class="detail-row">
            <span class="detail-label">Duraci\xF3n:</span>
            <span>${this.getSessionDuration(this.payment.parking_session)}</span>
          </div>
          `:""}
        </div>
        `:""}
        
        <div class="footer">
          <div>Fecha de impresi\xF3n: ${new Date().toLocaleString("es-CL")}</div>
          <div>Gracias por usar STPark</div>
        </div>
      </body>
      </html>
    `:""}static{this.\u0275fac=function(l){return new(l||a)}}static{this.\u0275cmp=O({type:a,selectors:[["app-payment-details-modal"]],inputs:{visible:"visible",payment:"payment"},outputs:{visibleChange:"visibleChange"},features:[N],decls:4,vars:13,consts:[["header","DETALLES DEL PAGO",3,"visibleChange","visible","modal","breakpoints","draggable","resizable","closable","closeOnEscape"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","payment-details",4,"ngIf"],["pTemplate","footer"],[1,"flex","justify-center","items-center","py-8"],[1,"text-center"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600","mx-auto","mb-4"],[1,"text-gray-600"],[1,"payment-details"],[1,"detail-section"],[1,"detail-grid","compact"],[1,"detail-item"],[1,"font-mono"],[1,"amount"],[1,"method-info"],[1,"method-icon"],[1,"status",3,"ngClass"],["class","detail-section",4,"ngIf"],["class","detail-item",4,"ngIf"],[1,"plate"],[1,"duration"],[1,"discount"],[1,"net-amount"],[1,"flex","justify-end","gap-2"],["pButton","","type","button","label","Cerrar","icon","pi pi-times",1,"p-button-text",3,"click"],["pButton","","type","button","label","Imprimir Recibo","icon","pi pi-print",1,"p-button-outlined",3,"click"]],template:function(l,r){l&1&&(n(0,"p-dialog",0),P("visibleChange",function(g){return v(r.visible,g)||(r.visible=g),g}),C("visibleChange",function(g){return r.visibleChange.emit(g)}),_(1,nt,5,0,"div",1)(2,ct,41,15,"div",2)(3,ut,3,0,"ng-template",3),t()),l&2&&(j(R(11,et)),M("visible",r.visible),m("modal",!0)("breakpoints",R(12,tt))("draggable",!1)("resizable",!1)("closable",!1)("closeOnEscape",!1),o(),m("ngIf",!r.payment),o(),m("ngIf",r.payment))},dependencies:[F,q,k,A,ve,Me,Ce,xe,he],styles:[".payment-details[_ngcontent-%COMP%]   .detail-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.payment-details[_ngcontent-%COMP%]   .detail-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#374151;margin-bottom:.75rem;padding-bottom:.25rem;border-bottom:1px solid #e5e7eb}.payment-details[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:.75rem}.payment-details[_ngcontent-%COMP%]   .detail-grid.compact[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.5rem}.payment-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.payment-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500;color:#6b7280;text-transform:uppercase;letter-spacing:.05em}.payment-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem;color:#111827;font-weight:500}.payment-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .font-mono[_ngcontent-%COMP%]{font-family:Monaco,Menlo,Ubuntu Mono,monospace;background-color:#f3f4f6;padding:.25rem .5rem;border-radius:.25rem;font-size:.875rem}.payment-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .plate[_ngcontent-%COMP%]{font-family:Monaco,Menlo,Ubuntu Mono,monospace;background-color:#dbeafe;color:#1e40af;padding:.25rem .5rem;border-radius:.25rem;font-weight:600;text-transform:uppercase}.payment-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;color:#059669}.payment-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .discount[_ngcontent-%COMP%]{color:#dc2626;font-weight:600}.payment-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .net-amount[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#059669}.payment-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .duration[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#1e40af;background-color:#dbeafe;padding:.2rem .4rem;border-radius:.25rem}.payment-details[_ngcontent-%COMP%]   .method-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.payment-details[_ngcontent-%COMP%]   .method-info[_ngcontent-%COMP%]   .method-icon[_ngcontent-%COMP%]{font-size:1.25rem;color:#6b7280}.payment-details[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .75rem;border-radius:9999px;font-size:.875rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em}.payment-details[_ngcontent-%COMP%]   .status.status-green[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.payment-details[_ngcontent-%COMP%]   .status.status-orange[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.payment-details[_ngcontent-%COMP%]   .status.status-red[_ngcontent-%COMP%]{background-color:#fee2e2;color:#991b1b}.payment-details[_ngcontent-%COMP%]   .status.status-blue[_ngcontent-%COMP%]{background-color:#dbeafe;color:#1e40af}.payment-details[_ngcontent-%COMP%]   .status.status-gray[_ngcontent-%COMP%]{background-color:#f3f4f6;color:#6b7280}.payment-details[_ngcontent-%COMP%]   .status.status-pending[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.payment-details[_ngcontent-%COMP%]   .status.status-paid[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.payment-details[_ngcontent-%COMP%]   .status.status-partial[_ngcontent-%COMP%]{background-color:#fef3c7;color:#92400e}.payment-details[_ngcontent-%COMP%]   .status.status-canceled[_ngcontent-%COMP%]{background-color:#fee2e2;color:#991b1b}@media (max-width: 768px){.payment-details[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%], .payment-details[_ngcontent-%COMP%]   .detail-grid.compact[_ngcontent-%COMP%]{grid-template-columns:1fr}.payment-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:1rem}.payment-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .net-amount[_ngcontent-%COMP%]{font-size:.9rem}}[_nghost-%COMP%]     .p-dialog-footer{padding:1rem 1.5rem;border-top:1px solid #e5e7eb;background-color:#f9fafb}[_nghost-%COMP%]     .p-dialog-mask .p-dialog{margin:1.75rem auto!important;top:50%!important;left:50%!important;transform:translate(-50%,-50%)!important;position:fixed!important}"]})}}return a})();function gt(a,s){a&1&&(n(0,"th",44),i(1,"ID"),t())}function _t(a,s){if(a&1&&(n(0,"td",45),i(1),t()),a&2){let e=s.$implicit;o(),u(e.id)}}function ft(a,s){a&1&&(n(0,"th",46),i(1,"Monto"),t())}function yt(a,s){if(a&1&&(n(0,"td",45)(1,"span",47),i(2),t()()),a&2){let e=s.$implicit,l=c();o(2),x(" ",l.formatAmount(e.amount)," ")}}function Ct(a,s){a&1&&(n(0,"th",48),i(1,"M\xE9todo"),t())}function ht(a,s){if(a&1&&(n(0,"td",45)(1,"div",49)(2,"mat-icon"),i(3),t(),n(4,"span"),i(5),t()()()),a&2){let e=s.$implicit,l=c();o(2),I("text-"+l.getMethodIcon(e.method)),o(),u(l.getMethodIcon(e.method)),o(2),u(l.getMethodText(e.method))}}function xt(a,s){a&1&&(n(0,"th",50),i(1,"Estado"),t())}function Mt(a,s){if(a&1&&(n(0,"td",45)(1,"span",51),i(2),t()()),a&2){let e=s.$implicit,l=c();o(),I("bg-"+l.getStatusColor(e.status)+"-100 text-"+l.getStatusColor(e.status)+"-800"),o(),x(" ",l.getStatusText(e.status)," ")}}function vt(a,s){a&1&&(n(0,"th",52),i(1,"Fecha"),t())}function Pt(a,s){if(a&1&&(n(0,"td",45),i(1),b(2,"date"),t()),a&2){let e=s.$implicit;o(),x(" ",S(2,1,e.created_at,"dd/MM/yyyy HH:mm")," ")}}function bt(a,s){a&1&&(n(0,"th",53),i(1,"Acciones"),t())}function St(a,s){if(a&1){let e=D();n(0,"button",55),C("click",function(){f(e);let r=c().$implicit,d=c();return y(d.retryPayment(r))}),n(1,"mat-icon"),i(2,"refresh"),t(),i(3," Reintentar "),t()}}function Et(a,s){if(a&1){let e=D();n(0,"td",45)(1,"button",54)(2,"mat-icon"),i(3,"more_vert"),t()(),n(4,"mat-menu",null,2)(6,"button",55),C("click",function(){let r=f(e).$implicit,d=c();return y(d.showPaymentDetails(r))}),n(7,"mat-icon"),i(8,"visibility"),t(),i(9," Ver detalles "),t(),n(10,"button",55),C("click",function(){let r=f(e).$implicit,d=c();return y(d.printReceipt(r))}),n(11,"mat-icon"),i(12,"receipt"),t(),i(13," Imprimir recibo "),t(),_(14,St,4,0,"button",56),t()()}if(a&2){let e=s.$implicit,l=T(5);o(),m("matMenuTriggerFor",l),o(13),m("ngIf",e.status==="PENDING")}}function wt(a,s){a&1&&h(0,"tr",57)}function Dt(a,s){a&1&&h(0,"tr",58)}function It(a,s){a&1&&(n(0,"div",59),h(1,"mat-spinner",60),t())}function Ot(a,s){a&1&&(n(0,"div",61)(1,"mat-icon",62),i(2,"payment"),t(),n(3,"h3",63),i(4,"No hay pagos registrados"),t(),n(5,"p",64),i(6,"Los pagos aparecer\xE1n aqu\xED cuando se realicen transacciones."),t()())}function Tt(a,s){if(a&1){let e=D();n(0,"mat-paginator",65),C("page",function(r){f(e);let d=c();return y(d.onPageChange(r))}),t()}if(a&2){let e=c();m("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}var Pn=(()=>{class a{constructor(e){this.paymentService=e,this._unsubscribeAll=new H,this.payments=[],this.loading=!1,this.displayedColumns=["id","amount","method","status","created_at","actions"],this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.sortBy="created_at",this.sortOrder="desc",this.filters={method:"",status:"",date_from:"",date_to:""},this.showDetailsModal=!1,this.selectedPayment=null}ngOnInit(){this.loadPayments()}ngAfterViewInit(){}onSortChange(e){this.sortBy=e.active,this.sortOrder=e.direction==="asc"?"asc":"desc",this.currentPage=0,this.loadPayments()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadPayments(){this.loading=!0;let e=B({page:this.currentPage+1,per_page:this.pageSize,sort_by:this.sortBy,sort_order:this.sortOrder},this.filters);this.paymentService.getPayments(e).pipe(L(this._unsubscribeAll)).subscribe({next:l=>{this.payments=l.data?.data||[],this.totalItems=l.data?.total||0,this.loading=!1},error:l=>{console.error("Error loading payments:",l),this.loading=!1}})}formatAmount(e){return this.paymentService.formatAmount(e)}getStatusColor(e){switch(e){case"COMPLETED":return"green";case"PENDING":return"orange";case"FAILED":return"red";default:return"gray"}}getMethodIcon(e){switch(e){case"CASH":return"payments";case"CARD":return"credit_card";case"WEBPAY":return"account_balance";default:return"payment"}}getMethodText(e){return this.paymentService.getPaymentMethodLabel(e)}getStatusText(e){return this.paymentService.getPaymentStatusLabel(e)}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadPayments()}applyFilters(){this.currentPage=0,this.loadPayments()}clearFilters(){this.filters={method:"",status:"",date_from:"",date_to:""},this.currentPage=0,this.loadPayments()}showPaymentDetails(e){this.loading=!0,this.paymentService.getPayment(e.id).pipe(L(this._unsubscribeAll)).subscribe({next:l=>{this.selectedPayment=l.data,this.showDetailsModal=!0,this.loading=!1},error:l=>{console.error("Error loading payment details:",l),this.loading=!1}})}closeDetailsModal(){this.showDetailsModal=!1,this.selectedPayment=null}printReceipt(e){this.showPaymentDetails(e)}retryPayment(e){console.log("Reintentando pago:",e.id)}static{this.\u0275fac=function(l){return new(l||a)($(Ie))}}static{this.\u0275cmp=O({type:a,selectors:[["app-payments"]],viewQuery:function(l,r){if(l&1&&G(V,5),l&2){let d;U(d=Y())&&(r.sort=d.first)}},features:[Q([{provide:Ne,useValue:qe()}])],decls:84,vars:18,consts:[["picker1",""],["picker2",""],["menu","matMenu"],[1,"p-6","w-full"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"p-6"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],["appearance","outline"],["matInput","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[3,"ngModelChange","ngModel"],["value",""],["value","CASH"],["value","CARD"],["value","WEBPAY"],["value","COMPLETED"],["value","PENDING"],["value","FAILED"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"overflow-x-auto"],["mat-table","","matSort","",1,"w-full",3,"matSortChange","dataSource","matSortActive","matSortDirection"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","id",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","amount"],["mat-header-cell","","mat-sort-header","amount",4,"matHeaderCellDef"],["matColumnDef","method"],["mat-header-cell","","mat-sort-header","method",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","status",4,"matHeaderCellDef"],["matColumnDef","created_at"],["mat-header-cell","","mat-sort-header","created_at",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],[3,"visibleChange","visible","payment"],["mat-header-cell","","mat-sort-header","id"],["mat-cell",""],["mat-header-cell","","mat-sort-header","amount"],[1,"font-semibold","text-green-600"],["mat-header-cell","","mat-sort-header","method"],[1,"flex","items-center","gap-2"],["mat-header-cell","","mat-sort-header","status"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],["mat-header-cell","","mat-sort-header","created_at"],["mat-header-cell",""],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-header-row",""],["mat-row",""],[1,"flex","justify-center","items-center","py-8"],["diameter","40"],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"text-gray-500"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"]],template:function(l,r){if(l&1){let d=D();n(0,"div",3)(1,"div",4)(2,"h1",5),i(3,"Pagos"),t(),n(4,"p",6),i(5,"Gestiona los pagos del sistema de estacionamientos"),t()(),n(6,"mat-card",4)(7,"mat-card-content",7)(8,"div",8)(9,"mat-form-field",9)(10,"mat-label"),i(11,"Fecha desde"),t(),n(12,"input",10),P("ngModelChange",function(p){return f(d),v(r.filters.date_from,p)||(r.filters.date_from=p),y(p)}),t(),h(13,"mat-datepicker-toggle",11)(14,"mat-datepicker",null,0),t(),n(16,"mat-form-field",9)(17,"mat-label"),i(18,"Fecha hasta"),t(),n(19,"input",10),P("ngModelChange",function(p){return f(d),v(r.filters.date_to,p)||(r.filters.date_to=p),y(p)}),t(),h(20,"mat-datepicker-toggle",11)(21,"mat-datepicker",null,1),t(),n(23,"mat-form-field",9)(24,"mat-label"),i(25,"M\xE9todo de pago"),t(),n(26,"mat-select",12),P("ngModelChange",function(p){return f(d),v(r.filters.method,p)||(r.filters.method=p),y(p)}),n(27,"mat-option",13),i(28,"Todos"),t(),n(29,"mat-option",14),i(30,"Efectivo"),t(),n(31,"mat-option",15),i(32,"Tarjeta"),t(),n(33,"mat-option",16),i(34,"Webpay"),t()()(),n(35,"mat-form-field",9)(36,"mat-label"),i(37,"Estado"),t(),n(38,"mat-select",12),P("ngModelChange",function(p){return f(d),v(r.filters.status,p)||(r.filters.status=p),y(p)}),n(39,"mat-option",13),i(40,"Todos"),t(),n(41,"mat-option",17),i(42,"Completado"),t(),n(43,"mat-option",18),i(44,"Pendiente"),t(),n(45,"mat-option",19),i(46,"Fallido"),t()()()(),n(47,"div",20)(48,"button",21),C("click",function(){return f(d),y(r.clearFilters())}),n(49,"mat-icon"),i(50,"clear"),t(),i(51," Limpiar "),t(),n(52,"button",22),C("click",function(){return f(d),y(r.applyFilters())}),n(53,"mat-icon"),i(54,"search"),t(),i(55," Filtrar "),t()()()(),n(56,"mat-card")(57,"mat-card-content",7)(58,"div",23)(59,"table",24),C("matSortChange",function(p){return f(d),y(r.onSortChange(p))}),E(60,25),_(61,gt,2,0,"th",26)(62,_t,2,1,"td",27),w(),E(63,28),_(64,ft,2,0,"th",29)(65,yt,3,1,"td",27),w(),E(66,30),_(67,Ct,2,0,"th",31)(68,ht,6,4,"td",27),w(),E(69,32),_(70,xt,2,0,"th",33)(71,Mt,3,3,"td",27),w(),E(72,34),_(73,vt,2,0,"th",35)(74,Pt,3,4,"td",27),w(),E(75,36),_(76,bt,2,0,"th",37)(77,Et,15,2,"td",27),w(),_(78,wt,1,0,"tr",38)(79,Dt,1,0,"tr",39),t(),_(80,It,2,0,"div",40)(81,Ot,7,0,"div",41),t(),_(82,Tt,1,5,"mat-paginator",42),t()(),n(83,"app-payment-details-modal",43),P("visibleChange",function(p){return f(d),v(r.showDetailsModal,p)||(r.showDetailsModal=p),y(p)}),C("visibleChange",function(){return f(d),y(r.closeDetailsModal())}),t()()}if(l&2){let d=T(15),g=T(22);o(12),m("matDatepicker",d),M("ngModel",r.filters.date_from),o(),m("for",d),o(6),m("matDatepicker",g),M("ngModel",r.filters.date_to),o(),m("for",g),o(6),M("ngModel",r.filters.method),o(12),M("ngModel",r.filters.status),o(21),m("dataSource",r.payments)("matSortActive",r.sortBy)("matSortDirection",r.sortOrder),o(19),m("matHeaderRowDef",r.displayedColumns),o(),m("matRowDefColumns",r.displayedColumns),o(),m("ngIf",r.loading),o(),m("ngIf",!r.loading&&r.payments.length===0),o(),m("ngIf",r.totalItems>0),o(),M("visible",r.showDetailsModal),m("payment",r.selectedPayment)}},dependencies:[F,k,A,ue,de,pe,ce,He,Oe,ke,Le,Ae,Te,Re,Fe,Ve,ze,Be,Qe,Ue,Ye,ie,te,ne,oe,ae,ye,fe,Je,ee,Z,K,X,_e,ge,Ee,Pe,be,Se,De,we,J,$e,We,Ge,V,je,me,le,re,se,Ke],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151}.mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}.status-completed[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.status-pending[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.status-failed[_ngcontent-%COMP%]{background-color:#fee2e2;color:#991b1b}.payment-method-icon[_ngcontent-%COMP%]{width:20px;height:20px;font-size:20px}@media (max-width: 768px){.grid-cols-4[_ngcontent-%COMP%]{grid-template-columns:1fr}.mat-mdc-table[_ngcontent-%COMP%]{font-size:.875rem}}"]})}}return a})();export{Pn as PaymentsComponent};
