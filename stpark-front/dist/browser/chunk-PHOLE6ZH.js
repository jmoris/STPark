import{a as we}from"./chunk-IGTKWB6A.js";import{c as Ae}from"./chunk-IAB63KK4.js";import{a as De}from"./chunk-EP46J676.js";import{a as ze}from"./chunk-VLZZSPQF.js";import{a as Be}from"./chunk-N3PSIUVN.js";import{a as Oe}from"./chunk-RO7KOFOP.js";import{a as Se,b as Ce,c as Me,d as Ee}from"./chunk-6DX2DSMH.js";import{b as Ie}from"./chunk-YOYZ3SXE.js";import{d as pe}from"./chunk-TM3ZDJJD.js";import{b as he}from"./chunk-KFI2WSVH.js";import"./chunk-RRHSJPSV.js";import"./chunk-QT3W5JSU.js";import"./chunk-VKB6BRO6.js";import{b as me,c as ce}from"./chunk-7EGXZGVT.js";import{d as ve,e as ye}from"./chunk-7QQT45KE.js";import{a as xe,b as _e}from"./chunk-7AXTM6W3.js";import{b as ie,f as ne,j as se,k as re}from"./chunk-DO3SX6N4.js";import{b as ge,f as ue,j as be,x as fe}from"./chunk-EGGCURRC.js";import{J,Q as I,S as A,T as K,U as ee,V as te,W as ae,la as oe,na as de,oa as le}from"./chunk-AHUY5V3P.js";import"./chunk-2JMYS33K.js";import"./chunk-CQGOYTFO.js";import"./chunk-7OGW3PNS.js";import{l as G,m as W,s as X,u as Q}from"./chunk-TQARHOKX.js";import{$ as x,$b as D,Ba as P,Ca as l,Eb as c,Ia as F,Pb as n,Qb as i,Rb as p,U as k,Vb as Y,bb as o,bc as S,cb as v,ea as C,f as z,i as B,jb as R,jc as Z,kb as N,kc as j,lc as V,mc as s,na as L,nc as h,oa as b,oc as E,pa as f,pb as y,qb as _,rc as $,sc as U,tc as H,uc as q,wb as M,za as T}from"./chunk-BSJZAB7M.js";import{g as O}from"./chunk-TSRGIXR5.js";var Le=(()=>{class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=_({type:r});static \u0275inj=x({imports:[J,I,I]})}return r})();var Fe=["chart"],Te=(()=>{class r{constructor(){this.chart=l(),this.annotations=l(),this.colors=l(),this.dataLabels=l(),this.series=l(),this.stroke=l(),this.labels=l(),this.legend=l(),this.markers=l(),this.noData=l(),this.fill=l(),this.tooltip=l(),this.plotOptions=l(),this.responsive=l(),this.xaxis=l(),this.yaxis=l(),this.forecastDataPoints=l(),this.grid=l(),this.states=l(),this.title=l(),this.subtitle=l(),this.theme=l(),this.autoUpdateSeries=l(!0),this.chartReady=P(),this.chartInstance=R(null),this.chartElement=N.required("chart"),this.ngZone=C(T),this.isBrowser=Q(C(F))}ngOnChanges(e){this.isBrowser&&this.ngZone.runOutsideAngular(()=>{B.schedule(()=>this.hydrate(e))})}ngOnDestroy(){this.destroy()}hydrate(e){if(this.autoUpdateSeries()&&Object.keys(e).filter(a=>a!=="series").length===0){this.updateSeries(this.series(),!0);return}this.createElement()}createElement(){return O(this,null,function*(){let{default:e}=yield import("./chunk-VRXIKMLJ.js");window.ApexCharts||=e;let t={};["annotations","chart","colors","dataLabels","series","stroke","labels","legend","fill","tooltip","plotOptions","responsive","markers","noData","xaxis","yaxis","forecastDataPoints","grid","states","title","subtitle","theme"].forEach(g=>{let u=this[g]();u&&(t[g]=u)}),this.destroy();let d=this.ngZone.runOutsideAngular(()=>new e(this.chartElement().nativeElement,t));this.chartInstance.set(d),this.render(),this.chartReady.emit({chartObj:d})})}render(){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.render())}updateOptions(e,t,a,d){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.updateOptions(e,t,a,d))}updateSeries(e,t){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.updateSeries(e,t))}appendSeries(e,t){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.appendSeries(e,t))}appendData(e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.appendData(e))}highlightSeries(e){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.highlightSeries(e))}toggleSeries(e){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.toggleSeries(e))}showSeries(e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.showSeries(e))}hideSeries(e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.hideSeries(e))}resetSeries(){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.resetSeries())}zoomX(e,t){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.zoomX(e,t))}toggleDataPointSelection(e,t){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.toggleDataPointSelection(e,t))}destroy(){this.chartInstance()?.destroy(),this.chartInstance.set(null)}setLocale(e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.setLocale(e))}paper(){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.paper())}addXaxisAnnotation(e,t,a){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addXaxisAnnotation(e,t,a))}addYaxisAnnotation(e,t,a){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addYaxisAnnotation(e,t,a))}addPointAnnotation(e,t,a){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addPointAnnotation(e,t,a))}removeAnnotation(e,t){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.removeAnnotation(e,t))}clearAnnotations(e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.clearAnnotations(e))}dataURI(e){return this.chartInstance()?.dataURI(e)}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=y({type:r,selectors:[["apx-chart"]],viewQuery:function(t,a){t&1&&Z(a.chartElement,Fe,5),t&2&&j()},inputs:{chart:[1,"chart"],annotations:[1,"annotations"],colors:[1,"colors"],dataLabels:[1,"dataLabels"],series:[1,"series"],stroke:[1,"stroke"],labels:[1,"labels"],legend:[1,"legend"],markers:[1,"markers"],noData:[1,"noData"],fill:[1,"fill"],tooltip:[1,"tooltip"],plotOptions:[1,"plotOptions"],responsive:[1,"responsive"],xaxis:[1,"xaxis"],yaxis:[1,"yaxis"],forecastDataPoints:[1,"forecastDataPoints"],grid:[1,"grid"],states:[1,"states"],title:[1,"title"],subtitle:[1,"subtitle"],theme:[1,"theme"],autoUpdateSeries:[1,"autoUpdateSeries"]},outputs:{chartReady:"chartReady"},features:[L],decls:2,vars:0,consts:[["chart",""]],template:function(t,a){t&1&&p(0,"div",null,0)},encapsulation:2,changeDetection:0})}}return r})();var Pe=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=_({type:r})}static{this.\u0275inj=x({})}}return r})();function Ne(r,m){r&1&&(n(0,"div",15),p(1,"mat-spinner",16),i())}function Ye(r,m){if(r&1&&(n(0,"div",17)(1,"fuse-alert",18),s(2),i()()),r&2){let e=S();o(),c("dismissible",!0),o(),E(" ",e.error," ")}}function Ze(r,m){if(r&1&&(n(0,"div",45)(1,"div",46),p(2,"div",47),n(3,"div")(4,"p",48),s(5),i(),n(6,"p",38),s(7),i()()(),n(8,"div",49)(9,"p",38),s(10),i(),n(11,"p",50),s(12),i()()()),r&2){let e=m.$implicit,t=S(2);o(5),h(e.plate),o(2),h(e.sector==null?null:e.sector.name),o(3),h(t.getElapsedTime(e.started_at)),o(2),h(t.formatDate(e.started_at))}}function je(r,m){r&1&&(n(0,"div",51),s(1," No hay sesiones activas "),i())}function Ve(r,m){if(r&1&&(n(0,"div")(1,"div",19)(2,"fuse-card",20)(3,"div",21)(4,"div",22)(5,"mat-icon",23),s(6,"attach_money"),i()(),n(7,"div",24)(8,"p",25),s(9,"Ingresos Hoy"),i(),n(10,"p",26),s(11),i()()()(),n(12,"fuse-card",20)(13,"div",21)(14,"div",27)(15,"mat-icon",28),s(16,"directions_car"),i()(),n(17,"div",24)(18,"p",25),s(19,"Sesiones Hoy"),i(),n(20,"p",26),s(21),i()()()(),n(22,"fuse-card",20)(23,"div",21)(24,"div",29)(25,"mat-icon",30),s(26,"receipt"),i()(),n(27,"div",24)(28,"p",25),s(29,"Ticket Promedio"),i(),n(30,"p",26),s(31),i()()()(),n(32,"fuse-card",20)(33,"div",21)(34,"div",31)(35,"mat-icon",32),s(36,"schedule"),i()(),n(37,"div",24)(38,"p",25),s(39,"Sesiones Activas"),i(),n(40,"p",26),s(41),i()()()(),n(42,"fuse-card",20)(43,"div",21)(44,"div",33)(45,"mat-icon",34),s(46,"warning"),i()(),n(47,"div",24)(48,"p",25),s(49,"Deudas Pendientes"),i(),n(50,"p",26),s(51),i()()()()(),n(52,"div",35)(53,"fuse-card",20)(54,"div",36)(55,"h3",37),s(56,"Ventas por Sector"),i(),n(57,"p",38),s(58,"Distribuci\xF3n de ingresos por sector"),i()(),p(59,"apx-chart",39),i(),n(60,"fuse-card",20)(61,"div",36)(62,"h3",37),s(63,"Pagos por M\xE9todo"),i(),n(64,"p",38),s(65,"Distribuci\xF3n de pagos por m\xE9todo"),i()(),p(66,"apx-chart",40),i()(),n(67,"div",35)(68,"fuse-card",20)(69,"div",36)(70,"h3",37),s(71,"Sesiones Iniciadas por Hora"),i(),n(72,"p",38),s(73,"Distribuci\xF3n temporal de sesiones iniciadas"),i()(),p(74,"apx-chart",41),i(),n(75,"fuse-card",20)(76,"div",36)(77,"h3",37),s(78,"Sesiones Activas"),i(),n(79,"p",38),s(80),i()(),n(81,"div",42),M(82,Ze,13,4,"div",43)(83,je,2,0,"div",44),i()()()()),r&2){let e=S();o(11),h(e.formatAmount(e.stats.totalRevenue)),o(10),h(e.stats.totalSessions),o(10),h(e.formatAmount(e.stats.averageTicket)),o(10),h(e.stats.activeSessions),o(10),h(e.formatAmount(e.stats.pendingDebts)),o(8),c("series",e.salesChart.series)("chart",e.salesChart.chart)("plotOptions",e.salesChart.plotOptions)("dataLabels",e.salesChart.dataLabels)("xaxis",e.salesChart.xaxis)("yaxis",e.salesChart.yaxis)("colors",e.salesChart.colors)("tooltip",e.salesChart.tooltip),o(7),c("series",e.paymentsChart.series)("chart",e.paymentsChart.chart)("labels",e.paymentsChart.labels)("colors",e.paymentsChart.colors)("legend",e.paymentsChart.legend)("tooltip",e.paymentsChart.tooltip),o(8),c("series",e.sessionsChart.series)("chart",e.sessionsChart.chart)("xaxis",e.sessionsChart.xaxis)("yaxis",e.sessionsChart.yaxis)("colors",e.sessionsChart.colors)("fill",e.sessionsChart.fill),o(6),E("",e.dashboardData.active_sessions.count," sesiones activas"),o(2),c("ngForOf",e.dashboardData.active_sessions.sessions),o(),c("ngIf",e.dashboardData.active_sessions.sessions.length===0)}}var $e={parse:{dateInput:"DD/MM/YYYY"},display:{dateInput:"DD/MM/YYYY",monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}},w=class extends te{format(m,e){if(e==="DD/MM/YYYY"){let t=m.getDate().toString().padStart(2,"0"),a=(m.getMonth()+1).toString().padStart(2,"0"),d=m.getFullYear();return`${t}/${a}/${d}`}return super.format(m,e)}parse(m){if(m&&m.match(/^\d{2}\/\d{2}\/\d{4}$/)){let[e,t,a]=m.split("/");return new Date(parseInt(a),parseInt(t)-1,parseInt(e))}return super.parse(m)}},Pt=(()=>{class r{constructor(e,t,a,d){this.reportService=e,this.sessionService=t,this.paymentService=a,this.debtService=d,this._unsubscribeAll=new z,this.dashboardData=null,this.loading=!1,this.error=null,this.selectedDate=new Date,this.salesChart={},this.paymentsChart={},this.sessionsChart={},this.stats={totalRevenue:0,totalSessions:0,averageTicket:0,pendingDebts:0,activeSessions:0}}ngOnInit(){this.loadDashboardData(),this.initializeCharts()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}formatDateLocal(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${d}`}loadDashboardData(){this.loading=!0,this.error=null;let e=this.formatDateLocal(this.selectedDate);this.reportService.getDashboard(e).pipe(k(this._unsubscribeAll)).subscribe({next:t=>{this.dashboardData=t.data,this.updateStats(),this.updateCharts(),this.loading=!1},error:t=>{this.error="Error al cargar datos del dashboard",this.loading=!1,console.error("Error loading dashboard:",t)}})}onDateChange(){this.loadDashboardData()}updateStats(){this.dashboardData&&(this.stats={totalRevenue:this.dashboardData.today_sales.total_amount,totalSessions:this.dashboardData.today_sales.count,averageTicket:this.dashboardData.today_sales.count>0?this.dashboardData.today_sales.total_amount/this.dashboardData.today_sales.count:0,pendingDebts:this.dashboardData.pending_debts.total_amount,activeSessions:this.dashboardData.active_sessions.count})}updateCharts(){this.dashboardData&&(this.updateSalesChart(),this.updatePaymentsChart(),this.updateSessionsChart())}updateSalesChart(){let e=this.dashboardData.today_sales.by_sector,t=Object.entries(e).map(([a,d])=>({x:a,y:d.total}));this.salesChart={series:[{name:"Ventas",data:t}],chart:{type:"bar",height:300,toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!1},xaxis:{categories:Object.keys(e)},yaxis:{labels:{formatter:a=>this.formatAmount(a)}},colors:["#3B82F6"],tooltip:{y:{formatter:a=>this.formatAmount(a)}}}}updatePaymentsChart(){let e=this.dashboardData.today_payments.by_method,t=Object.entries(e).map(([a,d])=>({x:this.paymentService.getPaymentMethodLabel(a),y:d.total}));this.paymentsChart={series:Object.values(e).map(a=>a.total),chart:{type:"donut",height:300},labels:Object.keys(e).map(a=>this.paymentService.getPaymentMethodLabel(a)),colors:["#10B981","#3B82F6","#8B5CF6","#F59E0B"],legend:{position:"bottom"},tooltip:{y:{formatter:a=>this.formatAmount(a)}}}}updateSessionsChart(){let e=this.dashboardData.sessions_by_hour||[],t=e.map(a=>({x:`${a.hour.toString().padStart(2,"0")}:00`,y:a.count}));this.sessionsChart={series:[{name:"Sesiones Iniciadas",data:t}],chart:{type:"area",height:300,toolbar:{show:!1}},xaxis:{categories:e.map(a=>`${a.hour.toString().padStart(2,"0")}:00`)},yaxis:{title:{text:"Sesiones"}},colors:["#10B981"],fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.3}}}}initializeCharts(){this.salesChart={series:[],chart:{type:"bar"}},this.paymentsChart={series:[],chart:{type:"donut"}},this.sessionsChart={series:[],chart:{type:"area"}}}formatAmount(e){return this.reportService.formatAmount(e)}formatDate(e){return this.reportService.formatDate(e)}refreshData(){this.loadDashboardData()}exportReport(){let e=this.formatDateLocal(this.selectedDate),t={date_from:e,date_to:e};this.reportService.exportToPdf("sales",t)}getStatusColor(e){return this.sessionService.getStatusColor(e)}getStatusLabel(e){return this.sessionService.getStatusLabel(e)}getPaymentMethodColor(e){return this.paymentService.getPaymentMethodColor(e)}getPaymentMethodLabel(e){return this.paymentService.getPaymentMethodLabel(e)}getElapsedTime(e){let t=new Date(e),d=Math.floor((new Date().getTime()-t.getTime())/1e3);return this.sessionService.formatDuration(d)}static{this.\u0275fac=function(t){return new(t||r)(v(we),v(Oe),v(ze),v(Be))}}static{this.\u0275cmp=y({type:r,selectors:[["app-dashboard"]],features:[q([{provide:K,useClass:w,deps:[A]},{provide:ee,useValue:$e},{provide:A,useValue:"es-CL"}])],decls:26,vars:8,consts:[["picker",""],[1,"p-6","w-full"],[1,"mb-8"],[1,"flex","items-center","justify-between"],[1,"text-3xl","font-bold","text-gray-900"],[1,"mt-2","text-gray-600"],[1,"flex","items-center","gap-4"],["appearance","outline",1,"w-48"],["matInput","","placeholder","dd/mm/yyyy",3,"ngModelChange","dateChange","matDatepicker","ngModel"],["matIconSuffix","",3,"for"],["mat-icon-button","",1,"rounded-sm",3,"click","disabled"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click","disabled"],["class","flex justify-center items-center h-64",4,"ngIf"],["class","mb-6",4,"ngIf"],[4,"ngIf"],[1,"flex","justify-center","items-center","h-64"],["diameter","50"],[1,"mb-6"],["type","error",3,"dismissible"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-5","gap-6","mb-8"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-green-100","rounded-lg"],[1,"text-green-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-gray-900"],[1,"p-3","bg-blue-100","rounded-lg"],[1,"text-blue-600"],[1,"p-3","bg-purple-100","rounded-lg"],[1,"text-purple-600"],[1,"p-3","bg-orange-100","rounded-lg"],[1,"text-orange-600"],[1,"p-3","bg-red-100","rounded-lg"],[1,"text-red-600"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-8"],[1,"mb-4"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[3,"series","chart","plotOptions","dataLabels","xaxis","yaxis","colors","tooltip"],[3,"series","chart","labels","colors","legend","tooltip"],[3,"series","chart","xaxis","yaxis","colors","fill"],[1,"space-y-3","max-h-80","overflow-y-auto"],["class","flex items-center justify-between p-3 bg-gray-50 rounded-lg",4,"ngFor","ngForOf"],["class","text-center py-8 text-gray-500",4,"ngIf"],[1,"flex","items-center","justify-between","p-3","bg-gray-50","rounded-lg"],[1,"flex","items-center","space-x-3"],[1,"w-3","h-3","bg-green-500","rounded-full"],[1,"font-medium","text-gray-900"],[1,"text-right"],[1,"text-xs","text-gray-500"],[1,"text-center","py-8","text-gray-500"]],template:function(t,a){if(t&1){let d=Y();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"div")(4,"h1",4),s(5,"Dashboard"),i(),n(6,"p",5),s(7,"Resumen general del sistema de estacionamientos"),i()(),n(8,"div",6)(9,"mat-form-field",7)(10,"mat-label"),s(11,"Fecha"),i(),n(12,"input",8),H("ngModelChange",function(u){return b(d),U(a.selectedDate,u)||(a.selectedDate=u),f(u)}),D("dateChange",function(){return b(d),f(a.onDateChange())}),i(),p(13,"mat-datepicker-toggle",9)(14,"mat-datepicker",null,0),i(),n(16,"button",10),D("click",function(){return b(d),f(a.refreshData())}),n(17,"mat-icon"),s(18,"refresh"),i()(),n(19,"button",11),D("click",function(){return b(d),f(a.exportReport())}),n(20,"mat-icon"),s(21,"download"),i(),s(22," Exportar "),i()()()(),M(23,Ne,2,0,"div",12)(24,Ye,3,2,"div",13)(25,Ve,84,28,"div",14),i()}if(t&2){let d=V(15);o(12),c("matDatepicker",d),$("ngModel",a.selectedDate),o(),c("for",d),o(3),c("disabled",a.loading),o(3),c("disabled",!a.dashboardData),o(4),c("ngIf",a.loading),o(),c("ngIf",a.error),o(),c("ngIf",a.dashboardData&&!a.loading)}},dependencies:[X,G,W,fe,ge,ue,be,De,le,oe,de,ce,me,_e,xe,Ee,Se,Ce,Me,ae,re,se,ie,ne,ye,ve,Ie,Ae,Le,he,pe,Pe,Te],styles:[".apx-chart[_ngcontent-%COMP%]{width:100%}.stats-card[_ngcontent-%COMP%]{transition:transform .2s ease-in-out}.stats-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.active-session-item[_ngcontent-%COMP%]{transition:background-color .2s ease-in-out}.active-session-item[_ngcontent-%COMP%]:hover{background-color:#0000000d}.quick-action-button[_ngcontent-%COMP%]{height:48px;min-width:120px}.quick-action-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}@media (max-width: 768px){.grid-cols-6[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (max-width: 480px){.grid-cols-6[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return r})();export{w as CustomDateAdapter,$e as DATE_FORMATS,Pt as DashboardComponent};
