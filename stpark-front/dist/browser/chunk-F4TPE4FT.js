import{a as nt}from"./chunk-BJU3BTBB.js";import{c as Q}from"./chunk-5BS7ZJIQ.js";import{a as F,b as U,c as $,d as V,e as W,f as Y,g as q,h as z,i as G,j as J,k as K}from"./chunk-MTXYWIWL.js";import{a as X,b as Z,c as tt,e as et,f as it}from"./chunk-NB6DWIHZ.js";import{a as B,b as H}from"./chunk-QYKB6O4W.js";import"./chunk-JQ7ZGKDS.js";import"./chunk-VKB6BRO6.js";import{b as O,c as L}from"./chunk-7EGXZGVT.js";import{a as j,b as N}from"./chunk-7AXTM6W3.js";import"./chunk-DO3SX6N4.js";import"./chunk-EGGCURRC.js";import{la as R,na as P,oa as k}from"./chunk-AHUY5V3P.js";import"./chunk-CQGOYTFO.js";import{b as T,d as A}from"./chunk-DOMNBE5L.js";import"./chunk-7OGW3PNS.js";import{m as w,s as M}from"./chunk-TQARHOKX.js";import{$b as S,Eb as d,Gb as u,Pb as n,Qb as e,Rb as v,Sb as b,Tb as g,U as h,Vb as I,bb as r,bc as s,cb as x,f as C,mc as a,nc as m,oa as E,oc as p,pa as y,pb as D,wb as f}from"./chunk-BSJZAB7M.js";import"./chunk-TSRGIXR5.js";function ot(i,o){if(i&1){let t=I();n(0,"button",8),S("click",function(){E(t);let c=s();return y(c.downloadReport("pdf"))}),n(1,"mat-icon"),a(2,"picture_as_pdf"),e(),a(3," Descargar PDF "),e()}}function lt(i,o){i&1&&(n(0,"div",9),v(1,"mat-spinner",10),e())}function dt(i,o){if(i&1&&(n(0,"mat-card",13)(1,"mat-card-content",14)(2,"div",15)(3,"div",31)(4,"mat-icon",32),a(5,"account_balance_wallet"),e()(),n(6,"div",17)(7,"p",18),a(8,"Efectivo Esperado"),e(),n(9,"p",33),a(10),e()()()()()),i&2){let t=s(2);r(10),m(t.formatAmount(t.totals.cash_expected))}}function st(i,o){if(i&1&&(n(0,"mat-card",13)(1,"mat-card-content",14)(2,"div",15)(3,"div",34)(4,"mat-icon",35),a(5,"payments"),e()(),n(6,"div",17)(7,"p",18),a(8,"Efectivo Cobrado"),e(),n(9,"p",36),a(10),e()()()()()),i&2){let t=s(2);r(10),m(t.formatAmount(t.totals.cash_collected))}}function mt(i,o){if(i&1&&(n(0,"mat-card",13)(1,"mat-card-content",14)(2,"div",15)(3,"div",16)(4,"mat-icon"),a(5),e()(),n(6,"div",17)(7,"p",18),a(8,"Diferencia"),e(),n(9,"p",37),a(10),e()()()()()),i&2){let t=s(2);r(3),u("bg-red-100",t.shift.cash_over_short<0)("bg-green-100",t.shift.cash_over_short>0),r(),u("text-red-600",t.shift.cash_over_short<0)("text-green-600",t.shift.cash_over_short>0),r(),p(" ",t.shift.cash_over_short<0?"trending_down":"trending_up"," "),r(4),u("text-red-600",t.shift.cash_over_short<0)("text-green-600",t.shift.cash_over_short>0),r(),p(" ",t.formatAmount(t.shift.cash_over_short)," ")}}function ct(i,o){if(i&1&&(n(0,"div",38)(1,"span",26),a(2,"Cierre"),e(),n(3,"span",29),a(4),e()()),i&2){let t=s(2);r(4),m(t.formatDate(t.shift.closed_at))}}function ft(i,o){if(i&1&&(n(0,"div",25)(1,"span",26),a(2,"Retiros"),e(),n(3,"span",43),a(4),e()()),i&2){let t=s(3);r(4),p("-",t.formatAmount(t.totals.cash_withdrawals),"")}}function pt(i,o){if(i&1&&(n(0,"div",25)(1,"span",26),a(2,"Dep\xF3sitos"),e(),n(3,"span",39),a(4),e()()),i&2){let t=s(3);r(4),p("+",t.formatAmount(t.totals.cash_deposits),"")}}function _t(i,o){if(i&1&&(n(0,"div",38)(1,"span",26),a(2,"Efectivo Declarado"),e(),n(3,"span",28),a(4),e()()),i&2){let t=s(3);r(4),m(t.formatAmount(t.totals.cash_declared))}}function ut(i,o){if(i&1&&(n(0,"mat-card",13)(1,"mat-card-header",22)(2,"mat-card-title",23)(3,"mat-icon"),a(4,"account_balance"),e(),a(5," Flujo de Efectivo "),e()(),n(6,"mat-card-content")(7,"div",24)(8,"div",25)(9,"span",26),a(10,"Fondo Inicial"),e(),n(11,"span",28),a(12),e()(),n(13,"div",25)(14,"span",26),a(15,"Efectivo Cobrado"),e(),n(16,"span",39),a(17),e()(),f(18,ft,5,1,"div",40)(19,pt,5,1,"div",40),n(20,"div",41)(21,"span",42),a(22,"Efectivo Esperado"),e(),n(23,"span",33),a(24),e()(),f(25,_t,5,1,"div",30),e()()()),i&2){let t=s(2);r(12),m(t.formatAmount(t.totals.opening_float)),r(5),p("+",t.formatAmount(t.totals.cash_collected),""),r(),d("ngIf",t.totals.cash_withdrawals>0),r(),d("ngIf",t.totals.cash_deposits>0),r(5),m(t.formatAmount(t.totals.cash_expected)),r(),d("ngIf",t.totals.cash_declared!==null&&t.totals.cash_declared!==void 0)}}function ht(i,o){i&1&&(n(0,"th",55),a(1,"M\xE9todo de Pago"),e())}function xt(i,o){if(i&1&&(n(0,"td",56)(1,"div",23)(2,"mat-icon",57),a(3),e(),n(4,"span",58),a(5),e()()()),i&2){let t=o.$implicit,l=s(3);r(3),m(l.getMethodIcon(t.method)),r(2),m(l.getMethodText(t.method))}}function vt(i,o){i&1&&(n(0,"th",59),a(1,"Transacciones"),e())}function bt(i,o){if(i&1&&(n(0,"td",60)(1,"span",61),a(2),e()()),i&2){let t=o.$implicit;r(2),m(t.count)}}function gt(i,o){i&1&&(n(0,"th",59),a(1,"Monto Total"),e())}function St(i,o){if(i&1&&(n(0,"td",60)(1,"span",62),a(2),e()()),i&2){let t=o.$implicit,l=s(3);r(2),m(l.formatAmount(t.collected))}}function Ct(i,o){i&1&&v(0,"tr",63)}function Et(i,o){i&1&&v(0,"tr",64)}function yt(i,o){if(i&1&&(n(0,"mat-card",13)(1,"mat-card-header",22)(2,"mat-card-title",23)(3,"mat-icon"),a(4,"receipt_long"),e(),a(5," Pagos por M\xE9todo "),e()(),n(6,"mat-card-content")(7,"div",44)(8,"table",45),b(9,46),f(10,ht,2,0,"th",47)(11,xt,6,2,"td",48),g(),b(12,49),f(13,vt,2,0,"th",50)(14,bt,3,1,"td",51),g(),b(15,52),f(16,gt,2,0,"th",50)(17,St,3,1,"td",51),g(),f(18,Ct,1,0,"tr",53)(19,Et,1,0,"tr",54),e()()()()),i&2){let t=s(2);r(8),d("dataSource",t.totals.payments_by_method),r(10),d("matHeaderRowDef",t.displayedColumns),r(),d("matRowDefColumns",t.displayedColumns)}}function Dt(i,o){if(i&1&&(n(0,"div",11)(1,"div",12)(2,"mat-card",13)(3,"mat-card-content",14)(4,"div",15)(5,"div",16)(6,"mat-icon"),a(7),e()(),n(8,"div",17)(9,"p",18),a(10,"Estado"),e(),n(11,"p",19),a(12),e()()()()(),f(13,dt,11,1,"mat-card",20)(14,st,11,1,"mat-card",20)(15,mt,11,14,"mat-card",20),e(),n(16,"div",21)(17,"mat-card",13)(18,"mat-card-header",22)(19,"mat-card-title",23)(20,"mat-icon"),a(21,"info"),e(),a(22," Informaci\xF3n del Turno "),e()(),n(23,"mat-card-content")(24,"div",24)(25,"div",25)(26,"span",26),a(27,"Turno ID"),e(),n(28,"span",27),a(29),e()(),n(30,"div",25)(31,"span",26),a(32,"Operador"),e(),n(33,"span",28),a(34),e()(),n(35,"div",25)(36,"span",26),a(37,"Sector"),e(),n(38,"span",28),a(39),e()(),n(40,"div",25)(41,"span",26),a(42,"Apertura"),e(),n(43,"span",29),a(44),e()(),f(45,ct,5,1,"div",30),e()()(),f(46,ut,26,6,"mat-card",20),e(),f(47,yt,20,3,"mat-card",20),e()),i&2){let t=s();r(5),u("bg-green-100",t.shift.status==="OPEN")("bg-blue-100",t.shift.status==="CLOSED")("bg-red-100",t.shift.status==="CANCELED"),r(),u("text-green-600",t.shift.status==="OPEN")("text-blue-600",t.shift.status==="CLOSED")("text-red-600",t.shift.status==="CANCELED"),r(),p(" ",t.shift.status==="OPEN"?"stopwatch":t.shift.status==="CLOSED"?"check_circle":"cancel"," "),r(4),u("text-green-600",t.shift.status==="OPEN")("text-blue-600",t.shift.status==="CLOSED")("text-red-600",t.shift.status==="CANCELED"),r(),p(" ",t.shift.status==="OPEN"?"Abierto":t.shift.status==="CLOSED"?"Cerrado":"Cancelado"," "),r(),d("ngIf",t.totals),r(),d("ngIf",t.totals),r(),d("ngIf",t.shift.cash_over_short!==null&&t.shift.cash_over_short!==void 0),r(14),p("#",t.shift.id.substring(0,8),""),r(5),m((t.shift.operator==null?null:t.shift.operator.name)||"N/A"),r(5),m((t.shift.sector==null?null:t.shift.sector.name)||"N/A"),r(5),m(t.formatDate(t.shift.opened_at)),r(),d("ngIf",t.shift.closed_at),r(),d("ngIf",t.totals),r(),d("ngIf",t.totals&&t.totals.payments_by_method&&t.totals.payments_by_method.length>0)}}var Yt=(()=>{class i{constructor(t,l,c,_){this.route=t,this.router=l,this.shiftService=c,this.snackBar=_,this._unsubscribeAll=new C,this.shift=null,this.totals=null,this.report=null,this.loading=!1,this.shiftId="",this.displayedColumns=["method","collected","count"]}ngOnInit(){this.shiftId=this.route.snapshot.paramMap.get("id")||"",this.shiftId&&this.loadShift()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadShift(){this.loading=!0,this.shiftService.getShift(this.shiftId).pipe(h(this._unsubscribeAll)).subscribe({next:t=>{t.success&&t.data&&(this.shift=t.data.shift,this.totals=t.data.totals,this.loadReport()),this.loading=!1},error:t=>{console.error("Error loading shift:",t),this.loading=!1}})}loadReport(){this.shiftService.getShiftReport(this.shiftId).pipe(h(this._unsubscribeAll)).subscribe({next:t=>{t.success&&t.data&&(this.report=t.data)},error:t=>console.error("Error loading report:",t)})}formatAmount(t){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP"}).format(t)}formatDate(t){return t?new Date(t).toLocaleString("es-CL"):"-"}getMethodIcon(t){switch(t){case"CASH":return"payments";case"CARD":return"credit_card";case"WEBPAY":return"account_balance";case"TRANSFER":return"account_balance_wallet";default:return"payment"}}getMethodText(t){switch(t){case"CASH":return"Efectivo";case"CARD":return"Tarjeta";case"WEBPAY":return"Webpay";case"TRANSFER":return"Transferencia";default:return t}}goBack(){this.router.navigate(["/parking/shifts"])}downloadReport(t="pdf"){t==="pdf"?this.shiftService.downloadShiftReportPdf(this.shiftId).pipe(h(this._unsubscribeAll)).subscribe({next:l=>{let c=window.URL.createObjectURL(l),_=document.createElement("a");_.href=c;let at=this.shiftId.substring(0,8),rt=new Date().toISOString().split("T")[0];_.download=`reporte-turno-${at}-${rt}.pdf`,document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(c),this.snackBar.open("Reporte descargado exitosamente","Cerrar",{duration:3e3})},error:l=>{console.error("Error downloading report:",l),this.snackBar.open("Error al descargar el reporte","Cerrar",{duration:3e3})}}):this.shiftService.getShiftReport(this.shiftId,t).pipe(h(this._unsubscribeAll)).subscribe({next:l=>{l.success&&console.log("Report:",l.data)},error:l=>{console.error("Error downloading report:",l),this.snackBar.open("Error al obtener el reporte","Cerrar",{duration:3e3})}})}static{this.\u0275fac=function(l){return new(l||i)(x(T),x(A),x(nt),x(B))}}static{this.\u0275cmp=D({type:i,selectors:[["app-shift-detail"]],decls:11,vars:3,consts:[[1,"p-6","w-full"],[1,"flex","items-center","gap-4","mb-6"],["mat-icon-button","",1,"rounded-sm",3,"click"],[1,"text-2xl","font-bold","text-gray-900"],[1,"flex-1"],["mat-raised-button","","color","primary","class","rounded-sm",3,"click",4,"ngIf"],["class","flex justify-center items-center h-64",4,"ngIf"],["class","space-y-6",4,"ngIf"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"flex","justify-center","items-center","h-64"],["diameter","50"],[1,"space-y-6"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6"],[1,"rounded-lg"],[1,"p-6"],[1,"flex","items-center","mb-2"],[1,"p-3","rounded-full"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-lg","font-bold"],["class","rounded-lg",4,"ngIf"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"pb-4"],[1,"flex","items-center","gap-2"],[1,"space-y-4"],[1,"flex","items-center","justify-between","py-2","border-b","border-gray-100"],[1,"text-gray-600","font-medium"],[1,"font-mono","text-sm","font-semibold"],[1,"font-semibold","text-gray-900"],[1,"text-sm"],["class","flex items-center justify-between py-2",4,"ngIf"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"text-xl","font-bold","text-blue-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-xl","font-bold","text-green-600"],[1,"text-xl","font-bold"],[1,"flex","items-center","justify-between","py-2"],[1,"font-semibold","text-green-600"],["class","flex items-center justify-between py-2 border-b border-gray-100",4,"ngIf"],[1,"flex","items-center","justify-between","py-3","border-t-2","border-blue-200","bg-blue-50","px-2","-mx-2","rounded"],[1,"font-semibold","text-blue-900"],[1,"font-semibold","text-red-600"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","method"],["mat-header-cell","","class","font-semibold",4,"matHeaderCellDef"],["mat-cell","","class","py-4",4,"matCellDef"],["matColumnDef","count"],["mat-header-cell","","class","font-semibold text-right",4,"matHeaderCellDef"],["mat-cell","","class","text-right",4,"matCellDef"],["matColumnDef","collected"],["mat-header-row","","class","border-b-2 border-gray-200",4,"matHeaderRowDef"],["mat-row","","class","border-b border-gray-100",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"font-semibold"],["mat-cell","",1,"py-4"],[1,"text-gray-400","text-sm"],[1,"font-medium"],["mat-header-cell","",1,"font-semibold","text-right"],["mat-cell","",1,"text-right"],[1,"font-semibold"],[1,"font-bold","text-gray-900"],["mat-header-row","",1,"border-b-2","border-gray-200"],["mat-row","",1,"border-b","border-gray-100"]],template:function(l,c){l&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),S("click",function(){return c.goBack()}),n(3,"mat-icon"),a(4,"arrow_back"),e()(),n(5,"h1",3),a(6,"Detalle de Turno"),e(),v(7,"span",4),f(8,ot,4,0,"button",5),e(),f(9,lt,2,0,"div",6)(10,Dt,48,30,"div",7),e()),l&2&&(r(8),d("ngIf",(c.shift==null?null:c.shift.status)==="CLOSED"),r(),d("ngIf",c.loading),r(),d("ngIf",!c.loading&&c.shift))},dependencies:[M,w,it,X,tt,et,Z,k,R,P,L,O,N,j,Q,K,F,$,q,V,U,z,W,Y,G,J,H],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f;border-radius:8px}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151}.mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}@media (max-width: 768px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}"]})}}return i})();export{Yt as ShiftDetailComponent};
