import{a as _e}from"./chunk-IGTKWB6A.js";import{a as Fe}from"./chunk-QU4WFXUG.js";import{a as ke}from"./chunk-ZMZZWBL4.js";import{a as ue,b as fe,c as he,d as ge,e as Re,f as Se,g as ve,h as xe,i as be,j as ye,k as Ce}from"./chunk-CCGP22DJ.js";import{a as Te,b as Ee,c as Me,d as De,e as we,f as Ie}from"./chunk-NB6DWIHZ.js";import{a as le,b as se,c as de,d as pe}from"./chunk-VOI6ZFOM.js";import{a as me,b as ce}from"./chunk-F3KLSFSR.js";import{b as Z}from"./chunk-CSAVAYTO.js";import"./chunk-LKYHZS4A.js";import"./chunk-VKB6BRO6.js";import{b as Q,c as X}from"./chunk-7EGXZGVT.js";import{b as ae}from"./chunk-7AXTM6W3.js";import{b as G,f as U,j as Y,k as $,o as oe,p as ne}from"./chunk-FMD5N6HP.js";import{b as ee,f as te,j as re,w as ie}from"./chunk-SOR2HQFJ.js";import{W as N,fa as z,la as q,na as J,oa as K}from"./chunk-AHUY5V3P.js";import"./chunk-CQGOYTFO.js";import"./chunk-7OGW3PNS.js";import{l as B,m as H,p as j,s as L}from"./chunk-TQARHOKX.js";import{$b as v,Eb as m,Fc as T,Gb as D,Hc as E,Lc as W,Pb as e,Qb as t,Rb as g,Sb as R,Tb as S,U as M,Vb as A,bb as a,bc as w,cb as C,f as V,lc as k,mc as o,nc as _,oa as f,oc as F,pa as h,pb as P,pc as O,rc as x,sc as b,tc as y,vc as I,wb as c}from"./chunk-BSJZAB7M.js";import"./chunk-TSRGIXR5.js";var Ve=()=>[],Oe=()=>["plate","started_at","ended_at","sector","operator","duration","amount"];function Pe(i,l){i&1&&g(0,"div",40)}function Ae(i,l){i&1&&g(0,"div",40)}function We(i,l){i&1&&g(0,"div",40)}function Be(i,l){if(i&1&&(e(0,"mat-option",34),o(1),t()),i&2){let r=l.$implicit;m("value",r.id),a(),_(r.name)}}function He(i,l){if(i&1&&(e(0,"mat-option",34),o(1),t()),i&2){let r=l.$implicit;m("value",r.id),a(),_(r.name)}}function je(i,l){i&1&&(e(0,"span"),o(1,"Resultados - Reporte de Ventas"),t())}function Le(i,l){i&1&&(e(0,"span"),o(1,"Resultados - Reporte de Deudas"),t())}function Ne(i,l){i&1&&(e(0,"span"),o(1,"Resultados - Reporte por Operador"),t())}function ze(i,l){i&1&&(e(0,"th",63),o(1,"Placa"),t())}function Ge(i,l){if(i&1&&(e(0,"td",64),o(1),t()),i&2){let r=l.$implicit;a(),_(r.plate)}}function Ue(i,l){i&1&&(e(0,"th",63),o(1,"Fecha Inicio"),t())}function Ye(i,l){if(i&1&&(e(0,"td",64),o(1),T(2,"date"),t()),i&2){let r=l.$implicit;a(),_(E(2,1,r.started_at,"dd/MM/yyyy HH:mm"))}}function $e(i,l){i&1&&(e(0,"th",63),o(1,"Fecha Fin"),t())}function qe(i,l){if(i&1&&(e(0,"td",64),o(1),T(2,"date"),t()),i&2){let r=l.$implicit;a(),_(E(2,1,r.ended_at,"dd/MM/yyyy HH:mm"))}}function Je(i,l){i&1&&(e(0,"th",63),o(1,"Sector"),t())}function Ke(i,l){if(i&1&&(e(0,"td",64),o(1),t()),i&2){let r=l.$implicit;a(),_(r.sector)}}function Qe(i,l){i&1&&(e(0,"th",63),o(1,"Operador"),t())}function Xe(i,l){if(i&1&&(e(0,"td",64),o(1),t()),i&2){let r=l.$implicit;a(),_(r.operator)}}function Ze(i,l){i&1&&(e(0,"th",63),o(1,"Duraci\xF3n"),t())}function et(i,l){if(i&1&&(e(0,"td",64),o(1),t()),i&2){let r=l.$implicit;a(),_(r.duration_formatted||"N/A")}}function tt(i,l){i&1&&(e(0,"th",63),o(1,"Monto"),t())}function rt(i,l){if(i&1&&(e(0,"td",64),o(1),t()),i&2){let r=l.$implicit,d=w(3);a(),_(d.reportService.formatAmount(r.amount||0))}}function it(i,l){i&1&&g(0,"tr",65)}function ot(i,l){i&1&&g(0,"tr",66)}function nt(i,l){i&1&&(e(0,"div",67)(1,"p",68),o(2,"No hay datos para mostrar"),t()())}function at(i,l){if(i&1&&(e(0,"div",49)(1,"table",50),R(2,51),c(3,ze,2,0,"th",52)(4,Ge,2,1,"td",53),S(),R(5,54),c(6,Ue,2,0,"th",52)(7,Ye,3,4,"td",53),S(),R(8,55),c(9,$e,2,0,"th",52)(10,qe,3,4,"td",53),S(),R(11,56),c(12,Je,2,0,"th",52)(13,Ke,2,1,"td",53),S(),R(14,57),c(15,Qe,2,0,"th",52)(16,Xe,2,1,"td",53),S(),R(17,58),c(18,Ze,2,0,"th",52)(19,et,2,1,"td",53),S(),R(20,59),c(21,tt,2,0,"th",52)(22,rt,2,1,"td",53),S(),c(23,it,1,0,"tr",60)(24,ot,1,0,"tr",61),t(),c(25,nt,3,0,"div",62),t()),i&2){let r=w(2);a(),m("dataSource",r.currentReport.sessions||I(4,Ve)),a(22),m("matHeaderRowDef",I(5,Oe)),a(),m("matRowDefColumns",I(6,Oe)),a(),m("ngIf",!r.currentReport.sessions||r.currentReport.sessions.length===0)}}function lt(i,l){if(i&1&&(e(0,"mat-card",25)(1,"mat-card-header")(2,"mat-card-title"),c(3,je,2,0,"span",41)(4,Le,2,0,"span",41)(5,Ne,2,0,"span",41),t(),e(6,"mat-card-subtitle"),o(7),T(8,"date"),T(9,"date"),t()(),e(10,"mat-card-content",9)(11,"div",42)(12,"div",43)(13,"p",15),o(14,"Total Registros"),t(),e(15,"p",44),o(16),t()(),e(17,"div",45)(18,"p",15),o(19,"Monto Total"),t(),e(20,"p",17),o(21),t()(),e(22,"div",46)(23,"p",15),o(24,"Per\xEDodo"),t(),e(25,"p",47),o(26),t()()(),c(27,at,26,7,"div",48),t()()),i&2){let r=w();a(3),m("ngIf",r.currentReportType==="sales"),a(),m("ngIf",r.currentReportType==="debts"),a(),m("ngIf",r.currentReportType==="operator"),a(2),O(" Per\xEDodo: ",E(8,10,r.filters.date_from,"dd/MM/yyyy")," - ",E(9,13,r.filters.date_to,"dd/MM/yyyy")," "),a(9),F(" ",r.currentReport.total_sales||r.currentReport.total_sessions||r.currentReport.total_debts||0," "),a(5),F(" ",r.reportService.formatAmount(r.currentReport.total_amount||0)," "),a(5),O(" ",r.currentReport.period==null?null:r.currentReport.period.from," - ",r.currentReport.period==null?null:r.currentReport.period.to," "),a(),m("ngIf",r.currentReportType==="sales")}}var Wt=(()=>{class i{constructor(r,d,n,p){this.reportService=r,this.sectorService=d,this.operatorService=n,this.cdr=p,this._unsubscribeAll=new V,this.loading=!1,this.dashboardData=null,this.filters={date_from:new Date(new Date().setDate(new Date().getDate()-7)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0],sector_id:void 0,operator_id:void 0},this.selectedReportType="sales",this.sectors=[],this.operators=[],this.currentReport=null,this.currentReportType="",this.displayedColumns=["plate","started_at","ended_at","sector","operator","duration","amount"]}ngOnInit(){this.loadDashboardData(),this.loadFiltersData()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadDashboardData(){this.loading=!0,this.reportService.getDashboard().pipe(M(this._unsubscribeAll)).subscribe({next:r=>{this.dashboardData=r.data,this.loading=!1},error:r=>{console.error("Error loading dashboard data:",r),this.loading=!1}})}loadFiltersData(){this.sectorService.getSectors().subscribe({next:r=>{this.sectors=r.data.data||[]},error:r=>console.error("Error loading sectors:",r)}),this.operatorService.getAllOperators().subscribe({next:r=>{this.operators=r.data||[]},error:r=>console.error("Error loading operators:",r)})}onCardClick(r){this.selectedReportType=r}generateReportFromFilters(){this.generateReport(this.selectedReportType)}generateReport(r){this.currentReportType=r,this.loading=!0;let d={date_from:this.filters.date_from,date_to:this.filters.date_to};this.filters.sector_id&&(d.sector_id=this.filters.sector_id),this.filters.operator_id&&(d.operator_id=this.filters.operator_id);let n;switch(r){case"sales":n=this.reportService.getSalesReport(d);break;case"debts":n=this.reportService.getDebtsReport(d);break;case"operator":if(!d.operator_id){alert("Debe seleccionar un operador"),this.loading=!1;return}n=this.reportService.getOperatorReport(d);break;default:this.loading=!1;return}n.pipe(M(this._unsubscribeAll)).subscribe({next:p=>{this.currentReport=p.data,this.loading=!1,this.cdr.detectChanges()},error:p=>{console.error("Error generating report:",p),this.loading=!1}})}exportReport(r){if(this.currentReport&&this.currentReportType===r){this.exportCurrentReport();return}this.currentReportType=r,this.loading=!0;let d={date_from:this.filters.date_from,date_to:this.filters.date_to};this.filters.sector_id&&(d.sector_id=this.filters.sector_id),this.filters.operator_id&&(d.operator_id=this.filters.operator_id);let n;switch(r){case"sales":n=this.reportService.getSalesReport(d);break;case"debts":n=this.reportService.getDebtsReport(d);break;case"operator":if(!d.operator_id){alert("Debe seleccionar un operador"),this.loading=!1;return}n=this.reportService.getOperatorReport(d);break;default:this.loading=!1;return}n.pipe(M(this._unsubscribeAll)).subscribe({next:p=>{this.currentReport=p.data,this.loading=!1,this.cdr.detectChanges(),this.exportCurrentReport()},error:p=>{console.error("Error generating report:",p),this.loading=!1}})}exportCurrentReport(){if(!this.currentReport)return;let r={date_from:this.filters.date_from,date_to:this.filters.date_to};this.filters.sector_id&&(r.sector_id=this.filters.sector_id),this.filters.operator_id&&(r.operator_id=this.filters.operator_id),this.reportService.exportToPdf(this.currentReportType,r)}clearFilters(){this.filters={date_from:new Date(new Date().setDate(new Date().getDate()-7)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0],sector_id:void 0,operator_id:void 0},this.currentReport=null,this.currentReportType=""}getTotalSales(){return this.currentReport&&this.currentReportType==="sales"?this.reportService.formatAmount(this.currentReport.total_amount||0):this.dashboardData?.today_sales?.total_amount?this.reportService.formatAmount(this.dashboardData.today_sales.total_amount):"$0"}getTotalPayments(){return this.currentReport&&this.currentReportType==="payments"?this.currentReport.total_payments||0:this.dashboardData?.today_payments?.count||0}getTotalDebts(){return this.currentReport&&this.currentReportType==="debts"?this.currentReport.total_debts||0:this.dashboardData?.pending_debts?.count||0}getTotalDebtsAmount(){return this.currentReport&&this.currentReportType==="debts"?this.reportService.formatAmount(this.currentReport.total_amount||0):this.dashboardData?.pending_debts?.total_amount?this.reportService.formatAmount(this.dashboardData.pending_debts.total_amount):"$0"}getOperatorCount(){return this.currentReport&&this.currentReportType==="operator"&&this.currentReport.sessions?.total||0}getSessionsCount(){return this.currentReport&&this.currentReportType==="sessions"?(this.currentReport.total_sessions||0).toString():this.dashboardData?.active_sessions?.count!==void 0?this.dashboardData.active_sessions.count.toString():"0"}getPaymentMethodLabel(r){return{CASH:"Efectivo",CARD:"Tarjeta",WEBPAY:"Webpay",TRANSFER:"Transferencia"}[r]||r}static{this.\u0275fac=function(d){return new(d||i)(C(_e),C(ke),C(Fe),C(W))}}static{this.\u0275cmp=P({type:i,selectors:[["app-reports"]],decls:118,vars:32,consts:[["picker1",""],["picker2",""],[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[1,"relative","hover:shadow-lg","transition-all"],["class","absolute inset-0 bg-gray-300 bg-opacity-30 z-10 rounded-lg",4,"ngIf"],[1,"p-6"],[1,"flex","items-center","mb-4"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"ml-4"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-green-600"],["mat-icon-button","",3,"click"],[1,"p-3","bg-red-100","rounded-full"],[1,"text-red-600"],[1,"text-2xl","font-bold","text-red-600"],[1,"p-3","bg-purple-100","rounded-full"],[1,"text-purple-600"],[1,"text-2xl","font-bold","text-purple-600"],[1,"mt-6"],[1,"grid","grid-cols-1","md:grid-cols-5","gap-4"],["appearance","outline"],[3,"ngModelChange","ngModel"],["value","sales"],["value","debts"],["value","operator"],["matInput","","type","text","placeholder","dd/mm/yyyy",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"flex","justify-end","gap-4","mt-6"],["mat-stroked-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["class","mt-6",4,"ngIf"],[1,"absolute","inset-0","bg-gray-300","bg-opacity-30","z-10","rounded-lg"],[4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6"],[1,"bg-blue-50","p-4","rounded-lg"],[1,"text-2xl","font-bold","text-blue-600"],[1,"bg-green-50","p-4","rounded-lg"],[1,"bg-purple-50","p-4","rounded-lg"],[1,"text-lg","font-semibold","text-purple-600"],["class","overflow-x-auto",4,"ngIf"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","plate"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","started_at"],["matColumnDef","ended_at"],["matColumnDef","sector"],["matColumnDef","operator"],["matColumnDef","duration"],["matColumnDef","amount"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","text-center py-8",4,"ngIf"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"text-center","py-8"],[1,"text-gray-500"]],template:function(d,n){if(d&1){let p=A();e(0,"div",2)(1,"div",3)(2,"div")(3,"h1",4),o(4,"Reportes"),t(),e(5,"p",5),o(6,"Genera y exporta reportes del sistema"),t()()(),e(7,"div",6)(8,"mat-card",7),c(9,Pe,1,0,"div",8),e(10,"mat-card-content",9)(11,"div",10)(12,"div",11)(13,"mat-icon",12),o(14,"trending_up"),t()(),e(15,"div",13)(16,"h3",14),o(17,"Reporte de Ventas"),t(),e(18,"p",15),o(19,"An\xE1lisis de ventas por per\xEDodo"),t()()(),e(20,"div",16)(21,"span",17),o(22),t(),e(23,"button",18),v("click",function(s){return f(p),n.exportReport("sales"),h(s.stopPropagation())}),e(24,"mat-icon"),o(25,"download"),t()()()()(),e(26,"mat-card",7),c(27,Ae,1,0,"div",8),e(28,"mat-card-content",9)(29,"div",10)(30,"div",19)(31,"mat-icon",20),o(32,"account_balance_wallet"),t()(),e(33,"div",13)(34,"h3",14),o(35,"Reporte de Deudas"),t(),e(36,"p",15),o(37,"An\xE1lisis de deudas pendientes"),t()()(),e(38,"div",16)(39,"span",21),o(40),t(),e(41,"button",18),v("click",function(s){return f(p),n.exportReport("debts"),h(s.stopPropagation())}),e(42,"mat-icon"),o(43,"download"),t()()()()(),e(44,"mat-card",7),c(45,We,1,0,"div",8),e(46,"mat-card-content",9)(47,"div",10)(48,"div",22)(49,"mat-icon",23),o(50,"people"),t()(),e(51,"div",13)(52,"h3",14),o(53,"Reporte por Operador"),t(),e(54,"p",15),o(55,"Rendimiento por operador"),t()()(),e(56,"div",16)(57,"span",24),o(58),t(),e(59,"button",18),v("click",function(s){return f(p),n.exportReport("operator"),h(s.stopPropagation())}),e(60,"mat-icon"),o(61,"download"),t()()()()()(),e(62,"mat-card",25)(63,"mat-card-header")(64,"mat-card-title"),o(65,"Filtros de Reporte"),t(),e(66,"mat-card-subtitle"),o(67,"Configura los par\xE1metros para generar reportes personalizados"),t()(),e(68,"mat-card-content",9)(69,"div",26)(70,"mat-form-field",27)(71,"mat-label"),o(72,"Tipo de Reporte"),t(),e(73,"mat-select",28),y("ngModelChange",function(s){return f(p),b(n.selectedReportType,s)||(n.selectedReportType=s),h(s)}),e(74,"mat-option",29),o(75,"Reporte de Ventas"),t(),e(76,"mat-option",30),o(77,"Reporte de Deudas"),t(),e(78,"mat-option",31),o(79,"Reporte por Operador"),t()()(),e(80,"mat-form-field",27)(81,"mat-label"),o(82,"Fecha desde"),t(),e(83,"input",32),y("ngModelChange",function(s){return f(p),b(n.filters.date_from,s)||(n.filters.date_from=s),h(s)}),t(),g(84,"mat-datepicker-toggle",33)(85,"mat-datepicker",null,0),t(),e(87,"mat-form-field",27)(88,"mat-label"),o(89,"Fecha hasta"),t(),e(90,"input",32),y("ngModelChange",function(s){return f(p),b(n.filters.date_to,s)||(n.filters.date_to=s),h(s)}),t(),g(91,"mat-datepicker-toggle",33)(92,"mat-datepicker",null,1),t(),e(94,"mat-form-field",27)(95,"mat-label"),o(96,"Sector"),t(),e(97,"mat-select",28),y("ngModelChange",function(s){return f(p),b(n.filters.sector_id,s)||(n.filters.sector_id=s),h(s)}),e(98,"mat-option",34),o(99,"Todos los sectores"),t(),c(100,Be,2,2,"mat-option",35),t()(),e(101,"mat-form-field",27)(102,"mat-label"),o(103,"Operador"),t(),e(104,"mat-select",28),y("ngModelChange",function(s){return f(p),b(n.filters.operator_id,s)||(n.filters.operator_id=s),h(s)}),e(105,"mat-option",34),o(106,"Todos los operadores"),t(),c(107,He,2,2,"mat-option",35),t()()(),e(108,"div",36)(109,"button",37),v("click",function(){return f(p),h(n.clearFilters())}),e(110,"mat-icon"),o(111,"refresh"),t(),o(112," Limpiar "),t(),e(113,"button",38),v("click",function(){return f(p),h(n.generateReportFromFilters())}),e(114,"mat-icon"),o(115,"search"),t(),o(116," Generar Reporte "),t()()()(),c(117,lt,28,16,"mat-card",39),t()}if(d&2){let p=k(86),u=k(93);a(8),D("cursor-pointer",n.selectedReportType==="sales")("opacity-50",n.selectedReportType!=="sales"),a(),m("ngIf",n.selectedReportType!=="sales"),a(13),_(n.getTotalSales()),a(4),D("cursor-pointer",n.selectedReportType==="debts")("opacity-50",n.selectedReportType!=="debts"),a(),m("ngIf",n.selectedReportType!=="debts"),a(13),_(n.getTotalDebtsAmount()),a(4),D("cursor-pointer",n.selectedReportType==="operator")("opacity-50",n.selectedReportType!=="operator"),a(),m("ngIf",n.selectedReportType!=="operator"),a(13),_(n.getOperatorCount()),a(15),x("ngModel",n.selectedReportType),a(10),m("matDatepicker",p),x("ngModel",n.filters.date_from),a(),m("for",p),a(6),m("matDatepicker",u),x("ngModel",n.filters.date_to),a(),m("for",u),a(6),x("ngModel",n.filters.sector_id),a(),m("value",void 0),a(2),m("ngForOf",n.sectors),a(4),x("ngModel",n.filters.operator_id),a(),m("value",void 0),a(2),m("ngForOf",n.operators),a(10),m("ngIf",n.currentReport&&n.currentReportType)}},dependencies:[L,B,H,j,ie,ee,te,re,Ie,Te,Me,we,De,Ee,K,q,J,X,Q,ae,$,Y,G,U,ne,oe,pe,le,se,de,ce,me,z,Ce,ue,he,ve,ge,fe,xe,Re,Se,be,ye,N,Z],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f;transition:box-shadow .3s ease}.mat-mdc-card[_ngcontent-%COMP%]:hover{box-shadow:0 10px 25px #00000026}@media (max-width: 768px){.grid-cols-3[_ngcontent-%COMP%], .grid-cols-4[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return i})();export{Wt as ReportsComponent};
