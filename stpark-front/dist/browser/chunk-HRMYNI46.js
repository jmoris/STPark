import{a as Ee}from"./chunk-HQDJMMZR.js";import{a as le,b as se,c as de}from"./chunk-IAB63KK4.js";import{a as ce,b as ue,c as pe,d as ge,e as fe,f as _e}from"./chunk-NB6DWIHZ.js";import{d as ne}from"./chunk-6DX2DSMH.js";import{a as oe,b as me}from"./chunk-YOYZ3SXE.js";import{a as Y,b as ee}from"./chunk-BFKOMUGM.js";import{a as te,b as re}from"./chunk-MVJB4HTB.js";import"./chunk-RRHSJPSV.js";import"./chunk-QT3W5JSU.js";import{a as f}from"./chunk-VKB6BRO6.js";import{a as ie,b as ae}from"./chunk-M6EHWIYJ.js";import{b as U,c as V}from"./chunk-7EGXZGVT.js";import{d as W,e as X}from"./chunk-7QQT45KE.js";import{b as N,c as D,d as G,j as B,k as L}from"./chunk-DO3SX6N4.js";import{b as O,d as s,f as H,g as j,k as z,l as $,n as R,o as Z,s as J,v as K,y as Q}from"./chunk-EGGCURRC.js";import{W as P,fa as q,la as w,oa as A}from"./chunk-AHUY5V3P.js";import"./chunk-CQGOYTFO.js";import{d as k}from"./chunk-7OGW3PNS.js";import{m as I,s as T}from"./chunk-TQARHOKX.js";import{$b as _,Eb as l,Pb as r,Qb as e,Rb as u,bb as m,cb as g,mc as t,pb as F,wb as c}from"./chunk-BSJZAB7M.js";import"./chunk-TSRGIXR5.js";function be(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function xe(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function he(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Se(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function ve(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ce(a,d){a&1&&(r(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Me(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function ye(a,d){a&1&&(r(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Fe(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ie(a,d){a&1&&(r(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}var nt=(()=>{class a{constructor(i,o,n,p){this.fb=i,this.pricingProfileService=o,this.http=n,this.snackBar=p,this.loading=!1,this.generalForm=this.fb.group({name:["STPark - Sistema de Estacionamientos",[s.required]],currency:["CLP",[s.required]],timezone:["America/Santiago",[s.required]],language:["es",[s.required]]}),this.pricingForm=this.fb.group({price_per_min:[0,[s.required,s.min(0)]],min_amount:[0,[s.required,s.min(0)]],daily_max_amount:[0,[s.required,s.min(0)]],start_time:["00:00",s.required],end_time:["23:59",s.required],is_active:[!0]})}ngOnInit(){this.loadGeneralSettings(),this.loadDefaultPricing()}loadGeneralSettings(){this.loading=!0,this.http.get(`${f.apiUrl}/settings/general`).subscribe({next:i=>{i&&i.success&&i.data?(console.log("Configuraci\xF3n general cargada:",i.data),this.generalForm.patchValue(i.data)):console.warn("La respuesta no tiene el formato esperado:",i),this.loading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n general:",i),console.log("No hay configuraci\xF3n general previa, usando valores por defecto"),this.loading=!1}})}loadDefaultPricing(){this.loading=!0,this.http.get(`${f.apiUrl}/settings/default-pricing`).subscribe({next:i=>{i&&i.success&&i.data?(console.log("Configuraci\xF3n de precios cargada:",i.data),this.pricingForm.patchValue(i.data)):console.warn("La respuesta no tiene el formato esperado:",i),this.loading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n de precios:",i),console.log("No hay configuraci\xF3n previa, usando valores por defecto"),this.loading=!1}})}saveSettings(){let i=this.getActiveTab();i==="general"?this.saveGeneralSettings():i==="pricing"&&this.savePricingSettings()}getActiveTab(){let i=document.querySelector("mat-tab-group");if(i){let o=i.querySelector(".mat-mdc-tab-active");if(o){let n=o.querySelector(".mdc-tab__text-label");if(n?.textContent?.toLowerCase().includes("general"))return"general";if(n?.textContent?.toLowerCase().includes("precios"))return"pricing"}}return"general"}saveGeneralSettings(){if(this.generalForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let i=this.generalForm.value;this.http.post(`${f.apiUrl}/settings/general`,i).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n general guardada exitosamente","Cerrar",{duration:3e3}),this.loading=!1},error:o=>{console.error("Error al guardar configuraci\xF3n general:",o),this.snackBar.open("Error al guardar la configuraci\xF3n general","Cerrar",{duration:3e3}),this.loading=!1}})}savePricingSettings(){if(this.pricingForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let i=this.pricingForm.value;this.http.post(`${f.apiUrl}/settings/default-pricing`,i).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n de precios guardada exitosamente","Cerrar",{duration:3e3}),this.loading=!1},error:o=>{console.error("Error al guardar configuraci\xF3n de precios:",o),this.snackBar.open("Error al guardar la configuraci\xF3n de precios","Cerrar",{duration:3e3}),this.loading=!1}})}resetSettings(){this.generalForm.reset({name:"STPark - Sistema de Estacionamientos",currency:"CLP",timezone:"America/Santiago",language:"es"}),this.pricingForm.reset({price_per_min:0,min_amount:0,daily_max_amount:0,start_time:"00:00",end_time:"23:59",is_active:!0}),this.snackBar.open("Valores restaurados","Cerrar",{duration:2e3})}static{this.\u0275fac=function(o){return new(o||a)(g(K),g(Ee),g(k),g(te))}}static{this.\u0275cmp=F({type:a,selectors:[["app-settings"]],decls:119,vars:12,consts:[[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"flex","gap-2"],["mat-stroked-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"w-full"],["label","General"],[1,"p-6"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Nombre del sistema"],[4,"ngIf"],["formControlName","currency"],["value","CLP"],["value","USD"],["formControlName","timezone"],["value","America/Santiago"],["value","UTC"],["formControlName","language"],["value","es"],["value","en"],["label","Precios"],[1,"space-y-4"],[1,"bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-800","rounded-lg","p-4"],[1,"flex","items-start","gap-3"],[1,"text-blue-600","dark:text-blue-400"],[1,"text-sm","text-blue-800","dark:text-blue-200"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["matInput","","type","number","formControlName","price_per_min","placeholder","0","min","0"],["matInput","","type","number","formControlName","min_amount","placeholder","0","min","0"],["matInput","","type","number","formControlName","daily_max_amount","placeholder","0","min","0"],[1,"my-6"],[1,"text-lg","font-semibold","mb-4"],["matInput","","type","time","formControlName","start_time"],["matInput","","type","time","formControlName","end_time"],[1,"flex","items-center","gap-2","mb-4"],["formControlName","is_active"]],template:function(o,n){if(o&1&&(r(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),t(4,"Configuraci\xF3n"),e(),r(5,"p",3),t(6,"Configura los par\xE1metros del sistema de estacionamientos"),e()(),r(7,"div",4)(8,"button",5),_("click",function(){return n.resetSettings()}),r(9,"mat-icon"),t(10,"refresh"),e(),t(11," Restaurar "),e(),r(12,"button",6),_("click",function(){return n.saveSettings()}),r(13,"mat-icon"),t(14,"save"),e(),t(15," Guardar "),e()()(),r(16,"mat-tab-group",7)(17,"mat-tab",8)(18,"div",9)(19,"mat-card")(20,"mat-card-header")(21,"mat-card-title"),t(22,"Configuraci\xF3n General"),e(),r(23,"mat-card-subtitle"),t(24,"Par\xE1metros b\xE1sicos del sistema"),e()(),r(25,"mat-card-content")(26,"form",10)(27,"div",11)(28,"mat-form-field",12)(29,"mat-label"),t(30,"Nombre del sistema"),e(),u(31,"input",13),c(32,be,2,0,"mat-error",14),e(),r(33,"mat-form-field",12)(34,"mat-label"),t(35,"Moneda"),e(),r(36,"mat-select",15)(37,"mat-option",16),t(38,"Peso Chileno (CLP)"),e(),r(39,"mat-option",17),t(40,"D\xF3lar Americano (USD)"),e()(),c(41,xe,2,0,"mat-error",14),e(),r(42,"mat-form-field",12)(43,"mat-label"),t(44,"Zona horaria"),e(),r(45,"mat-select",18)(46,"mat-option",19),t(47,"Santiago (GMT-3)"),e(),r(48,"mat-option",20),t(49,"UTC (GMT+0)"),e()(),c(50,he,2,0,"mat-error",14),e(),r(51,"mat-form-field",12)(52,"mat-label"),t(53,"Idioma"),e(),r(54,"mat-select",21)(55,"mat-option",22),t(56,"Espa\xF1ol"),e(),r(57,"mat-option",23),t(58,"English"),e()(),c(59,Se,2,0,"mat-error",14),e()()()()()()(),r(60,"mat-tab",24)(61,"div",9)(62,"mat-card")(63,"mat-card-header")(64,"mat-card-title"),t(65,"Configuraci\xF3n de Precios por Defecto"),e(),r(66,"mat-card-subtitle"),t(67,"Establece las tarifas por defecto del sistema"),e()(),r(68,"mat-card-content")(69,"div",25)(70,"div",26)(71,"div",27)(72,"mat-icon",28),t(73,"info"),e(),r(74,"div",29)(75,"strong"),t(76,"Nota:"),e(),t(77," Estos precios se utilizar\xE1n como regla de precio por defecto si no existen otras reglas espec\xEDficas para el sector. "),e()()(),r(78,"form",10)(79,"div",30)(80,"mat-form-field",12)(81,"mat-label"),t(82,"Costo por Minuto (CLP)"),e(),u(83,"input",31),r(84,"mat-hint"),t(85,"Precio por cada minuto de estacionamiento"),e(),c(86,ve,2,0,"mat-error",14)(87,Ce,2,0,"mat-error",14),e(),r(88,"mat-form-field",12)(89,"mat-label"),t(90,"Tarifa M\xEDnima (CLP)"),e(),u(91,"input",32),r(92,"mat-hint"),t(93,"Cantidad m\xEDnima a cobrar"),e(),c(94,Me,2,0,"mat-error",14)(95,ye,2,0,"mat-error",14),e(),r(96,"mat-form-field",12)(97,"mat-label"),t(98,"Tarifa M\xE1xima (CLP)"),e(),u(99,"input",33),r(100,"mat-hint"),t(101,"L\xEDmite m\xE1ximo a cobrar por d\xEDa"),e(),c(102,Fe,2,0,"mat-error",14)(103,Ie,2,0,"mat-error",14),e()(),u(104,"mat-divider",34),r(105,"h3",35),t(106,"Configuraci\xF3n de Horarios"),e(),r(107,"div",11)(108,"mat-form-field",12)(109,"mat-label"),t(110,"Hora de Inicio"),e(),u(111,"input",36),e(),r(112,"mat-form-field",12)(113,"mat-label"),t(114,"Hora de Fin"),e(),u(115,"input",37),e()(),r(116,"div",38)(117,"mat-checkbox",39),t(118,"Regla activa"),e()()()()()()()()()()),o&2){let p,E,b,x,h,S,v,C,M,y;m(26),l("formGroup",n.generalForm),m(6),l("ngIf",(p=n.generalForm.get("name"))==null?null:p.hasError("required")),m(9),l("ngIf",(E=n.generalForm.get("currency"))==null?null:E.hasError("required")),m(9),l("ngIf",(b=n.generalForm.get("timezone"))==null?null:b.hasError("required")),m(9),l("ngIf",(x=n.generalForm.get("language"))==null?null:x.hasError("required")),m(19),l("formGroup",n.pricingForm),m(8),l("ngIf",(h=n.pricingForm.get("price_per_min"))==null?null:h.hasError("required")),m(),l("ngIf",(S=n.pricingForm.get("price_per_min"))==null?null:S.hasError("min")),m(7),l("ngIf",(v=n.pricingForm.get("min_amount"))==null?null:v.hasError("required")),m(),l("ngIf",(C=n.pricingForm.get("min_amount"))==null?null:C.hasError("min")),m(7),l("ngIf",(M=n.pricingForm.get("daily_max_amount"))==null?null:M.hasError("required")),m(),l("ngIf",(y=n.pricingForm.get("daily_max_amount"))==null?null:y.hasError("min"))}},dependencies:[T,I,Q,z,O,$,H,j,J,R,Z,_e,ce,pe,fe,ge,ue,A,w,V,U,de,le,se,L,B,N,G,D,X,W,me,oe,q,ae,ie,ee,Y,P,ne,re],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-tab-group[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.config-item[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:8px;padding:1rem;transition:all .2s ease}.config-item[_ngcontent-%COMP%]:hover{border-color:#3b82f6;box-shadow:0 2px 4px #0000001a}@media (max-width: 768px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return a})();export{nt as SettingsComponent};
