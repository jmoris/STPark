import{a as ct}from"./chunk-BEHE27WQ.js";import{a as W}from"./chunk-6AGRNQTD.js";import{a as dt}from"./chunk-J2G3Y6LG.js";import{a as at,c as rt}from"./chunk-ICPS6N2F.js";import{a as Xe,b as et,c as tt,d as G,e as nt,f as it,g as st}from"./chunk-TU7IT4N6.js";import{a as Oe,b as He,c as Ue,d as $e,e as Ge,f as We,g as Qe,h as Ye,i as Ze,j as Je,k as Ke}from"./chunk-Y6UNS2UZ.js";import{a as ot,c as mt,f as lt}from"./chunk-N7KP3IEB.js";import"./chunk-KEI4KRBM.js";import{a as U,b as Ve}from"./chunk-FSRW5HPF.js";import{a as pe,b as ue,c as fe,e as _e,f as ge,g as he,h as w}from"./chunk-65NYBKEE.js";import{a as ve,b as ye,c as Me,d as Fe}from"./chunk-IDWAZBHT.js";import{a as be,b as Te}from"./chunk-FSA3IEFI.js";import{a as Re,b as $}from"./chunk-POSCZER2.js";import"./chunk-ECYJLMJT.js";import"./chunk-VKB6BRO6.js";import{a as Le,b as je}from"./chunk-RDXEG6SZ.js";import{b as q,c as z}from"./chunk-IMRKXFOQ.js";import{d as L,e as j}from"./chunk-5Q7CCL6V.js";import{a as O,b as H}from"./chunk-CWSZZ2DY.js";import{b as k,c as xe,d as Ee,e as Se,j as N,k as P}from"./chunk-K3BNOLHS.js";import{A as ze,b as V,d as u,f as R,g as Ie,j as De,k as we,l as ke,n as Ne,q as Pe,u as Be,x as Ae,z as qe}from"./chunk-ZTFUS4RN.js";import{fa as ce,la as B,na as Ce,oa as A}from"./chunk-QQQ5XT6I.js";import"./chunk-YXFY4UXK.js";import"./chunk-EARUC3FY.js";import{l as de,m as I,s as D}from"./chunk-BAM5RHC5.js";import{$b as E,Eb as s,Pb as n,Qb as t,Rb as p,Sb as b,Tb as T,U as M,Vb as Q,bb as m,bc as g,cb as x,f as te,fc as ne,gc as ie,hc as ae,lc as re,mc as i,nc as S,oa as v,oc as C,pa as y,pb as F,rc as oe,sc as me,tc as le,uc as se,wb as c}from"./chunk-MLNNMN4J.js";import{a as ee}from"./chunk-TSRGIXR5.js";function Tt(a,l){a&1&&(n(0,"mat-error"),i(1," El ID es requerido "),t())}function vt(a,l){a&1&&(n(0,"mat-error"),i(1," Solo se permiten letras min\xFAsculas, n\xFAmeros, guiones y guiones bajos "),t())}function yt(a,l){a&1&&(n(0,"mat-error"),i(1," Debe tener al menos 2 caracteres "),t())}function Mt(a,l){a&1&&(n(0,"mat-error"),i(1," El nombre es requerido "),t())}function Ft(a,l){a&1&&(n(0,"mat-error"),i(1," Debe tener al menos 2 caracteres "),t())}function It(a,l){if(a&1&&(n(0,"span",27),i(1),t()),a&2){let e=g().$implicit;m(),C(" - ",e.description," ")}}function Dt(a,l){if(a&1&&(n(0,"mat-option",25),i(1),c(2,It,2,1,"span",26),t()),a&2){let e=l.$implicit;s("value",e.id),m(),C(" ",e.name," "),m(),s("ngIf",e.description)}}function wt(a,l){a&1&&(n(0,"mat-error"),i(1," El plan de servicio es requerido "),t())}function kt(a,l){a&1&&(n(0,"mat-error"),i(1," Los d\xEDas de cr\xE9dito deben ser mayor o igual a 0 "),t())}function Nt(a,l){a&1&&(n(0,"mat-error"),i(1," Formato de email inv\xE1lido "),t())}function Pt(a,l){a&1&&(n(0,"mat-error"),i(1," El nombre del sistema es requerido "),t())}function Bt(a,l){a&1&&(n(0,"mat-error"),i(1," La capacidad debe ser mayor o igual a 0 "),t())}function At(a,l){if(a&1&&(n(0,"div",3)(1,"h3",4),i(2,"Configuraci\xF3n del Sistema"),t(),n(3,"div",28)(4,"mat-form-field",6)(5,"mat-label"),i(6,"Nombre del Sistema"),t(),p(7,"input",29),n(8,"mat-icon",8),i(9,"label"),t(),c(10,Pt,2,0,"mat-error",9),t(),n(11,"div",5)(12,"mat-form-field",6)(13,"mat-label"),i(14,"Capacidad M\xE1xima"),t(),p(15,"input",30),n(16,"mat-icon",8),i(17,"directions_car"),t(),n(18,"mat-hint"),i(19,"N\xFAmero m\xE1ximo de veh\xEDculos que puede albergar el estacionamiento"),t(),c(20,Bt,2,0,"mat-error",9),t(),n(21,"div",31)(22,"mat-checkbox",32)(23,"span",33),i(24,"POS TUU Habilitado"),t()(),n(25,"mat-icon",34),i(26,"info"),t()()()()()),a&2){let e,o,r=g();m(3),s("formGroup",r.settingsForm),m(7),s("ngIf",(e=r.tenantForm.get("settings.name"))==null?null:e.hasError("required")),m(10),s("ngIf",(o=r.tenantForm.get("settings.max_capacity"))==null?null:o.hasError("min")),m(5),s("matTooltip","Habilita la integraci\xF3n con POS TUU")}}function qt(a,l){a&1&&(n(0,"mat-error"),i(1," El nombre es requerido "),t())}function zt(a,l){a&1&&(n(0,"mat-error"),i(1," Debe tener al menos 2 caracteres "),t())}function Vt(a,l){a&1&&(n(0,"mat-error"),i(1," El email es requerido "),t())}function Rt(a,l){a&1&&(n(0,"mat-error"),i(1," Formato de email inv\xE1lido "),t())}function Lt(a,l){a&1&&(n(0,"mat-error"),i(1," La contrase\xF1a es requerida "),t())}function jt(a,l){a&1&&(n(0,"mat-error"),i(1," La contrase\xF1a debe tener al menos 6 caracteres "),t())}function Ot(a,l){if(a&1&&(n(0,"div",3)(1,"h3",4),i(2,"Usuario Principal"),t(),n(3,"div",28)(4,"div",5)(5,"mat-form-field",6)(6,"mat-label"),i(7,"Nombre del Usuario"),t(),p(8,"input",35),n(9,"mat-icon",8),i(10,"person"),t(),c(11,qt,2,0,"mat-error",9)(12,zt,2,0,"mat-error",9),t(),n(13,"mat-form-field",6)(14,"mat-label"),i(15,"Email"),t(),p(16,"input",36),n(17,"mat-icon",8),i(18,"email"),t(),c(19,Vt,2,0,"mat-error",9)(20,Rt,2,0,"mat-error",9),t()(),n(21,"mat-form-field",6)(22,"mat-label"),i(23,"Contrase\xF1a"),t(),p(24,"input",37),n(25,"mat-icon",8),i(26,"lock"),t(),c(27,Lt,2,0,"mat-error",9)(28,jt,2,0,"mat-error",9),t()()()),a&2){let e,o,r,d,f,_,h=g();m(3),s("formGroup",h.userForm),m(8),s("ngIf",(e=h.tenantForm.get("user.name"))==null?null:e.hasError("required")),m(),s("ngIf",(o=h.tenantForm.get("user.name"))==null?null:o.hasError("minlength")),m(7),s("ngIf",(r=h.tenantForm.get("user.email"))==null?null:r.hasError("required")),m(),s("ngIf",(d=h.tenantForm.get("user.email"))==null?null:d.hasError("email")),m(7),s("ngIf",(f=h.tenantForm.get("user.password"))==null?null:f.hasError("required")),m(),s("ngIf",(_=h.tenantForm.get("user.password"))==null?null:_.hasError("minlength"))}}function Ht(a,l){a&1&&p(0,"mat-spinner",38)}function Ut(a,l){if(a&1&&(n(0,"span"),i(1),t()),a&2){let e=g();m(),S(e.data.isEdit?"Actualizar":"Crear")}}function $t(a,l){a&1&&(n(0,"span"),i(1,"Creando..."),t())}var Y=(()=>{class a{get settingsForm(){return this.tenantForm.get("settings")}get userForm(){return this.tenantForm.get("user")}constructor(e,o,r,d,f){this.fb=e,this.dialogRef=o,this.data=r,this.tenantService=d,this.snackBar=f,this.loading=!1}ngOnInit(){this.tenantForm=this.createForm(),this.data.isEdit&&this.data.tenant&&setTimeout(()=>{this.loadTenantData()},50)}createForm(){let e=this.data.isEdit,o={id:["",[u.required,u.minLength(2),u.pattern(/^[a-z0-9_-]+$/)]],name:["",[u.required,u.minLength(2)]],plan_id:["",u.required],rut:[""],razon_social:[""],giro:[""],direccion:[""],comuna:[""],dias_credito:[0,[u.min(0)]],correo_intercambio:["",[u.email]],user:this.fb.group({name:["",e?[]:[u.required,u.minLength(2)]],email:["",e?[]:[u.required,u.email]],password:["",e?[]:[u.required,u.minLength(6)]]})};return e&&(o.settings=this.fb.group({name:["",u.required],pos_tuu:[!1],max_capacity:[0,[u.min(0)]]})),this.fb.group(o)}loadTenantData(){if(this.data.tenant){console.log("Loading tenant data:",this.data.tenant);let e=this.data.tenant.settings||{};console.log("Settings from tenant:",e);let o={id:this.data.tenant.id,name:this.data.tenant.name||"",plan_id:this.data.tenant.plan_id||"",rut:this.data.tenant.rut||"",razon_social:this.data.tenant.razon_social||"",giro:this.data.tenant.giro||"",direccion:this.data.tenant.direccion||"",comuna:this.data.tenant.comuna||"",dias_credito:this.data.tenant.dias_credito||0,correo_intercambio:this.data.tenant.correo_intercambio||""};this.tenantForm.get("settings")&&(o.settings={name:e.name||"STPark - Sistema de Estacionamientos",pos_tuu:e.pos_tuu!==void 0?!!e.pos_tuu:!1,max_capacity:e.max_capacity!==void 0?Number(e.max_capacity):0},console.log("Settings to load:",o.settings)),this.tenantForm.patchValue(o,{emitEvent:!1}),console.log("Form value after loading:",this.tenantForm.value),console.log("Settings control value:",this.tenantForm.get("settings")?.value)}}getErrorMessage(e){let o=this.tenantForm.get(e);return o?.hasError("required")?"Este campo es requerido":o?.hasError("minlength")?"Debe tener al menos 2 caracteres":o?.hasError("email")?"Formato de email inv\xE1lido":o?.hasError("pattern")?"Solo se permiten letras min\xFAsculas, n\xFAmeros, guiones y guiones bajos":"Campo inv\xE1lido"}getUserErrorMessage(e){let r=this.tenantForm.get("user")?.get(e);return r?.hasError("required")?"Este campo es requerido":r?.hasError("minlength")?e==="password"?"La contrase\xF1a debe tener al menos 6 caracteres":"Debe tener al menos 2 caracteres":r?.hasError("email")?"Formato de email inv\xE1lido":"Campo inv\xE1lido"}onSubmit(){if(this.tenantForm.valid){this.loading=!0;let e=this.tenantForm.value;if(this.data.isEdit&&this.data.tenant){let o={name:e.name.trim(),plan_id:e.plan_id,rut:e.rut?.trim()||null,razon_social:e.razon_social?.trim()||null,giro:e.giro?.trim()||null,direccion:e.direccion?.trim()||null,comuna:e.comuna?.trim()||null,dias_credito:e.dias_credito?parseInt(e.dias_credito):0,correo_intercambio:e.correo_intercambio?.trim()||null};e.settings&&(o.settings={name:e.settings.name?.trim()||"STPark - Sistema de Estacionamientos",pos_tuu:e.settings.pos_tuu!==void 0?e.settings.pos_tuu:!1,max_capacity:e.settings.max_capacity!==void 0?parseInt(e.settings.max_capacity):0}),this.tenantService.updateTenant(this.data.tenant.id,o).subscribe({next:r=>{this.loading=!1,this.snackBar.open("Estacionamiento actualizado exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:r=>{this.loading=!1,console.error("Error updating tenant:",r);let d=r.error?.message||"Error al actualizar estacionamiento";this.snackBar.open(d,"Cerrar",{duration:5e3})}})}else{let o={id:e.id.toLowerCase().trim(),name:e.name.trim(),plan_id:e.plan_id,rut:e.rut?.trim()||null,razon_social:e.razon_social?.trim()||null,giro:e.giro?.trim()||null,direccion:e.direccion?.trim()||null,comuna:e.comuna?.trim()||null,dias_credito:e.dias_credito?parseInt(e.dias_credito):0,correo_intercambio:e.correo_intercambio?.trim()||null,user:{name:e.user.name.trim(),email:e.user.email.trim().toLowerCase(),password:e.user.password}};this.tenantService.createTenant(o).subscribe({next:r=>{this.loading=!1,this.snackBar.open("Estacionamiento creado exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:r=>{this.loading=!1,console.error("Error creating tenant:",r);let d=r.error?.message||"Error al crear estacionamiento";this.snackBar.open(d,"Cerrar",{duration:5e3})}})}}else this.tenantForm.markAllAsTouched()}onCancel(){this.dialogRef.close(!1)}static{this.\u0275fac=function(o){return new(o||a)(x(Ae),x(pe),x(ue),x(W),x(U))}}static{this.\u0275cmp=F({type:a,selectors:[["app-tenant-form"]],decls:100,vars:19,consts:[["mat-dialog-title",""],[1,"mr-2"],[1,"space-y-4",3,"formGroup"],[1,"mb-6"],[1,"text-lg","font-semibold","mb-4","text-gray-700"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","id","placeholder","ej: estacionamiento-1",3,"readonly"],["matPrefix",""],[4,"ngIf"],["matInput","","formControlName","name","placeholder","Nombre descriptivo"],["formControlName","plan_id"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","rut","placeholder","Ej: 12345678-9"],["matInput","","formControlName","razon_social","placeholder","Nombre de la empresa"],["matInput","","formControlName","giro","placeholder","Actividad econ\xF3mica"],["matInput","","formControlName","direccion","placeholder","Direcci\xF3n completa"],["matInput","","formControlName","comuna","placeholder","Comuna"],["matInput","","type","number","formControlName","dias_credito","placeholder","0","min","0"],["matInput","","type","email","formControlName","correo_intercambio","placeholder","correo@ejemplo.com"],["class","mb-6",4,"ngIf"],["align","end",1,"p-4"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20","class","inline-block mr-2",4,"ngIf"],[3,"value"],["class","text-gray-500 text-sm ml-2",4,"ngIf"],[1,"text-gray-500","text-sm","ml-2"],[3,"formGroup"],["matInput","","formControlName","name","placeholder","Nombre del sistema"],["matInput","","type","number","formControlName","max_capacity","placeholder","0","min","0"],[1,"flex","items-center","mt-6"],["formControlName","pos_tuu"],[1,"ml-2"],[1,"ml-2","text-gray-500",3,"matTooltip"],["matInput","","formControlName","name","placeholder","Nombre completo"],["matInput","","type","email","formControlName","email","placeholder","usuario@ejemplo.com"],["matInput","","type","password","formControlName","password","placeholder","M\xEDnimo 6 caracteres"],["diameter","20",1,"inline-block","mr-2"]],template:function(o,r){if(o&1&&(n(0,"h2",0)(1,"mat-icon",1),i(2,"local_parking"),t(),i(3),t(),n(4,"mat-dialog-content")(5,"form",2)(6,"div",3)(7,"h3",4),i(8,"Informaci\xF3n del Estacionamiento"),t(),n(9,"div",5)(10,"mat-form-field",6)(11,"mat-label"),i(12,"ID del Estacionamiento"),t(),p(13,"input",7),n(14,"mat-icon",8),i(15,"tag"),t(),n(16,"mat-hint"),i(17,"Solo letras min\xFAsculas, n\xFAmeros y guiones"),t(),c(18,Tt,2,0,"mat-error",9)(19,vt,2,0,"mat-error",9)(20,yt,2,0,"mat-error",9),t(),n(21,"mat-form-field",6)(22,"mat-label"),i(23,"Nombre del Estacionamiento"),t(),p(24,"input",10),n(25,"mat-icon",8),i(26,"business"),t(),c(27,Mt,2,0,"mat-error",9)(28,Ft,2,0,"mat-error",9),t()(),n(29,"mat-form-field",6)(30,"mat-label"),i(31,"Plan de Servicio"),t(),n(32,"mat-select",11),c(33,Dt,3,3,"mat-option",12),t(),n(34,"mat-icon",8),i(35,"card_membership"),t(),c(36,wt,2,0,"mat-error",9),t()(),n(37,"div",3)(38,"h3",4),i(39,"Informaci\xF3n de Facturaci\xF3n"),t(),n(40,"div",5)(41,"mat-form-field",6)(42,"mat-label"),i(43,"RUT"),t(),p(44,"input",13),n(45,"mat-icon",8),i(46,"badge"),t()(),n(47,"mat-form-field",6)(48,"mat-label"),i(49,"Raz\xF3n Social"),t(),p(50,"input",14),n(51,"mat-icon",8),i(52,"business"),t()()(),n(53,"mat-form-field",6)(54,"mat-label"),i(55,"Giro"),t(),p(56,"input",15),n(57,"mat-icon",8),i(58,"work"),t()(),n(59,"div",5)(60,"mat-form-field",6)(61,"mat-label"),i(62,"Direcci\xF3n"),t(),p(63,"input",16),n(64,"mat-icon",8),i(65,"location_on"),t()(),n(66,"mat-form-field",6)(67,"mat-label"),i(68,"Comuna"),t(),p(69,"input",17),n(70,"mat-icon",8),i(71,"place"),t()()(),n(72,"div",5)(73,"mat-form-field",6)(74,"mat-label"),i(75,"D\xEDas de Cr\xE9dito"),t(),p(76,"input",18),n(77,"mat-icon",8),i(78,"schedule"),t(),n(79,"mat-hint"),i(80,"N\xFAmero de d\xEDas de cr\xE9dito para facturaci\xF3n"),t(),c(81,kt,2,0,"mat-error",9),t(),n(82,"mat-form-field",6)(83,"mat-label"),i(84,"Correo Intercambio"),t(),p(85,"input",19),n(86,"mat-icon",8),i(87,"email"),t(),n(88,"mat-hint"),i(89,"Correo electr\xF3nico para intercambio de documentos"),t(),c(90,Nt,2,0,"mat-error",9),t()()(),c(91,At,27,4,"div",20)(92,Ot,29,7,"div",20),t()(),n(93,"mat-dialog-actions",21)(94,"button",22),E("click",function(){return r.onCancel()}),i(95," Cancelar "),t(),n(96,"button",23),E("click",function(){return r.onSubmit()}),c(97,Ht,1,0,"mat-spinner",24)(98,Ut,2,1,"span",9)(99,$t,2,0,"span",9),t()()),o&2){let d,f,_,h,Z,J,K,X;m(3),C(" ",r.data.isEdit?"Editar Estacionamiento":"Nuevo Estacionamiento",`
`),m(2),s("formGroup",r.tenantForm),m(8),s("readonly",r.data.isEdit),m(5),s("ngIf",(d=r.tenantForm.get("id"))==null?null:d.hasError("required")),m(),s("ngIf",(f=r.tenantForm.get("id"))==null?null:f.hasError("pattern")),m(),s("ngIf",(_=r.tenantForm.get("id"))==null?null:_.hasError("minlength")),m(7),s("ngIf",(h=r.tenantForm.get("name"))==null?null:h.hasError("required")),m(),s("ngIf",(Z=r.tenantForm.get("name"))==null?null:Z.hasError("minlength")),m(5),s("ngForOf",r.data.plans),m(3),s("ngIf",(J=r.tenantForm.get("plan_id"))==null?null:J.hasError("required")),m(45),s("ngIf",(K=r.tenantForm.get("dias_credito"))==null?null:K.hasError("min")),m(9),s("ngIf",(X=r.tenantForm.get("correo_intercambio"))==null?null:X.hasError("email")),m(),s("ngIf",r.data.isEdit&&r.settingsForm),m(),s("ngIf",!r.data.isEdit),m(2),s("disabled",r.loading),m(2),s("disabled",r.loading||r.tenantForm.invalid),m(),s("ngIf",r.loading),m(),s("ngIf",!r.loading),m(),s("ngIf",r.loading)}},dependencies:[D,de,I,ze,we,V,ke,R,Ie,Be,Ne,Pe,w,_e,he,ge,P,N,k,Ee,xe,Se,j,L,A,B,z,q,$,Re,ce,H,O,je,Le,Te,be],encapsulation:2})}}return a})();function Gt(a,l){a&1&&(n(0,"th",45),i(1,"ID"),t())}function Wt(a,l){if(a&1&&(n(0,"td",46)(1,"div",47)(2,"mat-icon",48),i(3,"tag"),t(),n(4,"span",49),i(5),t()()()),a&2){let e=l.$implicit;m(5),S(e.id)}}function Qt(a,l){a&1&&(n(0,"th",50),i(1,"Nombre"),t())}function Yt(a,l){if(a&1&&(n(0,"td",46)(1,"span",51),i(2),t()()),a&2){let e=l.$implicit;m(2),S(e.name||e.id)}}function Zt(a,l){a&1&&(n(0,"th",52),i(1,"Plan de Servicio"),t())}function Jt(a,l){if(a&1&&(n(0,"mat-chip",55),i(1),t()),a&2){let e=g().$implicit,o=g();m(),C(" ",o.getPlanName(e)," ")}}function Kt(a,l){a&1&&(n(0,"span",56),i(1,"Sin plan"),t())}function Xt(a,l){if(a&1&&(n(0,"td",46),c(1,Jt,2,1,"mat-chip",53)(2,Kt,2,0,"span",54),t()),a&2){let e=l.$implicit;m(),s("ngIf",e.plan),m(),s("ngIf",!e.plan)}}function en(a,l){a&1&&(n(0,"th",57),i(1,"Fecha de Inicio"),t())}function tn(a,l){if(a&1&&(n(0,"td",46)(1,"span",4),i(2),t()()),a&2){let e=l.$implicit,o=g();m(2),S(o.formatDate(e.created_at))}}function nn(a,l){a&1&&(n(0,"th",58),i(1,"Usuarios"),t())}function an(a,l){if(a&1&&(n(0,"td",46)(1,"div",47)(2,"mat-icon",59),i(3,"people"),t(),n(4,"span",60),i(5),t()()()),a&2){let e=l.$implicit;m(5),S(e.users_count||0)}}function rn(a,l){a&1&&(n(0,"th",52),i(1,"Acciones"),t())}function on(a,l){if(a&1){let e=Q();n(0,"td",46)(1,"button",61)(2,"mat-icon"),i(3,"more_vert"),t()(),n(4,"mat-menu",null,0)(6,"button",62),E("click",function(){let r=v(e).$implicit,d=g();return y(d.viewTenant(r))}),n(7,"mat-icon"),i(8,"visibility"),t(),i(9," Ver detalles "),t(),n(10,"button",62),E("click",function(){let r=v(e).$implicit,d=g();return y(d.editTenant(r))}),n(11,"mat-icon"),i(12,"edit"),t(),i(13," Editar "),t(),n(14,"button",63),E("click",function(){let r=v(e).$implicit,d=g();return y(d.deleteTenant(r))}),n(15,"mat-icon"),i(16,"delete"),t(),i(17," Eliminar "),t()()()}if(a&2){let e=re(5);m(),s("matMenuTriggerFor",e)}}function mn(a,l){a&1&&p(0,"tr",64)}function ln(a,l){a&1&&p(0,"tr",65)}function sn(a,l){a&1&&(n(0,"div",66),p(1,"mat-spinner",67),t())}function dn(a,l){a&1&&(n(0,"div",68)(1,"mat-icon",69),i(2,"local_parking"),t(),n(3,"h3",70),i(4,"No hay estacionamientos registrados"),t(),n(5,"p",48),i(6,"Los estacionamientos aparecer\xE1n aqu\xED cuando se registren."),t()())}function cn(a,l){if(a&1){let e=Q();n(0,"mat-paginator",71),E("page",function(r){v(e);let d=g();return y(d.onPageChange(r))}),t()}if(a&2){let e=g();s("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}var ti=(()=>{class a{constructor(e,o,r,d){this.tenantService=e,this.planService=o,this.dialog=r,this.snackBar=d,this._unsubscribeAll=new te,this.tenants=[],this.loading=!1,this.displayedColumns=["id","name","plan","created_at","users_count","actions"],this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.sortBy="created_at",this.sortOrder="desc",this.filters={name:""},this.plans=[]}ngOnInit(){this.loadTenants(),this.loadPlans()}ngAfterViewInit(){this.sort&&this.sort.sortChange.pipe(M(this._unsubscribeAll)).subscribe(e=>{this.sortBy=e.active,this.sortOrder=e.direction==="asc"?"asc":"desc",this.currentPage=0,this.loadTenants()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadTenants(){this.loading=!0;let e=ee({page:this.currentPage+1,per_page:this.pageSize,sort_by:this.sortBy,sort_order:this.sortOrder},this.filters);this.tenantService.getTenants(e).pipe(M(this._unsubscribeAll)).subscribe({next:o=>{this.tenants=o.data?.data||[],this.totalItems=o.data?.total||0,this.loading=!1},error:o=>{console.error("Error loading tenants:",o),this.loading=!1,o.status===403?this.snackBar.open("No tiene permisos para acceder a esta funcionalidad","Cerrar",{duration:5e3}):this.snackBar.open("Error al cargar estacionamientos","Cerrar",{duration:3e3})}})}loadPlans(){this.planService.getPlans({status:"ACTIVE",per_page:100}).pipe(M(this._unsubscribeAll)).subscribe({next:e=>{this.plans=e.data?.data||[]},error:e=>{console.error("Error loading plans:",e)}})}formatDate(e){if(!e)return"-";let o=new Date(e);return new Intl.DateTimeFormat("es-CL",{year:"numeric",month:"2-digit",day:"2-digit"}).format(o)}getPlanName(e){return e.plan?.name||"-"}get totalUsers(){return this.tenants.reduce((e,o)=>e+(o.users_count||0),0)}get tenantsThisMonth(){let e=new Date;return this.tenants.filter(o=>{if(!o.created_at)return!1;let r=new Date(o.created_at);return r.getMonth()===e.getMonth()&&r.getFullYear()===e.getFullYear()}).length}createTenant(){this.dialog.open(Y,{width:"800px",maxWidth:"90vw",data:{isEdit:!1,plans:this.plans}}).afterClosed().subscribe(o=>{o&&this.loadTenants()})}viewTenant(e){this.tenantService.getTenant(e.id).subscribe({next:o=>{let r=o.data,d=[{label:"ID",key:"id",icon:"tag",type:"text"},{label:"Nombre",key:"name",icon:"business",type:"text"},{label:"Plan de Servicio",key:"plan.name",icon:"card_membership",type:"chip",chipColor:()=>"primary"},{label:"Cantidad de Usuarios",key:"users_count",icon:"people",type:"text",format:_=>_?`${_} usuarios`:"0 usuarios"},{label:"Fecha de Inicio de Servicio",key:"created_at",icon:"calendar_today",type:"date"},{label:"\xDAltima Actualizaci\xF3n",key:"updated_at",icon:"update",type:"date"},{label:"Nombre del Sistema",key:"settings.name",icon:"label",type:"text"},{label:"Capacidad M\xE1xima",key:"settings.max_capacity",icon:"directions_car",type:"text",format:_=>_?`${_} veh\xEDculos`:"No especificado"},{label:"POS TUU Habilitado",key:"settings.pos_tuu",icon:"point_of_sale",type:"boolean"},{label:"Idioma",key:"settings.language",icon:"language",type:"text",format:_=>_?{es:"Espa\xF1ol",en:"English",pt:"Portugu\xEAs"}[_]||_:"No especificado"},{label:"Moneda",key:"settings.currency",icon:"attach_money",type:"text"},{label:"Zona Horaria",key:"settings.timezone",icon:"schedule",type:"text"}],f=this.dialog.open(dt,{width:"700px",data:{title:"Detalles del Estacionamiento",data:r,fields:d,actions:[{label:"Editar",icon:"edit",color:"primary",action:()=>{f.close(),this.editTenant(e)}}]}})},error:o=>{console.error("Error loading tenant:",o),this.snackBar.open("Error al cargar los datos del estacionamiento","Cerrar",{duration:3e3})}})}editTenant(e){this.tenantService.getTenant(e.id).subscribe({next:o=>{let r=o.data;console.log("Tenant loaded for edit:",r),console.log("Settings:",r.settings),this.dialog.open(Y,{width:"800px",maxWidth:"90vw",data:{isEdit:!0,tenant:r,plans:this.plans}}).afterClosed().subscribe(f=>{f&&this.loadTenants()})},error:o=>{console.error("Error loading tenant:",o),this.snackBar.open("Error al cargar los datos del estacionamiento","Cerrar",{duration:3e3})}})}deleteTenant(e){confirm(`\xBFEst\xE1 seguro de eliminar el estacionamiento ${e.name||e.id}? Esta acci\xF3n no se puede deshacer.`)&&this.tenantService.deleteTenant(e.id).subscribe({next:()=>{this.snackBar.open("Estacionamiento eliminado correctamente","Cerrar",{duration:3e3}),this.loadTenants()},error:o=>{console.error("Error deleting tenant:",o);let r=o.error?.message||"Error al eliminar estacionamiento";this.snackBar.open(r,"Cerrar",{duration:5e3})}})}applyFilters(){this.currentPage=0,this.loadTenants()}clearFilters(){this.filters={name:""},this.currentPage=0,this.loadTenants()}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadTenants()}static{this.\u0275fac=function(o){return new(o||a)(x(W),x(ct),x(fe),x(U))}}static{this.\u0275cmp=F({type:a,selectors:[["app-tenants"]],viewQuery:function(o,r){if(o&1&&ne(G,5),o&2){let d;ie(d=ae())&&(r.sort=d.first)}},features:[se([{provide:Xe,useValue:st()}])],decls:88,vars:12,consts:[["tenantMenu","matMenu"],[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-blue-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"p-3","bg-purple-100","rounded-full"],[1,"text-purple-600"],[1,"text-2xl","font-bold","text-purple-600"],[1,"mb-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline"],["matInput","","placeholder","Nombre o ID",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],[1,"overflow-x-auto"],["mat-table","","matSort","",1,"w-full",3,"dataSource","matSortActive","matSortDirection"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","id",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","name",4,"matHeaderCellDef"],["matColumnDef","plan"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","created_at"],["mat-header-cell","","mat-sort-header","created_at",4,"matHeaderCellDef"],["matColumnDef","users_count"],["mat-header-cell","","mat-sort-header","users_count",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],["mat-header-cell","","mat-sort-header","id"],["mat-cell",""],[1,"flex","items-center","gap-2"],[1,"text-gray-500"],[1,"font-mono","text-sm"],["mat-header-cell","","mat-sort-header","name"],[1,"font-semibold"],["mat-header-cell",""],["class","bg-blue-100 text-blue-800",4,"ngIf"],["class","text-gray-400",4,"ngIf"],[1,"bg-blue-100","text-blue-800"],[1,"text-gray-400"],["mat-header-cell","","mat-sort-header","created_at"],["mat-header-cell","","mat-sort-header","users_count"],[1,"text-gray-500","text-sm"],[1,"font-medium"],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"text-red-600",3,"click"],["mat-header-row",""],["mat-row",""],[1,"flex","justify-center","items-center","py-8"],["diameter","40"],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"]],template:function(o,r){o&1&&(n(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),i(4,"Estacionamientos"),t(),n(5,"p",4),i(6,"Gestiona los estacionamientos (tenants) registrados"),t()(),n(7,"button",5),E("click",function(){return r.createTenant()}),n(8,"mat-icon"),i(9,"add"),t(),i(10," Nuevo Estacionamiento "),t()(),n(11,"div",6)(12,"mat-card")(13,"mat-card-content",7)(14,"div",8)(15,"div",9)(16,"mat-icon",10),i(17,"local_parking"),t()(),n(18,"div",11)(19,"p",12),i(20,"Total Estacionamientos"),t(),n(21,"p",13),i(22),t()()()()(),n(23,"mat-card")(24,"mat-card-content",7)(25,"div",8)(26,"div",14)(27,"mat-icon",15),i(28,"people"),t()(),n(29,"div",11)(30,"p",12),i(31,"Total Usuarios"),t(),n(32,"p",16),i(33),t()()()()(),n(34,"mat-card")(35,"mat-card-content",7)(36,"div",8)(37,"div",17)(38,"mat-icon",18),i(39,"calendar_today"),t()(),n(40,"div",11)(41,"p",12),i(42,"Este Mes"),t(),n(43,"p",19),i(44),t()()()()()(),n(45,"mat-card",20)(46,"mat-card-content",7)(47,"div",21)(48,"mat-form-field",22)(49,"mat-label"),i(50,"Buscar estacionamiento"),t(),n(51,"input",23),le("ngModelChange",function(f){return me(r.filters.name,f)||(r.filters.name=f),f}),t()()(),n(52,"div",24)(53,"button",25),E("click",function(){return r.clearFilters()}),n(54,"mat-icon"),i(55,"clear"),t(),i(56," Limpiar "),t(),n(57,"button",5),E("click",function(){return r.applyFilters()}),n(58,"mat-icon"),i(59,"search"),t(),i(60," Filtrar "),t()()()(),n(61,"mat-card")(62,"mat-card-content",7)(63,"div",26)(64,"table",27),b(65,28),c(66,Gt,2,0,"th",29)(67,Wt,6,1,"td",30),T(),b(68,31),c(69,Qt,2,0,"th",32)(70,Yt,3,1,"td",30),T(),b(71,33),c(72,Zt,2,0,"th",34)(73,Xt,3,2,"td",30),T(),b(74,35),c(75,en,2,0,"th",36)(76,tn,3,1,"td",30),T(),b(77,37),c(78,nn,2,0,"th",38)(79,an,6,1,"td",30),T(),b(80,39),c(81,rn,2,0,"th",34)(82,on,18,1,"td",30),T(),c(83,mn,1,0,"tr",40)(84,ln,1,0,"tr",41),t(),c(85,sn,2,0,"div",42)(86,dn,7,0,"div",43),t(),c(87,cn,1,5,"mat-paginator",44),t()()()),o&2&&(m(22),S(r.tenants.length),m(11),C(" ",r.totalUsers," "),m(11),C(" ",r.tenantsThisMonth," "),m(7),oe("ngModel",r.filters.name),m(13),s("dataSource",r.tenants)("matSortActive",r.sortBy)("matSortDirection",r.sortOrder),m(19),s("matHeaderRowDef",r.displayedColumns),m(),s("matRowDefColumns",r.displayedColumns),m(),s("ngIf",r.loading),m(),s("ngIf",!r.loading&&r.tenants.length===0),m(),s("ngIf",r.totalItems>0))},dependencies:[D,I,qe,V,R,De,Ke,Oe,Ue,Qe,$e,He,Ye,Ge,We,Ze,Je,lt,ot,mt,A,B,Ce,z,q,H,O,P,N,k,j,L,Fe,ye,ve,Me,rt,at,$,tt,et,it,G,nt,w,Ve],encapsulation:2})}}return a})();export{ti as TenantsComponent};
