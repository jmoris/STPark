import{a as be}from"./chunk-7M455HP6.js";import{a as _e,b as xe,c as Ee}from"./chunk-TCOXJXET.js";import{d as fe}from"./chunk-EEUJEGPN.js";import{a as se,b as de,c as ce,d as pe,e as ue,f as ge}from"./chunk-N7KP3IEB.js";import{a as ae,b as re}from"./chunk-FSRW5HPF.js";import{a as ne,b as oe}from"./chunk-POSCZER2.js";import{a as te,b as ie}from"./chunk-KEI4KRBM.js";import"./chunk-ECYJLMJT.js";import{a as x}from"./chunk-VKB6BRO6.js";import{a as me,b as le}from"./chunk-RDXEG6SZ.js";import{b as U,c as j}from"./chunk-IMRKXFOQ.js";import{d as Z,e as ee}from"./chunk-5Q7CCL6V.js";import{b as w,c as G,d as B,j as V,k as L}from"./chunk-K3BNOLHS.js";import{A as Y,b as A,d as s,f as R,g as $,k as z,l as J,n as K,q as Q,u as W,x as X}from"./chunk-ZTFUS4RN.js";import{W as q,fa as D,la as O,oa as H}from"./chunk-QQQ5XT6I.js";import"./chunk-YXFY4UXK.js";import{d as T}from"./chunk-EARUC3FY.js";import{m as k,s as P}from"./chunk-BAM5RHC5.js";import{$b as b,Eb as m,Pb as i,Qb as e,Rb as u,bb as o,cb as _,mc as t,nc as N,pb as I,wb as g}from"./chunk-MLNNMN4J.js";import{d as E}from"./chunk-TSRGIXR5.js";function he(n,p){n&1&&(i(0,"mat-error"),t(1," Este campo es requerido "),e())}function ve(n,p){n&1&&(i(0,"mat-error"),t(1," Este campo es requerido "),e())}function Se(n,p){n&1&&(i(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ce(n,p){n&1&&(i(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Me(n,p){n&1&&(i(0,"mat-error"),t(1," Este campo es requerido "),e())}function ye(n,p){n&1&&(i(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Fe(n,p){n&1&&(i(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ie(n,p){n&1&&(i(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Ne(n,p){n&1&&(i(0,"mat-error"),t(1," Este campo es requerido "),e())}function ke(n,p){n&1&&(i(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}var mt=(()=>{class n{constructor(a,l,r,d){this.fb=a,this.pricingProfileService=l,this.http=r,this.snackBar=d,this.loading=!1,this.planName="Sin plan",this.generalForm=this.fb.group({name:["STPark - Sistema de Estacionamientos",[s.required]],language:["es",[s.required]],plan_name:["Sin plan"],pos_tuu:[{value:!1,disabled:!0}],max_capacity:[0,[s.required,s.min(0)]]}),this.pricingForm=this.fb.group({price_per_min:[0,[s.required,s.min(0)]],min_amount:[0,[s.required,s.min(0)]],daily_max_amount:[0,[s.required,s.min(0)]],start_time:["00:00",s.required],end_time:["23:59",s.required],is_active:[!0]})}ngOnInit(){this.loadGeneralSettings(),this.loadDefaultPricing()}loadGeneralSettings(){this.loading=!0,this.http.get(`${x.apiUrl}/settings/general`).subscribe({next:a=>{if(a&&a.success&&a.data){console.log("Configuraci\xF3n general cargada:",a.data);let r=a.data.plan_name||"Sin plan";this.planName=r,console.log("Plan name asignado:",this.planName);let l=a.data,{plan_name:d}=l,f=E(l,["plan_name"]);this.generalForm.patchValue(f),setTimeout(()=>{let c=this.generalForm.get("plan_name");c&&(c.disabled&&c.enable({emitEvent:!1}),c.setValue(r,{emitEvent:!1}),console.log("Plan name establecido en FormControl:",c.value),setTimeout(()=>{c.disable({emitEvent:!1}),console.log("Plan name deshabilitado. Valor final:",c.value)},100))},0)}else console.warn("La respuesta no tiene el formato esperado:",a);this.loading=!1},error:a=>{console.error("Error al cargar configuraci\xF3n general:",a),console.log("No hay configuraci\xF3n general previa, usando valores por defecto"),this.loading=!1}})}loadDefaultPricing(){this.loading=!0,this.http.get(`${x.apiUrl}/settings/default-pricing`).subscribe({next:a=>{a&&a.success&&a.data?(console.log("Configuraci\xF3n de precios cargada:",a.data),this.pricingForm.patchValue(a.data)):console.warn("La respuesta no tiene el formato esperado:",a),this.loading=!1},error:a=>{console.error("Error al cargar configuraci\xF3n de precios:",a),console.log("No hay configuraci\xF3n previa, usando valores por defecto"),this.loading=!1}})}saveSettings(){let a=this.getActiveTab();a==="general"?this.saveGeneralSettings():a==="pricing"&&this.savePricingSettings()}getActiveTab(){let a=document.querySelector("mat-tab-group");if(a){let l=a.querySelector(".mat-mdc-tab-active");if(l){let r=l.querySelector(".mdc-tab__text-label");if(r?.textContent?.toLowerCase().includes("general"))return"general";if(r?.textContent?.toLowerCase().includes("precios"))return"pricing"}}return"general"}saveGeneralSettings(){if(this.generalForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let d=this.generalForm.getRawValue(),{pos_tuu:a,plan_name:l}=d,r=E(d,["pos_tuu","plan_name"]);this.http.post(`${x.apiUrl}/settings/general`,r).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n general guardada exitosamente","Cerrar",{duration:3e3}),this.loading=!1},error:f=>{console.error("Error al guardar configuraci\xF3n general:",f),this.snackBar.open("Error al guardar la configuraci\xF3n general","Cerrar",{duration:3e3}),this.loading=!1}})}savePricingSettings(){if(this.pricingForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let a=this.pricingForm.value;this.http.post(`${x.apiUrl}/settings/default-pricing`,a).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n de precios guardada exitosamente","Cerrar",{duration:3e3}),this.loading=!1},error:l=>{console.error("Error al guardar configuraci\xF3n de precios:",l),this.snackBar.open("Error al guardar la configuraci\xF3n de precios","Cerrar",{duration:3e3}),this.loading=!1}})}resetSettings(){this.generalForm.reset({name:"STPark - Sistema de Estacionamientos",language:"es",pos_tuu:!1,max_capacity:0}),this.pricingForm.reset({price_per_min:0,min_amount:0,daily_max_amount:0,start_time:"00:00",end_time:"23:59",is_active:!0}),this.snackBar.open("Valores restaurados","Cerrar",{duration:2e3})}static{this.\u0275fac=function(l){return new(l||n)(_(X),_(be),_(T),_(ae))}}static{this.\u0275cmp=I({type:n,selectors:[["app-settings"]],decls:133,vars:16,consts:[[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"flex","gap-2"],["mat-stroked-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"w-full"],["label","General"],[1,"p-6"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Nombre del sistema"],[4,"ngIf"],["formControlName","language"],["value","es"],["value","en"],["formControlName","plan_name"],[3,"value"],[2,"display","inline-flex","align-items","center","gap","4px"],[2,"font-size","16px","width","16px","height","16px"],["matInput","","type","number","formControlName","max_capacity","placeholder","0","min","0"],["formControlName","pos_tuu"],["label","Precios"],[1,"space-y-4"],[1,"bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-800","rounded-lg","p-4"],[1,"flex","items-start","gap-3"],[1,"text-blue-600","dark:text-blue-400"],[1,"text-sm","text-blue-800","dark:text-blue-200"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["matInput","","type","number","formControlName","price_per_min","placeholder","0","min","0"],["matInput","","type","number","formControlName","min_amount","placeholder","0","min","0"],["matInput","","type","number","formControlName","daily_max_amount","placeholder","0","min","0"],[1,"my-6"],[1,"text-lg","font-semibold","mb-4"],["matInput","","type","time","formControlName","start_time"],["matInput","","type","time","formControlName","end_time"],[1,"flex","items-center","gap-2","mb-4"],["formControlName","is_active"]],template:function(l,r){if(l&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),t(4,"Configuraci\xF3n"),e(),i(5,"p",3),t(6,"Configura los par\xE1metros del sistema de estacionamientos"),e()(),i(7,"div",4)(8,"button",5),b("click",function(){return r.resetSettings()}),i(9,"mat-icon"),t(10,"refresh"),e(),t(11," Restaurar "),e(),i(12,"button",6),b("click",function(){return r.saveSettings()}),i(13,"mat-icon"),t(14,"save"),e(),t(15," Guardar "),e()()(),i(16,"mat-tab-group",7)(17,"mat-tab",8)(18,"div",9)(19,"mat-card")(20,"mat-card-header")(21,"mat-card-title"),t(22,"Configuraci\xF3n General"),e(),i(23,"mat-card-subtitle"),t(24,"Par\xE1metros b\xE1sicos del sistema"),e()(),i(25,"mat-card-content")(26,"form",10)(27,"div",11)(28,"mat-form-field",12)(29,"mat-label"),t(30,"Nombre del sistema"),e(),u(31,"input",13),g(32,he,2,0,"mat-error",14),e(),i(33,"mat-form-field",12)(34,"mat-label"),t(35,"Idioma"),e(),i(36,"mat-select",15)(37,"mat-option",16),t(38,"Espa\xF1ol"),e(),i(39,"mat-option",17),t(40,"English"),e()(),g(41,ve,2,0,"mat-error",14),e(),i(42,"mat-form-field",12)(43,"mat-label"),t(44,"Suscripci\xF3n"),e(),i(45,"mat-select",18)(46,"mat-option",19),t(47),e()(),i(48,"mat-hint")(49,"span",20)(50,"mat-icon",21),t(51,"lock"),e(),t(52," Plan de servicio asociado al estacionamiento (solo lectura) "),e()()(),i(53,"mat-form-field",12)(54,"mat-label"),t(55,"M\xE1xima Capacidad"),e(),u(56,"input",22),i(57,"mat-hint"),t(58,"Cantidad m\xE1xima de veh\xEDculos que pueden estar en el estacionamiento simult\xE1neamente"),e(),g(59,Se,2,0,"mat-error",14)(60,Ce,2,0,"mat-error",14),e(),i(61,"mat-form-field",12)(62,"mat-label"),t(63,"POS TUU"),e(),i(64,"mat-select",23)(65,"mat-option",19),t(66,"Activado"),e(),i(67,"mat-option",19),t(68,"Desactivado"),e()(),i(69,"mat-hint")(70,"span",20)(71,"mat-icon",21),t(72,"lock"),e(),t(73," Solo lectura - Solo administradores pueden modificar este valor "),e()()()()()()()()(),i(74,"mat-tab",24)(75,"div",9)(76,"mat-card")(77,"mat-card-header")(78,"mat-card-title"),t(79,"Configuraci\xF3n de Precios por Defecto"),e(),i(80,"mat-card-subtitle"),t(81,"Establece las tarifas por defecto del sistema"),e()(),i(82,"mat-card-content")(83,"div",25)(84,"div",26)(85,"div",27)(86,"mat-icon",28),t(87,"info"),e(),i(88,"div",29)(89,"strong"),t(90,"Nota:"),e(),t(91," Estos precios se utilizar\xE1n como regla de precio por defecto si no existen otras reglas espec\xEDficas para el sector. "),e()()(),i(92,"form",10)(93,"div",30)(94,"mat-form-field",12)(95,"mat-label"),t(96,"Costo por Minuto (CLP)"),e(),u(97,"input",31),i(98,"mat-hint"),t(99,"Precio por cada minuto de estacionamiento"),e(),g(100,Me,2,0,"mat-error",14)(101,ye,2,0,"mat-error",14),e(),i(102,"mat-form-field",12)(103,"mat-label"),t(104,"Tarifa M\xEDnima (CLP)"),e(),u(105,"input",32),i(106,"mat-hint"),t(107,"Cantidad m\xEDnima a cobrar"),e(),g(108,Fe,2,0,"mat-error",14)(109,Ie,2,0,"mat-error",14),e(),i(110,"mat-form-field",12)(111,"mat-label"),t(112,"Tarifa M\xE1xima (CLP)"),e(),u(113,"input",33),i(114,"mat-hint"),t(115,"L\xEDmite m\xE1ximo a cobrar por d\xEDa"),e(),g(116,Ne,2,0,"mat-error",14)(117,ke,2,0,"mat-error",14),e()(),u(118,"mat-divider",34),i(119,"h3",35),t(120,"Configuraci\xF3n de Horarios"),e(),i(121,"div",11)(122,"mat-form-field",12)(123,"mat-label"),t(124,"Hora de Inicio"),e(),u(125,"input",36),e(),i(126,"mat-form-field",12)(127,"mat-label"),t(128,"Hora de Fin"),e(),u(129,"input",37),e()(),i(130,"div",38)(131,"mat-checkbox",39),t(132,"Regla activa"),e()()()()()()()()()()),l&2){let d,f,c,h,v,S,C,M,y,F;o(26),m("formGroup",r.generalForm),o(6),m("ngIf",(d=r.generalForm.get("name"))==null?null:d.hasError("required")),o(9),m("ngIf",(f=r.generalForm.get("language"))==null?null:f.hasError("required")),o(5),m("value",r.planName),o(),N(r.planName),o(12),m("ngIf",(c=r.generalForm.get("max_capacity"))==null?null:c.hasError("required")),o(),m("ngIf",(h=r.generalForm.get("max_capacity"))==null?null:h.hasError("min")),o(5),m("value",!0),o(2),m("value",!1),o(25),m("formGroup",r.pricingForm),o(8),m("ngIf",(v=r.pricingForm.get("price_per_min"))==null?null:v.hasError("required")),o(),m("ngIf",(S=r.pricingForm.get("price_per_min"))==null?null:S.hasError("min")),o(7),m("ngIf",(C=r.pricingForm.get("min_amount"))==null?null:C.hasError("required")),o(),m("ngIf",(M=r.pricingForm.get("min_amount"))==null?null:M.hasError("min")),o(7),m("ngIf",(y=r.pricingForm.get("daily_max_amount"))==null?null:y.hasError("required")),o(),m("ngIf",(F=r.pricingForm.get("daily_max_amount"))==null?null:F.hasError("min"))}},dependencies:[P,k,Y,z,A,J,R,$,W,K,Q,ge,se,ce,ue,pe,de,H,O,j,U,Ee,_e,xe,L,V,w,B,G,ee,Z,oe,ne,D,le,me,ie,te,q,fe,re],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-tab-group[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.config-item[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:8px;padding:1rem;transition:all .2s ease}.config-item[_ngcontent-%COMP%]:hover{border-color:#3b82f6;box-shadow:0 2px 4px #0000001a}@media (max-width: 768px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return n})();export{mt as SettingsComponent};
