import{a as ft}from"./chunk-WLULZCPQ.js";import{a as gt}from"./chunk-3K23HDUD.js";import{a as U}from"./chunk-QU4WFXUG.js";import{a as ce}from"./chunk-ZMZZWBL4.js";import{c as st}from"./chunk-B4562CJV.js";import{a as nt,b as ot,c as at,d as pe,e as lt,f as mt,g as ut}from"./chunk-EIOBBUXT.js";import{a as We,b as Ue,c as Qe,d as Ke,e as Je,f as Xe,g as Ye,h as Ze,i as et,j as tt,k as rt,l as it}from"./chunk-JQJEW66P.js";import{a as dt,c as pt,f as ct}from"./chunk-LQ6VDMYR.js";import{a as Le,b as $e,c as He,d as Ge}from"./chunk-22A5ZCIO.js";import{a as G,b as W}from"./chunk-3XUFRE2P.js";import"./chunk-NHN5S4IY.js";import{a as H}from"./chunk-MCASAUQU.js";import{a as ee,b as te,c as ke,e as Fe,f as Te,g as Ae,h as re}from"./chunk-YFJJFD2R.js";import{a as Pe,b as Ve,c as Be,d as Ne}from"./chunk-WUZYVV4A.js";import"./chunk-VW6GL46F.js";import"./chunk-5BYKA3OK.js";import"./chunk-VKB6BRO6.js";import{b as qe}from"./chunk-BTXX7H7C.js";import{b as B,c as N}from"./chunk-VZDRD6LA.js";import{d as z,e as q}from"./chunk-FPQM25CI.js";import{a as L,b as $}from"./chunk-INOVVGPP.js";import{b as T,c as ie,f as De,j as A,k as D}from"./chunk-PXBHKAGM.js";import{b as R,d as M,f as j,g as oe,j as Re,k as ae,n as le,o as me,u as je,v as se,x as ze,y as de}from"./chunk-EGGCURRC.js";import{X as we,ga as F,ma as P,oa as ne,pa as V}from"./chunk-CVYDX437.js";import"./chunk-CQGOYTFO.js";import"./chunk-7OGW3PNS.js";import{l as ye,m as w,s as k}from"./chunk-TQARHOKX.js";import{$b as _,Eb as d,Jb as ve,Pb as n,Qb as t,Rb as h,Sb as b,Tb as E,U as O,Vb as y,bb as l,bc as c,cb as f,f as J,fc as Me,gc as be,hc as Ee,lc as K,mc as o,nc as x,oa as S,oc as g,pa as v,pb as I,pc as Oe,rc as X,sc as Y,tc as Z,uc as Ie,wb as u}from"./chunk-BSJZAB7M.js";import{a as Se}from"./chunk-TSRGIXR5.js";function Ft(r,s){if(r&1&&(n(0,"mat-error"),o(1),t()),r&2){let e=c();l(),g(" ",e.getErrorMessage("name")," ")}}function Tt(r,s){if(r&1&&(n(0,"mat-error"),o(1),t()),r&2){let e=c();l(),g(" ",e.getErrorMessage("name")," ")}}function At(r,s){if(r&1&&(n(0,"mat-error"),o(1),t()),r&2){let e=c();l(),g(" ",e.getErrorMessage("rut")," ")}}function Dt(r,s){if(r&1&&(n(0,"mat-error"),o(1),t()),r&2){let e=c();l(),g(" ",e.getErrorMessage("rut")," ")}}function Pt(r,s){if(r&1&&(n(0,"mat-error"),o(1),t()),r&2){let e=c();l(),g(" ",e.getErrorMessage("email")," ")}}function Vt(r,s){if(r&1&&(n(0,"mat-error"),o(1),t()),r&2){let e=c();l(),g(" ",e.getErrorMessage("email")," ")}}function Bt(r,s){if(r&1&&(n(0,"mat-error"),o(1),t()),r&2){let e=c();l(),g(" ",e.getErrorMessage("phone")," ")}}function Nt(r,s){if(r&1&&(n(0,"mat-error"),o(1),t()),r&2){let e=c();l(),g(" ",e.getErrorMessage("phone")," ")}}function Rt(r,s){if(r&1&&(n(0,"mat-error"),o(1),t()),r&2){let e=c();l(),g(" ",e.getErrorMessage("pin")," ")}}function jt(r,s){r&1&&h(0,"mat-spinner",21)}function zt(r,s){if(r&1&&(n(0,"mat-icon"),o(1),t()),r&2){let e=c();l(),x(e.data.isEdit?"save":"add")}}var ue=(()=>{class r{constructor(e,a,i,m,p,C){this.fb=e,this.dialogRef=a,this.data=i,this.operatorService=m,this.sectorService=p,this.snackBar=C,this.loading=!1,this.sectors=[],this.operatorForm=this.createForm()}ngOnInit(){this.loadSectors(),this.data.isEdit&&this.data.operator&&this.loadOperatorData()}createForm(){return this.fb.group({name:["",[M.required,M.minLength(2)]],rut:["",[M.required,M.pattern(/^[0-9]+-[0-9kK]{1}$/)]],email:["",[M.email]],phone:["",[M.pattern(/^[+]?[\d\s-()]+$/)]],pin:["",[M.pattern(/^[0-9]{6}$/)]],status:["ACTIVE"]})}loadSectors(){this.sectorService.getSectors().subscribe({next:e=>{this.sectors=e.data?.data||[]},error:e=>{console.error("Error loading sectors:",e),this.snackBar.open("Error al cargar sectores","Cerrar",{duration:3e3})}})}loadOperatorData(){this.data.operator&&this.operatorForm.patchValue({name:this.data.operator.name,rut:this.data.operator.rut,email:this.data.operator.email||"",phone:this.data.operator.phone||"",pin:this.data.operator.pin||"",status:this.data.operator.status||"ACTIVE"})}onSubmit(){if(this.operatorForm.valid){this.loading=!0;let e=this.operatorForm.value;if(this.data.isEdit&&this.data.operator){let a=Number(this.data.operator.id);this.operatorService.updateOperator(a,e).subscribe({next:i=>{this.loading=!1,this.snackBar.open("Operador actualizado correctamente","Cerrar",{duration:3e3}),this.dialogRef.close(i.data)},error:i=>{this.loading=!1,console.error("Error updating operator:",i),this.snackBar.open("Error al actualizar operador","Cerrar",{duration:3e3})}})}else this.operatorService.createOperator(e).subscribe({next:a=>{this.loading=!1,this.snackBar.open("Operador creado correctamente","Cerrar",{duration:3e3}),this.dialogRef.close(a.data)},error:a=>{this.loading=!1,this.snackBar.open("Error al crear operador","Cerrar",{duration:3e3})}})}else this.snackBar.open("Por favor, complete todos los campos requeridos","Cerrar",{duration:3e3})}onCancel(){this.dialogRef.close()}getErrorMessage(e){let a=this.operatorForm.get(e);return a?.hasError("required")?"Este campo es requerido":a?.hasError("email")?"Ingrese un email v\xE1lido":a?.hasError("minlength")?"M\xEDnimo 2 caracteres":a?.hasError("pattern")?e==="rut"?"Formato de RUT inv\xE1lido (ej: 12.345.678-9)":e==="pin"?"El PIN debe tener exactamente 6 d\xEDgitos":"Formato de tel\xE9fono inv\xE1lido":""}static{this.\u0275fac=function(a){return new(a||r)(f(se),f(ee),f(te),f(U),f(ce),f(H))}}static{this.\u0275cmp=I({type:r,selectors:[["app-operator-form"]],decls:56,vars:16,consts:[[1,"operator-form-dialog"],[1,"dialog-header"],[1,"dialog-title"],["mat-icon-button","",1,"close-button",3,"click"],[1,"dialog-content"],[1,"operator-form",3,"formGroup"],[1,"form-row"],["appearance","outline",1,"half-width"],["matInput","","formControlName","name","placeholder","Ingrese el nombre completo"],[4,"ngIf"],["matInput","","formControlName","rut","placeholder","12.345.678-9"],["matInput","","formControlName","email","type","email","placeholder","operador@ejemplo.com"],["matInput","","formControlName","phone","placeholder","+56 9 1234 5678"],["matInput","","formControlName","pin","placeholder","123456","maxlength","6"],["formControlName","status"],["value","ACTIVE"],["value","INACTIVE"],[1,"dialog-actions"],["mat-button","",1,"rounded-sm",3,"click","disabled"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click","disabled"],["diameter","20","class","inline-spinner",4,"ngIf"],["diameter","20",1,"inline-spinner"]],template:function(a,i){if(a&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),o(3),t(),n(4,"button",3),_("click",function(){return i.onCancel()}),n(5,"mat-icon"),o(6,"close"),t()()(),n(7,"div",4)(8,"form",5)(9,"div",6)(10,"mat-form-field",7)(11,"mat-label"),o(12,"Nombre completo"),t(),h(13,"input",8),u(14,Ft,2,1,"mat-error",9)(15,Tt,2,1,"mat-error",9),t(),n(16,"mat-form-field",7)(17,"mat-label"),o(18,"RUT"),t(),h(19,"input",10),u(20,At,2,1,"mat-error",9)(21,Dt,2,1,"mat-error",9),t()(),n(22,"div",6)(23,"mat-form-field",7)(24,"mat-label"),o(25,"Email"),t(),h(26,"input",11),u(27,Pt,2,1,"mat-error",9)(28,Vt,2,1,"mat-error",9),t(),n(29,"mat-form-field",7)(30,"mat-label"),o(31,"Tel\xE9fono"),t(),h(32,"input",12),u(33,Bt,2,1,"mat-error",9)(34,Nt,2,1,"mat-error",9),t()(),n(35,"div",6)(36,"mat-form-field",7)(37,"mat-label"),o(38,"PIN (6 d\xEDgitos)"),t(),h(39,"input",13),u(40,Rt,2,1,"mat-error",9),t(),n(41,"mat-form-field",7)(42,"mat-label"),o(43,"Estado"),t(),n(44,"mat-select",14)(45,"mat-option",15),o(46,"Activo"),t(),n(47,"mat-option",16),o(48,"Inactivo"),t()()()()()(),n(49,"div",17)(50,"button",18),_("click",function(){return i.onCancel()}),o(51," Cancelar "),t(),n(52,"button",19),_("click",function(){return i.onSubmit()}),u(53,jt,1,0,"mat-spinner",20)(54,zt,2,1,"mat-icon",9),o(55),t()()()),a&2){let m,p,C,Q,fe,_e,he,xe,Ce;l(3),g(" ",i.data.isEdit?"Editar Operador":"Nuevo Operador"," "),l(5),d("formGroup",i.operatorForm),l(6),d("ngIf",(m=i.operatorForm.get("name"))==null?null:m.hasError("required")),l(),d("ngIf",(p=i.operatorForm.get("name"))==null?null:p.hasError("minlength")),l(5),d("ngIf",(C=i.operatorForm.get("rut"))==null?null:C.hasError("required")),l(),d("ngIf",(Q=i.operatorForm.get("rut"))==null?null:Q.hasError("pattern")),l(6),d("ngIf",(fe=i.operatorForm.get("email"))==null?null:fe.hasError("required")),l(),d("ngIf",(_e=i.operatorForm.get("email"))==null?null:_e.hasError("email")),l(5),d("ngIf",(he=i.operatorForm.get("phone"))==null?null:he.hasError("required")),l(),d("ngIf",(xe=i.operatorForm.get("phone"))==null?null:xe.hasError("pattern")),l(6),d("ngIf",(Ce=i.operatorForm.get("pin"))==null?null:Ce.hasError("pattern")),l(10),d("disabled",i.loading),l(2),d("disabled",i.loading||i.operatorForm.invalid),l(),d("ngIf",i.loading),l(),d("ngIf",!i.loading),l(),g(" ",i.data.isEdit?"Actualizar":"Crear"," ")}},dependencies:[k,w,de,ae,R,j,oe,je,le,me,re,D,A,T,ie,q,z,V,P,ne,N,B,W,G,F,qe,$,L],styles:[".operator-form-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:90vh;width:100%}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem 1.5rem 0;border-bottom:1px solid #e5e7eb;margin-bottom:1rem}.dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:#111827}.close-button[_ngcontent-%COMP%]{margin-left:auto}.dialog-content[_ngcontent-%COMP%]{flex:1;padding:0 1.5rem;overflow-y:auto}.dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1rem 1.5rem 1.5rem;border-top:1px solid #e5e7eb;margin-top:1rem}.operator-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-start}.full-width[_ngcontent-%COMP%]{width:100%}.half-width[_ngcontent-%COMP%]{flex:1}.inline-spinner[_ngcontent-%COMP%]{margin-right:8px}@media (max-width: 600px){.operator-form-dialog[_ngcontent-%COMP%]{max-height:95vh}.form-row[_ngcontent-%COMP%]{flex-direction:column}.half-width[_ngcontent-%COMP%]{width:100%}.dialog-header[_ngcontent-%COMP%]{padding:1rem 1rem 0}.dialog-content[_ngcontent-%COMP%]{padding:0 1rem}.dialog-actions[_ngcontent-%COMP%]{padding:1rem}}"]})}}return r})();function qt(r,s){if(r&1&&(n(0,"mat-option",30),o(1),t()),r&2){let e=s.$implicit;d("value",e.id),l(),Oe(" ",e.name," (",e.is_private?"Privado":"P\xFAblico",") ")}}function Lt(r,s){if(r&1&&(n(0,"mat-error"),o(1),t()),r&2){let e=c();l(),g(" ",e.getErrorMessage("sector_id")," ")}}function $t(r,s){if(r&1&&(n(0,"mat-option",30),o(1),t()),r&2){let e=s.$implicit;d("value",e.id),l(),g(" ",e.name," ")}}function Ht(r,s){r&1&&h(0,"mat-spinner",31)}function Gt(r,s){if(r&1&&(n(0,"mat-error"),o(1),t()),r&2){let e=c();l(),g(" ",e.getErrorMessage("valid_from")," ")}}function Wt(r,s){r&1&&h(0,"mat-spinner",31)}function Ut(r,s){if(r&1&&(n(0,"mat-icon"),o(1),t()),r&2){let e=c();l(),x(e.data.isEdit?"save":"add")}}var ge=(()=>{class r{constructor(e,a,i,m,p,C){this.fb=e,this.dialogRef=a,this.data=i,this.operatorService=m,this.sectorService=p,this.snackBar=C,this._unsubscribeAll=new J,this.loading=!1,this.sectors=[],this.streets=[],this.loadingStreets=!1,this.assignmentForm=this.createForm()}ngOnInit(){this.loadSectors(),this.data.isEdit&&this.data.assignment&&this.loadAssignmentData()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}createForm(){return this.fb.group({sector_id:["",[M.required]],street_id:[""],valid_from:["",[M.required]],valid_to:[""]})}loadSectors(){this.sectorService.getSectors().pipe(O(this._unsubscribeAll)).subscribe({next:e=>{this.sectors=e.data?.data||[]},error:e=>{console.error("Error loading sectors:",e),this.snackBar.open("Error al cargar sectores","Cerrar",{duration:3e3})}})}onSectorChange(e){this.streets=[],this.assignmentForm.patchValue({street_id:""}),e&&this.loadStreetsBySector(e)}loadStreetsBySector(e){this.loadingStreets=!0,this.sectorService.getSectorStreets(e).pipe(O(this._unsubscribeAll)).subscribe({next:a=>{this.streets=a.data||[],this.loadingStreets=!1},error:a=>{console.error("Error loading streets:",a),this.snackBar.open("Error al cargar calles","Cerrar",{duration:3e3}),this.loadingStreets=!1}})}loadAssignmentData(){this.data.assignment&&(this.assignmentForm.patchValue({sector_id:this.data.assignment.sector_id,street_id:this.data.assignment.street_id,valid_from:this.data.assignment.valid_from,valid_to:this.data.assignment.valid_to}),this.data.assignment.sector_id&&this.loadStreetsBySector(this.data.assignment.sector_id))}onSubmit(){if(this.assignmentForm.valid){this.loading=!0;let e=this.assignmentForm.value;e.valid_from&&(e.valid_from=new Date(e.valid_from).toISOString().split("T")[0]),e.valid_to&&(e.valid_to=new Date(e.valid_to).toISOString().split("T")[0]),this.operatorService.assignOperator(this.data.operator.id,e).pipe(O(this._unsubscribeAll)).subscribe({next:a=>{let i=a.message||"Asignaci\xF3n realizada exitosamente";this.snackBar.open(i,"Cerrar",{duration:4e3}),this.dialogRef.close(!0)},error:a=>{console.error("Error assigning operator:",a),this.snackBar.open("Error al asignar operador","Cerrar",{duration:3e3}),this.loading=!1}})}else this.snackBar.open("Por favor, complete todos los campos requeridos","Cerrar",{duration:3e3})}onCancel(){this.dialogRef.close()}getErrorMessage(e){return this.assignmentForm.get(e)?.hasError("required")?"Este campo es requerido":""}static{this.\u0275fac=function(a){return new(a||r)(f(se),f(ee),f(te),f(U),f(ce),f(H))}}static{this.\u0275cmp=I({type:r,selectors:[["app-operator-assignment"]],decls:61,vars:19,consts:[["picker1",""],["picker2",""],[1,"operator-assignment-dialog"],["mat-dialog-title",""],[1,"mb-4","p-3","bg-gray-50","rounded-lg"],[1,"flex","items-center","gap-2"],[1,"text-gray-500"],[1,"font-semibold"],[1,"mb-4","p-3","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"flex","items-start","gap-2"],[1,"text-blue-600","mt-0.5"],[1,"text-sm","text-blue-800"],[1,"font-medium","mb-1"],[1,"assignment-form",3,"formGroup"],[1,"form-row"],["appearance","outline",1,"full-width"],["formControlName","sector_id",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["formControlName","street_id",3,"disabled"],["value",""],["diameter","20","class","inline-spinner",4,"ngIf"],[1,"form-row","grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline"],["matInput","","formControlName","valid_from",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","valid_to",3,"matDatepicker"],["align","end"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click","disabled"],[3,"value"],["diameter","20",1,"inline-spinner"]],template:function(a,i){if(a&1){let m=y();n(0,"div",2)(1,"h2",3),o(2),t(),n(3,"mat-dialog-content")(4,"div",4)(5,"div",5)(6,"mat-icon",6),o(7,"person"),t(),n(8,"span",7),o(9),t(),n(10,"span",6),o(11),t()()(),n(12,"div",8)(13,"div",9)(14,"mat-icon",10),o(15,"info"),t(),n(16,"div",11)(17,"p",12),o(18,"Informaci\xF3n importante:"),t(),n(19,"p"),o(20,"Al asignar un nuevo sector, se eliminar\xE1n autom\xE1ticamente todas las asignaciones anteriores del operador. Cada operador solo puede tener un sector asignado a la vez."),t()()()(),n(21,"form",13)(22,"div",14)(23,"mat-form-field",15)(24,"mat-label"),o(25,"Sector *"),t(),n(26,"mat-select",16),_("selectionChange",function(C){return S(m),v(i.onSectorChange(C.value))}),u(27,qt,2,3,"mat-option",17),t(),u(28,Lt,2,1,"mat-error",18),t()(),n(29,"div",14)(30,"mat-form-field",15)(31,"mat-label"),o(32,"Calle (Opcional)"),t(),n(33,"mat-select",19)(34,"mat-option",20),o(35,"Sin calle espec\xEDfica"),t(),u(36,$t,2,2,"mat-option",17),t(),u(37,Ht,1,0,"mat-spinner",21),t()(),n(38,"div",22)(39,"mat-form-field",23)(40,"mat-label"),o(41,"V\xE1lido desde *"),t(),h(42,"input",24)(43,"mat-datepicker-toggle",25)(44,"mat-datepicker",null,0),u(46,Gt,2,1,"mat-error",18),t(),n(47,"mat-form-field",23)(48,"mat-label"),o(49,"V\xE1lido hasta (Opcional)"),t(),h(50,"input",26)(51,"mat-datepicker-toggle",25)(52,"mat-datepicker",null,1),t()()()(),n(54,"mat-dialog-actions",27)(55,"button",28),_("click",function(){return S(m),v(i.onCancel())}),o(56," Cancelar "),t(),n(57,"button",29),_("click",function(){return S(m),v(i.onSubmit())}),u(58,Wt,1,0,"mat-spinner",21)(59,Ut,2,1,"mat-icon",18),o(60),t()()()}if(a&2){let m,p,C=K(45),Q=K(53);l(2),g(" ",i.data.isEdit?"Editar Asignaci\xF3n":"Asignar Sector"," "),l(7),x(i.data.operator.name),l(2),g("(",i.data.operator.rut,")"),l(10),d("formGroup",i.assignmentForm),l(6),d("ngForOf",i.sectors),l(),d("ngIf",(m=i.assignmentForm.get("sector_id"))==null?null:m.hasError("required")),l(5),d("disabled",i.loadingStreets),l(3),d("ngForOf",i.streets),l(),d("ngIf",i.loadingStreets),l(5),d("matDatepicker",C),l(),d("for",C),l(3),d("ngIf",(p=i.assignmentForm.get("valid_from"))==null?null:p.hasError("required")),l(4),d("matDatepicker",Q),l(),d("for",Q),l(4),d("disabled",i.loading),l(2),d("disabled",i.loading||i.assignmentForm.invalid),l(),d("ngIf",i.loading),l(),d("ngIf",!i.loading),l(),g(" ",i.data.isEdit?"Actualizar":"Asignar"," ")}},dependencies:[k,ye,w,de,ae,R,j,oe,le,me,re,Fe,Ae,Te,D,A,T,ie,De,q,z,W,G,F,V,P,N,B,$,L,Ge,Le,$e,He,we],styles:[".operator-assignment-dialog[_ngcontent-%COMP%]{min-width:500px;max-width:600px}.assignment-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{margin-bottom:16px}.assignment-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.inline-spinner[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-content[_ngcontent-%COMP%]{max-height:70vh;overflow-y:auto}"]})}}return r})();function Qt(r,s){r&1&&(n(0,"th",50),o(1,"Nombre"),t())}function Kt(r,s){if(r&1&&(n(0,"td",51)(1,"div",52)(2,"mat-icon",53),o(3,"person"),t(),n(4,"span",54),o(5),t()()()),r&2){let e=s.$implicit;l(5),x(e.name)}}function Jt(r,s){r&1&&(n(0,"th",55),o(1,"RUT"),t())}function Xt(r,s){if(r&1&&(n(0,"td",51)(1,"span",56),o(2),t()()),r&2){let e=s.$implicit;l(2),x(e.rut||"No asignado")}}function Yt(r,s){r&1&&(n(0,"th",57),o(1,"Email"),t())}function Zt(r,s){if(r&1&&(n(0,"td",51)(1,"span",4),o(2),t()()),r&2){let e=s.$implicit;l(2),x(e.email||"No asignado")}}function er(r,s){r&1&&(n(0,"th",58),o(1,"Tel\xE9fono"),t())}function tr(r,s){if(r&1&&(n(0,"td",51)(1,"span",4),o(2),t()()),r&2){let e=s.$implicit;l(2),x(e.phone||"No asignado")}}function rr(r,s){r&1&&(n(0,"th",59),o(1,"Estado"),t())}function ir(r,s){if(r&1&&(n(0,"td",51)(1,"span"),o(2),t()()),r&2){let e=s.$implicit,a=c();l(),ve("px-2 py-1 rounded text-xs font-medium status-",a.getStatusColor(e),""),l(),g(" ",a.getStatusText(e)," ")}}function nr(r,s){r&1&&(n(0,"th",60),o(1,"Acciones"),t())}function or(r,s){if(r&1){let e=y();n(0,"button",65),_("click",function(){S(e);let i=c().$implicit,m=c();return v(m.removeAllAssignments(i))}),n(1,"mat-icon"),o(2,"location_off"),t(),o(3," Eliminar Asignaciones "),t()}}function ar(r,s){if(r&1){let e=y();n(0,"td",51)(1,"button",61)(2,"mat-icon"),o(3,"more_vert"),t()(),n(4,"mat-menu",null,0)(6,"button",62),_("click",function(){let i=S(e).$implicit,m=c();return v(m.viewOperator(i))}),n(7,"mat-icon"),o(8,"visibility"),t(),o(9," Ver detalles "),t(),n(10,"button",62),_("click",function(){let i=S(e).$implicit,m=c();return v(m.editOperator(i))}),n(11,"mat-icon"),o(12,"edit"),t(),o(13," Editar "),t(),n(14,"button",62),_("click",function(){let i=S(e).$implicit,m=c();return v(m.assignOperator(i))}),n(15,"mat-icon"),o(16,"location_on"),t(),o(17," Asignar Sector "),t(),u(18,or,4,0,"button",63),n(19,"button",64),_("click",function(){let i=S(e).$implicit,m=c();return v(m.deleteOperator(i))}),n(20,"mat-icon"),o(21,"delete"),t(),o(22," Eliminar "),t()()()}if(r&2){let e=s.$implicit,a=K(5),i=c();l(),d("matMenuTriggerFor",a),l(17),d("ngIf",i.getAssignmentsCount(e)>0)}}function lr(r,s){r&1&&h(0,"tr",66)}function mr(r,s){r&1&&h(0,"tr",67)}function sr(r,s){r&1&&(n(0,"div",68),h(1,"mat-spinner",69),t())}function dr(r,s){r&1&&(n(0,"div",70)(1,"mat-icon",71),o(2,"people"),t(),n(3,"h3",72),o(4,"No hay operadores registrados"),t(),n(5,"p",53),o(6,"Los operadores aparecer\xE1n aqu\xED cuando se registren."),t()())}function pr(r,s){if(r&1){let e=y();n(0,"mat-paginator",73),_("page",function(i){S(e);let m=c();return v(m.onPageChange(i))}),t()}if(r&2){let e=c();d("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}var mi=(()=>{class r{constructor(e,a,i){this.operatorService=e,this.dialog=a,this.snackBar=i,this._unsubscribeAll=new J,this.operators=[],this.dataSource=new it([]),this.loading=!1,this.displayedColumns=["name","rut","email","phone","status","actions"],this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.filters={name:"",status:"",sector:""}}ngOnInit(){this.loadOperators()}ngAfterViewInit(){this.dataSource.sort=this.sort}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadOperators(){this.loading=!0;let e=Se({page:this.currentPage+1,per_page:this.pageSize},this.filters);this.operatorService.getOperators(e).pipe(O(this._unsubscribeAll)).subscribe({next:a=>{this.operators=a.data?.data||[],this.dataSource.data=this.operators,this.totalItems=a.data?.total||0,this.loading=!1},error:a=>{console.error("Error loading operators:",a),this.loading=!1}})}getAssignmentsCount(e){if(!e.operator_assignments||e.operator_assignments.length===0)return 0;let a=new Set;return e.operator_assignments.forEach(i=>{i.sector&&i.sector.id&&a.add(i.sector.id)}),a.size}getAssignments(e){if(!e.operator_assignments||e.operator_assignments.length===0)return[];let a=[],i=new Set;return e.operator_assignments.forEach(m=>{m.sector&&m.sector.id&&!i.has(m.sector.id)&&(a.push({type:"Sector",name:m.sector.name,id:m.sector.id}),i.add(m.sector.id))}),a}getStatusColor(e){return this.getAssignmentsCount(e)>0?"assigned":"unassigned"}getStatusText(e){return this.getAssignmentsCount(e)>0?"Asignado":"Sin asignar"}createOperator(){this.dialog.open(ue,{width:"600px",data:{isEdit:!1}}).afterClosed().subscribe(a=>{a&&this.loadOperators()})}editOperator(e){this.dialog.open(ue,{width:"600px",data:{isEdit:!0,operator:e}}).afterClosed().subscribe(i=>{i&&this.loadOperators()})}deleteOperator(e){confirm(`\xBFEst\xE1 seguro de eliminar al operador ${e.name}?`)&&this.operatorService.deleteOperator(e.id).subscribe({next:()=>{this.snackBar.open("Operador eliminado correctamente","Cerrar",{duration:3e3}),this.loadOperators()},error:a=>{this.snackBar.open("Error al eliminar operador","Cerrar",{duration:3e3})}})}getAssignedCount(){return this.operators.filter(e=>this.getAssignmentsCount(e)>0).length}getUnassignedCount(){return this.operators.filter(e=>this.getAssignmentsCount(e)===0).length}viewOperator(e){let a=[{label:"Nombre",key:"name",icon:"person",type:"text"},{label:"RUT",key:"rut",icon:"badge",type:"text"},{label:"Email",key:"email",icon:"email",type:"text"},{label:"Tel\xE9fono",key:"phone",icon:"phone",type:"text"},{label:"Estado",key:"status",icon:"toggle_on",type:"badge",badgeColor:m=>m==="ACTIVE"?"success":"error"},{label:"Asignaciones",key:"operator_assignments",icon:"location_on",type:"array",format:m=>!m||m.length===0?["Sin asignaciones"]:m.map(p=>`${p.sector?.name||"Sector"}${p.street?.name?" - "+p.street.name:""}`)},{label:"Fecha de Creaci\xF3n",key:"created_at",icon:"schedule",type:"date"}],i=this.dialog.open(ft,{width:"600px",data:{title:"Detalles del Operador",data:e,fields:a,actions:[{label:"Editar",icon:"edit",color:"primary",action:()=>{i.close(),this.editOperator(e)}},{label:"Asignar",icon:"location_on",color:"accent",action:()=>{i.close(),this.assignOperator(e)}}]}})}removeAllAssignments(e){confirm(`\xBFEst\xE1 seguro de eliminar todas las asignaciones del operador ${e.name}?`)&&this.operatorService.removeAllAssignments(e.id).subscribe({next:a=>{this.snackBar.open(a.message||"Asignaciones eliminadas correctamente","Cerrar",{duration:3e3}),this.loadOperators()},error:a=>{this.snackBar.open("Error al eliminar asignaciones","Cerrar",{duration:3e3})}})}assignOperator(e){this.dialog.open(ge,{width:"600px",data:{operator:e}}).afterClosed().subscribe(i=>{i&&this.loadOperators()})}applyFilters(){this.currentPage=0,this.loadOperators()}clearFilters(){this.filters={name:"",status:"",sector:""},this.currentPage=0,this.loadOperators()}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadOperators()}assignSector(e){this.dialog.open(ge,{width:"600px",data:{isEdit:!1,operator:e}}).afterClosed().subscribe(i=>{i&&this.loadOperators()})}static{this.\u0275fac=function(a){return new(a||r)(f(U),f(ke),f(H))}}static{this.\u0275cmp=I({type:r,selectors:[["app-operators"]],viewQuery:function(a,i){if(a&1&&Me(pe,5),a&2){let m;be(m=Ee())&&(i.sort=m.first)}},features:[Ie([{provide:nt,useValue:ut()}])],decls:104,vars:12,consts:[["menu","matMenu"],[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-blue-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"p-3","bg-orange-100","rounded-full"],[1,"text-orange-600"],[1,"text-2xl","font-bold","text-orange-600"],[1,"mb-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["appearance","outline"],["matInput","","placeholder","Nombre o email",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],["value","assigned"],["value","unassigned"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],[1,"overflow-x-auto"],["mat-table","","matSort","",1,"w-full",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","name",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","rut"],["mat-header-cell","","mat-sort-header","rut",4,"matHeaderCellDef"],["matColumnDef","email"],["mat-header-cell","","mat-sort-header","email",4,"matHeaderCellDef"],["matColumnDef","phone"],["mat-header-cell","","mat-sort-header","phone",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","status",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],["mat-header-cell","","mat-sort-header","name"],["mat-cell",""],[1,"flex","items-center","gap-2"],[1,"text-gray-500"],[1,"font-semibold"],["mat-header-cell","","mat-sort-header","rut"],[1,"text-gray-600","font-mono"],["mat-header-cell","","mat-sort-header","email"],["mat-header-cell","","mat-sort-header","phone"],["mat-header-cell","","mat-sort-header","status"],["mat-header-cell",""],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","","class","text-orange-600",3,"click",4,"ngIf"],["mat-menu-item","",1,"text-red-600",3,"click"],["mat-menu-item","",1,"text-orange-600",3,"click"],["mat-header-row",""],["mat-row",""],[1,"flex","justify-center","items-center","py-8"],["diameter","40"],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"]],template:function(a,i){a&1&&(n(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),o(4,"Operadores"),t(),n(5,"p",4),o(6,"Gestiona los operadores del sistema"),t()(),n(7,"button",5),_("click",function(){return i.createOperator()}),n(8,"mat-icon"),o(9,"add"),t(),o(10," Nuevo Operador "),t()(),n(11,"div",6)(12,"mat-card")(13,"mat-card-content",7)(14,"div",8)(15,"div",9)(16,"mat-icon",10),o(17,"people"),t()(),n(18,"div",11)(19,"p",12),o(20,"Total Operadores"),t(),n(21,"p",13),o(22),t()()()()(),n(23,"mat-card")(24,"mat-card-content",7)(25,"div",8)(26,"div",14)(27,"mat-icon",15),o(28,"check_circle"),t()(),n(29,"div",11)(30,"p",12),o(31,"Asignados"),t(),n(32,"p",16),o(33),t()()()()(),n(34,"mat-card")(35,"mat-card-content",7)(36,"div",8)(37,"div",17)(38,"mat-icon",18),o(39,"warning"),t()(),n(40,"div",11)(41,"p",12),o(42,"Sin Asignar"),t(),n(43,"p",19),o(44),t()()()()()(),n(45,"mat-card",20)(46,"mat-card-content",7)(47,"div",21)(48,"mat-form-field",22)(49,"mat-label"),o(50,"Buscar operador"),t(),n(51,"input",23),Z("ngModelChange",function(p){return Y(i.filters.name,p)||(i.filters.name=p),p}),t()(),n(52,"mat-form-field",22)(53,"mat-label"),o(54,"Estado"),t(),n(55,"mat-select",24),Z("ngModelChange",function(p){return Y(i.filters.status,p)||(i.filters.status=p),p}),n(56,"mat-option",25),o(57,"Todos"),t(),n(58,"mat-option",26),o(59,"Asignado"),t(),n(60,"mat-option",27),o(61,"Sin asignar"),t()()(),n(62,"mat-form-field",22)(63,"mat-label"),o(64,"Sector"),t(),n(65,"mat-select",24),Z("ngModelChange",function(p){return Y(i.filters.sector,p)||(i.filters.sector=p),p}),n(66,"mat-option",25),o(67,"Todos los sectores"),t()()()(),n(68,"div",28)(69,"button",29),_("click",function(){return i.clearFilters()}),n(70,"mat-icon"),o(71,"clear"),t(),o(72," Limpiar "),t(),n(73,"button",5),_("click",function(){return i.applyFilters()}),n(74,"mat-icon"),o(75,"search"),t(),o(76," Filtrar "),t()()()(),n(77,"mat-card")(78,"mat-card-content",7)(79,"div",30)(80,"table",31),b(81,32),u(82,Qt,2,0,"th",33)(83,Kt,6,1,"td",34),E(),b(84,35),u(85,Jt,2,0,"th",36)(86,Xt,3,1,"td",34),E(),b(87,37),u(88,Yt,2,0,"th",38)(89,Zt,3,1,"td",34),E(),b(90,39),u(91,er,2,0,"th",40)(92,tr,3,1,"td",34),E(),b(93,41),u(94,rr,2,0,"th",42)(95,ir,3,4,"td",34),E(),b(96,43),u(97,nr,2,0,"th",44)(98,ar,23,2,"td",34),E(),u(99,lr,1,0,"tr",45)(100,mr,1,0,"tr",46),t(),u(101,sr,2,0,"div",47)(102,dr,7,0,"div",48),t(),u(103,pr,1,5,"mat-paginator",49),t()()()),a&2&&(l(22),x(i.operators.length),l(11),x(i.getAssignedCount()),l(11),x(i.getUnassignedCount()),l(7),X("ngModel",i.filters.name),l(4),X("ngModel",i.filters.status),l(10),X("ngModel",i.filters.sector),l(15),d("dataSource",i.dataSource),l(19),d("matHeaderRowDef",i.displayedColumns),l(),d("matRowDefColumns",i.displayedColumns),l(),d("ngIf",i.loading),l(),d("ngIf",!i.loading&&i.operators.length===0),l(),d("ngIf",i.totalItems>0))},dependencies:[k,w,ze,R,j,Re,rt,We,Qe,Ye,Ke,Ue,Ze,Je,Xe,et,tt,ct,dt,pt,V,P,ne,N,B,$,L,gt,D,A,T,q,z,Ne,Ve,Pe,Be,st,W,G,F,at,ot,mt,pe,lt],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151}.mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}.status-assigned[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.status-unassigned[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.operators-assignments-list[_ngcontent-%COMP%]{max-height:4rem;overflow-y:auto;padding:.25rem}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:2px}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:2px}.operators-assignments-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}@media (max-width: 768px){.grid-cols-3[_ngcontent-%COMP%]{grid-template-columns:1fr}.mat-mdc-table[_ngcontent-%COMP%]{font-size:.875rem}}"]})}}return r})();export{mi as OperatorsComponent};
