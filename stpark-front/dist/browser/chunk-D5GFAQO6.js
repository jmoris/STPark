import{a as H}from"./chunk-K7WLWQCS.js";import{c as F}from"./chunk-5BS7ZJIQ.js";import{f as Y}from"./chunk-NB6DWIHZ.js";import{a as B}from"./chunk-VUFBSA72.js";import"./chunk-F3KLSFSR.js";import{a as N,b as j}from"./chunk-S6WOOULQ.js";import{c as T}from"./chunk-FUTQ4G6L.js";import"./chunk-LKYHZS4A.js";import"./chunk-VKB6BRO6.js";import{b as V,c as L}from"./chunk-7EGXZGVT.js";import{a as z,b as R}from"./chunk-7AXTM6W3.js";import"./chunk-FMD5N6HP.js";import"./chunk-SOR2HQFJ.js";import{la as k,na as A,oa as w}from"./chunk-AHUY5V3P.js";import"./chunk-CQGOYTFO.js";import{b as E,d as D}from"./chunk-DOMNBE5L.js";import"./chunk-7OGW3PNS.js";import{m as y,s as I}from"./chunk-TQARHOKX.js";import{$b as g,Eb as c,Ib as S,Pb as i,Qb as e,Rb as O,U as P,Vb as C,bb as s,bc as l,cb as p,f as M,mc as o,nc as m,oa as _,oc as x,pa as v,pb as b,wb as u}from"./chunk-BSJZAB7M.js";import"./chunk-TSRGIXR5.js";function U(n,d){if(n&1&&(i(0,"div",8)(1,"span",9),o(2),e(),i(3,"span",10),o(4),e(),i(5,"span",11),o(6),e()()),n&2){let t=l();s(2),x("#",t.session.id,""),s(2),m(t.session.plate),s(),S("bg-"+t.getStatusColor(t.session.status)+"-100 text-"+t.getStatusColor(t.session.status)+"-800"),s(),x(" ",t.getStatusLabel(t.session.status)," ")}}function W(n,d){n&1&&(i(0,"div",12),O(1,"mat-spinner"),i(2,"p"),o(3,"Cargando detalles de la sesi\xF3n..."),e()())}function G(n,d){if(n&1){let t=C();i(0,"div",13)(1,"mat-icon",14),o(2,"error"),e(),i(3,"p"),o(4),e(),i(5,"button",15),g("click",function(){_(t);let r=l();return v(r.loadSession())}),o(6," Reintentar "),e()()}if(n&2){let t=l();s(4),m(t.error)}}function J(n,d){if(n&1&&(i(0,"div",20)(1,"span",21),o(2,"Fin"),e(),i(3,"span",22),o(4),e()()),n&2){let t=l(2);s(4),m(t.formatDate(t.session.ended_at))}}function K(n,d){if(n&1&&(i(0,"div",20)(1,"span",21),o(2,"Duraci\xF3n"),e(),i(3,"span",22),o(4),e()()),n&2){let t=l(2);s(4),m(t.formatDuration(t.session.seconds_total))}}function Q(n,d){if(n&1&&(i(0,"div",20)(1,"span",21),o(2,"Duraci\xF3n Actual"),e(),i(3,"span",33),o(4),e()()),n&2){let t=l(2);s(4),m(t.getCurrentDurationFormatted())}}function X(n,d){if(n&1&&(i(0,"div",39)(1,"span",40),o(2,"Monto Bruto"),e(),i(3,"span",41),o(4),e()()),n&2){let t=l(3);s(4),m(t.formatAmount(t.session.gross_amount))}}function Z(n,d){if(n&1&&(i(0,"div",39)(1,"span",40),o(2,"Descuento"),e(),i(3,"span",42),o(4),e()()),n&2){let t=l(3);s(4),x("-",t.formatAmount(t.session.discount_amount),"")}}function $(n,d){if(n&1&&(i(0,"div",43)(1,"span",40),o(2,"Total"),e(),i(3,"span",41),o(4),e()()),n&2){let t=l(3);s(4),m(t.formatAmount(t.session.net_amount))}}function tt(n,d){if(n&1&&(i(0,"div",44)(1,"span",40),o(2,"Costo Estimado"),e(),i(3,"span",41),o(4),e()()),n&2){let t=l(3);s(4),m(t.getEstimatedCostFormatted())}}function et(n,d){if(n&1&&(i(0,"div",34)(1,"h3"),o(2,"Resumen Financiero"),e(),i(3,"div",35),u(4,X,5,1,"div",36)(5,Z,5,1,"div",36)(6,$,5,1,"div",37)(7,tt,5,1,"div",38),e()()),n&2){let t=l(2);s(4),c("ngIf",t.session.gross_amount),s(),c("ngIf",t.session.discount_amount),s(),c("ngIf",t.session.net_amount),s(),c("ngIf",t.isActiveSession)}}function nt(n,d){if(n&1){let t=C();i(0,"button",15),g("click",function(){_(t);let r=l(3);return v(r.paySession())}),i(1,"mat-icon"),o(2,"payment"),e(),o(3," Pagar "),e()}}function it(n,d){if(n&1){let t=C();i(0,"button",48),g("click",function(){_(t);let r=l(3);return v(r.checkoutSession())}),i(1,"mat-icon"),o(2,"payment"),e(),o(3," Procesar Checkout "),e()}}function ot(n,d){if(n&1&&(i(0,"div",45),u(1,nt,4,0,"button",46)(2,it,4,0,"button",47),e()),n&2){let t=l(2);s(),c("ngIf",t.session.status==="TO_PAY"),s(),c("ngIf",t.session.status==="ACTIVE")}}function st(n,d){if(n&1&&(i(0,"div",16)(1,"div",17)(2,"div",18)(3,"h3"),o(4,"Informaci\xF3n de la Sesi\xF3n"),e(),i(5,"div",19)(6,"div",20)(7,"span",21),o(8,"Sector"),e(),i(9,"span",22),o(10),e()(),i(11,"div",20)(12,"span",21),o(13,"Calle"),e(),i(14,"span",22),o(15),e()(),i(16,"div",20)(17,"span",21),o(18,"Operador"),e(),i(19,"span",22),o(20),e()()()(),i(21,"div",18)(22,"h3"),o(23,"Tiempo"),e(),i(24,"div",19)(25,"div",20)(26,"span",21),o(27,"Inicio"),e(),i(28,"span",22),o(29),e()(),u(30,J,5,1,"div",23)(31,K,5,1,"div",23)(32,Q,5,1,"div",23),e()()(),u(33,et,8,4,"div",24),i(34,"div",25)(35,"div",26)(36,"div",27)(37,"mat-icon",28),o(38),e(),i(39,"div",29)(40,"div",30),o(41),e(),i(42,"div",31),o(43),e()()(),u(44,ot,3,2,"div",32),e()()()),n&2){let t=l();s(10),m((t.session.sector==null?null:t.session.sector.name)||"N/A"),s(5),m((t.session.street==null?null:t.session.street.name)||"N/A"),s(5),m((t.session.operator==null?null:t.session.operator.name)||"N/A"),s(9),m(t.formatDate(t.session.started_at)),s(),c("ngIf",t.session.ended_at),s(),c("ngIf",t.session.seconds_total&&!t.isActiveSession),s(),c("ngIf",t.isActiveSession),s(),c("ngIf",t.session.gross_amount||t.session.net_amount||t.isActiveSession),s(2),S("status-"+t.session.status),s(3),m(t.getPaymentIcon(t.session.status)),s(3),m(t.getPaymentStatusTitle(t.session.status)),s(2),m(t.getPaymentStatusDescription(t.session.status)),s(),c("ngIf",t.session.status==="TO_PAY"||t.session.status==="ACTIVE")}}var bt=(()=>{class n{constructor(t,a,r,f,h){this.route=t,this.router=a,this.sessionService=r,this.snackBar=f,this.dialog=h,this._unsubscribeAll=new M,this.session=null,this.loading=!1,this.error=null,this.currentDuration=0,this.estimatedCost=0,this.isActiveSession=!1}ngOnInit(){this.loadSession()}ngOnDestroy(){this.stopRealTimeCalculation(),this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadSession(){this.loading=!0,this.error=null;let t=this.route.snapshot.paramMap.get("id");if(!t){this.error="ID de sesi\xF3n no v\xE1lido",this.loading=!1;return}this.sessionService.getSession(parseInt(t)).pipe(P(this._unsubscribeAll)).subscribe({next:a=>{this.session=a.data,this.loading=!1,this.session?.status==="ACTIVE"?(this.isActiveSession=!0,this.startRealTimeCalculation()):(this.isActiveSession=!1,this.stopRealTimeCalculation())},error:a=>{this.error="Error al cargar la sesi\xF3n",this.loading=!1,console.error("Error loading session:",a),this.snackBar.open("Error al cargar la sesi\xF3n","Cerrar",{duration:3e3})}})}goBack(){this.router.navigate(["/parking/sessions"])}checkoutSession(){if(!this.session||this.session.status!=="ACTIVE"){this.snackBar.open("Solo se puede hacer checkout de sesiones activas","Cerrar",{duration:3e3});return}this.dialog.open(H,{width:"800px",maxWidth:"95vw",maxHeight:"90vh",data:{session:this.session},disableClose:!1}).afterClosed().subscribe(a=>{a?.success&&(this.loadSession(),this.snackBar.open("Checkout procesado exitosamente","Cerrar",{duration:3e3}))})}paySession(){if(!this.session||this.session.status!=="TO_PAY"){this.snackBar.open("Solo se pueden pagar sesiones pendientes de pago","Cerrar",{duration:3e3});return}this.router.navigate(["/parking/sessions",this.session.id,"payment"])}formatAmount(t){return this.sessionService.formatAmount(t)}formatDate(t){if(!t)return"N/A";let a=new Date(t);return isNaN(a.getTime())?"N/A":a.toLocaleString("es-CL")}formatDuration(t){return this.sessionService.formatDuration(t)}getStatusLabel(t){return this.sessionService.getStatusLabel(t)}getStatusColor(t){return this.sessionService.getStatusColor(t)}getPaymentIcon(t){return{PAID:"check_circle",TO_PAY:"schedule",ACTIVE:"play_circle",CANCELLED:"cancel"}[t]||"help"}getPaymentStatusTitle(t){return{PAID:"Sesi\xF3n Pagada",TO_PAY:"Pendiente de Pago",ACTIVE:"Sesi\xF3n Activa",CANCELLED:"Sesi\xF3n Cancelada"}[t]||"Estado Desconocido"}getPaymentStatusDescription(t){return{PAID:"La sesi\xF3n ha sido pagada exitosamente",TO_PAY:"La sesi\xF3n est\xE1 lista para ser pagada",ACTIVE:"La sesi\xF3n est\xE1 actualmente en curso",CANCELLED:"Esta sesi\xF3n ha sido cancelada"}[t]||"Estado no disponible"}startRealTimeCalculation(){this.stopRealTimeCalculation(),this.calculateCurrentDuration(),this._intervalId=setInterval(()=>{this.calculateCurrentDuration()},1e3)}stopRealTimeCalculation(){this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)}calculateCurrentDuration(){if(!this.session||this.session.status!=="ACTIVE")return;let t=new Date(this.session.started_at),r=Math.floor((new Date().getTime()-t.getTime())/1e3);this.currentDuration=r,this.estimatedCost=this.calculateEstimatedCost(r)}calculateEstimatedCost(t){let r=Math.floor(t/3600),f=Math.floor(t%3600/60),h=1e3/4,q=Math.ceil(f/15);return r*1e3+q*h}getCurrentDurationFormatted(){return this.formatDuration(this.currentDuration)}getEstimatedCostFormatted(){return this.formatAmount(this.estimatedCost)}static{this.\u0275fac=function(a){return new(a||n)(p(E),p(D),p(B),p(N),p(T))}}static{this.\u0275cmp=b({type:n,selectors:[["app-session-detail"]],decls:12,vars:4,consts:[[1,"session-detail-container"],[1,"header"],["mat-icon-button","",1,"back-button",3,"click"],[1,"header-content"],["class","session-meta",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","error-container",4,"ngIf"],["class","session-details",4,"ngIf"],[1,"session-meta"],[1,"session-id"],[1,"plate"],[1,"px-2","py-1","rounded","text-xs","font-medium"],[1,"loading-container"],[1,"error-container"],["color","warn"],["mat-raised-button","","color","primary",3,"click"],[1,"session-details"],[1,"main-info"],[1,"info-section"],[1,"info-list"],[1,"info-entry"],[1,"info-label"],[1,"info-value"],["class","info-entry",4,"ngIf"],["class","financial-summary",4,"ngIf"],[1,"status-section"],[1,"status-card"],[1,"status-content"],[1,"status-icon"],[1,"status-text"],[1,"status-title"],[1,"status-description"],["class","status-actions",4,"ngIf"],[1,"info-value","real-time"],[1,"financial-summary"],[1,"amounts"],["class","amount-item",4,"ngIf"],["class","amount-item total",4,"ngIf"],["class","amount-item estimated",4,"ngIf"],[1,"amount-item"],[1,"amount-label"],[1,"amount-value"],[1,"amount-value","discount"],[1,"amount-item","total"],[1,"amount-item","estimated"],[1,"status-actions"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","color","accent",3,"click"]],template:function(a,r){a&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return r.goBack()}),i(3,"mat-icon"),o(4,"arrow_back"),e()(),i(5,"div",3)(6,"h1"),o(7,"Detalle de Sesi\xF3n"),e(),u(8,U,7,5,"div",4),e()(),u(9,W,4,0,"div",5)(10,G,7,1,"div",6)(11,st,45,14,"div",7),e()),a&2&&(s(8),c("ngIf",r.session),s(),c("ngIf",r.loading),s(),c("ngIf",r.error&&!r.loading),s(),c("ngIf",r.session&&!r.loading))},dependencies:[I,y,w,k,A,L,V,Y,F,j,R,z],styles:[".session-detail-container[_ngcontent-%COMP%]{padding:2rem;max-width:1000px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:1rem;margin-bottom:3rem}.back-button[_ngcontent-%COMP%]{margin-top:.25rem}.header-content[_ngcontent-%COMP%]{flex:1}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:2rem;font-weight:700;color:var(--fuse-text-primary);line-height:1.2}.session-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.session-id[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--fuse-text-secondary);background:var(--fuse-bg-card);padding:.25rem .75rem;border-radius:1rem;border:1px solid var(--fuse-border)}.plate[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:var(--fuse-primary-600);background:var(--fuse-primary-50);padding:.5rem 1rem;border-radius:.5rem;border:1px solid var(--fuse-primary-200)}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center}.loading-container[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-bottom:1rem}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--fuse-text-secondary);margin:0}.error-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem;margin-bottom:1rem}.error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 1rem}.session-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.main-info[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:2rem}.info-section[_ngcontent-%COMP%]{background:var(--fuse-bg-card);border:1px solid var(--fuse-border);border-radius:.75rem;padding:1.5rem}.info-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1rem;font-weight:600;color:var(--fuse-text-primary);text-transform:uppercase;letter-spacing:.05em}.info-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.info-entry[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 0;border-bottom:1px solid var(--fuse-border)}.info-entry[_ngcontent-%COMP%]:last-child{border-bottom:none}.info-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--fuse-text-secondary)}.info-value[_ngcontent-%COMP%]{font-size:.875rem;font-weight:400;color:var(--fuse-text-primary);text-align:right}.financial-summary[_ngcontent-%COMP%]{background:var(--fuse-bg-card);border:1px solid var(--fuse-border);border-radius:.75rem;padding:1.5rem}.financial-summary[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1rem;font-weight:600;color:var(--fuse-text-primary);text-transform:uppercase;letter-spacing:.05em}.amounts[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.amount-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--fuse-bg-default);border-radius:.5rem;border:1px solid var(--fuse-border)}.amount-item.total[_ngcontent-%COMP%]{background:var(--fuse-primary-50);border-color:var(--fuse-primary-200)}.amount-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--fuse-text-secondary)}.amount-value[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--fuse-text-primary)}.amount-value.discount[_ngcontent-%COMP%]{color:var(--fuse-warn-600)}.amount-item.total[_ngcontent-%COMP%]   .amount-value[_ngcontent-%COMP%]{color:var(--fuse-primary-600);font-size:1.125rem}.amount-item.estimated[_ngcontent-%COMP%]{background:var(--fuse-warn-50);border-color:var(--fuse-warn-200)}.amount-item.estimated[_ngcontent-%COMP%]   .amount-value[_ngcontent-%COMP%]{color:var(--fuse-warn-600);font-size:1.125rem}.info-value.real-time[_ngcontent-%COMP%]{color:var(--fuse-primary-600);font-weight:600;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:1}50%{opacity:.7}to{opacity:1}}.status-section[_ngcontent-%COMP%]{background:var(--fuse-bg-card);border:1px solid var(--fuse-border);border-radius:.75rem;padding:1.5rem}.status-card[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1.5rem;border-radius:.75rem;border:2px solid var(--fuse-border)}.status-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.status-icon[_ngcontent-%COMP%]{font-size:2.5rem;width:2.5rem;height:2.5rem}.status-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.status-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:var(--fuse-text-primary)}.status-description[_ngcontent-%COMP%]{font-size:.875rem;color:var(--fuse-text-secondary)}.status-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.status-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.status-PAID[_ngcontent-%COMP%]{background:var(--fuse-success-50);border-color:var(--fuse-success-300)}.status-PAID[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:var(--fuse-success-600)}.status-TO_PAY[_ngcontent-%COMP%]{background:var(--fuse-warn-50);border-color:var(--fuse-warn-300)}.status-TO_PAY[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:var(--fuse-warn-600)}.status-ACTIVE[_ngcontent-%COMP%]{background:var(--fuse-primary-50);border-color:var(--fuse-primary-300)}.status-ACTIVE[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:var(--fuse-primary-600)}.status-CANCELLED[_ngcontent-%COMP%]{background:var(--fuse-error-50);border-color:var(--fuse-error-300)}.status-CANCELLED[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:var(--fuse-error-600)}mat-chip[_ngcontent-%COMP%]{font-weight:500;font-size:.875rem}.status-success[_ngcontent-%COMP%]{background-color:var(--fuse-success-100)!important;color:var(--fuse-success-800)!important}.status-primary[_ngcontent-%COMP%]{background-color:var(--fuse-primary-100)!important;color:var(--fuse-primary-800)!important}.status-warn[_ngcontent-%COMP%]{background-color:var(--fuse-warn-100)!important;color:var(--fuse-warn-800)!important}.status-error[_ngcontent-%COMP%]{background-color:var(--fuse-error-100)!important;color:var(--fuse-error-800)!important}@media (max-width: 768px){.session-detail-container[_ngcontent-%COMP%]{padding:1rem}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.session-meta[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.75rem}.main-info[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1.5rem}.status-card[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:1rem}.status-actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-start}}"]})}}return n})();export{bt as SessionDetailComponent};
