import{a as $e}from"./chunk-5YHLMQZP.js";import{o as ce,q as pe,u as ge,v as ue}from"./chunk-IS5LCSW4.js";import{a as ve}from"./chunk-N3PSIUVN.js";import{a as Ae,b as Fe,c as ze}from"./chunk-5BS7ZJIQ.js";import{a as Le,b as Ne}from"./chunk-VIG4DQVM.js";import{a as he,b as De,c as Se,d as Ee,e as ye,f as Pe,g as we,h as Oe,i as Ie,j as Te,k as ke}from"./chunk-MTXYWIWL.js";import{a as Ve,c as We,f as Be}from"./chunk-NB6DWIHZ.js";import{a as _e,b as fe,c as be,d as xe}from"./chunk-F3RZXQG2.js";import{a as Ce,b as Me}from"./chunk-VH6ICZSD.js";import{_ as me}from"./chunk-GI2EMKD6.js";import{a as X,b as Z,c as ee,d as te}from"./chunk-T34AVQAX.js";import"./chunk-4IKOPOY6.js";import"./chunk-JQ7ZGKDS.js";import"./chunk-VKB6BRO6.js";import{b as K,c as Q}from"./chunk-7EGXZGVT.js";import{d as le,e as re}from"./chunk-7QQT45KE.js";import{a as se,b as de}from"./chunk-7AXTM6W3.js";import{b as R,f as q,j as G,k as H}from"./chunk-DO3SX6N4.js";import{b as ne,f as ie,j as ae,x as oe}from"./chunk-EGGCURRC.js";import{fa as j,la as U,na as Y,oa as J}from"./chunk-AHUY5V3P.js";import"./chunk-CQGOYTFO.js";import"./chunk-7OGW3PNS.js";import{k as B,l as $,m as O,s as I}from"./chunk-TQARHOKX.js";import{$b as x,Eb as d,Hb as W,Ib as P,Pb as n,Qb as t,Rb as C,Sb as D,Tb as S,U as T,Vb as E,bb as o,bc as c,cb as V,f as A,lc as k,mc as a,na as F,nc as p,oa as _,oc as y,pa as f,pb as w,rc as M,sc as v,tc as h,vc as L,wb as u,ya as z}from"./chunk-BSJZAB7M.js";import{a as N}from"./chunk-TSRGIXR5.js";var Ge=()=>({width:"45rem"}),He=()=>({"1199px":"70vw","575px":"90vw"});function Ue(i,s){i&1&&(n(0,"div",4)(1,"div",5),C(2,"div",6),n(3,"p",7),a(4,"Cargando detalles de la deuda..."),t()()())}function Ye(i,s){if(i&1&&(n(0,"div",11)(1,"label"),a(2,"Patente:"),t(),n(3,"span",13),a(4),t()()),i&2){let e=c(3);o(4),p(e.debt.parking_session.plate)}}function Je(i,s){if(i&1&&(n(0,"div",11)(1,"label"),a(2,"Sector:"),t(),n(3,"span"),a(4),t()()),i&2){let e=c(3);o(4),p(e.debt.parking_session.sector.name)}}function Ke(i,s){if(i&1&&(n(0,"div",11)(1,"label"),a(2,"Calle:"),t(),n(3,"span"),a(4),t()()),i&2){let e=c(3);o(4),p(e.debt.parking_session.street.name)}}function Qe(i,s){if(i&1&&(n(0,"div",11)(1,"label"),a(2,"Inicio:"),t(),n(3,"span"),a(4),t()()),i&2){let e=c(3);o(4),p(e.formatDate(e.debt.parking_session.started_at))}}function Xe(i,s){if(i&1&&(n(0,"div",11)(1,"label"),a(2,"Fin:"),t(),n(3,"span"),a(4),t()()),i&2){let e=c(3);o(4),p(e.formatDate(e.debt.parking_session.ended_at))}}function Ze(i,s){if(i&1&&(n(0,"div",9)(1,"h3"),a(2,"Sesi\xF3n Asociada"),t(),n(3,"div",10)(4,"div",11)(5,"label"),a(6,"ID de Sesi\xF3n:"),t(),n(7,"span",12),a(8),t()(),u(9,Ye,5,1,"div",19)(10,Je,5,1,"div",19)(11,Ke,5,1,"div",19)(12,Qe,5,1,"div",19)(13,Xe,5,1,"div",19),t()()),i&2){let e=c(2);o(8),p(e.debt.session_id),o(),d("ngIf",e.debt.parking_session),o(),d("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.sector),o(),d("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.street),o(),d("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.started_at),o(),d("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.ended_at)}}function et(i,s){if(i&1&&(n(0,"div",22)(1,"div",23)(2,"span",24),a(3),t(),n(4,"span",25),a(5),t()(),n(6,"div",26),a(7),t()()),i&2){let e=s.$implicit,r=c(3);o(3),p(e.method),o(2),p(r.formatAmount(e.amount)),o(2),p(r.formatDate(e.created_at))}}function tt(i,s){if(i&1&&(n(0,"div",9)(1,"h3"),a(2,"Pagos Realizados"),t(),n(3,"div",20),u(4,et,8,3,"div",21),t()()),i&2){let e=c(2);o(4),d("ngForOf",e.debt.payments)}}function nt(i,s){if(i&1&&(n(0,"div",11)(1,"label"),a(2,"Liquidada:"),t(),n(3,"span"),a(4),t()()),i&2){let e=c(2);o(4),p(e.formatDate(e.debt.settled_at))}}function it(i,s){if(i&1&&(n(0,"div",11)(1,"label"),a(2,"Actualizada:"),t(),n(3,"span"),a(4),t()()),i&2){let e=c(2);o(4),p(e.formatDate(e.debt.updated_at))}}function at(i,s){if(i&1&&(n(0,"div",8)(1,"div",9)(2,"h3"),a(3,"Informaci\xF3n de la Deuda"),t(),n(4,"div",10)(5,"div",11)(6,"label"),a(7,"ID:"),t(),n(8,"span",12),a(9),t()(),n(10,"div",11)(11,"label"),a(12,"Placa:"),t(),n(13,"span",13),a(14),t()(),n(15,"div",11)(16,"label"),a(17,"Monto:"),t(),n(18,"span",14),a(19),t()(),n(20,"div",11)(21,"label"),a(22,"Origen:"),t(),n(23,"div",15),C(24,"i",16),n(25,"span"),a(26),t()()(),n(27,"div",11)(28,"label"),a(29,"Estado:"),t(),n(30,"span",17),a(31),t()()()(),u(32,Ze,14,6,"div",18)(33,tt,5,1,"div",18),n(34,"div",9)(35,"h3"),a(36,"Auditor\xEDa"),t(),n(37,"div",10)(38,"div",11)(39,"label"),a(40,"Creada:"),t(),n(41,"span"),a(42),t()(),u(43,nt,5,1,"div",19)(44,it,5,1,"div",19),t()()()),i&2){let e=c();o(9),p(e.debt.id),o(5),p(e.debt.plate),o(5),p(e.formatAmount(e.debt.principal_amount)),o(5),P(e.getOriginIcon(e.debt.origin)),o(2),p(e.getOriginText(e.debt.origin)),o(4),d("ngClass","status-"+e.getStatusColor(e.debt.status)),o(),y(" ",e.getStatusText(e.debt.status)," "),o(),d("ngIf",e.debt.session_id),o(),d("ngIf",e.debt.payments&&e.debt.payments.length>0),o(9),p(e.formatDate(e.debt.created_at)),o(),d("ngIf",e.debt.settled_at),o(),d("ngIf",e.debt.updated_at&&e.debt.updated_at!==e.debt.created_at)}}function ot(i,s){if(i&1){let e=E();n(0,"div",27)(1,"button",28),x("click",function(){_(e);let l=c();return f(l.closeModal())}),t(),n(2,"button",29),x("click",function(){_(e);let l=c();return f(l.printDebt())}),t()()}}var je=(()=>{class i{constructor(){this.visible=!1,this.debt=null,this.visibleChange=new z}ngOnChanges(){}closeModal(){this.visible=!1,this.visibleChange.emit(!1)}formatAmount(e){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e).replace("CLP","$")}formatDate(e){if(!e)return"N/A";let r=new Date(e);if(isNaN(r.getTime()))return"N/A";let l=r.toLocaleDateString("es-CL",{day:"2-digit",month:"2-digit",year:"numeric"}),m=r.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${l} ${m}`}getStatusText(e){switch(e){case"PENDING":return"Pendiente";case"SETTLED":return"Liquidada";case"CANCELLED":return"Cancelada";default:return e}}getStatusColor(e){switch(e){case"PENDING":return"orange";case"SETTLED":return"green";case"CANCELLED":return"red";default:return"gray"}}getOriginText(e){switch(e){case"SESSION":return"Sesi\xF3n de Estacionamiento";case"FINE":return"Multa";case"MANUAL":return"Manual";default:return e}}getOriginIcon(e){switch(e){case"SESSION":return"pi-car";case"FINE":return"pi-exclamation-triangle";case"MANUAL":return"pi-user-edit";default:return"pi-question-circle"}}printDebt(){if(!this.debt)return;let e=window.open("","_blank");if(e){let r=this.generateDebtReceiptHtml();e.document.write(r),e.document.close(),e.print()}}generateDebtReceiptHtml(){return this.debt?`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Detalle de Deuda - ${this.debt.id}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          .header { text-align: center; margin-bottom: 30px; }
          .receipt-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
          .receipt-info { font-size: 14px; color: #666; }
          .section { margin-bottom: 20px; }
          .section-title { font-size: 16px; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #ccc; }
          .detail-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
          .detail-label { font-weight: bold; }
          .amount { font-size: 18px; font-weight: bold; color: #dc2626; }
          .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #666; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="receipt-title">DETALLE DE DEUDA</div>
          <div class="receipt-info">STPark - Sistema de Estacionamientos</div>
        </div>
        
        <div class="section">
          <div class="section-title">Informaci\xF3n de la Deuda</div>
          <div class="detail-row">
            <span class="detail-label">ID de Deuda:</span>
            <span>${this.debt.id}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Placa:</span>
            <span>${this.debt.plate}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Monto:</span>
            <span class="amount">${this.formatAmount(this.debt.principal_amount)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Origen:</span>
            <span>${this.getOriginText(this.debt.origin)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Estado:</span>
            <span>${this.getStatusText(this.debt.status)}</span>
          </div>
        </div>
        
        ${this.debt.session_id?`
        <div class="section">
          <div class="section-title">Informaci\xF3n de la Sesi\xF3n</div>
          <div class="detail-row">
            <span class="detail-label">ID de Sesi\xF3n:</span>
            <span>${this.debt.session_id}</span>
          </div>
        </div>
        `:""}
        
        <div class="section">
          <div class="section-title">Informaci\xF3n de Auditor\xEDa</div>
          <div class="detail-row">
            <span class="detail-label">Creada:</span>
            <span>${this.formatDate(this.debt.created_at)}</span>
          </div>
          ${this.debt.settled_at?`
          <div class="detail-row">
            <span class="detail-label">Liquidada:</span>
            <span>${this.formatDate(this.debt.settled_at)}</span>
          </div>
          `:""}
        </div>
        
        <div class="footer">
          <div>Fecha de impresi\xF3n: ${this.formatDate(new Date().toISOString())}</div>
          <div>Gracias por usar STPark</div>
        </div>
      </body>
      </html>
    `:""}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=w({type:i,selectors:[["app-debt-details-modal"]],inputs:{visible:"visible",debt:"debt"},outputs:{visibleChange:"visibleChange"},features:[F],decls:4,vars:13,consts:[["header","DETALLES DE LA DEUDA",3,"visibleChange","visible","modal","breakpoints","draggable","resizable","closable","closeOnEscape"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","debt-details",4,"ngIf"],["pTemplate","footer"],[1,"flex","justify-center","items-center","py-8"],[1,"text-center"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600","mx-auto","mb-4"],[1,"text-gray-600"],[1,"debt-details"],[1,"detail-section"],[1,"detail-grid","compact"],[1,"detail-item"],[1,"font-mono"],[1,"plate"],[1,"amount"],[1,"origin-info"],[1,"origin-icon"],[1,"status",3,"ngClass"],["class","detail-section",4,"ngIf"],["class","detail-item",4,"ngIf"],[1,"payments-list"],["class","payment-item",4,"ngFor","ngForOf"],[1,"payment-item"],[1,"payment-info"],[1,"payment-method"],[1,"payment-amount"],[1,"payment-date"],[1,"flex","justify-end","gap-2"],["pButton","","type","button","label","Cerrar","icon","pi pi-times",1,"p-button-text",3,"click"],["pButton","","type","button","label","Imprimir","icon","pi pi-print",1,"p-button-outlined",3,"click"]],template:function(r,l){r&1&&(n(0,"p-dialog",0),h("visibleChange",function(b){return v(l.visible,b)||(l.visible=b),b}),x("visibleChange",function(b){return l.visibleChange.emit(b)}),u(1,Ue,5,0,"div",1)(2,at,45,13,"div",2)(3,ot,3,0,"ng-template",3),t()),r&2&&(W(L(11,Ge)),M("visible",l.visible),d("modal",!0)("breakpoints",L(12,He))("draggable",!1)("resizable",!1)("closable",!1)("closeOnEscape",!1),o(),d("ngIf",!l.debt),o(),d("ngIf",l.debt))},dependencies:[I,B,$,O,ue,ge,me,pe,ce],styles:[".debt-details[_ngcontent-%COMP%]   .detail-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.debt-details[_ngcontent-%COMP%]   .detail-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#374151;margin-bottom:.75rem;padding-bottom:.25rem;border-bottom:1px solid #e5e7eb}.debt-details[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:.75rem}.debt-details[_ngcontent-%COMP%]   .detail-grid.compact[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.5rem}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500;color:#6b7280;text-transform:uppercase;letter-spacing:.05em}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem;color:#111827;font-weight:500}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .font-mono[_ngcontent-%COMP%]{font-family:Monaco,Menlo,Ubuntu Mono,monospace;background-color:#f3f4f6;padding:.25rem .5rem;border-radius:.25rem;font-size:.875rem}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .plate[_ngcontent-%COMP%]{font-family:Monaco,Menlo,Ubuntu Mono,monospace;background-color:#dbeafe;color:#1e40af;padding:.25rem .5rem;border-radius:.25rem;font-weight:600;text-transform:uppercase}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;color:#dc2626}.debt-details[_ngcontent-%COMP%]   .origin-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.debt-details[_ngcontent-%COMP%]   .origin-info[_ngcontent-%COMP%]   .origin-icon[_ngcontent-%COMP%]{font-size:1.25rem;color:#6b7280}.debt-details[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .75rem;border-radius:9999px;font-size:.875rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em}.debt-details[_ngcontent-%COMP%]   .status.status-orange[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.debt-details[_ngcontent-%COMP%]   .status.status-green[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.debt-details[_ngcontent-%COMP%]   .status.status-red[_ngcontent-%COMP%]{background-color:#fee2e2;color:#991b1b}.debt-details[_ngcontent-%COMP%]   .status.status-gray[_ngcontent-%COMP%]{background-color:#f3f4f6;color:#6b7280}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background-color:#f9fafb;border-radius:.5rem;margin-bottom:.5rem;border-left:4px solid #10b981}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-info[_ngcontent-%COMP%]   .payment-method[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#374151}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-info[_ngcontent-%COMP%]   .payment-amount[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#059669}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-date[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280}@media (max-width: 768px){.debt-details[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%], .debt-details[_ngcontent-%COMP%]   .detail-grid.compact[_ngcontent-%COMP%]{grid-template-columns:1fr}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:1rem}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}[_nghost-%COMP%]     .p-dialog-footer{padding:1rem 1.5rem;border-top:1px solid #e5e7eb;background-color:#f9fafb}"]})}}return i})();function lt(i,s){i&1&&(n(0,"th",51),a(1,"Placa"),t())}function rt(i,s){if(i&1&&(n(0,"td",52)(1,"span",53),a(2),t()()),i&2){let e=s.$implicit;o(2),p(e.plate)}}function st(i,s){i&1&&(n(0,"th",51),a(1,"Monto"),t())}function dt(i,s){if(i&1&&(n(0,"td",52)(1,"span",54),a(2),t()()),i&2){let e=s.$implicit,r=c();o(2),y(" ",r.formatAmount(e.principal_amount)," ")}}function mt(i,s){i&1&&(n(0,"th",51),a(1,"Origen"),t())}function ct(i,s){if(i&1&&(n(0,"td",52)(1,"mat-chip-set")(2,"mat-chip"),a(3),t()()()),i&2){let e=s.$implicit,r=c();o(2),P("bg-"+r.getOriginColor(e.origin)+"-100 text-"+r.getOriginColor(e.origin)+"-800"),o(),y(" ",r.getOriginLabel(e.origin)," ")}}function pt(i,s){i&1&&(n(0,"th",51),a(1,"Estado"),t())}function gt(i,s){if(i&1&&(n(0,"td",52)(1,"span",55),a(2),t()()),i&2){let e=s.$implicit,r=c();o(),P("bg-"+r.getStatusColor(e.status)+"-100 text-"+r.getStatusColor(e.status)+"-800"),o(),y(" ",e.status==="PENDING"?"Pendiente":"Liquidada"," ")}}function ut(i,s){i&1&&(n(0,"th",51),a(1,"Fecha"),t())}function _t(i,s){if(i&1&&(n(0,"td",52),a(1),t()),i&2){let e=s.$implicit,r=c();o(),y(" ",r.formatDate(e.created_at)," ")}}function ft(i,s){i&1&&(n(0,"th",51),a(1,"Acciones"),t())}function bt(i,s){if(i&1){let e=E();n(0,"button",57),x("click",function(){_(e);let l=c().$implicit,m=c();return f(m.settleDebt(l))}),n(1,"mat-icon"),a(2,"payment"),t(),a(3," Liquidar deuda "),t()}}function xt(i,s){if(i&1){let e=E();n(0,"td",52)(1,"button",56)(2,"mat-icon"),a(3,"more_vert"),t()(),n(4,"mat-menu",null,1)(6,"button",57),x("click",function(){let l=_(e).$implicit,m=c();return f(m.showDebtDetails(l))}),n(7,"mat-icon"),a(8,"visibility"),t(),a(9," Ver detalles "),t(),u(10,bt,4,0,"button",58),n(11,"button",57),x("click",function(){let l=_(e).$implicit,m=c();return f(m.printDebt(l))}),n(12,"mat-icon"),a(13,"print"),t(),a(14," Imprimir "),t()()()}if(i&2){let e=s.$implicit,r=k(5);o(),d("matMenuTriggerFor",r),o(9),d("ngIf",e.status==="PENDING")}}function Ct(i,s){i&1&&C(0,"tr",59)}function Mt(i,s){i&1&&C(0,"tr",60)}function vt(i,s){i&1&&(n(0,"div",61),C(1,"mat-spinner",62),t())}function ht(i,s){i&1&&(n(0,"div",63)(1,"mat-icon",64),a(2,"account_balance_wallet"),t(),n(3,"h3",65),a(4,"No hay deudas registradas"),t(),n(5,"p",66),a(6,"Las deudas aparecer\xE1n aqu\xED cuando se generen."),t()())}function Dt(i,s){if(i&1){let e=E();n(0,"mat-paginator",67),x("page",function(l){_(e);let m=c();return f(m.onPageChange(l))}),t()}if(i&2){let e=c();d("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}var un=(()=>{class i{constructor(e){this.debtService=e,this._unsubscribeAll=new A,this.debts=[],this.loading=!1,this.displayedColumns=["plate","amount","origin","status","created_at","actions"],this.showDetailsModal=!1,this.selectedDebt=null,this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.filters={plate:"",origin:"",status:"",date_from:""}}ngOnInit(){this.loadDebts()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadDebts(){this.loading=!0;let e=N({page:this.currentPage+1,per_page:this.pageSize},this.filters);this.debtService.getDebts(e).pipe(T(this._unsubscribeAll)).subscribe({next:r=>{this.debts=r.data?.data||[],this.totalItems=r.data?.total||0,this.loading=!1},error:r=>{console.error("Error loading debts:",r),this.loading=!1}})}formatAmount(e){return this.debtService.formatAmount(e)}formatDate(e){if(!e)return"N/A";let r=new Date(e);if(isNaN(r.getTime()))return"N/A";let l=r.toLocaleDateString("es-CL",{day:"2-digit",month:"2-digit",year:"numeric"}),m=r.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${l} ${m}`}getStatusColor(e){switch(e){case"PENDING":return"orange";case"SETTLED":return"green";default:return"gray"}}getOriginColor(e){switch(e){case"SESSION":return"blue";case"FINE":return"red";case"MANUAL":return"purple";default:return"gray"}}getOriginLabel(e){switch(e){case"SESSION":return"Sesi\xF3n";case"FINE":return"Multa";case"MANUAL":return"Manual";default:return e}}getPendingCount(){return this.debts.filter(e=>e.status==="PENDING").length}getSettledCount(){return this.debts.filter(e=>e.status==="SETTLED").length}getTotalPending(){return this.debts.filter(e=>e.status==="PENDING").reduce((e,r)=>e+r.principal_amount,0)}settleDebt(e){console.log("Settling debt:",e)}showDebtDetails(e){this.loading=!0,this.debtService.getDebt(e.id).pipe(T(this._unsubscribeAll)).subscribe({next:r=>{this.selectedDebt=r.data,this.showDetailsModal=!0,this.loading=!1},error:r=>{console.error("Error loading debt details:",r),this.loading=!1}})}closeDetailsModal(){this.showDetailsModal=!1,this.selectedDebt=null}printDebt(e){console.log("Printing debt:",e)}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadDebts()}applyFilters(){this.currentPage=0,this.loadDebts()}clearFilters(){this.filters={plate:"",origin:"",status:"",date_from:""},this.currentPage=0,this.loadDebts()}static{this.\u0275fac=function(r){return new(r||i)(V(ve))}}static{this.\u0275cmp=w({type:i,selectors:[["app-debts"]],decls:113,vars:17,consts:[["picker",""],["menu","matMenu"],[1,"p-6","w-full"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-orange-100","rounded-full"],[1,"text-orange-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-orange-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"text-2xl","font-bold","text-blue-600"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],["appearance","outline"],["matInput","","placeholder","ABC123",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],["value","SESSION"],["value","FINE"],["value","MANUAL"],["value","PENDING"],["value","SETTLED"],["matInput","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","plate"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","amount"],["matColumnDef","origin"],["matColumnDef","status"],["matColumnDef","created_at"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],[3,"visibleChange","visible","debt"],["mat-header-cell",""],["mat-cell",""],[1,"font-mono","font-semibold"],[1,"font-semibold","text-red-600"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-header-row",""],["mat-row",""],[1,"flex","justify-center","items-center","py-8"],["diameter","40"],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"text-gray-500"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"]],template:function(r,l){if(r&1){let m=E();n(0,"div",2)(1,"div",3)(2,"h1",4),a(3,"Deudas"),t(),n(4,"p",5),a(5,"Gestiona las deudas pendientes y liquidadas"),t()(),n(6,"div",6)(7,"mat-card")(8,"mat-card-content",7)(9,"div",8)(10,"div",9)(11,"mat-icon",10),a(12,"pending"),t()(),n(13,"div",11)(14,"p",12),a(15,"Pendientes"),t(),n(16,"p",13),a(17),t()()()()(),n(18,"mat-card")(19,"mat-card-content",7)(20,"div",8)(21,"div",14)(22,"mat-icon",15),a(23,"check_circle"),t()(),n(24,"div",11)(25,"p",12),a(26,"Liquidadas"),t(),n(27,"p",16),a(28),t()()()()(),n(29,"mat-card")(30,"mat-card-content",7)(31,"div",8)(32,"div",17)(33,"mat-icon",18),a(34,"account_balance_wallet"),t()(),n(35,"div",11)(36,"p",12),a(37,"Total Pendiente"),t(),n(38,"p",19),a(39),t()()()()()(),n(40,"mat-card",3)(41,"mat-card-content",7)(42,"div",20)(43,"mat-form-field",21)(44,"mat-label"),a(45,"Placa del veh\xEDculo"),t(),n(46,"input",22),h("ngModelChange",function(g){return _(m),v(l.filters.plate,g)||(l.filters.plate=g),f(g)}),t()(),n(47,"mat-form-field",21)(48,"mat-label"),a(49,"Origen"),t(),n(50,"mat-select",23),h("ngModelChange",function(g){return _(m),v(l.filters.origin,g)||(l.filters.origin=g),f(g)}),n(51,"mat-option",24),a(52,"Todos"),t(),n(53,"mat-option",25),a(54,"Sesi\xF3n"),t(),n(55,"mat-option",26),a(56,"Multa"),t(),n(57,"mat-option",27),a(58,"Manual"),t()()(),n(59,"mat-form-field",21)(60,"mat-label"),a(61,"Estado"),t(),n(62,"mat-select",23),h("ngModelChange",function(g){return _(m),v(l.filters.status,g)||(l.filters.status=g),f(g)}),n(63,"mat-option",24),a(64,"Todos"),t(),n(65,"mat-option",28),a(66,"Pendiente"),t(),n(67,"mat-option",29),a(68,"Liquidada"),t()()(),n(69,"mat-form-field",21)(70,"mat-label"),a(71,"Fecha desde"),t(),n(72,"input",30),h("ngModelChange",function(g){return _(m),v(l.filters.date_from,g)||(l.filters.date_from=g),f(g)}),t(),C(73,"mat-datepicker-toggle",31)(74,"mat-datepicker",null,0),t()(),n(76,"div",32)(77,"button",33),x("click",function(){return _(m),f(l.clearFilters())}),n(78,"mat-icon"),a(79,"clear"),t(),a(80," Limpiar "),t(),n(81,"button",34),x("click",function(){return _(m),f(l.applyFilters())}),n(82,"mat-icon"),a(83,"search"),t(),a(84," Filtrar "),t()()()(),n(85,"mat-card")(86,"mat-card-content",7)(87,"div",35)(88,"table",36),D(89,37),u(90,lt,2,0,"th",38)(91,rt,3,1,"td",39),S(),D(92,40),u(93,st,2,0,"th",38)(94,dt,3,1,"td",39),S(),D(95,41),u(96,mt,2,0,"th",38)(97,ct,4,3,"td",39),S(),D(98,42),u(99,pt,2,0,"th",38)(100,gt,3,3,"td",39),S(),D(101,43),u(102,ut,2,0,"th",38)(103,_t,2,1,"td",39),S(),D(104,44),u(105,ft,2,0,"th",38)(106,xt,15,2,"td",39),S(),u(107,Ct,1,0,"tr",45)(108,Mt,1,0,"tr",46),t(),u(109,vt,2,0,"div",47)(110,ht,7,0,"div",48),t(),u(111,Dt,1,5,"mat-paginator",49),t()(),n(112,"app-debt-details-modal",50),h("visibleChange",function(g){return _(m),v(l.showDetailsModal,g)||(l.showDetailsModal=g),f(g)}),x("visibleChange",function(){return _(m),f(l.closeDetailsModal())}),t()()}if(r&2){let m=k(75);o(17),p(l.getPendingCount()),o(11),p(l.getSettledCount()),o(11),p(l.formatAmount(l.getTotalPending())),o(7),M("ngModel",l.filters.plate),o(4),M("ngModel",l.filters.origin),o(12),M("ngModel",l.filters.status),o(10),d("matDatepicker",m),M("ngModel",l.filters.date_from),o(),d("for",m),o(15),d("dataSource",l.debts),o(19),d("matHeaderRowDef",l.displayedColumns),o(),d("matRowDefColumns",l.displayedColumns),o(),d("ngIf",l.loading),o(),d("ngIf",!l.loading&&l.debts.length===0),o(),d("ngIf",l.totalItems>0),o(),M("visible",l.showDetailsModal),d("debt",l.selectedDebt)}},dependencies:[I,O,oe,ne,ie,ae,ke,he,Se,we,Ee,De,Oe,ye,Pe,Ie,Te,Be,Ve,We,J,U,Y,Q,K,de,se,$e,H,G,R,q,re,le,xe,_e,fe,be,Me,Ce,j,te,Z,X,ee,ze,Ae,Fe,Ne,Le,je],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151}.mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}.status-pending[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.status-settled[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.origin-session[_ngcontent-%COMP%]{background-color:#dbeafe;color:#1e40af}.origin-fine[_ngcontent-%COMP%]{background-color:#fee2e2;color:#dc2626}.origin-manual[_ngcontent-%COMP%]{background-color:#e9d5ff;color:#7c3aed}.mat-mdc-chip[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500}@media (max-width: 768px){.grid-cols-3[_ngcontent-%COMP%], .grid-cols-4[_ngcontent-%COMP%]{grid-template-columns:1fr}.mat-mdc-table[_ngcontent-%COMP%]{font-size:.875rem}}"]})}}return i})();export{un as DebtsComponent};
