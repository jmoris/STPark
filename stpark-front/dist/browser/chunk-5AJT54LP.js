import{a as Je}from"./chunk-GQXICOHE.js";import{o as fe,q as be,u as Ce,v as xe}from"./chunk-VLILCSTU.js";import{a as ye}from"./chunk-PDSVMDVN.js";import{a as Re,b as je,c as qe}from"./chunk-ICPS6N2F.js";import{a as ze,b as Be,c as We,d as k,e as He,f as $e,g as Ye}from"./chunk-JNOO3R6U.js";import{a as Pe,b as we,c as Oe,d as Ie,e as Te,f as ke,g as Le,h as Ne,i as Ae,j as Fe,k as Ve}from"./chunk-Y6UNS2UZ.js";import{a as Ge,c as Ue,f as Qe}from"./chunk-N7KP3IEB.js";import{a as he,b as Me,c as ve,d as De}from"./chunk-5EOBZ7FL.js";import{a as Se,b as Ee}from"./chunk-ASZQIH2H.js";import{_ as _e}from"./chunk-XVA6OPV7.js";import{a as ne,b as ae,c as oe,d as re}from"./chunk-IDWAZBHT.js";import"./chunk-FSA3IEFI.js";import"./chunk-ECYJLMJT.js";import"./chunk-VKB6BRO6.js";import{b as te,c as ie}from"./chunk-IMRKXFOQ.js";import{d as ce,e as pe}from"./chunk-TWB6D3BU.js";import{a as ge,b as ue}from"./chunk-CWSZZ2DY.js";import{b as Q,f as Y,j as J,k as K}from"./chunk-K3BNOLHS.js";import{b as le,f as se,j as de,x as me}from"./chunk-AWW653NS.js";import{fa as U,la as X,na as Z,oa as ee}from"./chunk-QQQ5XT6I.js";import"./chunk-YXFY4UXK.js";import"./chunk-EARUC3FY.js";import{k as q,l as G,m as I,s as T}from"./chunk-BAM5RHC5.js";import{$b as C,Eb as m,Hb as W,Ib as P,Pb as i,Qb as t,Rb as x,Sb as D,Tb as S,U as w,Vb as E,bb as r,bc as c,cb as B,f as F,fc as H,gc as $,hc as R,lc as L,mc as a,na as V,nc as p,oa as _,oc as y,pa as f,pb as O,rc as h,sc as M,tc as v,uc as j,vc as N,wb as u,ya as z}from"./chunk-MLNNMN4J.js";import{a as A}from"./chunk-TSRGIXR5.js";var et=()=>({width:"45rem"}),tt=()=>({"1199px":"70vw","575px":"90vw"});function it(n,s){n&1&&(i(0,"div",4)(1,"div",5),x(2,"div",6),i(3,"p",7),a(4,"Cargando detalles de la deuda..."),t()()())}function nt(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Patente:"),t(),i(3,"span",13),a(4),t()()),n&2){let e=c(3);r(4),p(e.debt.parking_session.plate)}}function at(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Sector:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(3);r(4),p(e.debt.parking_session.sector.name)}}function ot(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Calle:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(3);r(4),p(e.debt.parking_session.street.name)}}function rt(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Inicio:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(3);r(4),p(e.formatDate(e.debt.parking_session.started_at))}}function lt(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Fin:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(3);r(4),p(e.formatDate(e.debt.parking_session.ended_at))}}function st(n,s){if(n&1&&(i(0,"div",9)(1,"h3"),a(2,"Sesi\xF3n Asociada"),t(),i(3,"div",10)(4,"div",11)(5,"label"),a(6,"ID de Sesi\xF3n:"),t(),i(7,"span",12),a(8),t()(),u(9,nt,5,1,"div",19)(10,at,5,1,"div",19)(11,ot,5,1,"div",19)(12,rt,5,1,"div",19)(13,lt,5,1,"div",19),t()()),n&2){let e=c(2);r(8),p(e.debt.session_id),r(),m("ngIf",e.debt.parking_session),r(),m("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.sector),r(),m("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.street),r(),m("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.started_at),r(),m("ngIf",e.debt.parking_session==null?null:e.debt.parking_session.ended_at)}}function dt(n,s){if(n&1&&(i(0,"div",22)(1,"div",23)(2,"span",24),a(3),t(),i(4,"span",25),a(5),t()(),i(6,"div",26),a(7),t()()),n&2){let e=s.$implicit,l=c(3);r(3),p(e.method),r(2),p(l.formatAmount(e.amount)),r(2),p(l.formatDate(e.created_at))}}function mt(n,s){if(n&1&&(i(0,"div",9)(1,"h3"),a(2,"Pagos Realizados"),t(),i(3,"div",20),u(4,dt,8,3,"div",21),t()()),n&2){let e=c(2);r(4),m("ngForOf",e.debt.payments)}}function ct(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Liquidada:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(2);r(4),p(e.formatDate(e.debt.settled_at))}}function pt(n,s){if(n&1&&(i(0,"div",11)(1,"label"),a(2,"Actualizada:"),t(),i(3,"span"),a(4),t()()),n&2){let e=c(2);r(4),p(e.formatDate(e.debt.updated_at))}}function gt(n,s){if(n&1&&(i(0,"div",8)(1,"div",9)(2,"h3"),a(3,"Informaci\xF3n de la Deuda"),t(),i(4,"div",10)(5,"div",11)(6,"label"),a(7,"ID:"),t(),i(8,"span",12),a(9),t()(),i(10,"div",11)(11,"label"),a(12,"Placa:"),t(),i(13,"span",13),a(14),t()(),i(15,"div",11)(16,"label"),a(17,"Monto:"),t(),i(18,"span",14),a(19),t()(),i(20,"div",11)(21,"label"),a(22,"Origen:"),t(),i(23,"div",15),x(24,"i",16),i(25,"span"),a(26),t()()(),i(27,"div",11)(28,"label"),a(29,"Estado:"),t(),i(30,"span",17),a(31),t()()()(),u(32,st,14,6,"div",18)(33,mt,5,1,"div",18),i(34,"div",9)(35,"h3"),a(36,"Auditor\xEDa"),t(),i(37,"div",10)(38,"div",11)(39,"label"),a(40,"Creada:"),t(),i(41,"span"),a(42),t()(),u(43,ct,5,1,"div",19)(44,pt,5,1,"div",19),t()()()),n&2){let e=c();r(9),p(e.debt.id),r(5),p(e.debt.plate),r(5),p(e.formatAmount(e.debt.principal_amount)),r(5),P(e.getOriginIcon(e.debt.origin)),r(2),p(e.getOriginText(e.debt.origin)),r(4),m("ngClass","status-"+e.getStatusColor(e.debt.status)),r(),y(" ",e.getStatusText(e.debt.status)," "),r(),m("ngIf",e.debt.session_id),r(),m("ngIf",e.debt.payments&&e.debt.payments.length>0),r(9),p(e.formatDate(e.debt.created_at)),r(),m("ngIf",e.debt.settled_at),r(),m("ngIf",e.debt.updated_at&&e.debt.updated_at!==e.debt.created_at)}}function ut(n,s){if(n&1){let e=E();i(0,"div",27)(1,"button",28),C("click",function(){_(e);let o=c();return f(o.closeModal())}),t(),i(2,"button",29),C("click",function(){_(e);let o=c();return f(o.printDebt())}),t()()}}var Ke=(()=>{class n{constructor(){this.visible=!1,this.debt=null,this.visibleChange=new z}ngOnChanges(){}closeModal(){this.visible=!1,this.visibleChange.emit(!1)}formatAmount(e){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e).replace("CLP","$")}formatDate(e){if(!e)return"N/A";let l=new Date(e);if(isNaN(l.getTime()))return"N/A";let o=l.toLocaleDateString("es-CL",{day:"2-digit",month:"2-digit",year:"numeric"}),d=l.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${o} ${d}`}getStatusText(e){switch(e){case"PENDING":return"Pendiente";case"SETTLED":return"Liquidada";case"CANCELLED":return"Cancelada";default:return e}}getStatusColor(e){switch(e){case"PENDING":return"orange";case"SETTLED":return"green";case"CANCELLED":return"red";default:return"gray"}}getOriginText(e){switch(e){case"SESSION":return"Sesi\xF3n de Estacionamiento";case"FINE":return"Multa";case"MANUAL":return"Manual";default:return e}}getOriginIcon(e){switch(e){case"SESSION":return"pi-car";case"FINE":return"pi-exclamation-triangle";case"MANUAL":return"pi-user-edit";default:return"pi-question-circle"}}printDebt(){if(!this.debt)return;let e=window.open("","_blank");if(e){let l=this.generateDebtReceiptHtml();e.document.write(l),e.document.close(),e.print()}}generateDebtReceiptHtml(){return this.debt?`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Detalle de Deuda - ${this.debt.id}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          .header { text-align: center; margin-bottom: 30px; }
          .receipt-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
          .receipt-info { font-size: 14px; color: #666; }
          .section { margin-bottom: 20px; }
          .section-title { font-size: 16px; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #ccc; }
          .detail-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
          .detail-label { font-weight: bold; }
          .amount { font-size: 18px; font-weight: bold; color: #dc2626; }
          .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #666; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="receipt-title">DETALLE DE DEUDA</div>
          <div class="receipt-info">STPark - Sistema de Estacionamientos</div>
        </div>
        
        <div class="section">
          <div class="section-title">Informaci\xF3n de la Deuda</div>
          <div class="detail-row">
            <span class="detail-label">ID de Deuda:</span>
            <span>${this.debt.id}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Placa:</span>
            <span>${this.debt.plate}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Monto:</span>
            <span class="amount">${this.formatAmount(this.debt.principal_amount)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Origen:</span>
            <span>${this.getOriginText(this.debt.origin)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Estado:</span>
            <span>${this.getStatusText(this.debt.status)}</span>
          </div>
        </div>
        
        ${this.debt.session_id?`
        <div class="section">
          <div class="section-title">Informaci\xF3n de la Sesi\xF3n</div>
          <div class="detail-row">
            <span class="detail-label">ID de Sesi\xF3n:</span>
            <span>${this.debt.session_id}</span>
          </div>
        </div>
        `:""}
        
        <div class="section">
          <div class="section-title">Informaci\xF3n de Auditor\xEDa</div>
          <div class="detail-row">
            <span class="detail-label">Creada:</span>
            <span>${this.formatDate(this.debt.created_at)}</span>
          </div>
          ${this.debt.settled_at?`
          <div class="detail-row">
            <span class="detail-label">Liquidada:</span>
            <span>${this.formatDate(this.debt.settled_at)}</span>
          </div>
          `:""}
        </div>
        
        <div class="footer">
          <div>Fecha de impresi\xF3n: ${this.formatDate(new Date().toISOString())}</div>
          <div>Gracias por usar STPark</div>
        </div>
      </body>
      </html>
    `:""}static{this.\u0275fac=function(l){return new(l||n)}}static{this.\u0275cmp=O({type:n,selectors:[["app-debt-details-modal"]],inputs:{visible:"visible",debt:"debt"},outputs:{visibleChange:"visibleChange"},features:[V],decls:4,vars:13,consts:[["header","DETALLES DE LA DEUDA",3,"visibleChange","visible","modal","breakpoints","draggable","resizable","closable","closeOnEscape"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","debt-details",4,"ngIf"],["pTemplate","footer"],[1,"flex","justify-center","items-center","py-8"],[1,"text-center"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600","mx-auto","mb-4"],[1,"text-gray-600"],[1,"debt-details"],[1,"detail-section"],[1,"detail-grid","compact"],[1,"detail-item"],[1,"font-mono"],[1,"plate"],[1,"amount"],[1,"origin-info"],[1,"origin-icon"],[1,"status",3,"ngClass"],["class","detail-section",4,"ngIf"],["class","detail-item",4,"ngIf"],[1,"payments-list"],["class","payment-item",4,"ngFor","ngForOf"],[1,"payment-item"],[1,"payment-info"],[1,"payment-method"],[1,"payment-amount"],[1,"payment-date"],[1,"flex","justify-end","gap-2"],["pButton","","type","button","label","Cerrar","icon","pi pi-times",1,"p-button-text",3,"click"],["pButton","","type","button","label","Imprimir","icon","pi pi-print",1,"p-button-outlined",3,"click"]],template:function(l,o){l&1&&(i(0,"p-dialog",0),v("visibleChange",function(b){return M(o.visible,b)||(o.visible=b),b}),C("visibleChange",function(b){return o.visibleChange.emit(b)}),u(1,it,5,0,"div",1)(2,gt,45,13,"div",2)(3,ut,3,0,"ng-template",3),t()),l&2&&(W(N(11,et)),h("visible",o.visible),m("modal",!0)("breakpoints",N(12,tt))("draggable",!1)("resizable",!1)("closable",!1)("closeOnEscape",!1),r(),m("ngIf",!o.debt),r(),m("ngIf",o.debt))},dependencies:[T,q,G,I,xe,Ce,_e,be,fe],styles:[".debt-details[_ngcontent-%COMP%]   .detail-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.debt-details[_ngcontent-%COMP%]   .detail-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#374151;margin-bottom:.75rem;padding-bottom:.25rem;border-bottom:1px solid #e5e7eb}.debt-details[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:.75rem}.debt-details[_ngcontent-%COMP%]   .detail-grid.compact[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.5rem}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500;color:#6b7280;text-transform:uppercase;letter-spacing:.05em}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem;color:#111827;font-weight:500}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .font-mono[_ngcontent-%COMP%]{font-family:Monaco,Menlo,Ubuntu Mono,monospace;background-color:#f3f4f6;padding:.25rem .5rem;border-radius:.25rem;font-size:.875rem}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .plate[_ngcontent-%COMP%]{font-family:Monaco,Menlo,Ubuntu Mono,monospace;background-color:#dbeafe;color:#1e40af;padding:.25rem .5rem;border-radius:.25rem;font-weight:600;text-transform:uppercase}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;color:#dc2626}.debt-details[_ngcontent-%COMP%]   .origin-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.debt-details[_ngcontent-%COMP%]   .origin-info[_ngcontent-%COMP%]   .origin-icon[_ngcontent-%COMP%]{font-size:1.25rem;color:#6b7280}.debt-details[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .75rem;border-radius:9999px;font-size:.875rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em}.debt-details[_ngcontent-%COMP%]   .status.status-orange[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.debt-details[_ngcontent-%COMP%]   .status.status-green[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.debt-details[_ngcontent-%COMP%]   .status.status-red[_ngcontent-%COMP%]{background-color:#fee2e2;color:#991b1b}.debt-details[_ngcontent-%COMP%]   .status.status-gray[_ngcontent-%COMP%]{background-color:#f3f4f6;color:#6b7280}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background-color:#f9fafb;border-radius:.5rem;margin-bottom:.5rem;border-left:4px solid #10b981}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-info[_ngcontent-%COMP%]   .payment-method[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#374151}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-info[_ngcontent-%COMP%]   .payment-amount[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#059669}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]   .payment-date[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280}@media (max-width: 768px){.debt-details[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%], .debt-details[_ngcontent-%COMP%]   .detail-grid.compact[_ngcontent-%COMP%]{grid-template-columns:1fr}.debt-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:1rem}.debt-details[_ngcontent-%COMP%]   .payments-list[_ngcontent-%COMP%]   .payment-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}[_nghost-%COMP%]     .p-dialog-footer{padding:1rem 1.5rem;border-top:1px solid #e5e7eb;background-color:#f9fafb}"]})}}return n})();function _t(n,s){n&1&&(i(0,"th",56),a(1,"Placa"),t())}function ft(n,s){if(n&1&&(i(0,"td",57)(1,"span",58),a(2),t()()),n&2){let e=s.$implicit;r(2),p(e.plate)}}function bt(n,s){n&1&&(i(0,"th",59),a(1,"Monto"),t())}function Ct(n,s){if(n&1&&(i(0,"td",57)(1,"span",60),a(2),t()()),n&2){let e=s.$implicit,l=c();r(2),y(" ",l.formatAmount(e.principal_amount)," ")}}function xt(n,s){n&1&&(i(0,"th",61),a(1,"Origen"),t())}function ht(n,s){if(n&1&&(i(0,"td",57)(1,"mat-chip-set")(2,"mat-chip"),a(3),t()()()),n&2){let e=s.$implicit,l=c();r(2),P("bg-"+l.getOriginColor(e.origin)+"-100 text-"+l.getOriginColor(e.origin)+"-800"),r(),y(" ",l.getOriginLabel(e.origin)," ")}}function Mt(n,s){n&1&&(i(0,"th",62),a(1,"Estado"),t())}function vt(n,s){if(n&1&&(i(0,"td",57)(1,"span",63),a(2),t()()),n&2){let e=s.$implicit,l=c();r(),P("bg-"+l.getStatusColor(e.status)+"-100 text-"+l.getStatusColor(e.status)+"-800"),r(),y(" ",e.status==="PENDING"?"Pendiente":"Liquidada"," ")}}function Dt(n,s){n&1&&(i(0,"th",64),a(1,"Fecha"),t())}function St(n,s){if(n&1&&(i(0,"td",57),a(1),t()),n&2){let e=s.$implicit,l=c();r(),y(" ",l.formatDate(e.created_at)," ")}}function Et(n,s){n&1&&(i(0,"th",65),a(1,"Acciones"),t())}function yt(n,s){if(n&1){let e=E();i(0,"button",67),C("click",function(){_(e);let o=c().$implicit,d=c();return f(d.settleDebt(o))}),i(1,"mat-icon"),a(2,"payment"),t(),a(3," Liquidar deuda "),t()}}function Pt(n,s){if(n&1){let e=E();i(0,"td",57)(1,"button",66)(2,"mat-icon"),a(3,"more_vert"),t()(),i(4,"mat-menu",null,1)(6,"button",67),C("click",function(){let o=_(e).$implicit,d=c();return f(d.showDebtDetails(o))}),i(7,"mat-icon"),a(8,"visibility"),t(),a(9," Ver detalles "),t(),u(10,yt,4,0,"button",68),i(11,"button",67),C("click",function(){let o=_(e).$implicit,d=c();return f(d.printDebt(o))}),i(12,"mat-icon"),a(13,"print"),t(),a(14," Imprimir "),t()()()}if(n&2){let e=s.$implicit,l=L(5);r(),m("matMenuTriggerFor",l),r(9),m("ngIf",e.status==="PENDING")}}function wt(n,s){n&1&&x(0,"tr",69)}function Ot(n,s){n&1&&x(0,"tr",70)}function It(n,s){n&1&&(i(0,"div",71),x(1,"mat-spinner",72),t())}function Tt(n,s){n&1&&(i(0,"div",73)(1,"mat-icon",74),a(2,"account_balance_wallet"),t(),i(3,"h3",75),a(4,"No hay deudas registradas"),t(),i(5,"p",76),a(6,"Las deudas aparecer\xE1n aqu\xED cuando se generen."),t()())}function kt(n,s){if(n&1){let e=E();i(0,"mat-paginator",77),C("page",function(o){_(e);let d=c();return f(d.onPageChange(o))}),t()}if(n&2){let e=c();m("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",e.pageSizeOptions)("showFirstLastButtons",!0)}}var Ei=(()=>{class n{constructor(e){this.debtService=e,this._unsubscribeAll=new F,this.debts=[],this.loading=!1,this.displayedColumns=["plate","amount","origin","status","created_at","actions"],this.showDetailsModal=!1,this.selectedDebt=null,this.totalItems=0,this.pageSize=10,this.currentPage=0,this.pageSizeOptions=[5,10,25,50],this.sortBy="created_at",this.sortOrder="desc",this.filters={plate:"",origin:"",status:"",date_from:""}}ngOnInit(){this.loadDebts()}ngAfterViewInit(){this.sort&&this.sort.sortChange.pipe(w(this._unsubscribeAll)).subscribe(e=>{this.sortBy=e.active,this.sortOrder=e.direction==="asc"?"asc":"desc",this.currentPage=0,this.loadDebts()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}loadDebts(){this.loading=!0;let e=A({page:this.currentPage+1,per_page:this.pageSize,sort_by:this.sortBy,sort_order:this.sortOrder},this.filters);this.debtService.getDebts(e).pipe(w(this._unsubscribeAll)).subscribe({next:l=>{this.debts=l.data?.data||[],this.totalItems=l.data?.total||0,this.loading=!1},error:l=>{console.error("Error loading debts:",l),this.loading=!1}})}formatAmount(e){return this.debtService.formatAmount(e)}formatDate(e){if(!e)return"N/A";let l=new Date(e);if(isNaN(l.getTime()))return"N/A";let o=l.toLocaleDateString("es-CL",{day:"2-digit",month:"2-digit",year:"numeric"}),d=l.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${o} ${d}`}getStatusColor(e){switch(e){case"PENDING":return"orange";case"SETTLED":return"green";default:return"gray"}}getOriginColor(e){switch(e){case"SESSION":return"blue";case"FINE":return"red";case"MANUAL":return"purple";default:return"gray"}}getOriginLabel(e){switch(e){case"SESSION":return"Sesi\xF3n";case"FINE":return"Multa";case"MANUAL":return"Manual";default:return e}}getPendingCount(){return this.debts.filter(e=>e.status==="PENDING").length}getSettledCount(){return this.debts.filter(e=>e.status==="SETTLED").length}getTotalPending(){return this.debts.filter(e=>e.status==="PENDING").reduce((e,l)=>e+l.principal_amount,0)}settleDebt(e){console.log("Settling debt:",e)}showDebtDetails(e){this.loading=!0,this.debtService.getDebt(e.id).pipe(w(this._unsubscribeAll)).subscribe({next:l=>{this.selectedDebt=l.data,this.showDetailsModal=!0,this.loading=!1},error:l=>{console.error("Error loading debt details:",l),this.loading=!1}})}closeDetailsModal(){this.showDetailsModal=!1,this.selectedDebt=null}printDebt(e){console.log("Printing debt:",e)}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadDebts()}applyFilters(){this.currentPage=0,this.loadDebts()}clearFilters(){this.filters={plate:"",origin:"",status:"",date_from:""},this.currentPage=0,this.loadDebts()}static{this.\u0275fac=function(l){return new(l||n)(B(ye))}}static{this.\u0275cmp=O({type:n,selectors:[["app-debts"]],viewQuery:function(l,o){if(l&1&&H(k,5),l&2){let d;$(d=R())&&(o.sort=d.first)}},features:[j([{provide:ze,useValue:Ye()}])],decls:113,vars:19,consts:[["picker",""],["menu","matMenu"],[1,"p-6","w-full"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"p-6"],[1,"flex","items-center"],[1,"p-3","bg-orange-100","rounded-full"],[1,"text-orange-600"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-orange-600"],[1,"p-3","bg-green-100","rounded-full"],[1,"text-green-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"p-3","bg-blue-100","rounded-full"],[1,"text-blue-600"],[1,"text-2xl","font-bold","text-blue-600"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],["appearance","outline"],["matInput","","placeholder","ABC123",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],["value","SESSION"],["value","FINE"],["value","MANUAL"],["value","PENDING"],["value","SETTLED"],["matInput","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[1,"flex","justify-end","gap-2","mt-4"],["mat-stroked-button","",1,"rounded-sm",3,"click"],["mat-raised-button","","color","primary",1,"rounded-sm",3,"click"],[1,"overflow-x-auto"],["mat-table","","matSort","",1,"w-full",3,"dataSource","matSortActive","matSortDirection"],["matColumnDef","plate"],["mat-header-cell","","mat-sort-header","plate",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","amount"],["mat-header-cell","","mat-sort-header","principal_amount",4,"matHeaderCellDef"],["matColumnDef","origin"],["mat-header-cell","","mat-sort-header","origin",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","status",4,"matHeaderCellDef"],["matColumnDef","created_at"],["mat-header-cell","","mat-sort-header","created_at",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","mt-4",3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page",4,"ngIf"],[3,"visibleChange","visible","debt"],["mat-header-cell","","mat-sort-header","plate"],["mat-cell",""],[1,"font-mono","font-semibold"],["mat-header-cell","","mat-sort-header","principal_amount"],[1,"font-semibold","text-red-600"],["mat-header-cell","","mat-sort-header","origin"],["mat-header-cell","","mat-sort-header","status"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],["mat-header-cell","","mat-sort-header","created_at"],["mat-header-cell",""],["mat-icon-button","",1,"rounded-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-header-row",""],["mat-row",""],[1,"flex","justify-center","items-center","py-8"],["diameter","40"],[1,"text-center","py-8"],[1,"text-gray-400","text-6xl"],[1,"text-lg","font-medium","text-gray-900","mt-4"],[1,"text-gray-500"],[1,"mt-4",3,"page","length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons"]],template:function(l,o){if(l&1){let d=E();i(0,"div",2)(1,"div",3)(2,"h1",4),a(3,"Deudas"),t(),i(4,"p",5),a(5,"Gestiona las deudas pendientes y liquidadas"),t()(),i(6,"div",6)(7,"mat-card")(8,"mat-card-content",7)(9,"div",8)(10,"div",9)(11,"mat-icon",10),a(12,"pending"),t()(),i(13,"div",11)(14,"p",12),a(15,"Pendientes"),t(),i(16,"p",13),a(17),t()()()()(),i(18,"mat-card")(19,"mat-card-content",7)(20,"div",8)(21,"div",14)(22,"mat-icon",15),a(23,"check_circle"),t()(),i(24,"div",11)(25,"p",12),a(26,"Liquidadas"),t(),i(27,"p",16),a(28),t()()()()(),i(29,"mat-card")(30,"mat-card-content",7)(31,"div",8)(32,"div",17)(33,"mat-icon",18),a(34,"account_balance_wallet"),t()(),i(35,"div",11)(36,"p",12),a(37,"Total Pendiente"),t(),i(38,"p",19),a(39),t()()()()()(),i(40,"mat-card",3)(41,"mat-card-content",7)(42,"div",20)(43,"mat-form-field",21)(44,"mat-label"),a(45,"Placa del veh\xEDculo"),t(),i(46,"input",22),v("ngModelChange",function(g){return _(d),M(o.filters.plate,g)||(o.filters.plate=g),f(g)}),t()(),i(47,"mat-form-field",21)(48,"mat-label"),a(49,"Origen"),t(),i(50,"mat-select",23),v("ngModelChange",function(g){return _(d),M(o.filters.origin,g)||(o.filters.origin=g),f(g)}),i(51,"mat-option",24),a(52,"Todos"),t(),i(53,"mat-option",25),a(54,"Sesi\xF3n"),t(),i(55,"mat-option",26),a(56,"Multa"),t(),i(57,"mat-option",27),a(58,"Manual"),t()()(),i(59,"mat-form-field",21)(60,"mat-label"),a(61,"Estado"),t(),i(62,"mat-select",23),v("ngModelChange",function(g){return _(d),M(o.filters.status,g)||(o.filters.status=g),f(g)}),i(63,"mat-option",24),a(64,"Todos"),t(),i(65,"mat-option",28),a(66,"Pendiente"),t(),i(67,"mat-option",29),a(68,"Liquidada"),t()()(),i(69,"mat-form-field",21)(70,"mat-label"),a(71,"Fecha desde"),t(),i(72,"input",30),v("ngModelChange",function(g){return _(d),M(o.filters.date_from,g)||(o.filters.date_from=g),f(g)}),t(),x(73,"mat-datepicker-toggle",31)(74,"mat-datepicker",null,0),t()(),i(76,"div",32)(77,"button",33),C("click",function(){return _(d),f(o.clearFilters())}),i(78,"mat-icon"),a(79,"clear"),t(),a(80," Limpiar "),t(),i(81,"button",34),C("click",function(){return _(d),f(o.applyFilters())}),i(82,"mat-icon"),a(83,"search"),t(),a(84," Filtrar "),t()()()(),i(85,"mat-card")(86,"mat-card-content",7)(87,"div",35)(88,"table",36),D(89,37),u(90,_t,2,0,"th",38)(91,ft,3,1,"td",39),S(),D(92,40),u(93,bt,2,0,"th",41)(94,Ct,3,1,"td",39),S(),D(95,42),u(96,xt,2,0,"th",43)(97,ht,4,3,"td",39),S(),D(98,44),u(99,Mt,2,0,"th",45)(100,vt,3,3,"td",39),S(),D(101,46),u(102,Dt,2,0,"th",47)(103,St,2,1,"td",39),S(),D(104,48),u(105,Et,2,0,"th",49)(106,Pt,15,2,"td",39),S(),u(107,wt,1,0,"tr",50)(108,Ot,1,0,"tr",51),t(),u(109,It,2,0,"div",52)(110,Tt,7,0,"div",53),t(),u(111,kt,1,5,"mat-paginator",54),t()(),i(112,"app-debt-details-modal",55),v("visibleChange",function(g){return _(d),M(o.showDetailsModal,g)||(o.showDetailsModal=g),f(g)}),C("visibleChange",function(){return _(d),f(o.closeDetailsModal())}),t()()}if(l&2){let d=L(75);r(17),p(o.getPendingCount()),r(11),p(o.getSettledCount()),r(11),p(o.formatAmount(o.getTotalPending())),r(7),h("ngModel",o.filters.plate),r(4),h("ngModel",o.filters.origin),r(12),h("ngModel",o.filters.status),r(10),m("matDatepicker",d),h("ngModel",o.filters.date_from),r(),m("for",d),r(15),m("dataSource",o.debts)("matSortActive",o.sortBy)("matSortDirection",o.sortOrder),r(19),m("matHeaderRowDef",o.displayedColumns),r(),m("matRowDefColumns",o.displayedColumns),r(),m("ngIf",o.loading),r(),m("ngIf",!o.loading&&o.debts.length===0),r(),m("ngIf",o.totalItems>0),r(),h("visible",o.showDetailsModal),m("debt",o.selectedDebt)}},dependencies:[T,I,me,le,se,de,Ve,Pe,Oe,Le,Ie,we,Ne,Te,ke,Ae,Fe,Qe,Ge,Ue,ee,X,Z,ie,te,ue,ge,Je,K,J,Q,Y,pe,ce,De,he,Me,ve,Ee,Se,U,re,ae,ne,oe,qe,Re,je,We,Be,$e,k,He,Ke],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151}.mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid #f3f4f6}.status-pending[_ngcontent-%COMP%]{background-color:#fed7aa;color:#9a3412}.status-settled[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.origin-session[_ngcontent-%COMP%]{background-color:#dbeafe;color:#1e40af}.origin-fine[_ngcontent-%COMP%]{background-color:#fee2e2;color:#dc2626}.origin-manual[_ngcontent-%COMP%]{background-color:#e9d5ff;color:#7c3aed}.mat-mdc-chip[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500}@media (max-width: 768px){.grid-cols-3[_ngcontent-%COMP%], .grid-cols-4[_ngcontent-%COMP%]{grid-template-columns:1fr}.mat-mdc-table[_ngcontent-%COMP%]{font-size:.875rem}}"]})}}return n})();export{Ei as DebtsComponent};
