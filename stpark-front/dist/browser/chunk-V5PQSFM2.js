import{a as be}from"./chunk-HQDJMMZR.js";import{a as de,b as ce,c as ue}from"./chunk-IAB63KK4.js";import{a as pe,b as ge,c as fe,d as _e,e as xe,f as Ee}from"./chunk-NB6DWIHZ.js";import{d as me}from"./chunk-6DX2DSMH.js";import{a as le,b as se}from"./chunk-YOYZ3SXE.js";import{a as te,b as re}from"./chunk-BFKOMUGM.js";import{a as ie,b as ae}from"./chunk-MVJB4HTB.js";import"./chunk-RRHSJPSV.js";import"./chunk-QT3W5JSU.js";import{a as f}from"./chunk-VKB6BRO6.js";import{a as ne,b as oe}from"./chunk-M6EHWIYJ.js";import{b as O,c as z}from"./chunk-7EGXZGVT.js";import{d as Y,e as ee}from"./chunk-7QQT45KE.js";import{b as G,c as w,d as B,j as L,k as V}from"./chunk-DO3SX6N4.js";import{b as H,d as s,f as j,g as R,k as $,l as Z,n as J,o as K,s as Q,v as W,y as X}from"./chunk-EGGCURRC.js";import{W as N,fa as D,la as U,oa as A}from"./chunk-AHUY5V3P.js";import"./chunk-CQGOYTFO.js";import{d as q}from"./chunk-7OGW3PNS.js";import{m as I,s as P}from"./chunk-TQARHOKX.js";import{$b as x,Eb as l,Pb as r,Qb as e,Rb as p,bb as m,cb as g,mc as t,pb as k,wb as u}from"./chunk-BSJZAB7M.js";import{a as _,d as T}from"./chunk-TSRGIXR5.js";function Se(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function he(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function ve(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ce(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Me(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function ye(a,d){a&1&&(r(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function Fe(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Te(a,d){a&1&&(r(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}function ke(a,d){a&1&&(r(0,"mat-error"),t(1," Este campo es requerido "),e())}function Ie(a,d){a&1&&(r(0,"mat-error"),t(1," El valor debe ser mayor o igual a 0 "),e())}var mt=(()=>{class a{constructor(i,o,n,c){this.fb=i,this.pricingProfileService=o,this.http=n,this.snackBar=c,this.loading=!1,this.generalForm=this.fb.group({name:["STPark - Sistema de Estacionamientos",[s.required]],currency:["CLP",[s.required]],timezone:["America/Santiago",[s.required]],language:["es",[s.required]],pos_tuu:[{value:!1,disabled:!0}]}),this.pricingForm=this.fb.group({price_per_min:[0,[s.required,s.min(0)]],min_amount:[0,[s.required,s.min(0)]],daily_max_amount:[0,[s.required,s.min(0)]],start_time:["00:00",s.required],end_time:["23:59",s.required],is_active:[!0]})}ngOnInit(){this.loadGeneralSettings(),this.loadDefaultPricing()}loadGeneralSettings(){this.loading=!0,this.http.get(`${f.apiUrl}/settings/general`).subscribe({next:i=>{if(i&&i.success&&i.data){console.log("Configuraci\xF3n general cargada:",i.data);let o=this.generalForm.getRawValue();this.generalForm.patchValue(_(_({},o),i.data))}else console.warn("La respuesta no tiene el formato esperado:",i);this.loading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n general:",i),console.log("No hay configuraci\xF3n general previa, usando valores por defecto"),this.loading=!1}})}loadDefaultPricing(){this.loading=!0,this.http.get(`${f.apiUrl}/settings/default-pricing`).subscribe({next:i=>{i&&i.success&&i.data?(console.log("Configuraci\xF3n de precios cargada:",i.data),this.pricingForm.patchValue(i.data)):console.warn("La respuesta no tiene el formato esperado:",i),this.loading=!1},error:i=>{console.error("Error al cargar configuraci\xF3n de precios:",i),console.log("No hay configuraci\xF3n previa, usando valores por defecto"),this.loading=!1}})}saveSettings(){let i=this.getActiveTab();i==="general"?this.saveGeneralSettings():i==="pricing"&&this.savePricingSettings()}getActiveTab(){let i=document.querySelector("mat-tab-group");if(i){let o=i.querySelector(".mat-mdc-tab-active");if(o){let n=o.querySelector(".mdc-tab__text-label");if(n?.textContent?.toLowerCase().includes("general"))return"general";if(n?.textContent?.toLowerCase().includes("precios"))return"pricing"}}return"general"}saveGeneralSettings(){if(this.generalForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let n=this.generalForm.getRawValue(),{pos_tuu:i}=n,o=T(n,["pos_tuu"]);this.http.post(`${f.apiUrl}/settings/general`,o).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n general guardada exitosamente","Cerrar",{duration:3e3}),this.loading=!1},error:c=>{console.error("Error al guardar configuraci\xF3n general:",c),this.snackBar.open("Error al guardar la configuraci\xF3n general","Cerrar",{duration:3e3}),this.loading=!1}})}savePricingSettings(){if(this.pricingForm.invalid){this.snackBar.open("Por favor completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.loading=!0;let i=this.pricingForm.value;this.http.post(`${f.apiUrl}/settings/default-pricing`,i).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n de precios guardada exitosamente","Cerrar",{duration:3e3}),this.loading=!1},error:o=>{console.error("Error al guardar configuraci\xF3n de precios:",o),this.snackBar.open("Error al guardar la configuraci\xF3n de precios","Cerrar",{duration:3e3}),this.loading=!1}})}resetSettings(){this.generalForm.reset({name:"STPark - Sistema de Estacionamientos",currency:"CLP",timezone:"America/Santiago",language:"es",pos_tuu:!1}),this.pricingForm.reset({price_per_min:0,min_amount:0,daily_max_amount:0,start_time:"00:00",end_time:"23:59",is_active:!0}),this.snackBar.open("Valores restaurados","Cerrar",{duration:2e3})}static{this.\u0275fac=function(o){return new(o||a)(g(W),g(be),g(q),g(ie))}}static{this.\u0275cmp=k({type:a,selectors:[["app-settings"]],decls:132,vars:14,consts:[[1,"p-6","w-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"flex","gap-2"],["mat-stroked-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"w-full"],["label","General"],[1,"p-6"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Nombre del sistema"],[4,"ngIf"],["formControlName","currency"],["value","CLP"],["value","USD"],["formControlName","timezone"],["value","America/Santiago"],["value","UTC"],["formControlName","language"],["value","es"],["value","en"],["formControlName","pos_tuu","disabled",""],[3,"value"],[2,"display","inline-flex","align-items","center","gap","4px"],[2,"font-size","16px","width","16px","height","16px"],["label","Precios"],[1,"space-y-4"],[1,"bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-800","rounded-lg","p-4"],[1,"flex","items-start","gap-3"],[1,"text-blue-600","dark:text-blue-400"],[1,"text-sm","text-blue-800","dark:text-blue-200"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["matInput","","type","number","formControlName","price_per_min","placeholder","0","min","0"],["matInput","","type","number","formControlName","min_amount","placeholder","0","min","0"],["matInput","","type","number","formControlName","daily_max_amount","placeholder","0","min","0"],[1,"my-6"],[1,"text-lg","font-semibold","mb-4"],["matInput","","type","time","formControlName","start_time"],["matInput","","type","time","formControlName","end_time"],[1,"flex","items-center","gap-2","mb-4"],["formControlName","is_active"]],template:function(o,n){if(o&1&&(r(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),t(4,"Configuraci\xF3n"),e(),r(5,"p",3),t(6,"Configura los par\xE1metros del sistema de estacionamientos"),e()(),r(7,"div",4)(8,"button",5),x("click",function(){return n.resetSettings()}),r(9,"mat-icon"),t(10,"refresh"),e(),t(11," Restaurar "),e(),r(12,"button",6),x("click",function(){return n.saveSettings()}),r(13,"mat-icon"),t(14,"save"),e(),t(15," Guardar "),e()()(),r(16,"mat-tab-group",7)(17,"mat-tab",8)(18,"div",9)(19,"mat-card")(20,"mat-card-header")(21,"mat-card-title"),t(22,"Configuraci\xF3n General"),e(),r(23,"mat-card-subtitle"),t(24,"Par\xE1metros b\xE1sicos del sistema"),e()(),r(25,"mat-card-content")(26,"form",10)(27,"div",11)(28,"mat-form-field",12)(29,"mat-label"),t(30,"Nombre del sistema"),e(),p(31,"input",13),u(32,Se,2,0,"mat-error",14),e(),r(33,"mat-form-field",12)(34,"mat-label"),t(35,"Moneda"),e(),r(36,"mat-select",15)(37,"mat-option",16),t(38,"Peso Chileno (CLP)"),e(),r(39,"mat-option",17),t(40,"D\xF3lar Americano (USD)"),e()(),u(41,he,2,0,"mat-error",14),e(),r(42,"mat-form-field",12)(43,"mat-label"),t(44,"Zona horaria"),e(),r(45,"mat-select",18)(46,"mat-option",19),t(47,"Santiago (GMT-3)"),e(),r(48,"mat-option",20),t(49,"UTC (GMT+0)"),e()(),u(50,ve,2,0,"mat-error",14),e(),r(51,"mat-form-field",12)(52,"mat-label"),t(53,"Idioma"),e(),r(54,"mat-select",21)(55,"mat-option",22),t(56,"Espa\xF1ol"),e(),r(57,"mat-option",23),t(58,"English"),e()(),u(59,Ce,2,0,"mat-error",14),e(),r(60,"mat-form-field",12)(61,"mat-label"),t(62,"POS TUU"),e(),r(63,"mat-select",24)(64,"mat-option",25),t(65,"Activado"),e(),r(66,"mat-option",25),t(67,"Desactivado"),e()(),r(68,"mat-hint")(69,"span",26)(70,"mat-icon",27),t(71,"lock"),e(),t(72," Solo lectura - Solo administradores pueden modificar este valor "),e()()()()()()()()(),r(73,"mat-tab",28)(74,"div",9)(75,"mat-card")(76,"mat-card-header")(77,"mat-card-title"),t(78,"Configuraci\xF3n de Precios por Defecto"),e(),r(79,"mat-card-subtitle"),t(80,"Establece las tarifas por defecto del sistema"),e()(),r(81,"mat-card-content")(82,"div",29)(83,"div",30)(84,"div",31)(85,"mat-icon",32),t(86,"info"),e(),r(87,"div",33)(88,"strong"),t(89,"Nota:"),e(),t(90," Estos precios se utilizar\xE1n como regla de precio por defecto si no existen otras reglas espec\xEDficas para el sector. "),e()()(),r(91,"form",10)(92,"div",34)(93,"mat-form-field",12)(94,"mat-label"),t(95,"Costo por Minuto (CLP)"),e(),p(96,"input",35),r(97,"mat-hint"),t(98,"Precio por cada minuto de estacionamiento"),e(),u(99,Me,2,0,"mat-error",14)(100,ye,2,0,"mat-error",14),e(),r(101,"mat-form-field",12)(102,"mat-label"),t(103,"Tarifa M\xEDnima (CLP)"),e(),p(104,"input",36),r(105,"mat-hint"),t(106,"Cantidad m\xEDnima a cobrar"),e(),u(107,Fe,2,0,"mat-error",14)(108,Te,2,0,"mat-error",14),e(),r(109,"mat-form-field",12)(110,"mat-label"),t(111,"Tarifa M\xE1xima (CLP)"),e(),p(112,"input",37),r(113,"mat-hint"),t(114,"L\xEDmite m\xE1ximo a cobrar por d\xEDa"),e(),u(115,ke,2,0,"mat-error",14)(116,Ie,2,0,"mat-error",14),e()(),p(117,"mat-divider",38),r(118,"h3",39),t(119,"Configuraci\xF3n de Horarios"),e(),r(120,"div",11)(121,"mat-form-field",12)(122,"mat-label"),t(123,"Hora de Inicio"),e(),p(124,"input",40),e(),r(125,"mat-form-field",12)(126,"mat-label"),t(127,"Hora de Fin"),e(),p(128,"input",41),e()(),r(129,"div",42)(130,"mat-checkbox",43),t(131,"Regla activa"),e()()()()()()()()()()),o&2){let c,E,b,S,h,v,C,M,y,F;m(26),l("formGroup",n.generalForm),m(6),l("ngIf",(c=n.generalForm.get("name"))==null?null:c.hasError("required")),m(9),l("ngIf",(E=n.generalForm.get("currency"))==null?null:E.hasError("required")),m(9),l("ngIf",(b=n.generalForm.get("timezone"))==null?null:b.hasError("required")),m(9),l("ngIf",(S=n.generalForm.get("language"))==null?null:S.hasError("required")),m(5),l("value",!0),m(2),l("value",!1),m(25),l("formGroup",n.pricingForm),m(8),l("ngIf",(h=n.pricingForm.get("price_per_min"))==null?null:h.hasError("required")),m(),l("ngIf",(v=n.pricingForm.get("price_per_min"))==null?null:v.hasError("min")),m(7),l("ngIf",(C=n.pricingForm.get("min_amount"))==null?null:C.hasError("required")),m(),l("ngIf",(M=n.pricingForm.get("min_amount"))==null?null:M.hasError("min")),m(7),l("ngIf",(y=n.pricingForm.get("daily_max_amount"))==null?null:y.hasError("required")),m(),l("ngIf",(F=n.pricingForm.get("daily_max_amount"))==null?null:F.hasError("min"))}},dependencies:[P,I,X,$,H,Z,j,R,Q,J,K,Ee,pe,fe,xe,_e,ge,A,U,z,O,ue,de,ce,V,L,G,B,w,ee,Y,se,le,D,oe,ne,re,te,N,me,ae],styles:[".mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-tab-group[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.config-item[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:8px;padding:1rem;transition:all .2s ease}.config-item[_ngcontent-%COMP%]:hover{border-color:#3b82f6;box-shadow:0 2px 4px #0000001a}@media (max-width: 768px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return a})();export{mt as SettingsComponent};
