<div class="p-6">
  <div class="flex items-start justify-between mb-4">
    <div>
      <h2 class="text-xl font-bold text-gray-900">Tipos de Lavado</h2>
      <p class="text-gray-600">Administra nombre, precio y duración de los lavados</p>
    </div>
    <button mat-icon-button (click)="close()" aria-label="Cerrar">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Form -->
    <div class="bg-white rounded border border-gray-200 p-4">
      <div class="flex items-center justify-between mb-3">
        <h3 class="font-semibold text-gray-900">{{ editingType ? 'Editar tipo' : 'Nuevo tipo' }}</h3>
        <button mat-stroked-button class="rounded-sm" (click)="startCreate()">
          <mat-icon>add</mat-icon>
          Nuevo
        </button>
      </div>

      <form [formGroup]="typeForm" class="grid grid-cols-1 gap-4">
        <mat-form-field appearance="outline">
          <mat-label>Nombre lavado</mat-label>
          <input matInput formControlName="name" placeholder="Ej: Lavado completo" />
          <mat-error *ngIf="typeForm.get('name')?.hasError('required')">Nombre es obligatorio</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Precio lavado (CLP)</mat-label>
          <input matInput type="number" formControlName="price" placeholder="Ej: 5000" />
          <mat-error *ngIf="typeForm.get('price')?.hasError('required')">Precio es obligatorio</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Duración (min)</mat-label>
          <input matInput type="number" formControlName="duration_minutes" placeholder="Ej: 30" />
        </mat-form-field>

        <div class="flex gap-2 justify-end">
          <button mat-stroked-button class="rounded-sm" (click)="startCreate()" type="button">
            Cancelar
          </button>
          <button mat-raised-button color="primary" class="rounded-sm" (click)="save()" type="button" [disabled]="saving">
            <mat-icon *ngIf="!saving">save</mat-icon>
            <mat-spinner *ngIf="saving" diameter="18"></mat-spinner>
            Guardar
          </button>
        </div>
      </form>
    </div>

    <!-- List -->
    <div class="bg-white rounded border border-gray-200 p-4">
      <h3 class="font-semibold text-gray-900 mb-3">Listado</h3>

      <div class="text-center py-8" *ngIf="loading">
        <mat-spinner diameter="40" class="mx-auto"></mat-spinner>
        <p class="mt-3 text-gray-600">Cargando tipos...</p>
      </div>

      <div class="overflow-x-auto" *ngIf="!loading">
        <table mat-table [dataSource]="washTypes" class="w-full">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Nombre</th>
            <td mat-cell *matCellDef="let t" class="font-medium">{{ t.name }}</td>
          </ng-container>

          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef>Precio</th>
            <td mat-cell *matCellDef="let t">{{ formatAmount(t.price) }}</td>
          </ng-container>

          <ng-container matColumnDef="duration">
            <th mat-header-cell *matHeaderCellDef>Duración</th>
            <td mat-cell *matCellDef="let t">{{ t.duration_minutes ? (t.duration_minutes + ' min') : '—' }}</td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="text-right">Acciones</th>
            <td mat-cell *matCellDef="let t" class="text-right">
              <button mat-icon-button (click)="startEdit(t)" aria-label="Editar">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="delete(t)" aria-label="Eliminar">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>

        <div class="py-6 text-center text-gray-600" *ngIf="washTypes.length === 0">
          No hay tipos creados todavía.
        </div>
      </div>
    </div>
  </div>

  <div class="flex justify-end mt-6">
    <button mat-stroked-button class="rounded-sm" (click)="close()">Cerrar</button>
  </div>
</div>


