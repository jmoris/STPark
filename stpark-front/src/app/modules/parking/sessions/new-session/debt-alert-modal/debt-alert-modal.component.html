<p-dialog 
    header="⚠️ DEUDAS PENDIENTES DETECTADAS" 
    [(visible)]="visible" 
    [modal]="true" 
    [style]="{width: '50rem'}"
    [breakpoints]="{'1199px': '70vw', '575px': '90vw'}"
    [draggable]="false" 
    [resizable]="false"
    [closable]="false"
    [closeOnEscape]="false"
    (visibleChange)="visibleChange.emit($event)">
    
    <div class="debt-alert-content">
        <!-- Header con información de la patente -->
        <div class="alert-header">
            <div class="plate-info">
                <i class="pi pi-car plate-icon"></i>
                <span class="plate-text">{{ plate }}</span>
            </div>
            <div class="alert-message">
                <p class="alert-title">Esta patente tiene deudas pendientes</p>
                <p class="alert-subtitle">Se encontraron {{ debts.length }} deuda{{ debts.length > 1 ? 's' : '' }} pendiente{{ debts.length > 1 ? 's' : '' }} por un total de <strong>{{ formatAmount(getTotalDebtAmount()) }}</strong></p>
            </div>
        </div>

        <!-- Lista de deudas -->
        <div class="debts-list">
            <h4>Deudas Pendientes:</h4>
            <div class="debt-items">
                <div *ngFor="let debt of debts" class="debt-item">
                    <div class="debt-info">
                        <div class="debt-header">
                            <div class="debt-origin">
                                <i [class]="getOriginIcon(debt.origin)" class="origin-icon"></i>
                                <span>{{ getOriginText(debt.origin) }}</span>
                            </div>
                            <div class="debt-amount">{{ formatAmount(debt.principal_amount) }}</div>
                        </div>
                        <div class="debt-details">
                            <span class="debt-id">ID: {{ debt.id }}</span>
                            <span class="debt-age">{{ getDebtAge(debt) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recomendación -->
        <div class="recommendation">
            <div class="recommendation-content">
                <i class="pi pi-info-circle recommendation-icon"></i>
                <div class="recommendation-text">
                    <p><strong>Recomendación:</strong> Te sugerimos liquidar las deudas pendientes antes de iniciar una nueva sesión para evitar acumulación de intereses.</p>
                </div>
            </div>
        </div>

        <!-- Opciones de acción -->
        <div class="action-options">
            <div class="option-card pay-option">
                <div class="option-header">
                    <i class="pi pi-credit-card option-icon"></i>
                    <h5>Liquidar Deudas</h5>
                </div>
                <p class="option-description">Pagar todas las deudas pendientes antes de iniciar la nueva sesión.</p>
                <div class="option-total">
                    Total a pagar: <strong>{{ formatAmount(getTotalDebtAmount()) }}</strong>
                </div>
            </div>
            
            <div class="option-card continue-option">
                <div class="option-header">
                    <i class="pi pi-play option-icon"></i>
                    <h5>Continuar Sin Pagar</h5>
                </div>
                <p class="option-description">Iniciar la nueva sesión sin liquidar las deudas pendientes.</p>
                <div class="option-warning">
                    ⚠️ Las deudas seguirán pendientes
                </div>
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <div class="flex justify-between w-full">
            <button pButton 
                    type="button" 
                    label="Cancelar" 
                    icon="pi pi-times" 
                    class="p-button-text"
                    (click)="closeModal()">
            </button>
            <div class="flex gap-2">
                <button pButton 
                        type="button" 
                        label="Continuar Sin Pagar" 
                        icon="pi pi-play" 
                        class="p-button-outlined p-button-warning"
                        (click)="onContinueWithoutPayment()">
                </button>
                <button pButton 
                        type="button" 
                        label="Liquidar Deudas" 
                        icon="pi pi-credit-card" 
                        class="p-button-success"
                        (click)="onPayDebts()">
                </button>
            </div>
        </div>
    </ng-template>
</p-dialog>
