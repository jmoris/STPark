<div class="street-form-dialog">
  <!-- Header -->
  <div class="dialog-header">
    <h2 class="dialog-title">
      {{ data.isEdit ? 'Editar Calle/Dirección' : 'Nueva Calle/Dirección' }}
    </h2>
    <button mat-icon-button class="close-button" (click)="onCancel()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Content -->
  <div class="dialog-content">
    <form [formGroup]="streetForm" class="street-form">
      <!-- Sector Selection -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Sector *</mat-label>
          <mat-select formControlName="sector_id" (selectionChange)="onSectorChange($event.value)">
            <mat-option *ngFor="let sector of sectors" [value]="sector.id">
              {{ sector.name }} 
              <span class="text-gray-500">({{ getSectorTypeText(sector) }})</span>
            </mat-option>
          </mat-select>
          <mat-error *ngIf="streetForm.get('sector_id')?.hasError('required')">
            {{ getErrorMessage('sector_id') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Sector Type Info -->
      <div *ngIf="selectedSector" class="mb-4 p-3 rounded-lg"
           [class]="'bg-' + getSectorTypeColor(selectedSector) + '-50 border border-' + getSectorTypeColor(selectedSector) + '-200'">
        <div class="flex items-center gap-2">
          <mat-icon [class]="'text-' + getSectorTypeColor(selectedSector) + '-600'">
            {{ selectedSector.is_private ? 'lock' : 'public' }}
          </mat-icon>
          <span class="font-medium" [class]="'text-' + getSectorTypeColor(selectedSector) + '-800'">
            Sector {{ getSectorTypeText(selectedSector) }}
          </span>
        </div>
        <p class="text-sm mt-1" [class]="'text-' + getSectorTypeColor(selectedSector) + '-700'">
          <span *ngIf="selectedSector.is_private">
            Los sectores privados manejan direcciones específicas (ej: Av. Principal 123)
          </span>
          <span *ngIf="!selectedSector.is_private">
            Los sectores públicos manejan calles completas o rangos de cuadras
          </span>
        </p>
      </div>

      <!-- Address Type Selection -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Tipo de Dirección</mat-label>
          <mat-select formControlName="address_type" (selectionChange)="onAddressTypeChange()">
            <mat-option value="STREET">Calle Completa</mat-option>
            <mat-option value="ADDRESS">Dirección Específica</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="half-width flex items-center">
          <mat-checkbox formControlName="is_specific_address" (change)="onAddressTypeChange()">
            Es dirección específica
          </mat-checkbox>
        </div>
      </div>

      <!-- Street/Address Name -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ streetForm.get('is_specific_address')?.value ? 'Nombre de la Calle' : 'Nombre de la Calle' }} *</mat-label>
          <input matInput formControlName="name" 
                 [placeholder]="streetForm.get('is_specific_address')?.value ? 'Ej: Avenida Principal' : 'Ej: Calle Central'">
          <mat-error *ngIf="streetForm.get('name')?.hasError('required')">
            {{ getErrorMessage('name') }}
          </mat-error>
          <mat-error *ngIf="streetForm.get('name')?.hasError('minlength')">
            {{ getErrorMessage('name') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Address Number (for specific addresses) -->
      <div class="form-row" *ngIf="streetForm.get('is_specific_address')?.value">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Número de Dirección</mat-label>
          <input matInput formControlName="address_number" placeholder="Ej: 123">
        </mat-form-field>
      </div>

      <!-- Block Range (for full streets) -->
      <div class="form-row" *ngIf="!streetForm.get('is_specific_address')?.value">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Rango de Cuadras (Opcional)</mat-label>
          <input matInput formControlName="block_range" placeholder="Ej: 100-200">
        </mat-form-field>
      </div>

      <!-- Notes -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Notas</mat-label>
          <textarea matInput formControlName="notes" rows="3" placeholder="Información adicional sobre esta calle/dirección"></textarea>
        </mat-form-field>
      </div>

      <!-- Preview -->
      <div *ngIf="streetForm.get('name')?.value" class="mt-4 p-3 bg-gray-50 rounded-lg">
        <h4 class="font-medium text-gray-700 mb-2">Vista Previa:</h4>
        <div class="flex items-center gap-2">
          <mat-icon class="text-gray-500">road</mat-icon>
          <span class="font-semibold">
            <span *ngIf="streetForm.get('is_specific_address')?.value && streetForm.get('address_number')?.value">
              {{ streetForm.get('name')?.value }} {{ streetForm.get('address_number')?.value }}
            </span>
            <span *ngIf="streetForm.get('is_specific_address')?.value && !streetForm.get('address_number')?.value">
              {{ streetForm.get('name')?.value }} [Número]
            </span>
            <span *ngIf="!streetForm.get('is_specific_address')?.value && streetForm.get('block_range')?.value">
              {{ streetForm.get('name')?.value }} (Cuadras {{ streetForm.get('block_range')?.value }})
            </span>
            <span *ngIf="!streetForm.get('is_specific_address')?.value && !streetForm.get('block_range')?.value">
              {{ streetForm.get('name')?.value }}
            </span>
          </span>
        </div>
      </div>
    </form>
  </div>

  <!-- Actions -->
  <div class="dialog-actions">
    <button mat-button class="rounded-sm" (click)="onCancel()" [disabled]="loading">
      Cancelar
    </button>
    <button mat-raised-button color="primary" class="rounded-sm" (click)="onSubmit()" [disabled]="loading || streetForm.invalid">
      <mat-spinner *ngIf="loading" diameter="20" class="inline-spinner"></mat-spinner>
      <mat-icon *ngIf="!loading">{{ data.isEdit ? 'save' : 'add' }}</mat-icon>
      {{ data.isEdit ? 'Actualizar' : 'Crear' }}
    </button>
  </div>
</div>
